export default "OyhmdW5jdGlvbigpIHsKICAvKgogaHR0cHM6Ly9tdGhzLmJlL2Zyb21jb2RlcG9pbnQgdjAuMi4xIGJ5IEBtYXRoaWFzICovCiAgInVzZSBzdHJpY3QiCiAgdmFyICRqc2NvbXAgPSAkanNjb21wIHx8IHt9CiAgJGpzY29tcC5zY29wZSA9IHt9CiAgJGpzY29tcC5hcnJheUl0ZXJhdG9ySW1wbCA9IGZ1bmN0aW9uKG0pIHsKICAgIHZhciBwID0gMAogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcCA8IG0ubGVuZ3RoID8geyBkb25lOiAhMSwgdmFsdWU6IG1bcCsrXSB9IDogeyBkb25lOiAhMCB9CiAgICB9CiAgfQogICRqc2NvbXAuYXJyYXlJdGVyYXRvciA9IGZ1bmN0aW9uKG0pIHsKICAgIHJldHVybiB7IG5leHQ6ICRqc2NvbXAuYXJyYXlJdGVyYXRvckltcGwobSkgfQogIH0KICAkanNjb21wLkFTU1VNRV9FUzUgPSAhMQogICRqc2NvbXAuQVNTVU1FX05PX05BVElWRV9NQVAgPSAhMQogICRqc2NvbXAuQVNTVU1FX05PX05BVElWRV9TRVQgPSAhMQogICRqc2NvbXAuU0lNUExFX0ZST1VORF9QT0xZRklMTCA9ICExCiAgJGpzY29tcC5kZWZpbmVQcm9wZXJ0eSA9CiAgICAkanNjb21wLkFTU1VNRV9FUzUgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMKICAgICAgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkKICAgICAgOiBmdW5jdGlvbihtLCBwLCBhKSB7CiAgICAgICAgICBtICE9IEFycmF5LnByb3RvdHlwZSAmJiBtICE9IE9iamVjdC5wcm90b3R5cGUgJiYgKG1bcF0gPSBhLnZhbHVlKQogICAgICAgIH0KICAkanNjb21wLmdldEdsb2JhbCA9IGZ1bmN0aW9uKG0pIHsKICAgIHJldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ICYmIHdpbmRvdyA9PT0gbQogICAgICA/IG0KICAgICAgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsICYmIG51bGwgIT0gZ2xvYmFsCiAgICAgID8gZ2xvYmFsCiAgICAgIDogbQogIH0KICAkanNjb21wLmdsb2JhbCA9ICRqc2NvbXAuZ2V0R2xvYmFsKHRoaXMpCiAgJGpzY29tcC5TWU1CT0xfUFJFRklYID0gImpzY29tcF9zeW1ib2xfIgogICRqc2NvbXAuaW5pdFN5bWJvbCA9IGZ1bmN0aW9uKCkgewogICAgJGpzY29tcC5pbml0U3ltYm9sID0gZnVuY3Rpb24oKSB7fQogICAgJGpzY29tcC5nbG9iYWwuU3ltYm9sIHx8ICgkanNjb21wLmdsb2JhbC5TeW1ib2wgPSAkanNjb21wLlN5bWJvbCkKICB9CiAgJGpzY29tcC5TeW1ib2xDbGFzcyA9IGZ1bmN0aW9uKG0sIHApIHsKICAgIHRoaXMuJGpzY29tcCRzeW1ib2wkaWRfID0gbQogICAgJGpzY29tcC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZGVzY3JpcHRpb24iLCB7CiAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgIHdyaXRhYmxlOiAhMCwKICAgICAgdmFsdWU6IHAsCiAgICB9KQogIH0KICAkanNjb21wLlN5bWJvbENsYXNzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuJGpzY29tcCRzeW1ib2wkaWRfCiAgfQogICRqc2NvbXAuU3ltYm9sID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gbShhKSB7CiAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgbSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yIikKICAgICAgcmV0dXJuIG5ldyAkanNjb21wLlN5bWJvbENsYXNzKAogICAgICAgICRqc2NvbXAuU1lNQk9MX1BSRUZJWCArIChhIHx8ICIiKSArICJfIiArIHArKywKICAgICAgICBhLAogICAgICApCiAgICB9CiAgICB2YXIgcCA9IDAKICAgIHJldHVybiBtCiAgfSkoKQogICRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yID0gZnVuY3Rpb24oKSB7CiAgICAkanNjb21wLmluaXRTeW1ib2woKQogICAgdmFyIG0gPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3IKICAgIG0gfHwKICAgICAgKG0gPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3IgPSAkanNjb21wLmdsb2JhbC5TeW1ib2woCiAgICAgICAgIlN5bWJvbC5pdGVyYXRvciIsCiAgICAgICkpCiAgICAiZnVuY3Rpb24iICE9IHR5cGVvZiBBcnJheS5wcm90b3R5cGVbbV0gJiYKICAgICAgJGpzY29tcC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIG0sIHsKICAgICAgICBjb25maWd1cmFibGU6ICEwLAogICAgICAgIHdyaXRhYmxlOiAhMCwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJGpzY29tcC5pdGVyYXRvclByb3RvdHlwZSgkanNjb21wLmFycmF5SXRlcmF0b3JJbXBsKHRoaXMpKQogICAgICAgIH0sCiAgICAgIH0pCiAgICAkanNjb21wLmluaXRTeW1ib2xJdGVyYXRvciA9IGZ1bmN0aW9uKCkge30KICB9CiAgJGpzY29tcC5pbml0U3ltYm9sQXN5bmNJdGVyYXRvciA9IGZ1bmN0aW9uKCkgewogICAgJGpzY29tcC5pbml0U3ltYm9sKCkKICAgIHZhciBtID0gJGpzY29tcC5nbG9iYWwuU3ltYm9sLmFzeW5jSXRlcmF0b3IKICAgIG0gfHwKICAgICAgKG0gPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuYXN5bmNJdGVyYXRvciA9ICRqc2NvbXAuZ2xvYmFsLlN5bWJvbCgKICAgICAgICAiU3ltYm9sLmFzeW5jSXRlcmF0b3IiLAogICAgICApKQogICAgJGpzY29tcC5pbml0U3ltYm9sQXN5bmNJdGVyYXRvciA9IGZ1bmN0aW9uKCkge30KICB9CiAgJGpzY29tcC5pdGVyYXRvclByb3RvdHlwZSA9IGZ1bmN0aW9uKG0pIHsKICAgICRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yKCkKICAgIG0gPSB7IG5leHQ6IG0gfQogICAgbVskanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzCiAgICB9CiAgICByZXR1cm4gbQogIH0KICAkanNjb21wLml0ZXJhdG9yRnJvbUFycmF5ID0gZnVuY3Rpb24obSwgcCkgewogICAgJGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IoKQogICAgbSBpbnN0YW5jZW9mIFN0cmluZyAmJiAobSArPSAiIikKICAgIHZhciBhID0gMCwKICAgICAgYiA9IHsKICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChhIDwgbS5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGMgPSBhKysKICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHAoYywgbVtjXSksIGRvbmU6ICExIH0KICAgICAgICAgIH0KICAgICAgICAgIGIubmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4geyBkb25lOiAhMCwgdmFsdWU6IHZvaWQgMCB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYi5uZXh0KCkKICAgICAgICB9LAogICAgICB9CiAgICBiW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGIKICAgIH0KICAgIHJldHVybiBiCiAgfQogICRqc2NvbXAucG9seWZpbGwgPSBmdW5jdGlvbihtLCBwLCBhLCBiKSB7CiAgICBpZiAocCkgewogICAgICBhID0gJGpzY29tcC5nbG9iYWwKICAgICAgbSA9IG0uc3BsaXQoIi4iKQogICAgICBmb3IgKGIgPSAwOyBiIDwgbS5sZW5ndGggLSAxOyBiKyspIHsKICAgICAgICB2YXIgYyA9IG1bYl0KICAgICAgICBjIGluIGEgfHwgKGFbY10gPSB7fSkKICAgICAgICBhID0gYVtjXQogICAgICB9CiAgICAgIG0gPSBtW20ubGVuZ3RoIC0gMV0KICAgICAgYiA9IGFbbV0KICAgICAgcCA9IHAoYikKICAgICAgcCAhPSBiICYmCiAgICAgICAgbnVsbCAhPSBwICYmCiAgICAgICAgJGpzY29tcC5kZWZpbmVQcm9wZXJ0eShhLCBtLCB7CiAgICAgICAgICBjb25maWd1cmFibGU6ICEwLAogICAgICAgICAgd3JpdGFibGU6ICEwLAogICAgICAgICAgdmFsdWU6IHAsCiAgICAgICAgfSkKICAgIH0KICB9CiAgJGpzY29tcC5wb2x5ZmlsbCgKICAgICJBcnJheS5wcm90b3R5cGUudmFsdWVzIiwKICAgIGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIG0KICAgICAgICA/IG0KICAgICAgICA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJGpzY29tcC5pdGVyYXRvckZyb21BcnJheSh0aGlzLCBmdW5jdGlvbihtLCBhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgIH0sCiAgICAiZXM4IiwKICAgICJlczMiLAogICkKICA7KGZ1bmN0aW9uKG0pIHsKICAgIGZ1bmN0aW9uIHAoYikgewogICAgICBpZiAoYVtiXSkgcmV0dXJuIGFbYl0uZXhwb3J0cwogICAgICB2YXIgYyA9IChhW2JdID0geyBpOiBiLCBsOiAhMSwgZXhwb3J0czoge30gfSkKICAgICAgbVtiXS5jYWxsKGMuZXhwb3J0cywgYywgYy5leHBvcnRzLCBwKQogICAgICBjLmwgPSAhMAogICAgICByZXR1cm4gYy5leHBvcnRzCiAgICB9CiAgICB2YXIgYSA9IHt9CiAgICBwLm0gPSBtCiAgICBwLmMgPSBhCiAgICBwLmQgPSBmdW5jdGlvbihhLCBjLCBkKSB7CiAgICAgIHAubyhhLCBjKSB8fCBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgYywgeyBlbnVtZXJhYmxlOiAhMCwgZ2V0OiBkIH0pCiAgICB9CiAgICBwLnIgPSBmdW5jdGlvbihhKSB7CiAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgU3ltYm9sICYmCiAgICAgICAgU3ltYm9sLnRvU3RyaW5nVGFnICYmCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogIk1vZHVsZSIgfSkKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSkKICAgIH0KICAgIHAudCA9IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgYyAmIDEgJiYgKGEgPSBwKGEpKQogICAgICBpZiAoYyAmIDgpIHJldHVybiBhCiAgICAgIGlmIChjICYgNCAmJiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgYSAmJiBhLl9fZXNNb2R1bGUpIHJldHVybiBhCiAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShudWxsKQogICAgICBwLnIoYikKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsICJkZWZhdWx0IiwgeyBlbnVtZXJhYmxlOiAhMCwgdmFsdWU6IGEgfSkKICAgICAgaWYgKGMgJiAyICYmICJzdHJpbmciICE9IHR5cGVvZiBhKQogICAgICAgIGZvciAodmFyIGUgaW4gYSkKICAgICAgICAgIHAuZCgKICAgICAgICAgICAgYiwKICAgICAgICAgICAgZSwKICAgICAgICAgICAgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgIHJldHVybiBhW2JdCiAgICAgICAgICAgIH0uYmluZChudWxsLCBlKSwKICAgICAgICAgICkKICAgICAgcmV0dXJuIGIKICAgIH0KICAgIHAubiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgdmFyIGIgPQogICAgICAgIGEgJiYgYS5fX2VzTW9kdWxlCiAgICAgICAgICA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBhWyJkZWZhdWx0Il0KICAgICAgICAgICAgfQogICAgICAgICAgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9CiAgICAgIHAuZChiLCAiYSIsIGIpCiAgICAgIHJldHVybiBiCiAgICB9CiAgICBwLm8gPSBmdW5jdGlvbihhLCBjKSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYSwgYykKICAgIH0KICAgIHAucCA9ICIiCiAgICByZXR1cm4gcCgocC5zID0gMSkpCiAgfSkoWwogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBwID0gKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0pKCkKICAgICAgdHJ5IHsKICAgICAgICBwID0gcCB8fCBuZXcgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKQogICAgICB9IGNhdGNoIChhKSB7CiAgICAgICAgIm9iamVjdCIgPT09IHR5cGVvZiB3aW5kb3cgJiYgKHAgPSB3aW5kb3cpCiAgICAgIH0KICAgICAgbS5leHBvcnRzID0gcAogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHAsIGEpIHsKICAgICAgYSgyKQogICAgICBTay5nbG9iYWwuc3RyZnRpbWUgPSBhKDMpCiAgICAgIFNrLmdsb2JhbC5zdHJwdGltZSA9IGEoNCkKICAgICAgYSg1KQogICAgICBhKDcpCiAgICAgIGEoOCkKICAgICAgYSg5KQogICAgICBhKDEwKQogICAgICBhKDExKQogICAgICBhKDEyKQogICAgICBhKDEzKQogICAgICBhKDE0KQogICAgICBhKDE1KQogICAgICBhKDE2KQogICAgICBhKDE3KQogICAgICBhKDE4KQogICAgICBhKDE5KQogICAgICBhKDIwKQogICAgICBhKDIxKQogICAgICBhKDIyKQogICAgICBhKDIzKQogICAgICBhKDI0KQogICAgICBhKDI1KQogICAgICBhKDI2KQogICAgICBhKDI3KQogICAgICBhKDI4KQogICAgICBhKDI5KQogICAgICBhKDMwKQogICAgICBhKDMxKQogICAgICBhKDMyKQogICAgICBhKDMzKQogICAgICBhKDM0KQogICAgICBhKDM1KQogICAgICBhKDM2KQogICAgICBhKDM3KQogICAgICBhKDM4KQogICAgICBhKDM5KQogICAgICBhKDQwKQogICAgICBhKDQxKQogICAgICBhKDQyKQogICAgICBhKDQzKQogICAgICBhKDQ0KQogICAgICBhKDQ1KQogICAgICBhKDQ2KQogICAgICBhKDQ3KQogICAgICBhKDQ4KQogICAgICBhKDQ5KQogICAgICBhKDUwKQogICAgICBhKDUxKQogICAgICBhKDUyKQogICAgICBhKDUzKQogICAgICBhKDU0KQogICAgICBhKDU1KQogICAgICBhKDU2KQogICAgICBhKDU3KQogICAgICBhKDU4KQogICAgICBhKDU5KQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHAsIGEpIHsKICAgICAgOyhmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB7CiAgICAgICAgICBidWlsZDogewogICAgICAgICAgICBnaXRoYXNoOiAiMjJjMzhjYjAzZDM3YWY2ZWMwMWMwN2UyZTRlMTdjNGFjZGMzZTAxZiIsCiAgICAgICAgICAgIGRhdGU6ICIyMDE5LTEyLTEyVDIwOjQ5OjA2LjQ5MFoiLAogICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgYi5nbG9iYWwgPQogICAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhCiAgICAgICAgICAgID8gYQogICAgICAgICAgICA6ICJ1bmRlZmluZWQiICE9PSB0eXBlb2Ygc2VsZgogICAgICAgICAgICA/IHNlbGYKICAgICAgICAgICAgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHdpbmRvdwogICAgICAgICAgICA/IHdpbmRvdwogICAgICAgICAgICA6IHt9CiAgICAgICAgYi5leHBvcnRTeW1ib2wgPSBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICBhID0gYS5zcGxpdCgiLiIpCiAgICAgICAgICB2YXIgZCA9IGIuZ2xvYmFsLAogICAgICAgICAgICBlCiAgICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYS5sZW5ndGggLSAxOyBlKyspIHsKICAgICAgICAgICAgdmFyIGggPSBhW2VdCiAgICAgICAgICAgIGQgPSBkLmhhc093blByb3BlcnR5KGgpID8gZFtoXSA6IChkW2hdID0ge30pCiAgICAgICAgICB9CiAgICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGMgJiYgKChoID0gYVtlXSksIChkW2hdID0gYykpCiAgICAgICAgfQogICAgICAgIGIuaXNBcnJheUxpa2UgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIEFycmF5IHx8CiAgICAgICAgICAgIChhICYmIGEubGVuZ3RoICYmICJudW1iZXIiID09IHR5cGVvZiBhLmxlbmd0aCkKICAgICAgICAgICAgPyAhMAogICAgICAgICAgICA6ICExCiAgICAgICAgfQogICAgICAgIGIuanNfYmVhdXRpZnkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0KICAgICAgICBiLmV4cG9ydFN5bWJvbCgiU2siLCBiKQogICAgICAgIGIuZXhwb3J0U3ltYm9sKCJTay5nbG9iYWwiLCBiLmdsb2JhbCkKICAgICAgICBiLmV4cG9ydFN5bWJvbCgiU2suYnVpbGQiLCBiLmJ1aWxkKQogICAgICAgIGIuZXhwb3J0U3ltYm9sKCJTay5leHBvcnRTeW1ib2wiLCBiLmV4cG9ydFN5bWJvbCkKICAgICAgICBiLmV4cG9ydFN5bWJvbCgiU2suaXNBcnJheUxpa2UiLCBiLmlzQXJyYXlMaWtlKQogICAgICAgIGIuZXhwb3J0U3ltYm9sKCJTay5qc19iZWF1dGlmeSIsIGIuanNfYmVhdXRpZnkpCiAgICAgIH0uY2FsbCh0aGlzLCBhKDApKSkKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIDsoZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gYShsLCByLCBEKSB7CiAgICAgICAgICBmdW5jdGlvbiBuKGEsIGssIGwsIHIpIHsKICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICB2YXIgaCA9ICIiLCBxID0gbnVsbCwgeCA9ICExLCBEID0gYS5sZW5ndGgsIEggPSAhMSwgcCA9IDA7CiAgICAgICAgICAgICAgcCA8IEQ7CiAgICAgICAgICAgICAgcCsrCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHZhciBCID0gYS5jaGFyQ29kZUF0KHApCiAgICAgICAgICAgICAgaWYgKCEwID09PSB4KQogICAgICAgICAgICAgICAgaWYgKDQ1ID09PSBCKSBxID0gIiIKICAgICAgICAgICAgICAgIGVsc2UgaWYgKDk1ID09PSBCKSBxID0gIiAiCiAgICAgICAgICAgICAgICBlbHNlIGlmICg0OCA9PT0gQikgcSA9ICIwIgogICAgICAgICAgICAgICAgZWxzZSBpZiAoNTggPT09IEIpCiAgICAgICAgICAgICAgICAgIEggJiYKICAgICAgICAgICAgICAgICAgICBnKAogICAgICAgICAgICAgICAgICAgICAgIltXQVJOSU5HXSBkZXRlY3RlZCB1c2Ugb2YgdW5zdXBwb3J0ZWQgJTo6IG9yICU6OjogbW9kaWZpZXJzIHRvIHN0cmZ0aW1lIiwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIChIID0gITApCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChCKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gIiUiCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgNjU6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGwuZGF5c1trLmdldERheSgpXQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY2OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBsLm1vbnRoc1trLmdldE1vbnRoKCldCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgNjc6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGIoTWF0aC5mbG9vcihrLmdldEZ1bGxZZWFyKCkgLyAxMDApLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY4OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5ELCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5GLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcyOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGsuZ2V0SG91cnMoKSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihkKGsuZ2V0SG91cnMoKSksIHEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgNzY6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGMoTWF0aC5mbG9vcihyICUgMWUzKSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA3NzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihrLmdldE1pbnV0ZXMoKSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA4MDoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gMTIgPiBrLmdldEhvdXJzKCkgPyBsLmFtIDogbC5wbQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDgyOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5SLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDgzOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGsuZ2V0U2Vjb25kcygpLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg0OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5ULCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg1OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGUoaywgInN1bmRheSIpLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg3OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGUoaywgIm1vbmRheSIpLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg4OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5YLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg5OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBrLmdldEZ1bGxZZWFyKCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA5MDoKICAgICAgICAgICAgICAgICAgICAgIEEgJiYgMCA9PT0gbQogICAgICAgICAgICAgICAgICAgICAgICA/IChoICs9ICJHTVQiKQogICAgICAgICAgICAgICAgICAgICAgICA6ICgocSA9IGsudG9TdHJpbmcoKS5tYXRjaCgvXCgoW1x3XHNdKylcKS8pKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAoaCArPSAocSAmJiBxWzFdKSB8fCAiIikpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgOTc6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGwuc2hvcnREYXlzW2suZ2V0RGF5KCldCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgOTg6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGwuc2hvcnRNb250aHNbay5nZXRNb250aCgpXQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk5OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5jLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwMDoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihrLmdldERhdGUoKSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDE6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGIoay5nZXREYXRlKCksIG51bGwgPT0gcSA/ICIgIiA6IHEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA0OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBsLnNob3J0TW9udGhzW2suZ2V0TW9udGgoKV0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDY6CiAgICAgICAgICAgICAgICAgICAgICBxID0gbmV3IERhdGUoay5nZXRGdWxsWWVhcigpLCAwLCAxKQogICAgICAgICAgICAgICAgICAgICAgcSA9IE1hdGguY2VpbCgoay5nZXRUaW1lKCkgLSBxLmdldFRpbWUoKSkgLyA4NjRlNSkKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYyhxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwNzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihrLmdldEhvdXJzKCksIG51bGwgPT0gcSA/ICIgIiA6IHEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA4OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGQoay5nZXRIb3VycygpKSwgbnVsbCA9PSBxID8gIiAiIDogcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDk6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGIoay5nZXRNb250aCgpICsgMSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTA6CiAgICAgICAgICAgICAgICAgICAgICBoICs9ICJcbiIKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTE6CiAgICAgICAgICAgICAgICAgICAgICBxID0gay5nZXREYXRlKCkKICAgICAgICAgICAgICAgICAgICAgIGggPSBsLm9yZGluYWxTdWZmaXhlcwogICAgICAgICAgICAgICAgICAgICAgICA/IGggKyAoU3RyaW5nKHEpICsgKGwub3JkaW5hbFN1ZmZpeGVzW3EgLSAxXSB8fCBmKHEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBoICsgKFN0cmluZyhxKSArIGYocSkpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTEyOgogICAgICAgICAgICAgICAgICAgICAgaCArPSAxMiA+IGsuZ2V0SG91cnMoKSA/IGwuQU0gOiBsLlBNCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE0OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5yLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNToKICAgICAgICAgICAgICAgICAgICAgIGggKz0gTWF0aC5mbG9vcihyIC8gMWUzKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNjoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gIlx0IgogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNzoKICAgICAgICAgICAgICAgICAgICAgIHEgPSBrLmdldERheSgpCiAgICAgICAgICAgICAgICAgICAgICBoICs9IDAgPT09IHEgPyA3IDogcQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExODoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gbihsLmZvcm1hdHMudiwgaywgbCwgcikKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTk6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGsuZ2V0RGF5KCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjA6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IG4obC5mb3JtYXRzLngsIGssIGwsIHIpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTIxOgogICAgICAgICAgICAgICAgICAgICAgaCArPSAoIiIgKyBrLmdldEZ1bGxZZWFyKCkpLnNsaWNlKDIpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTIyOgogICAgICAgICAgICAgICAgICAgICAgQSAmJiAwID09PSBtCiAgICAgICAgICAgICAgICAgICAgICAgID8gKGggKz0gSCA/ICIrMDA6MDAiIDogIiswMDAwIikKICAgICAgICAgICAgICAgICAgICAgICAgOiAoKHEgPSAwICE9PSBtID8gbSAvIDZlNCA6IC1rLmdldFRpbWV6b25lT2Zmc2V0KCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICh4ID0gSCA/ICI6IiA6ICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAoQiA9IE1hdGguYWJzKHEgJSA2MCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgIChoICs9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMCA+IHEgPyAiLSIgOiAiKyIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIoTWF0aC5mbG9vcihNYXRoLmFicyhxIC8gNjApKSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiKEIpKSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIHggJiYgKGggKz0gIiUiKSwgKGggKz0gYVtwXSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBxID0gbnVsbAogICAgICAgICAgICAgICAgICB4ID0gITEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIDM3ID09PSBCID8gKHggPSAhMCkgOiAoaCArPSBhW3BdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcSA9IGwgfHwgaywKICAgICAgICAgICAgbSA9IHIgfHwgMCwKICAgICAgICAgICAgQSA9IEQgfHwgITEsCiAgICAgICAgICAgIHAgPSAwLAogICAgICAgICAgICBLLAogICAgICAgICAgICBCID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGIuZ2V0VGltZSgpCiAgICAgICAgICAgICAgICBpZiAoQSkgewogICAgICAgICAgICAgICAgICB2YXIgZCA9IDZlNCAqIChiLmdldFRpbWV6b25lT2Zmc2V0KCkgfHwgMCkKICAgICAgICAgICAgICAgICAgYiA9IG5ldyBEYXRlKGMgKyBkICsgbSkKICAgICAgICAgICAgICAgICAgNmU0ICogKGIuZ2V0VGltZXpvbmVPZmZzZXQoKSB8fCAwKSAhPT0gZCAmJgogICAgICAgICAgICAgICAgICAgICgoYiA9IDZlNCAqIChiLmdldFRpbWV6b25lT2Zmc2V0KCkgfHwgMCkpLAogICAgICAgICAgICAgICAgICAgIChiID0gbmV3IERhdGUoYyArIGIgKyBtKSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAoYyA9IERhdGUubm93KCkpLAogICAgICAgICAgICAgICAgICBjID4gcAogICAgICAgICAgICAgICAgICAgID8gKChwID0gYyksCiAgICAgICAgICAgICAgICAgICAgICAoSyA9IG5ldyBEYXRlKHApKSwKICAgICAgICAgICAgICAgICAgICAgIChjID0gcCksCiAgICAgICAgICAgICAgICAgICAgICBBICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChLID0gbmV3IERhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgcCArIDZlNCAqIChLLmdldFRpbWV6b25lT2Zmc2V0KCkgfHwgMCkgKyBtLAogICAgICAgICAgICAgICAgICAgICAgICApKSkKICAgICAgICAgICAgICAgICAgICA6IChjID0gcCksCiAgICAgICAgICAgICAgICAgIChiID0gSykKICAgICAgICAgICAgICByZXR1cm4gbihhLCBiLCBxLCBjKQogICAgICAgICAgICB9CiAgICAgICAgICBCLmxvY2FsaXplID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICByZXR1cm4gbmV3IGEoYiB8fCBxLCBtLCBBKQogICAgICAgICAgfQogICAgICAgICAgQi5sb2NhbGl6ZUJ5SWRlbnRpZmllciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBoW2FdCiAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgPyBCLmxvY2FsaXplKGIpCiAgICAgICAgICAgICAgOiAoZygnW1dBUk5JTkddIE5vIGxvY2FsZSBmb3VuZCB3aXRoIGlkZW50aWZpZXIgIicgKyBhICsgJyIuJyksIEIpCiAgICAgICAgICB9CiAgICAgICAgICBCLnRpbWV6b25lID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICB2YXIgYyA9IG0sCiAgICAgICAgICAgICAgZCA9IEEsCiAgICAgICAgICAgICAgZSA9IHR5cGVvZiBiCiAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gZSB8fCAic3RyaW5nIiA9PT0gZSkKICAgICAgICAgICAgICAoZCA9ICEwKSwKICAgICAgICAgICAgICAgICJzdHJpbmciID09PSBlCiAgICAgICAgICAgICAgICAgID8gKChjID0gIi0iID09PSBiWzBdID8gLTEgOiAxKSwKICAgICAgICAgICAgICAgICAgICAoZSA9IHBhcnNlSW50KGIuc2xpY2UoMSwgMyksIDEwKSksCiAgICAgICAgICAgICAgICAgICAgKGIgPSBwYXJzZUludChiLnNsaWNlKDMsIDUpLCAxMCkpLAogICAgICAgICAgICAgICAgICAgIChjID0gYyAqICg2MCAqIGUgKyBiKSAqIDZlNCkpCiAgICAgICAgICAgICAgICAgIDogIm51bWJlciIgPT09IGUgJiYgKGMgPSA2ZTQgKiBiKQogICAgICAgICAgICByZXR1cm4gbmV3IGEocSwgYywgZCkKICAgICAgICAgIH0KICAgICAgICAgIEIudXRjID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgYShxLCBtLCAhMCkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBCCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGIoYSwgYikgewogICAgICAgICAgaWYgKCIiID09PSBiIHx8IDkgPCBhKSByZXR1cm4gYQogICAgICAgICAgbnVsbCA9PSBiICYmIChiID0gIjAiKQogICAgICAgICAgcmV0dXJuIGIgKyBhCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGMoYSkgewogICAgICAgICAgcmV0dXJuIDk5IDwgYSA/IGEgOiA5IDwgYSA/ICIwIiArIGEgOiAiMDAiICsgYQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkKGEpIHsKICAgICAgICAgIHJldHVybiAwID09PSBhID8gMTIgOiAxMiA8IGEgPyBhIC0gMTIgOiBhCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGUoYSwgYikgewogICAgICAgICAgYiA9IGIgfHwgInN1bmRheSIKICAgICAgICAgIHZhciBjID0gYS5nZXREYXkoKQogICAgICAgICAgIm1vbmRheSIgPT09IGIgJiYgKDAgPT09IGMgPyAoYyA9IDYpIDogYy0tKQogICAgICAgICAgYiA9IERhdGUuVVRDKGEuZ2V0RnVsbFllYXIoKSwgMCwgMSkKICAgICAgICAgIGEgPSBEYXRlLlVUQyhhLmdldEZ1bGxZZWFyKCksIGEuZ2V0TW9udGgoKSwgYS5nZXREYXRlKCkpCiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoTWF0aC5mbG9vcigoYSAtIGIpIC8gODY0ZTUpICsgNyAtIGMpIC8gNykKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZihhKSB7CiAgICAgICAgICB2YXIgYiA9IGEgJSAxMAogICAgICAgICAgYSAlPSAxMDAKICAgICAgICAgIGlmICgoMTEgPD0gYSAmJiAxMyA+PSBhKSB8fCAwID09PSBiIHx8IDQgPD0gYikgcmV0dXJuICJ0aCIKICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgcmV0dXJuICJzdCIKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHJldHVybiAibmQiCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICByZXR1cm4gInJkIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnKGEpIHsKICAgICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgY29uc29sZSAmJgogICAgICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBjb25zb2xlLndhcm4gJiYKICAgICAgICAgICAgY29uc29sZS53YXJuKGEpCiAgICAgICAgfQogICAgICAgIHZhciBoID0gewogICAgICAgICAgICBkZV9ERTogewogICAgICAgICAgICAgIGRheXM6ICJTb25udGFnIE1vbnRhZyBEaWVuc3RhZyBNaXR0d29jaCBEb25uZXJzdGFnIEZyZWl0YWcgU2Ftc3RhZyIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJTbyBNbyBEaSBNaSBEbyBGciBTYSIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICBtb250aHM6ICJKYW51YXIgRmVicnVhciBNXHUwMGU0cnogQXByaWwgTWFpIEp1bmkgSnVsaSBBdWd1c3QgU2VwdGVtYmVyIE9rdG9iZXIgTm92ZW1iZXIgRGV6ZW1iZXIiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnRNb250aHM6ICJKYW4gRmViIE1cdTAwZTRyIEFwciBNYWkgSnVuIEp1bCBBdWcgU2VwIE9rdCBOb3YgRGV6Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQuJW0uJVkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJVQiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbl9DQTogewogICAgICAgICAgICAgIGRheXM6ICJTdW5kYXkgTW9uZGF5IFR1ZXNkYXkgV2VkbmVzZGF5IFRodXJzZGF5IEZyaWRheSBTYXR1cmRheSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJTdW4gTW9uIFR1ZSBXZWQgVGh1IEZyaSBTYXQiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiSmFudWFyeSBGZWJydWFyeSBNYXJjaCBBcHJpbCBNYXkgSnVuZSBKdWx5IEF1Z3VzdCBTZXB0ZW1iZXIgT2N0b2JlciBOb3ZlbWJlciBEZWNlbWJlciIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogIkphbiBGZWIgTWFyIEFwciBNYXkgSnVuIEp1bCBBdWcgU2VwIE9jdCBOb3YgRGVjIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIG9yZGluYWxTdWZmaXhlczogInN0IG5kIHJkIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHN0IG5kIHJkIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHN0Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQvJW0vJXkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJXIiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbl9VUzogewogICAgICAgICAgICAgIGRheXM6ICJTdW5kYXkgTW9uZGF5IFR1ZXNkYXkgV2VkbmVzZGF5IFRodXJzZGF5IEZyaWRheSBTYXR1cmRheSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJTdW4gTW9uIFR1ZSBXZWQgVGh1IEZyaSBTYXQiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiSmFudWFyeSBGZWJydWFyeSBNYXJjaCBBcHJpbCBNYXkgSnVuZSBKdWx5IEF1Z3VzdCBTZXB0ZW1iZXIgT2N0b2JlciBOb3ZlbWJlciBEZWNlbWJlciIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogIkphbiBGZWIgTWFyIEFwciBNYXkgSnVuIEp1bCBBdWcgU2VwIE9jdCBOb3YgRGVjIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIG9yZGluYWxTdWZmaXhlczogInN0IG5kIHJkIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHN0IG5kIHJkIHRoIHRoIHRoIHRoIHRoIHRoIHRoIHN0Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJW0vJWQvJXkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJXIiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBlc19NWDogewogICAgICAgICAgICAgIGRheXM6ICJkb21pbmdvIGx1bmVzIG1hcnRlcyBtaVx1MDBlOXJjb2xlcyBqdWV2ZXMgdmllcm5lcyBzXHUwMGUxYmFkbyIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJkb20gbHVuIG1hciBtaVx1MDBlOSBqdWUgdmllIHNcdTAwZTFiIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIG1vbnRoczogImVuZXJvO2ZlYnJlcm87bWFyem87YWJyaWw7bWF5bztqdW5pbztqdWxpbzthZ29zdG87c2VwdGllbWJyZTtvY3R1YnJlO25vdmllbWJyZTsgZGljaWVtYnJlIi5zcGxpdCgKICAgICAgICAgICAgICAgICI7IiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiZW5lIGZlYiBtYXIgYWJyIG1heSBqdW4ganVsIGFnbyBzZXAgb2N0IG5vdiBkaWMiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC8lbS8lWSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyX0ZSOiB7CiAgICAgICAgICAgICAgZGF5czogImRpbWFuY2hlIGx1bmRpIG1hcmRpIG1lcmNyZWRpIGpldWRpIHZlbmRyZWRpIHNhbWVkaSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJkaW0uIGx1bi4gbWFyLiBtZXIuIGpldS4gdmVuLiBzYW0uIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIG1vbnRoczogImphbnZpZXIgZlx1MDBlOXZyaWVyIG1hcnMgYXZyaWwgbWFpIGp1aW4ganVpbGxldCBhb1x1MDBmYnQgc2VwdGVtYnJlIG9jdG9icmUgbm92ZW1icmUgZFx1MDBlOWNlbWJyZSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogImphbnYuIGZcdTAwZTl2ci4gbWFycyBhdnJpbCBtYWkganVpbiBqdWlsLiBhb1x1MDBmYnQgc2VwdC4gb2N0LiBub3YuIGRcdTAwZTljLiIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBBTTogIkFNIiwKICAgICAgICAgICAgICBQTTogIlBNIiwKICAgICAgICAgICAgICBhbTogImFtIiwKICAgICAgICAgICAgICBwbTogInBtIiwKICAgICAgICAgICAgICBmb3JtYXRzOiB7CiAgICAgICAgICAgICAgICBjOiAiJWEgJWQgJWIgJVkgJVggJVoiLAogICAgICAgICAgICAgICAgRDogIiVkLyVtLyVZIiwKICAgICAgICAgICAgICAgIEY6ICIlWS0lbS0lZCIsCiAgICAgICAgICAgICAgICBSOiAiJUg6JU0iLAogICAgICAgICAgICAgICAgcjogIiVJOiVNOiVTICVwIiwKICAgICAgICAgICAgICAgIFQ6ICIlSDolTTolUyIsCiAgICAgICAgICAgICAgICB2OiAiJWUtJWItJVkiLAogICAgICAgICAgICAgICAgWDogIiVUIiwKICAgICAgICAgICAgICAgIHg6ICIlRCIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXRfSVQ6IHsKICAgICAgICAgICAgICBkYXlzOiAiZG9tZW5pY2EgbHVuZWRcdTAwZWMgbWFydGVkXHUwMGVjIG1lcmNvbGVkXHUwMGVjIGdpb3ZlZFx1MDBlYyB2ZW5lcmRcdTAwZWMgc2FiYXRvIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogImRvbSBsdW4gbWFyIG1lciBnaW8gdmVuIHNhYiIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICBtb250aHM6ICJnZW5uYWlvIGZlYmJyYWlvIG1hcnpvIGFwcmlsZSBtYWdnaW8gZ2l1Z25vIGx1Z2xpbyBhZ29zdG8gc2V0dGVtYnJlIG90dG9icmUgbm92ZW1icmUgZGljZW1icmUiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnRNb250aHM6ICJwciBtYWcgZ2l1IGx1ZyBhZ28gc2V0IG90dCBub3YgZGljIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQvJW0vJVkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJVQiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBubF9OTDogewogICAgICAgICAgICAgIGRheXM6ICJ6b25kYWcgbWFhbmRhZyBkaW5zZGFnIHdvZW5zZGFnIGRvbmRlcmRhZyB2cmlqZGFnIHphdGVyZGFnIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogInpvIG1hIGRpIHdvIGRvIHZyIHphIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIG1vbnRoczogImphbnVhcmkgZmVicnVhcmkgbWFhcnQgYXByaWwgbWVpIGp1bmkganVsaSBhdWd1c3R1cyBzZXB0ZW1iZXIgb2t0b2JlciBub3ZlbWJlciBkZWNlbWJlciIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogImphbiBmZWIgbXJ0IGFwciBtZWkganVuIGp1bCBhdWcgc2VwIG9rdCBub3YgZGVjIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQtJW0tJXkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJVQiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBwdF9CUjogewogICAgICAgICAgICAgIGRheXM6ICJkb21pbmdvIHNlZ3VuZGEgdGVyXHUwMGU3YSBxdWFydGEgcXVpbnRhIHNleHRhIHNcdTAwZTFiYWRvIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogIkRvbSBTZWcgVGVyIFF1YSBRdWkgU2V4IFNcdTAwZTFiIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIG1vbnRoczogImphbmVpcm8gZmV2ZXJlaXJvIG1hclx1MDBlN28gYWJyaWwgbWFpbyBqdW5obyBqdWxobyBhZ29zdG8gc2V0ZW1icm8gb3V0dWJybyBub3ZlbWJybyBkZXplbWJybyIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogIkphbiBGZXYgTWFyIEFiciBNYWkgSnVuIEp1bCBBZ28gU2V0IE91dCBOb3YgRGV6Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQtJW0tJVkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJVQiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBydV9SVTogewogICAgICAgICAgICAgIGRheXM6ICJcdTA0MTJcdTA0M2VcdTA0NDFcdTA0M2FcdTA0NDBcdTA0MzVcdTA0NDFcdTA0MzVcdTA0M2RcdTA0NGNcdTA0MzUgXHUwNDFmXHUwNDNlXHUwNDNkXHUwNDM1XHUwNDM0XHUwNDM1XHUwNDNiXHUwNDRjXHUwNDNkXHUwNDM4XHUwNDNhIFx1MDQxMlx1MDQ0Mlx1MDQzZVx1MDQ0MFx1MDQzZFx1MDQzOFx1MDQzYSBcdTA0MjFcdTA0NDBcdTA0MzVcdTA0MzRcdTA0MzAgXHUwNDI3XHUwNDM1XHUwNDQyXHUwNDMyXHUwNDM1XHUwNDQwXHUwNDMzIFx1MDQxZlx1MDQ0Zlx1MDQ0Mlx1MDQzZFx1MDQzOFx1MDQ0Nlx1MDQzMCBcdTA0MjFcdTA0NDNcdTA0MzFcdTA0MzFcdTA0M2VcdTA0NDJcdTA0MzAiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnREYXlzOiAiXHUwNDEyXHUwNDQxIFx1MDQxZlx1MDQzZCBcdTA0MTJcdTA0NDIgXHUwNDIxXHUwNDQwIFx1MDQyN1x1MDQ0MiBcdTA0MWZcdTA0NDIgXHUwNDIxXHUwNDMxIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIG1vbnRoczogIlx1MDQyZlx1MDQzZFx1MDQzMlx1MDQzMFx1MDQ0MFx1MDQ0YyBcdTA0MjRcdTA0MzVcdTA0MzJcdTA0NDBcdTA0MzBcdTA0M2JcdTA0NGMgXHUwNDFjXHUwNDMwXHUwNDQwXHUwNDQyIFx1MDQxMFx1MDQzZlx1MDQ0MFx1MDQzNVx1MDQzYlx1MDQ0YyBcdTA0MWNcdTA0MzBcdTA0MzkgXHUwNDE4XHUwNDRlXHUwNDNkXHUwNDRjIFx1MDQxOFx1MDQ0ZVx1MDQzYlx1MDQ0YyBcdTA0MTBcdTA0MzJcdTA0MzNcdTA0NDNcdTA0NDFcdTA0NDIgXHUwNDIxXHUwNDM1XHUwNDNkXHUwNDQyXHUwNDRmXHUwNDMxXHUwNDQwXHUwNDRjIFx1MDQxZVx1MDQzYVx1MDQ0Mlx1MDQ0Zlx1MDQzMVx1MDQ0MFx1MDQ0YyBcdTA0MWRcdTA0M2VcdTA0NGZcdTA0MzFcdTA0NDBcdTA0NGMgXHUwNDE0XHUwNDM1XHUwNDNhXHUwNDMwXHUwNDMxXHUwNDQwXHUwNDRjIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiXHUwNDRmXHUwNDNkXHUwNDMyIFx1MDQ0NFx1MDQzNVx1MDQzMiBcdTA0M2NcdTA0MzBcdTA0NDAgXHUwNDMwXHUwNDNmXHUwNDQwIFx1MDQzY1x1MDQzMFx1MDQzOSBcdTA0MzhcdTA0NGVcdTA0M2QgXHUwNDM4XHUwNDRlXHUwNDNiIFx1MDQzMFx1MDQzMlx1MDQzMyBcdTA0NDFcdTA0MzVcdTA0M2QgXHUwNDNlXHUwNDNhXHUwNDQyIFx1MDQzZFx1MDQzZVx1MDQ0ZiBcdTA0MzRcdTA0MzVcdTA0M2EiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC4lbS4leSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRyX1RSOiB7CiAgICAgICAgICAgICAgZGF5czogIlBhemFyIFBhemFydGVzaSBTYWxcdTAxMzEgXHUwMGM3YXJcdTAxNWZhbWJhIFBlclx1MDE1ZmVtYmUgQ3VtYSBDdW1hcnRlc2kiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnREYXlzOiAiUGF6IFB6dCBTYWwgXHUwMGM3clx1MDE1ZiBQclx1MDE1ZiBDdW0gQ3RzIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIG1vbnRoczogIk9jYWsgXHUwMTVldWJhdCBNYXJ0IE5pc2FuIE1heVx1MDEzMXMgSGF6aXJhbiBUZW1tdXogQVx1MDExZnVzdG9zIEV5bFx1MDBmY2wgRWtpbSBLYXNcdTAxMzFtIEFyYWxcdTAxMzFrIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiT2NhIFx1MDE1ZXViIE1hciBOaXMgTWF5IEhheiBUZW0gQVx1MDExZnUgRXlsIEVraSBLYXMgQXJhIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiXHUwMGQ2XHUwMGQ2IiwKICAgICAgICAgICAgICBQTTogIlx1MDBkNlMiLAogICAgICAgICAgICAgIGFtOiAiXHUwMGQ2XHUwMGQ2IiwKICAgICAgICAgICAgICBwbTogIlx1MDBkNlMiLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQtJW0tJVkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJVQiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICB6aF9DTjogewogICAgICAgICAgICAgIGRheXM6ICJcdTY2MWZcdTY3MWZcdTY1ZTUgXHU2NjFmXHU2NzFmXHU0ZTAwIFx1NjYxZlx1NjcxZlx1NGU4YyBcdTY2MWZcdTY3MWZcdTRlMDkgXHU2NjFmXHU2NzFmXHU1NmRiIFx1NjYxZlx1NjcxZlx1NGU5NCBcdTY2MWZcdTY3MWZcdTUxNmQiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnREYXlzOiAiXHU2NWU1XHU0ZTAwXHU0ZThjXHU0ZTA5XHU1NmRiXHU0ZTk0XHU1MTZkIi5zcGxpdCgiIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiXHU0ZTAwXHU2NzA4XHU0ZWZkIFx1NGU4Y1x1NjcwOFx1NGVmZCBcdTRlMDlcdTY3MDhcdTRlZmQgXHU1NmRiXHU2NzA4XHU0ZWZkIFx1NGU5NFx1NjcwOFx1NGVmZCBcdTUxNmRcdTY3MDhcdTRlZmQgXHU0ZTAzXHU2NzA4XHU0ZWZkIFx1NTE2Ylx1NjcwOFx1NGVmZCBcdTRlNWRcdTY3MDhcdTRlZmQgXHU1MzQxXHU2NzA4XHU0ZWZkIFx1NTM0MVx1NGUwMFx1NjcwOFx1NGVmZCBcdTUzNDFcdTRlOGNcdTY3MDhcdTRlZmQiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnRNb250aHM6ICJcdTRlMDBcdTY3MDggXHU0ZThjXHU2NzA4IFx1NGUwOVx1NjcwOCBcdTU2ZGJcdTY3MDggXHU0ZTk0XHU2NzA4IFx1NTE2ZFx1NjcwOCBcdTRlMDNcdTY3MDggXHU1MTZiXHU2NzA4IFx1NGU1ZFx1NjcwOCBcdTUzNDFcdTY3MDggXHU1MzQxXHU0ZTAwXHU2NzA4IFx1NTM0MVx1NGU4Y1x1NjcwOCIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBBTTogIlx1NGUwYVx1NTM0OCIsCiAgICAgICAgICAgICAgUE06ICJcdTRlMGJcdTUzNDgiLAogICAgICAgICAgICAgIGFtOiAiXHU0ZTBhXHU1MzQ4IiwKICAgICAgICAgICAgICBwbTogIlx1NGUwYlx1NTM0OCIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC8lbS8leSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlciIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgayA9IGguZW5fVVMsCiAgICAgICAgICBsID0gbmV3IGEoaywgMCwgITEpCiAgICAgICAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgbSkgdmFyIHIgPSAobS5leHBvcnRzID0gbCkKICAgICAgICBlbHNlCiAgICAgICAgICAociA9IChmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMgfHwgKDAsIGV2YWwpKCJ0aGlzIikKICAgICAgICAgIH0pKCkpLAogICAgICAgICAgICAoci5zdHJmdGltZSA9IGwpCiAgICAgICAgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIERhdGUubm93ICYmCiAgICAgICAgICAoRGF0ZS5ub3cgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICtuZXcgRGF0ZSgpCiAgICAgICAgICB9KQogICAgICB9KSgpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCwgYSkgewogICAgICA7KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gZnVuY3Rpb24oYiwgZCwgZSkgewogICAgICAgICAgcmV0dXJuIGEucGFyc2UoYiwgZCwgZSkKICAgICAgICB9CiAgICAgICAgYS52ZXJzaW9uID0gIjAuMC4xIgogICAgICAgIDsobS5leHBvcnRzID0gYSkuc3RycHRpbWUgPSBhCiAgICAgICAgYS5sb2NhbGUgPSB7CiAgICAgICAgICBhOiAiU3VuIE1vbiBUdWUgV2VkIFRodSBGcmkgU2F0Ii5zcGxpdCgiICIpLAogICAgICAgICAgQTogIlN1bmRheSBNb25kYXkgVHVlc2RheSBXZWRuZXNkYXkgVGh1cnNkYXkgRnJpZGF5IFNhdHVyZGF5Ii5zcGxpdCgKICAgICAgICAgICAgIiAiLAogICAgICAgICAgKSwKICAgICAgICAgIGI6ICJKYW4gRmViIE1hciBBcHIgTWF5IEp1biBKdWwgQXVnIFNlcCBPY3QgTm92IERlYyIuc3BsaXQoIiAiKSwKICAgICAgICAgIEI6ICJKYW51YXJ5IEZlYnJ1YXJ5IE1hcmNoIEFwcmlsIE1heSBKdW5lIEp1bHkgQXVndXN0IFNlcHRlbWJlciBPY3RvYmVyIE5vdmVtYmVyIERlY2VtYmVyIi5zcGxpdCgKICAgICAgICAgICAgIiAiLAogICAgICAgICAgKSwKICAgICAgICAgIGY6ICJKYW4uIEZlYi4gTWFyLiBBcHIuIE1heSBKdW4uIEp1bC4gQXVnLiBTZXAuIE9jdC4gTm92LiBEZWMuIi5zcGxpdCgKICAgICAgICAgICAgIiAiLAogICAgICAgICAgKSwKICAgICAgICAgIGM6ICIlWS0lbS0lZCAlSDolTTolUyIsCiAgICAgICAgICBQOiBbImFtIiwgInBtIl0sCiAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgeDogIiVtLyVkLyV5IiwKICAgICAgICAgIFg6ICIlSDolTTolUyIsCiAgICAgICAgICBkYXk6IFsiWWVzdGVyZGF5IiwgIlRvZGF5IiwgIlRvbW9ycm93Il0sCiAgICAgICAgICBiZzogIkphbiBGZWIgTWFyIEFwciBNYXkgSnVuIEp1bCBBdWcgU2VwIE9jdCBOb3YgRGVjIi5zcGxpdCgiICIpLAogICAgICAgICAgQmc6ICJKYW51YXJ5IEZlYnJ1YXJ5IE1hcmNoIEFwcmlsIE1heSBKdW5lIEp1bHkgQXVndXN0IFNlcHRlbWJlciBPY3RvYmVyIE5vdmVtYmVyIERlY2VtYmVyIi5zcGxpdCgKICAgICAgICAgICAgIiAiLAogICAgICAgICAgKSwKICAgICAgICAgIGZnOiAiSmFuLiBGZWIuIE1hci4gQXByLiBNYXkgSnVuLiBKdWwuIEF1Zy4gU2VwLiBPY3QuIE5vdi4gRGVjLiIuc3BsaXQoCiAgICAgICAgICAgICIgIiwKICAgICAgICAgICksCiAgICAgICAgICBEYXRlX2RCWV95ZWFyX2luX0hNOiAiJSNCICUtZCwgJVkgYXQgJS1IOiVNIiwKICAgICAgICAgIERhdGVfZEJZX3llYXI6ICIlI0IgJS1kLCAlWSIsCiAgICAgICAgICBEYXRlX2RCWTogIiUjQiAlLWQsICVZIiwKICAgICAgICAgIERhdGVfQWRCWTogIiVBLCAlI0IgJS1kLCAlWSIsCiAgICAgICAgICBEYXRlX2RCQTogIiUjQiAlLWQsICVBIiwKICAgICAgICAgIERhdGVfZGZfaW5fSE06ICIlI2YsICUtZCBhdCAlLUg6JU0iLAogICAgICAgICAgRGF0ZV9kZlk6ICIlLWQgJSNmICVZIiwKICAgICAgICAgIERhdGVfZEJfaW5fSE06ICIlI0IgJS1kIGF0ICUtSDolTSIsCiAgICAgICAgICBEYXRlX2RmOiAiJS1kICUjZiIsCiAgICAgICAgfQogICAgICAgIDsoZnVuY3Rpb24oYSkgewogICAgICAgICAgZnVuY3Rpb24gYihhLCBjLCBkLCBlLCBnLCBmKSB7CiAgICAgICAgICAgIGMgPSBTdHJpbmcoYykKICAgICAgICAgICAgZCA9IFN0cmluZyhkKQogICAgICAgICAgICBjID0gYy5yZXBsYWNlKC9eWyNfMFxeXC0hfl0rLywgIiIpCiAgICAgICAgICAgIGUgPSBoW2NdCiAgICAgICAgICAgIGlmICghZSkgcmV0dXJuIGEKICAgICAgICAgICAgdmFyIGsgPSAhMQogICAgICAgICAgICA7LTEgPT09IGQuaW5kZXhPZigiISIpICYmCiAgICAgICAgICAgICAgMSA9PT0gYy5sZW5ndGggJiYKICAgICAgICAgICAgICAoLTEgPCBkLmluZGV4T2YoIn4iKSB8fAogICAgICAgICAgICAgICAgKC0xIDwgImJCZiIuaW5kZXhPZihjKSAmJgogICAgICAgICAgICAgICAgICAvJVswXC1fXT9kW1xzXSskLy50ZXN0KGYuc3Vic3RyKDAsIGcpKSkpICYmCiAgICAgICAgICAgICAgKGsgPSAhMCkKICAgICAgICAgICAgaWYgKCgiSSIgPT09IGMgfHwgImwiID09PSBjKSAmJiAhLyVbcFBdLy50ZXN0KGYpKQogICAgICAgICAgICAgIHRocm93IEVycm9yKCJVbmRlZmluZWQgQU0vUE0iKQogICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiZnVuY3Rpb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIGUoKQogICAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgIGNhc2UgIm9iamVjdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5tYWtlLnB1c2goW2UubWFrZSwgZCwga10pLCAiKCIgKyBlLnJlZyArICIpIgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjKGEsIGIpIHsKICAgICAgICAgICAgYSA9IFN0cmluZyhhKQogICAgICAgICAgICBiID0gU3RyaW5nKGIpCiAgICAgICAgICAgIHJldHVybiAtMSAhPT0gYi5pbmRleE9mKCIjIikKICAgICAgICAgICAgICA/IGEuc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBhLnN1YnN0cigxKQogICAgICAgICAgICAgIDogLTEgIT09IGIuaW5kZXhPZigiXiIpCiAgICAgICAgICAgICAgPyBhLnN1YnN0cigwLCAxKSArIGEuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICA6IGEKICAgICAgICAgIH0KICAgICAgICAgIHZhciBmID0KICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiB8fAogICAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSB0aGlzLmxlbmd0aCwgYyA9IDA7IGMgPCBiOyApIHsKICAgICAgICAgICAgICAgICAgaWYgKGEgPT0gdGhpc1tjXSkgcmV0dXJuIGMKICAgICAgICAgICAgICAgICAgYysrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICAgICAgICB9LAogICAgICAgICAgICBnID0gYS5sb2NhbGUsCiAgICAgICAgICAgIGggPSB7CiAgICAgICAgICAgICAgIiUiOiAiXFwlIiwKICAgICAgICAgICAgICBhOiAiXFxTKyIsCiAgICAgICAgICAgICAgQTogIlxcUysiLAogICAgICAgICAgICAgIGI6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYiwgZCwgZSkgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGUgPyBnLmJnIDogZy5iLCBjKGIsIGQpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ01vbnRoKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGg6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYiwgZCwgZSkgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGUgPyBnLmJnIDogZy5iLCBjKGIsIGQpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ01vbnRoKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEI6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYiwgZCwgZSkgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGUgPyBnLkJnIDogZy5CLCBjKGIsIGQpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ01vbnRoKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGY6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYiwgZCwgZSkgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGUgPyBnLmZnIDogZy5mLCBjKGIsIGQpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ01vbnRoKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGc6IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDAgPiBiIHx8IDk5IDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGIgKz0gMTAwICogcGFyc2VJbnQobmV3IERhdGUoKS5nZXRVVENGdWxsWWVhcigpIC8gMTAwLCAxMCkKICAgICAgICAgICAgICAgICAgYS5zZXRVVENGdWxsWWVhcihiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBHOiB7CiAgICAgICAgICAgICAgICByZWc6ICJcXGR7NH0iLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDRnVsbFllYXIoYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZDogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMSA+IGIgfHwgMzEgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENEYXRlKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGU6IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDEgPiBiIHx8IDMxIDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDRGF0ZShiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBIOiB7CiAgICAgICAgICAgICAgICByZWc6ICJbXFxkXFxzXT9cXGQiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGlmICgwID4gYiB8fCAyMyA8IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ0hvdXJzKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEk6IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDEgPiBiIHx8IDEyIDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDSG91cnMoYS5nZXRVVENIb3VycygpICsgYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbTogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMSA+IGIgfHwgMTIgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENNb250aChiIC0gMSkKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgTTogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMCA+IGIgfHwgNTkgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENNaW51dGVzKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG46ICJcXG4iLAogICAgICAgICAgICAgIHA6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGcuUCwgYi50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAxID09PSBiICYmIGEuc2V0VVRDSG91cnMoYS5nZXRVVENIb3VycygpICsgMTIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIFA6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGcuUCwgYi50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAxID09PSBiICYmIGEuc2V0VVRDSG91cnMoYS5nZXRVVENIb3VycygpICsgMTIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIFM6IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDAgPiBiIHx8IDYwIDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDU2Vjb25kcyhiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0OiAiXFx0IiwKICAgICAgICAgICAgICB1OiAiXFxkIiwKICAgICAgICAgICAgICBVOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICB3OiAiXFxkIiwKICAgICAgICAgICAgICBXOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICB5OiB7CiAgICAgICAgICAgICAgICByZWc6ICJbXFxkXFxzXT9cXGQiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGlmICgwID4gYiB8fCA5OSA8IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBiICs9IDEwMCAqIHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VVRDRnVsbFllYXIoKSAvIDEwMCwgMTApCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDRnVsbFllYXIoYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgWTogewogICAgICAgICAgICAgICAgcmVnOiAiXFxkezR9IiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBhLnNldFVUQ0Z1bGxZZWFyKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHo6IHsKICAgICAgICAgICAgICAgIHJlZzogIlsrXFwtXVxcZHs0fSIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBiLm1hdGNoKC9eKFsrXC1dKShcZHsyfSkoXGR7Mn0pJC8pCiAgICAgICAgICAgICAgICAgIGlmICghYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIHZhciBjID0gNmU0ICogKDYwICogcGFyc2VJbnQoYlsyXSwgMTApICsgcGFyc2VJbnQoYlszXSwgMTApKQogICAgICAgICAgICAgICAgICAiKyIgPT09IGJbMV0gJiYgKGMgPSAtYykKICAgICAgICAgICAgICAgICAgYS5zZXRUaW1lKGEuZ2V0VGltZSgpICsgYykKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbDogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMSA+IGIgfHwgMTIgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENIb3VycyhhLmdldFVUQ0hvdXJzKCkgKyBiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzOiB7CiAgICAgICAgICAgICAgICByZWc6ICJcXGQrIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBhLnNldFRpbWUoMWUzICogYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYzogZy5jLAogICAgICAgICAgICAgIHI6IGcuciwKICAgICAgICAgICAgICBSOiAiJUg6JU0iLAogICAgICAgICAgICAgIFQ6ICIlSDolTTolUyIsCiAgICAgICAgICAgICAgeDogZy54LAogICAgICAgICAgICAgIFg6IGcuWCwKICAgICAgICAgICAgICBEOiAiJW0vJWQvJXkiLAogICAgICAgICAgICAgIEY6ICIlWS0lbS0lZCIsCiAgICAgICAgICAgICAgRGF0ZV9pc286ICIlWS0lbS0lZFQlSDolTTolUyIsCiAgICAgICAgICAgICAgRGF0ZV9kQllfeWVhcl9pbl9ITTogZy5EYXRlX2RCWV95ZWFyX2luX0hNLAogICAgICAgICAgICAgIERhdGVfZEJZX3llYXI6IGcuRGF0ZV9kQllfeWVhciwKICAgICAgICAgICAgICBEYXRlX2RCWTogZy5EYXRlX2RCWSwKICAgICAgICAgICAgICBEYXRlX2RCQTogZy5EYXRlX2RCQSwKICAgICAgICAgICAgICBEYXRlX0FkQlk6IGcuRGF0ZV9BZEJZLAogICAgICAgICAgICAgIERhdGVfZGZfaW5fSE06IGcuRGF0ZV9kZl9pbl9ITSwKICAgICAgICAgICAgICBEYXRlX2RmWTogZy5EYXRlX2RmWSwKICAgICAgICAgICAgICBEYXRlX2RCX2luX0hNOiBnLkRhdGVfZEJfaW5fSE0sCiAgICAgICAgICAgICAgRGF0ZV9kbVlfX2RvdDogIiVkLiVtLiVZIiwKICAgICAgICAgICAgICBEYXRlX2RmOiBnLkRhdGVfZGYsCiAgICAgICAgICAgICAgRGF0ZV9GVDogIiVGICVUIiwKICAgICAgICAgICAgICBEYXRlX2RtWV9fbWludXM6ICIlZC0lbS0lWSIsCiAgICAgICAgICAgIH0KICAgICAgICAgIGEucGFyc2UgPSBmdW5jdGlvbihhLCBjLCBkKSB7CiAgICAgICAgICAgIGEgPSBTdHJpbmcoYSkKICAgICAgICAgICAgYyA9IFN0cmluZyhjKQogICAgICAgICAgICBmb3IgKHZhciBlID0gNTsgLyUoRGF0ZV9bYS16QS1aMC05X10rfFtjREZyUlR4WF0pL2cudGVzdChjKSAmJiBlOyApCiAgICAgICAgICAgICAgKGMgPSBjLnJlcGxhY2UoLyUoRGF0ZV9bYS16QS1aMC05X10rfFtjREZyUlR4WF0pLywgYikpLCBlLS0KICAgICAgICAgICAgYi5tYWtlID0gW10KICAgICAgICAgICAgYyA9IGMucmVwbGFjZSgKICAgICAgICAgICAgICAvJSgoWyNcXiF+XXswLDJ9KVthQWJCZmhdfChbMFwtX10/KVtkZWdISW1NU1ZXeWxdfFtHbnBQdHVVd1l6WnMlXSkvZywKICAgICAgICAgICAgICBiLAogICAgICAgICAgICApCiAgICAgICAgICAgIGEgPSBhLm1hdGNoKG5ldyBSZWdFeHAoYykpCiAgICAgICAgICAgIGlmICghYSB8fCAhYi5tYWtlLmxlbmd0aCkgcmV0dXJuIG51bGwKICAgICAgICAgICAgYyA9IG5ldyBEYXRlKERhdGUuVVRDKDAsIDApKQogICAgICAgICAgICBlID0gMAogICAgICAgICAgICBmb3IgKHZhciBrID0gYi5tYWtlLmxlbmd0aDsgZSA8IGs7IGUrKykgewogICAgICAgICAgICAgIHZhciBnID0gYi5tYWtlW2VdCiAgICAgICAgICAgICAgaWYgKCFnWzBdKGMsIGFbZSArIDFdLCBnWzFdLCBnWzJdKSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBkICYmIGMuc2V0VGltZShjLmdldFRpbWUoKSArIDZlNCAqIGMuZ2V0VGltZXpvbmVPZmZzZXQoKSkKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgIH0KICAgICAgICB9KShhKQogICAgICB9KSgpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCwgYSkgewogICAgICA7KGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICA7KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgICAgICBkZWxldGUgeFthXQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZShhKSB7CiAgICAgICAgICAgIGlmIChIKSBzZXRUaW1lb3V0KGUsIDAsIGEpCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHZhciBjID0geFthXQogICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICBIID0gITAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBrID0gYy5jYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICBnID0gYy5hcmdzCiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBrKCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgayhnWzBdKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBrKGdbMF0sIGdbMV0pCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIGsoZ1swXSwgZ1sxXSwgZ1syXSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIGsuYXBwbHkoYiwgZykKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgZChhKSwgKEggPSAhMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGgoKSB7CiAgICAgICAgICAgIEEgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgYy5uZXh0VGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGUoYSkKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBrKCkgewogICAgICAgICAgICBpZiAoYS5wb3N0TWVzc2FnZSAmJiAhYS5pbXBvcnRTY3JpcHRzKSB7CiAgICAgICAgICAgICAgdmFyIGIgPSAhMCwKICAgICAgICAgICAgICAgIGMgPSBhLm9ubWVzc2FnZQogICAgICAgICAgICAgIGEub25tZXNzYWdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBiID0gITEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYS5wb3N0TWVzc2FnZSgiIiwgIioiKQogICAgICAgICAgICAgIGEub25tZXNzYWdlID0gYwogICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGwoKSB7CiAgICAgICAgICAgIHZhciBiID0gInNldEltbWVkaWF0ZSQiICsgTWF0aC5yYW5kb20oKSArICIkIiwKICAgICAgICAgICAgICBjID0gZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgYy5zb3VyY2UgPT09IGEgJiYKICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBjLmRhdGEgJiYKICAgICAgICAgICAgICAgICAgMCA9PT0gYy5kYXRhLmluZGV4T2YoYikgJiYKICAgICAgICAgICAgICAgICAgZSgrYy5kYXRhLnNsaWNlKGIubGVuZ3RoKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcgogICAgICAgICAgICAgID8gYS5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgYywgITEpCiAgICAgICAgICAgICAgOiBhLmF0dGFjaEV2ZW50KCJvbm1lc3NhZ2UiLCBjKQogICAgICAgICAgICBBID0gZnVuY3Rpb24oYykgewogICAgICAgICAgICAgIGEucG9zdE1lc3NhZ2UoYiArIGMsICIqIikKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcigpIHsKICAgICAgICAgICAgdmFyIGEgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKQogICAgICAgICAgICBhLnBvcnQxLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICBlKGEuZGF0YSkKICAgICAgICAgICAgfQogICAgICAgICAgICBBID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgIGEucG9ydDIucG9zdE1lc3NhZ2UoYikKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gbigpIHsKICAgICAgICAgICAgdmFyIGEgPSBwLmRvY3VtZW50RWxlbWVudAogICAgICAgICAgICBBID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgIHZhciBjID0gcC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKQogICAgICAgICAgICAgIGMub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBlKGIpCiAgICAgICAgICAgICAgICBjLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwKICAgICAgICAgICAgICAgIGEucmVtb3ZlQ2hpbGQoYykKICAgICAgICAgICAgICAgIGMgPSBudWxsCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGEuYXBwZW5kQ2hpbGQoYykKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcSgpIHsKICAgICAgICAgICAgQSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGUsIDAsIGEpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghYS5zZXRJbW1lZGlhdGUpIHsKICAgICAgICAgICAgdmFyIG0gPSAxLAogICAgICAgICAgICAgIHggPSB7fSwKICAgICAgICAgICAgICBIID0gITEsCiAgICAgICAgICAgICAgcCA9IGEuZG9jdW1lbnQsCiAgICAgICAgICAgICAgQSwKICAgICAgICAgICAgICBDID0gT2JqZWN0LmdldFByb3RvdHlwZU9mICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZihhKQogICAgICAgICAgICBDID0gQyAmJiBDLnNldFRpbWVvdXQgPyBDIDogYQogICAgICAgICAgICAiW29iamVjdCBwcm9jZXNzXSIgPT09IHt9LnRvU3RyaW5nLmNhbGwoYS5wcm9jZXNzKQogICAgICAgICAgICAgID8gaCgpCiAgICAgICAgICAgICAgOiBrKCkKICAgICAgICAgICAgICA/IGwoKQogICAgICAgICAgICAgIDogYS5NZXNzYWdlQ2hhbm5lbAogICAgICAgICAgICAgID8gcigpCiAgICAgICAgICAgICAgOiBwICYmICJvbnJlYWR5c3RhdGVjaGFuZ2UiIGluIHAuY3JlYXRlRWxlbWVudCgic2NyaXB0IikKICAgICAgICAgICAgICA/IG4oKQogICAgICAgICAgICAgIDogcSgpCiAgICAgICAgICAgIEMuc2V0SW1tZWRpYXRlID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICJmdW5jdGlvbiIgIT09IHR5cGVvZiBhICYmIChhID0gbmV3IEZ1bmN0aW9uKCIiICsgYSkpCiAgICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICAgIHZhciBiID0gQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpLCBjID0gMDsKICAgICAgICAgICAgICAgIGMgPCBiLmxlbmd0aDsKICAgICAgICAgICAgICAgIGMrKwogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGJbY10gPSBhcmd1bWVudHNbYyArIDFdCiAgICAgICAgICAgICAgeFttXSA9IHsgY2FsbGJhY2s6IGEsIGFyZ3M6IGIgfQogICAgICAgICAgICAgIEEobSkKICAgICAgICAgICAgICByZXR1cm4gbSsrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQy5jbGVhckltbWVkaWF0ZSA9IGQKICAgICAgICAgIH0KICAgICAgICB9KSgKICAgICAgICAgICJ1bmRlZmluZWQiID09PSB0eXBlb2Ygc2VsZgogICAgICAgICAgICA/ICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYQogICAgICAgICAgICAgID8gdGhpcwogICAgICAgICAgICAgIDogYQogICAgICAgICAgICA6IHNlbGYsCiAgICAgICAgKQogICAgICB9LmNhbGwodGhpcywgYSgwKSwgYSg2KSkpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBmdW5jdGlvbiBhKCkgewogICAgICAgIHRocm93IEVycm9yKCJzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIikKICAgICAgfQogICAgICBmdW5jdGlvbiBiKCkgewogICAgICAgIHRocm93IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGMoYikgewogICAgICAgIGlmIChrID09PSBzZXRUaW1lb3V0KSByZXR1cm4gc2V0VGltZW91dChiLCAwKQogICAgICAgIGlmICgoayA9PT0gYSB8fCAhaykgJiYgc2V0VGltZW91dCkKICAgICAgICAgIHJldHVybiAoayA9IHNldFRpbWVvdXQpLCBzZXRUaW1lb3V0KGIsIDApCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBrKGIsIDApCiAgICAgICAgfSBjYXRjaCAoSCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGsuY2FsbChudWxsLCBiLCAwKQogICAgICAgICAgfSBjYXRjaCAoSikgewogICAgICAgICAgICByZXR1cm4gay5jYWxsKHRoaXMsIGIsIDApCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgIGlmIChsID09PSBjbGVhclRpbWVvdXQpIHJldHVybiBjbGVhclRpbWVvdXQoYSkKICAgICAgICBpZiAoKGwgPT09IGIgfHwgIWwpICYmIGNsZWFyVGltZW91dCkKICAgICAgICAgIHJldHVybiAobCA9IGNsZWFyVGltZW91dCksIGNsZWFyVGltZW91dChhKQogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gbChhKQogICAgICAgIH0gY2F0Y2ggKEgpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBsLmNhbGwobnVsbCwgYSkKICAgICAgICAgIH0gY2F0Y2ggKEopIHsKICAgICAgICAgICAgcmV0dXJuIGwuY2FsbCh0aGlzLCBhKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgIG4gJiYKICAgICAgICAgIHEgJiYKICAgICAgICAgICgobiA9ICExKSwgcS5sZW5ndGggPyAociA9IHEuY29uY2F0KHIpKSA6IChEID0gLTEpLCByLmxlbmd0aCAmJiBmKCkpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZigpIHsKICAgICAgICBpZiAoIW4pIHsKICAgICAgICAgIHZhciBhID0gYyhlKQogICAgICAgICAgbiA9ICEwCiAgICAgICAgICBmb3IgKHZhciBiID0gci5sZW5ndGg7IGI7ICkgewogICAgICAgICAgICBxID0gcgogICAgICAgICAgICBmb3IgKHIgPSBbXTsgKytEIDwgYjsgKSBxICYmIHFbRF0ucnVuKCkKICAgICAgICAgICAgRCA9IC0xCiAgICAgICAgICAgIGIgPSByLmxlbmd0aAogICAgICAgICAgfQogICAgICAgICAgcSA9IG51bGwKICAgICAgICAgIG4gPSAhMQogICAgICAgICAgZChhKQogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBnKGEsIGIpIHsKICAgICAgICB0aGlzLmZ1biA9IGEKICAgICAgICB0aGlzLmFycmF5ID0gYgogICAgICB9CiAgICAgIGZ1bmN0aW9uIGgoKSB7fQogICAgICBtID0gbS5leHBvcnRzID0ge30KICAgICAgdHJ5IHsKICAgICAgICB2YXIgayA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IGEKICAgICAgfSBjYXRjaCAoeCkgewogICAgICAgIGsgPSBhCiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICB2YXIgbCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiBiCiAgICAgIH0gY2F0Y2ggKHgpIHsKICAgICAgICBsID0gYgogICAgICB9CiAgICAgIHZhciByID0gW10sCiAgICAgICAgbiA9ICExLAogICAgICAgIHEsCiAgICAgICAgRCA9IC0xCiAgICAgIG0ubmV4dFRpY2sgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSkKICAgICAgICBpZiAoMSA8IGFyZ3VtZW50cy5sZW5ndGgpCiAgICAgICAgICBmb3IgKHZhciBkID0gMTsgZCA8IGFyZ3VtZW50cy5sZW5ndGg7IGQrKykgYltkIC0gMV0gPSBhcmd1bWVudHNbZF0KICAgICAgICByLnB1c2gobmV3IGcoYSwgYikpCiAgICAgICAgMSAhPT0gci5sZW5ndGggfHwgbiB8fCBjKGYpCiAgICAgIH0KICAgICAgZy5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSkKICAgICAgfQogICAgICBtLnRpdGxlID0gImJyb3dzZXIiCiAgICAgIG0uYnJvd3NlciA9ICEwCiAgICAgIG0uZW52ID0ge30KICAgICAgbS5hcmd2ID0gW10KICAgICAgbS52ZXJzaW9uID0gIiIKICAgICAgbS52ZXJzaW9ucyA9IHt9CiAgICAgIG0ub24gPSBoCiAgICAgIG0uYWRkTGlzdGVuZXIgPSBoCiAgICAgIG0ub25jZSA9IGgKICAgICAgbS5vZmYgPSBoCiAgICAgIG0ucmVtb3ZlTGlzdGVuZXIgPSBoCiAgICAgIG0ucmVtb3ZlQWxsTGlzdGVuZXJzID0gaAogICAgICBtLmVtaXQgPSBoCiAgICAgIG0ucHJlcGVuZExpc3RlbmVyID0gaAogICAgICBtLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBoCiAgICAgIG0ubGlzdGVuZXJzID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBbXQogICAgICB9CiAgICAgIG0uYmluZGluZyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aHJvdyBFcnJvcigicHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQiKQogICAgICB9CiAgICAgIG0uY3dkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICIvIgogICAgICB9CiAgICAgIG0uY2hkaXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoInByb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCIpCiAgICAgIH0KICAgICAgbS51bWFzayA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmFzc2VydHMgPSB7fQogICAgICBTay5hc3NlcnRzLmFzc2VydCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYXNzZXJ0cy5hc3NlcnQiLCBTay5hc3NlcnRzLmFzc2VydCkKICAgICAgU2suYXNzZXJ0cy5mYWlsID0gZnVuY3Rpb24oYSkge30KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hc3NlcnRzLmZhaWwiLCBTay5hc3NlcnRzLmZhaWwpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5ib29sX2NoZWNrID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEgfHwgbnVsbCA9PT0gYSB8fCAiYm9vbGVhbiIgIT09IHR5cGVvZiBhKQogICAgICAgICAgdGhyb3cgRXJyb3IoIm11c3Qgc3BlY2lmeSAiICsgYiArICIgYW5kIGl0IG11c3QgYmUgYSBib29sZWFuIikKICAgICAgfQogICAgICBTay5weXRob24yID0gewogICAgICAgIHByaW50X2Z1bmN0aW9uOiAhMSwKICAgICAgICBkaXZpc2lvbjogITEsCiAgICAgICAgYWJzb2x1dGVfaW1wb3J0OiBudWxsLAogICAgICAgIHVuaWNvZGVfbGl0ZXJhbHM6ICExLAogICAgICAgIHB5dGhvbjM6ICExLAogICAgICAgIHNldF9yZXByOiAhMSwKICAgICAgICBjbGFzc19yZXByOiAhMSwKICAgICAgICBpbmhlcml0X2Zyb21fb2JqZWN0OiAhMSwKICAgICAgICBzdXBlcl9hcmdzOiAhMSwKICAgICAgICBvY3RhbF9udW1iZXJfbGl0ZXJhbDogITEsCiAgICAgICAgYmFua2Vyc19yb3VuZGluZzogITEsCiAgICAgICAgcHl0aG9uX3ZlcnNpb246ICExLAogICAgICAgIGR1bmRlcl9uZXh0OiAhMSwKICAgICAgICBkdW5kZXJfcm91bmQ6ICExLAogICAgICAgIGxpc3RfY2xlYXI6ICExLAogICAgICAgIGV4Y2VwdGlvbnM6ICExLAogICAgICAgIG5vX2xvbmdfdHlwZTogITEsCiAgICAgICAgY2VpbF9mbG9vcl9pbnQ6ICExLAogICAgICAgIHNpbGVudF9vY3RhbF9saXRlcmFsOiAhMCwKICAgICAgfQogICAgICBTay5weXRob24zID0gewogICAgICAgIHByaW50X2Z1bmN0aW9uOiAhMCwKICAgICAgICBkaXZpc2lvbjogITAsCiAgICAgICAgYWJzb2x1dGVfaW1wb3J0OiBudWxsLAogICAgICAgIHVuaWNvZGVfbGl0ZXJhbHM6ICEwLAogICAgICAgIHB5dGhvbjM6ICEwLAogICAgICAgIHNldF9yZXByOiAhMCwKICAgICAgICBjbGFzc19yZXByOiAhMCwKICAgICAgICBpbmhlcml0X2Zyb21fb2JqZWN0OiAhMCwKICAgICAgICBzdXBlcl9hcmdzOiAhMCwKICAgICAgICBvY3RhbF9udW1iZXJfbGl0ZXJhbDogITAsCiAgICAgICAgYmFua2Vyc19yb3VuZGluZzogITAsCiAgICAgICAgcHl0aG9uX3ZlcnNpb246ICEwLAogICAgICAgIGR1bmRlcl9uZXh0OiAhMCwKICAgICAgICBkdW5kZXJfcm91bmQ6ICEwLAogICAgICAgIGxpc3RfY2xlYXI6ICEwLAogICAgICAgIGV4Y2VwdGlvbnM6ICEwLAogICAgICAgIG5vX2xvbmdfdHlwZTogITAsCiAgICAgICAgY2VpbF9mbG9vcl9pbnQ6ICEwLAogICAgICAgIHNpbGVudF9vY3RhbF9saXRlcmFsOiAhMSwKICAgICAgfQogICAgICBTay5jb25maWd1cmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2sub3V0cHV0ID0gYS5vdXRwdXQgfHwgU2sub3V0cHV0CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLm91dHB1dCkKICAgICAgICBTay5kZWJ1Z291dCA9IGEuZGVidWdvdXQgfHwgU2suZGVidWdvdXQKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiZnVuY3Rpb24iID09PSB0eXBlb2YgU2suZGVidWdvdXQpCiAgICAgICAgU2sudW5jYXVnaHRFeGNlcHRpb24gPSBhLnVuY2F1Z2h0RXhjZXB0aW9uIHx8IFNrLnVuY2F1Z2h0RXhjZXB0aW9uCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLnVuY2F1Z2h0RXhjZXB0aW9uKQogICAgICAgIFNrLnJlYWQgPSBhLnJlYWQgfHwgU2sucmVhZAogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5yZWFkKQogICAgICAgIFNrLm5vbnJlYWRvcGVuID0gYS5ub25yZWFkb3BlbiB8fCAhMQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJib29sZWFuIiA9PT0gdHlwZW9mIFNrLm5vbnJlYWRvcGVuKQogICAgICAgIFNrLmZpbGVvcGVuID0gYS5maWxlb3BlbiB8fCB2b2lkIDAKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5maWxlb3BlbiB8fAogICAgICAgICAgICAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIFNrLmZpbGVvcGVuLAogICAgICAgICkKICAgICAgICBTay5maWxld3JpdGUgPSBhLmZpbGV3cml0ZSB8fCB2b2lkIDAKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5maWxld3JpdGUgfHwKICAgICAgICAgICAgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBTay5maWxld3JpdGUsCiAgICAgICAgKQogICAgICAgIFNrLnRpbWVvdXRNc2cgPSBhLnRpbWVvdXRNc2cgfHwgU2sudGltZW91dE1zZwogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay50aW1lb3V0TXNnKQogICAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudGltZW91dE1zZyIsIFNrLnRpbWVvdXRNc2cpCiAgICAgICAgU2suc3lzYXJndiA9IGEuc3lzYXJndiB8fCBTay5zeXNhcmd2CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoU2suaXNBcnJheUxpa2UoU2suc3lzYXJndikpCiAgICAgICAgU2suX19mdXR1cmVfXyA9IGEuX19mdXR1cmVfXyB8fCBTay5weXRob24yCiAgICAgICAgU2suYm9vbF9jaGVjaygKICAgICAgICAgIFNrLl9fZnV0dXJlX18ucHJpbnRfZnVuY3Rpb24sCiAgICAgICAgICAiU2suX19mdXR1cmVfXy5wcmludF9mdW5jdGlvbiIsCiAgICAgICAgKQogICAgICAgIFNrLmJvb2xfY2hlY2soU2suX19mdXR1cmVfXy5kaXZpc2lvbiwgIlNrLl9fZnV0dXJlX18uZGl2aXNpb24iKQogICAgICAgIFNrLmJvb2xfY2hlY2soCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLnVuaWNvZGVfbGl0ZXJhbHMsCiAgICAgICAgICAiU2suX19mdXR1cmVfXy51bmljb2RlX2xpdGVyYWxzIiwKICAgICAgICApCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLnNldF9yZXByLCAiU2suX19mdXR1cmVfXy5zZXRfcmVwciIpCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLmNsYXNzX3JlcHIsICJTay5fX2Z1dHVyZV9fLmNsYXNzX3JlcHIiKQogICAgICAgIFNrLmJvb2xfY2hlY2soCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLmluaGVyaXRfZnJvbV9vYmplY3QsCiAgICAgICAgICAiU2suX19mdXR1cmVfXy5pbmhlcml0X2Zyb21fb2JqZWN0IiwKICAgICAgICApCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLnN1cGVyX2FyZ3MsICJTay5fX2Z1dHVyZV9fLnN1cGVyX2FyZ3MiKQogICAgICAgIFNrLmJvb2xfY2hlY2soCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLm9jdGFsX251bWJlcl9saXRlcmFsLAogICAgICAgICAgIlNrLl9fZnV0dXJlX18ub2N0YWxfbnVtYmVyX2xpdGVyYWwiLAogICAgICAgICkKICAgICAgICBTay5ib29sX2NoZWNrKAogICAgICAgICAgU2suX19mdXR1cmVfXy5iYW5rZXJzX3JvdW5kaW5nLAogICAgICAgICAgIlNrLl9fZnV0dXJlX18uYmFua2Vyc19yb3VuZGluZyIsCiAgICAgICAgKQogICAgICAgIFNrLmJvb2xfY2hlY2soCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLnB5dGhvbl92ZXJzaW9uLAogICAgICAgICAgIlNrLl9fZnV0dXJlX18ucHl0aG9uX3ZlcnNpb24iLAogICAgICAgICkKICAgICAgICBTay5ib29sX2NoZWNrKFNrLl9fZnV0dXJlX18uZHVuZGVyX25leHQsICJTay5fX2Z1dHVyZV9fLmR1bmRlcl9uZXh0IikKICAgICAgICBTay5ib29sX2NoZWNrKFNrLl9fZnV0dXJlX18uZHVuZGVyX3JvdW5kLCAiU2suX19mdXR1cmVfXy5kdW5kZXJfcm91bmQiKQogICAgICAgIFNrLmJvb2xfY2hlY2soU2suX19mdXR1cmVfXy5saXN0X2NsZWFyLCAiU2suX19mdXR1cmVfXy5saXN0X2NsZWFyIikKICAgICAgICBTay5ib29sX2NoZWNrKFNrLl9fZnV0dXJlX18uZXhjZXB0aW9ucywgIlNrLl9fZnV0dXJlX18uZXhjZXB0aW9ucyIpCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLm5vX2xvbmdfdHlwZSwgIlNrLl9fZnV0dXJlX18ubm9fbG9uZ190eXBlIikKICAgICAgICBTay5ib29sX2NoZWNrKAogICAgICAgICAgU2suX19mdXR1cmVfXy5jZWlsX2Zsb29yX2ludCwKICAgICAgICAgICJTay5fX2Z1dHVyZV9fLmNlaWxfZmxvb3JfaW50IiwKICAgICAgICApCiAgICAgICAgU2suYm9vbF9jaGVjaygKICAgICAgICAgIFNrLl9fZnV0dXJlX18uc2lsZW50X29jdGFsX2xpdGVyYWwsCiAgICAgICAgICAiU2suX19mdXR1cmVfXy5zaWxlbnRfb2N0YWxfbGl0ZXJhbCIsCiAgICAgICAgKQogICAgICAgIFNrLmltYWdlUHJveHkgPSBhLmltYWdlUHJveHkgfHwgImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC8zMjB4IgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBTay5pbWFnZVByb3h5IHx8CiAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5pbWFnZVByb3h5LAogICAgICAgICkKICAgICAgICBTay5pbnB1dGZ1biA9IGEuaW5wdXRmdW4gfHwgU2suaW5wdXRmdW4KICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiZnVuY3Rpb24iID09PSB0eXBlb2YgU2suaW5wdXRmdW4pCiAgICAgICAgU2suaW5wdXRmdW5UYWtlc1Byb21wdCA9IGEuaW5wdXRmdW5UYWtlc1Byb21wdCB8fCAhMQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJib29sZWFuIiA9PT0gdHlwZW9mIFNrLmlucHV0ZnVuVGFrZXNQcm9tcHQpCiAgICAgICAgU2sucmV0YWluR2xvYmFscyA9IGEucmV0YWluZ2xvYmFscyB8fCAhMQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJib29sZWFuIiA9PT0gdHlwZW9mIFNrLnJldGFpbkdsb2JhbHMpCiAgICAgICAgU2suZGVidWdnaW5nID0gYS5kZWJ1Z2dpbmcgfHwgITEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiYm9vbGVhbiIgPT09IHR5cGVvZiBTay5kZWJ1Z2dpbmcpCiAgICAgICAgU2sua2lsbGFibGVXaGlsZSA9IGEua2lsbGFibGVXaGlsZSB8fCAhMQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJib29sZWFuIiA9PT0gdHlwZW9mIFNrLmtpbGxhYmxlV2hpbGUpCiAgICAgICAgU2sua2lsbGFibGVGb3IgPSBhLmtpbGxhYmxlRm9yIHx8ICExCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImJvb2xlYW4iID09PSB0eXBlb2YgU2sua2lsbGFibGVGb3IpCiAgICAgICAgU2suc2lnbmFscyA9IGEuc2lnbmFscwogICAgICAgIFNrLnNpZ25hbHMgPQogICAgICAgICAgITAgPT09IFNrLnNpZ25hbHMKICAgICAgICAgICAgPyB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcnM6IFtdLAogICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICBTay5zaWduYWxzLmxpc3RlbmVycy5wdXNoKGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICBhID0gU2suc2lnbmFscy5saXN0ZW5lcnMuaW5kZXhPZihhKQogICAgICAgICAgICAgICAgICAwIDw9IGEgJiYgU2suc2lnbmFscy5saXN0ZW5lcnMuc3BsaWNlKGEsIDEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2lnbmFsOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgU2suc2lnbmFscy5saXN0ZW5lcnMubGVuZ3RoOyBiKyspCiAgICAgICAgICAgICAgICAgICAgU2suc2lnbmFscy5saXN0ZW5lcnNbYl0uY2FsbChudWxsLCBhLCBjKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDogbnVsbAogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJvYmplY3QiID09PSB0eXBlb2YgU2suc2lnbmFscykKICAgICAgICBTay5icmVha3BvaW50cyA9CiAgICAgICAgICBhLmJyZWFrcG9pbnRzIHx8CiAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLmJyZWFrcG9pbnRzKQogICAgICAgIFNrLnNldFRpbWVvdXQgPSBhLnNldFRpbWVvdXQKICAgICAgICB2b2lkIDAgPT09IFNrLnNldFRpbWVvdXQgJiYKICAgICAgICAgIChTay5zZXRUaW1lb3V0ID0KICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHNldFRpbWVvdXQKICAgICAgICAgICAgICA/IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChhLCBjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICBhKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLnNldFRpbWVvdXQpCiAgICAgICAgImV4ZWNMaW1pdCIgaW4gYSAmJiAoU2suZXhlY0xpbWl0ID0gYS5leGVjTGltaXQpCiAgICAgICAgInlpZWxkTGltaXQiIGluIGEgJiYgKFNrLnlpZWxkTGltaXQgPSBhLnlpZWxkTGltaXQpCiAgICAgICAgYS5zeXNwYXRoICYmCiAgICAgICAgICAoKFNrLnN5c3BhdGggPSBhLnN5c3BhdGgpLAogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoU2suaXNBcnJheUxpa2UoU2suc3lzcGF0aCkpLAogICAgICAgICAgKFNrLnJlYWxzeXNwYXRoID0gdm9pZCAwKSwKICAgICAgICAgIChTay5zeXNtb2R1bGVzID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbXSkpKQogICAgICAgIFNrLm1pc2NldmFsLnNvZnRzcGFjZV8gPSAhMQogICAgICAgIFNrLnN3aXRjaF92ZXJzaW9uKCJyb3VuZCQiLCBTay5fX2Z1dHVyZV9fLmR1bmRlcl9yb3VuZCkKICAgICAgICBTay5zd2l0Y2hfdmVyc2lvbigibmV4dCQiLCBTay5fX2Z1dHVyZV9fLmR1bmRlcl9uZXh0KQogICAgICAgIFNrLnN3aXRjaF92ZXJzaW9uKCJjbGVhciQiLCBTay5fX2Z1dHVyZV9fLmxpc3RfY2xlYXIpCiAgICAgICAgU2suYnVpbHRpbi5sbmcudHAkbmFtZSA9IFNrLl9fZnV0dXJlX18ubm9fbG9uZ190eXBlID8gImludCIgOiAibG9uZyIKICAgICAgICBTay5zZXR1cE9wZXJhdG9ycyhTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgU2suc2V0dXBEdW5kZXJNZXRob2RzKFNrLl9fZnV0dXJlX18ucHl0aG9uMykKICAgICAgICBTay5zZXR1cE9iamVjdHMoU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suY29uZmlndXJlIiwgU2suY29uZmlndXJlKQogICAgICBTay51bmNhdWdodEV4Y2VwdGlvbiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2sudW5jYXVnaHRFeGNlcHRpb24gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudW5jYXVnaHRFeGNlcHRpb24iLCBTay51bmNhdWdodEV4Y2VwdGlvbikKICAgICAgU2sudGltZW91dE1zZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAiUHJvZ3JhbSBleGNlZWRlZCBydW4gdGltZSBsaW1pdC4iCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay50aW1lb3V0TXNnIiwgU2sudGltZW91dE1zZykKICAgICAgU2suZXhlY0xpbWl0ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZCiAgICAgIFNrLnlpZWxkTGltaXQgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkKICAgICAgU2sub3V0cHV0ID0gZnVuY3Rpb24oYSkge30KICAgICAgU2sucmVhZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aHJvdyAiU2sucmVhZCBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQiCiAgICAgIH0KICAgICAgU2suc3lzYXJndiA9IFtdCiAgICAgIFNrLmdldFN5c0FyZ3YgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gU2suc3lzYXJndgogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZ2V0U3lzQXJndiIsIFNrLmdldFN5c0FyZ3YpCiAgICAgIFNrLnN5c3BhdGggPSBbXQogICAgICBTay5pbkJyb3dzZXIgPSB2b2lkIDAgIT09IFNrLmdsb2JhbC5kb2N1bWVudAogICAgICBTay5kZWJ1Z291dCA9IGZ1bmN0aW9uKGEpIHt9CiAgICAgIDsoZnVuY3Rpb24oKSB7CiAgICAgICAgdm9pZCAwICE9PSBTay5nbG9iYWwud3JpdGUKICAgICAgICAgID8gKFNrLm91dHB1dCA9IFNrLmdsb2JhbC53cml0ZSkKICAgICAgICAgIDogdm9pZCAwICE9PSBTay5nbG9iYWwuY29uc29sZSAmJiB2b2lkIDAgIT09IFNrLmdsb2JhbC5jb25zb2xlLmxvZwogICAgICAgICAgPyAoU2sub3V0cHV0ID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgIFNrLmdsb2JhbC5jb25zb2xlLmxvZyhhKQogICAgICAgICAgICB9KQogICAgICAgICAgOiB2b2lkIDAgIT09IFNrLmdsb2JhbC5wcmludCAmJiAoU2sub3V0cHV0ID0gU2suZ2xvYmFsLnByaW50KQogICAgICAgIHZvaWQgMCAhPT0gU2suZ2xvYmFsLmNvbnNvbGUgJiYgdm9pZCAwICE9PSBTay5nbG9iYWwuY29uc29sZS5sb2cKICAgICAgICAgID8gKFNrLmRlYnVnb3V0ID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgIFNrLmdsb2JhbC5jb25zb2xlLmxvZyhhKQogICAgICAgICAgICB9KQogICAgICAgICAgOiB2b2lkIDAgIT09IFNrLmdsb2JhbC5wcmludCAmJiAoU2suZGVidWdvdXQgPSBTay5nbG9iYWwucHJpbnQpCiAgICAgIH0pKCkKICAgICAgU2suaW5wdXRmdW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5wcm9tcHQoYSkKICAgICAgfQogICAgICBTay5zZXR1cF9tZXRob2RfbWFwcGluZ3MgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcm91bmQkOiB7CiAgICAgICAgICAgIGNsYXNzZXM6IFtTay5idWlsdGluLmZsb2F0XywgU2suYnVpbHRpbi5pbnRfLCBTay5idWlsdGluLm5tYmVyXSwKICAgICAgICAgICAgMjogbnVsbCwKICAgICAgICAgICAgMzogIl9fcm91bmRfXyIsCiAgICAgICAgICB9LAogICAgICAgICAgY2xlYXIkOiB7IGNsYXNzZXM6IFtTay5idWlsdGluLmxpc3RdLCAyOiBudWxsLCAzOiAiY2xlYXIiIH0sCiAgICAgICAgICBuZXh0JDogewogICAgICAgICAgICBjbGFzc2VzOiBbCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5kaWN0X2l0ZXJfLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4ubGlzdF9pdGVyXywKICAgICAgICAgICAgICBTay5idWlsdGluLnNldF9pdGVyXywKICAgICAgICAgICAgICBTay5idWlsdGluLnN0cl9pdGVyXywKICAgICAgICAgICAgICBTay5idWlsdGluLnR1cGxlX2l0ZXJfLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uZ2VuZXJhdG9yLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXywKICAgICAgICAgICAgICBTay5idWlsdGluLnppcF8sCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5tYXBfLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uaXRlcmF0b3IsCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIDI6ICJuZXh0IiwKICAgICAgICAgICAgMzogIl9fbmV4dF9fIiwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLnN3aXRjaF92ZXJzaW9uID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgdmFyIGQgPSBTay5zZXR1cF9tZXRob2RfbWFwcGluZ3MoKVthXQogICAgICAgIGlmIChiKSB7CiAgICAgICAgICBiID0gZFszXQogICAgICAgICAgdmFyIGUgPSBkWzJdCiAgICAgICAgfSBlbHNlIChiID0gZFsyXSksIChlID0gZFszXSkKICAgICAgICB2YXIgZiA9IGQuY2xhc3NlcwogICAgICAgIHZhciBnID0gZi5sZW5ndGgKICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZzsgYysrKQogICAgICAgICAgKGQgPSBmW2NdKSwKICAgICAgICAgICAgZSAmJiBkLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShlKSAmJiBkZWxldGUgZC5wcm90b3R5cGVbZV0sCiAgICAgICAgICAgIGIgJiYgKGQucHJvdG90eXBlW2JdID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhkLnByb3RvdHlwZVthXSkpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5fX2Z1dHVyZV9fIiwgU2suX19mdXR1cmVfXykKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5pbnB1dGZ1biIsIFNrLmlucHV0ZnVuKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgdm9pZCAwID09PSBTay5idWlsdGluICYmIChTay5idWlsdGluID0ge30pCiAgICAgIFNrLmR1bmRlclRvU2t1bHB0ID0gewogICAgICAgIF9fZXFfXzogIm9iJGVxIiwKICAgICAgICBfX25lX186ICJvYiRuZSIsCiAgICAgICAgX19sdF9fOiAib2IkbHQiLAogICAgICAgIF9fbGVfXzogIm9iJGxlIiwKICAgICAgICBfX2d0X186ICJvYiRndCIsCiAgICAgICAgX19nZV9fOiAib2IkZ2UiLAogICAgICAgIF9faGFzaF9fOiAidHAkaGFzaCIsCiAgICAgICAgX19hYnNfXzogIm5iJGFicyIsCiAgICAgICAgX19uZWdfXzogIm5iJG5lZ2F0aXZlIiwKICAgICAgICBfX3Bvc19fOiAibmIkcG9zaXRpdmUiLAogICAgICAgIF9faW50X186ICJuYiRpbnRfIiwKICAgICAgICBfX2xvbmdfXzogIm5iJGxuZyIsCiAgICAgICAgX19mbG9hdF9fOiAibmIkZmxvYXRfIiwKICAgICAgICBfX2FkZF9fOiAibmIkYWRkIiwKICAgICAgICBfX3JhZGRfXzogIm5iJHJlZmxlY3RlZF9hZGQiLAogICAgICAgIF9fc3ViX186ICJuYiRzdWJ0cmFjdCIsCiAgICAgICAgX19yc3ViX186ICJuYiRyZWZsZWN0ZWRfc3VidHJhY3QiLAogICAgICAgIF9fbXVsX186ICJuYiRtdWx0aXBseSIsCiAgICAgICAgX19ybXVsX186ICJuYiRyZWZsZWN0ZWRfbXVsdGlwbHkiLAogICAgICAgIF9fZGl2X186ICJuYiRkaXZpZGUiLAogICAgICAgIF9fcmRpdl9fOiAibmIkcmVmbGVjdGVkX2RpdmlkZSIsCiAgICAgICAgX19mbG9vcmRpdl9fOiAibmIkZmxvb3JfZGl2aWRlIiwKICAgICAgICBfX3JmbG9vcmRpdl9fOiAibmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSIsCiAgICAgICAgX19tb2RfXzogIm5iJHJlbWFpbmRlciIsCiAgICAgICAgX19ybW9kX186ICJuYiRyZWZsZWN0ZWRfcmVtYWluZGVyIiwKICAgICAgICBfX2Rpdm1vZF9fOiAibmIkZGl2bW9kIiwKICAgICAgICBfX3JkaXZtb2RfXzogIm5iJHJlZmxlY3RlZF9kaXZtb2QiLAogICAgICAgIF9fcG93X186ICJuYiRwb3dlciIsCiAgICAgICAgX19ycG93X186ICJuYiRyZWZsZWN0ZWRfcG93ZXIiLAogICAgICAgIF9fY29udGFpbnNfXzogInNxJGNvbnRhaW5zIiwKICAgICAgICBfX2xlbl9fOiBbInNxJGxlbmd0aCIsIDFdLAogICAgICAgIF9fZ2V0X186IFsidHAkZGVzY3JfZ2V0IiwgM10sCiAgICAgICAgX19zZXRfXzogWyJ0cCRkZXNjcl9zZXQiLCAzXSwKICAgICAgfQogICAgICBTay5zZXR1cER1bmRlck1ldGhvZHMgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYQogICAgICAgICAgPyAoKFNrLmR1bmRlclRvU2t1bHB0Ll9fbWF0bXVsX18gPSAidHAkbWF0bXVsIiksCiAgICAgICAgICAgIChTay5kdW5kZXJUb1NrdWxwdC5fX3JtYXRtdWxfXyA9ICJ0cCRyZWZsZWN0ZWRfbWF0bXVsIikpCiAgICAgICAgICA6IChTay5kdW5kZXJUb1NrdWxwdC5fX21hdG11bF9fICYmCiAgICAgICAgICAgICAgZGVsZXRlIFNrLmR1bmRlclRvU2t1bHB0Ll9fbWF0bXVsX18sCiAgICAgICAgICAgIFNrLmR1bmRlclRvU2t1bHB0Ll9fcm1hdG11bF9fICYmCiAgICAgICAgICAgICAgZGVsZXRlIFNrLmR1bmRlclRvU2t1bHB0Ll9fcm1hdG11bF9fKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suc2V0dXBEdW5kZXJNZXRob2RzIiwgU2suc2V0dXBEdW5kZXJNZXRob2RzKQogICAgICBTay5idWlsdGluLnR5cGUgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQKICAgICAgICBpZiAodm9pZCAwID09PSBiICYmIHZvaWQgMCA9PT0gYykgcmV0dXJuIGEub2IkdHlwZQogICAgICAgIGlmICgiZGljdCIgIT09IGMudHAkbmFtZSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgInR5cGUoKSBhcmd1bWVudCAzIG11c3QgYmUgZGljdCwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShjKSwKICAgICAgICAgICkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJ0eXBlKCkgYXJndW1lbnQgMSBtdXN0IGJlIHN0ciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICAgICkKICAgICAgICBpZiAoInR1cGxlIiAhPT0gYi50cCRuYW1lKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAidHlwZSgpIGFyZ3VtZW50IDIgbXVzdCBiZSB0dXBsZSwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICB2YXIgZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHZvaWQgMCAhPT0gZS5wcm90b3R5cGUudHAkYmFzZSAmJgogICAgICAgICAgICAoZS5wcm90b3R5cGUudHAkYmFzZS5zayRrbGFzcwogICAgICAgICAgICAgID8gZS5wcm90b3R5cGUudHAkYmFzZS5jYWxsKHRoaXMsIGEsIGIpCiAgICAgICAgICAgICAgOiAoKGEgPSBhLnNsaWNlKCkpLAogICAgICAgICAgICAgICAgYS51bnNoaWZ0KGUsIHRoaXMpLAogICAgICAgICAgICAgICAgU2suYWJzdHIuc3VwZXJDb25zdHJ1Y3Rvci5hcHBseSh2b2lkIDAsIGEpKSkKICAgICAgICAgIHRoaXMuJGQgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgICAgdGhpcy4kZC5tcCRhc3Nfc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnN0cigiX19kaWN0X18iKSwgdGhpcy4kZCkKICAgICAgICB9CiAgICAgICAgdmFyIGYgPSBTay5mZmkucmVtYXBUb0pzKGEpLAogICAgICAgICAgZyA9ICExCiAgICAgICAgZS50cCRjYWxsID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cChlLCBTay5idWlsdGluLnN0ci4kbmV3KQogICAgICAgICAgYSA9IGEgfHwgW10KICAgICAgICAgIGIgPSBiIHx8IFtdCiAgICAgICAgICBpZiAodm9pZCAwID09PSBjIHx8IGMgPT09IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX25ld19fKSB7CiAgICAgICAgICAgIHZhciBkID0gbmV3IGUoYSwgYikKICAgICAgICAgICAgYyA9IHZvaWQgMAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGsgPSBhLnNsaWNlKCkKICAgICAgICAgICAgay51bnNoaWZ0KGUpCiAgICAgICAgICAgIGQgPSBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChjLCB2b2lkIDAsIHZvaWQgMCwgYiwgaykKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgZCwKICAgICAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciBrID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoCiAgICAgICAgICAgICAgICBlLm9iJHR5cGUsCiAgICAgICAgICAgICAgICBTay5idWlsdGluLnN0ci4kaW5pdCwKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgZCA9IGUKICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBrKQogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgYS51bnNoaWZ0KGQpLAogICAgICAgICAgICAgICAgICBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChrLCB2b2lkIDAsIHZvaWQgMCwgYiwgYSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBjICYmICgwICE9PSBhLmxlbmd0aCB8fCAwICE9PSBiLmxlbmd0aCkgJiYgIWcpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAgICJfX2luaXRfXygpIGdvdCB1bmV4cGVjdGVkIGFyZ3VtZW50KHMpIiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgIGlmIChhICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQgJiYgdm9pZCAwICE9PSBhKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAiX19pbml0X18oKSBzaG91bGQgcmV0dXJuIE5vbmUsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgfSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgMCA9PT0gYi52Lmxlbmd0aCAmJgogICAgICAgICAgU2suX19mdXR1cmVfXy5pbmhlcml0X2Zyb21fb2JqZWN0ICYmCiAgICAgICAgICAoYi52LnB1c2goU2suYnVpbHRpbi5vYmplY3QpLAogICAgICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZShmLCBlLCBTay5idWlsdGluLm9iamVjdCkpCiAgICAgICAgdmFyIGgsCiAgICAgICAgICBrID0gW10KICAgICAgICB2YXIgbCA9IGIudHAkaXRlcigpCiAgICAgICAgZm9yIChkID0gbC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBsLnRwJGl0ZXJuZXh0KCkpIHsKICAgICAgICAgIGZvciAodm9pZCAwID09PSBoICYmIChoID0gZCk7IGQuc2ska2xhc3MgJiYgZC5wcm90b3R5cGUudHAkYmFzZTsgKQogICAgICAgICAgICBkID0gZC5wcm90b3R5cGUudHAkYmFzZQogICAgICAgICAgIWQuc2ska2xhc3MgJiYgMCA+IGsuaW5kZXhPZihkKSAmJiAoay5wdXNoKGQpLCAoZyA9ICEwKSkKICAgICAgICB9CiAgICAgICAgaWYgKDEgPCBrLmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIk11bHRpcGxlIGluaGVyaXRhbmNlIHdpdGggbW9yZSB0aGFuIG9uZSBidWlsdGluIHR5cGUgaXMgdW5zdXBwb3J0ZWQiLAogICAgICAgICAgKQogICAgICAgIHZvaWQgMCAhPT0gaCAmJgogICAgICAgICAgKFNrLmFic3RyLmluaGVyaXRzKGUsIGgpLAogICAgICAgICAgaC5wcm90b3R5cGUgaW5zdGFuY2VvZiBTay5idWlsdGluLm9iamVjdCB8fAogICAgICAgICAgICBoID09PSBTay5idWlsdGluLm9iamVjdCkgJiYKICAgICAgICAgIChlLnByb3RvdHlwZS50cCRiYXNlID0gaCkKICAgICAgICBlLnByb3RvdHlwZS50cCRuYW1lID0gZgogICAgICAgIGUucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKGYsIGUpCiAgICAgICAgdmFyIHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbW9kdWxlX18iKQogICAgICAgIHZvaWQgMCA9PT0gYy5tcCRsb29rdXAocikgJiYgYy5tcCRhc3Nfc3Vic2NyaXB0KHIsIFNrLmdsb2JhbHMuX19uYW1lX18pCiAgICAgICAgbCA9IGMudHAkaXRlcigpCiAgICAgICAgZm9yIChoID0gbC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGg7IGggPSBsLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAoZCA9IGMubXAkc3Vic2NyaXB0KGgpKSwKICAgICAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gbnVsbCksCiAgICAgICAgICAgIChlLnByb3RvdHlwZVtoLnZdID0gZCksCiAgICAgICAgICAgIChlW2gudl0gPSBkKQogICAgICAgIGUuX19jbGFzc19fID0gZQogICAgICAgIGUuX19uYW1lX18gPSBhCiAgICAgICAgZS5zayRrbGFzcyA9ICEwCiAgICAgICAgZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhID0gdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZXByKQogICAgICAgICAgaWYgKAogICAgICAgICAgICB2b2lkIDAgIT09IGEgJiYKICAgICAgICAgICAgYS5pbV9mdW5jICE9PSBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19yZXByX18KICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5KGEsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIFtdKQogICAgICAgICAgaWYgKAogICAgICAgICAgICB2b2lkIDAgIT09IGUucHJvdG90eXBlLnRwJGJhc2UgJiYKICAgICAgICAgICAgZS5wcm90b3R5cGUudHAkYmFzZSAhPT0gU2suYnVpbHRpbi5vYmplY3QgJiYKICAgICAgICAgICAgdm9pZCAwICE9PSBlLnByb3RvdHlwZS50cCRiYXNlLnByb3RvdHlwZS4kcgogICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUudHAkYmFzZS5wcm90b3R5cGUuJHIuY2FsbCh0aGlzKQogICAgICAgICAgdmFyIGIgPSBjLm1wJHN1YnNjcmlwdChyKQogICAgICAgICAgYSA9ICIiCiAgICAgICAgICBiICYmIChhID0gYi52ICsgIi4iKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPCIgKyBhICsgZiArICIgb2JqZWN0PiIpCiAgICAgICAgfQogICAgICAgIGUucHJvdG90eXBlLnRwJHNldGF0dHIgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljR2V0QXR0ci5jYWxsKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBTay5idWlsdGluLnN0ci4kc2V0YXR0ciwKICAgICAgICAgICkKICAgICAgICAgIHJldHVybiB2b2lkIDAgIT09IGQKICAgICAgICAgICAgPyAoKGEgPSBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoZCwgW2EsIGJdKSksCiAgICAgICAgICAgICAgYyA/IGEgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYSkpCiAgICAgICAgICAgIDogU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNTZXRBdHRyLmNhbGwodGhpcywgYSwgYiwgYykKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkZ2V0YXR0ciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHZhciBjCiAgICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4udHlwZS50eXBlTG9va3VwKGUsIFNrLmJ1aWx0aW4uc3RyLiRnZXRhdHRyaWJ1dGUpCiAgICAgICAgICB2b2lkIDAgIT09IGQgJiYKICAgICAgICAgICAgbnVsbCAhPT0gZCAmJgogICAgICAgICAgICB2b2lkIDAgIT09IGQudHAkZGVzY3JfZ2V0ICYmCiAgICAgICAgICAgIChjID0gZC50cCRkZXNjcl9nZXQuY2FsbChkLCB0aGlzLCBlKSkKICAgICAgICAgIHZvaWQgMCA9PT0gYyAmJgogICAgICAgICAgICAoYyA9IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uR2V0QXR0ci5iaW5kKAogICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgKSkKICAgICAgICAgIGQgPSBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheShjLCBbYV0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICBpZiAoIShhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcikpIHRocm93IGEKICAgICAgICAgICAgfSwKICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBiID8gZCA6IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyhkKQogICAgICAgIH0KICAgICAgICBlLnByb3RvdHlwZS50cCRzdHIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhID0gdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRzdHIpCiAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBhICYmCiAgICAgICAgICAgIGEuaW1fZnVuYyAhPT0gU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fc3RyX18KICAgICAgICAgICAgPyBTay5taXNjZXZhbC5hcHBseShhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBbXSkKICAgICAgICAgICAgOiB2b2lkIDAgIT09IGUucHJvdG90eXBlLnRwJGJhc2UgJiYKICAgICAgICAgICAgICBlLnByb3RvdHlwZS50cCRiYXNlICE9PSBTay5idWlsdGluLm9iamVjdCAmJgogICAgICAgICAgICAgIHZvaWQgMCAhPT0gZS5wcm90b3R5cGUudHAkYmFzZS5wcm90b3R5cGUudHAkc3RyCiAgICAgICAgICAgID8gZS5wcm90b3R5cGUudHAkYmFzZS5wcm90b3R5cGUudHAkc3RyLmNhbGwodGhpcykKICAgICAgICAgICAgOiB0aGlzLiRyKCkKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkbGVuZ3RoID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgdmFyIGIgPSBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgU2suYWJzdHIuZ2F0dHIodGhpcywgU2suYnVpbHRpbi5zdHIuJGxlbiwgYSksCiAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgW10pCiAgICAgICAgICAgIH0sCiAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gYSA/IGIgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYikKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkY2FsbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRjYWxsLCAhMCksCiAgICAgICAgICAgIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBjKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZSh0aGlzKSArICInIG9iamVjdCBpcyBub3QgY2FsbGFibGUiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChjLCB2b2lkIDAsIHZvaWQgMCwgYiwgYSkKICAgICAgICAgICAgfSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkaXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGEgPSB0aGlzLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJGl0ZXIpCiAgICAgICAgICBpZiAodm9pZCAwID09PSBhKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUodGhpcykgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhKQogICAgICAgIH0KICAgICAgICBlLnByb3RvdHlwZS50cCRpdGVybmV4dCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHZhciBiID0gdGhpcywKICAgICAgICAgICAgYyA9IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICAgIGIudHAkZ2V0YXR0cigKICAgICAgICAgICAgICAgIFNrLl9fZnV0dXJlX18uZHVuZGVyX25leHQKICAgICAgICAgICAgICAgICAgPyBTay5idWlsdGluLnN0ci4kbmV4dDMKICAgICAgICAgICAgICAgICAgOiBTay5idWlsdGluLnN0ci4kbmV4dDIsCiAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheShhKQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbikpIHRocm93IGEKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gYSA/IGMgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYykKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkZ2V0aXRlbSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHZhciBjID0gdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtLCBiKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYykKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAoYSA9IFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKGMsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIFthXSkpLAogICAgICAgICAgICAgIGIgPyBhIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGEpCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZSh0aGlzKSArCiAgICAgICAgICAgICAgIicgb2JqZWN0IGRvZXMgbm90IHN1cHBvcnQgaW5kZXhpbmciLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBlLnByb3RvdHlwZS50cCRzZXRpdGVtID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgdmFyIGQgPSB0aGlzLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJHNldGl0ZW0sIGMpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBkKQogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIChhID0gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoZCwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgWwogICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgXSkpLAogICAgICAgICAgICAgIGMgPyBhIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGEpCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZSh0aGlzKSArCiAgICAgICAgICAgICAgIicgb2JqZWN0IGRvZXMgbm90IHN1cHBvcnQgaXRlbSBhc3NpZ25tZW50IiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgYiAmJgogICAgICAgICAgKChlLiRkID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbXSkpLAogICAgICAgICAgZS4kZC5tcCRhc3Nfc3Vic2NyaXB0KFNrLmJ1aWx0aW4udHlwZS5iYXNlc1N0cl8sIGIpLAogICAgICAgICAgKGEgPSBTay5idWlsdGluLnR5cGUuYnVpbGRNUk8oZSkpLAogICAgICAgICAgZS4kZC5tcCRhc3Nfc3Vic2NyaXB0KFNrLmJ1aWx0aW4udHlwZS5tcm9TdHJfLCBhKSwKICAgICAgICAgIChlLnRwJG1ybyA9IGEpKQogICAgICAgIGUudHAkc2V0YXR0ciA9IFNrLmJ1aWx0aW4udHlwZS5wcm90b3R5cGUudHAkc2V0YXR0cgogICAgICAgIGEgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgICBlLnByb3RvdHlwZVthXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYSA9ICExLAogICAgICAgICAgICAgIGIgPSBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgICAgIGUKICAgICAgICAgICAgdmFyIGsgPSBudWxsICE9PSBkICYmIGQgPD0gYiA/IEFycmF5KGIpIDogQXJyYXkoYiArIDEpCiAgICAgICAgICAgIGtbMF0gPSB0aGlzCiAgICAgICAgICAgIHZhciBnID0gMQogICAgICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYjsgZSsrKQogICAgICAgICAgICAgIGUgPT09IGQgLSAxCiAgICAgICAgICAgICAgICA/IChhID0gYXJndW1lbnRzW2VdKQogICAgICAgICAgICAgICAgOiAoKGtbZ10gPSBhcmd1bWVudHNbZV0pLCAoZyArPSAxKSkKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICA/IFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheShjLCBrKQogICAgICAgICAgICAgIDogU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIGspCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIG4gaW4gU2suZHVuZGVyVG9Ta3VscHQpCiAgICAgICAgICAoYiA9IFNrLmR1bmRlclRvU2t1bHB0W25dKSwKICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBiID8gKGwgPSBudWxsKSA6ICgobCA9IGJbMV0pLCAoYiA9IGJbMF0pKSwKICAgICAgICAgICAgZVtuXSAmJiBhKGIsIG4sIGVbbl0sIGwpCiAgICAgICAgcmV0dXJuIGUKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUubWFrZVR5cGVPYmogPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi50eXBlLm1ha2VJbnRvVHlwZU9iaihhLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLm1ha2VJbnRvVHlwZU9iaiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBiKQogICAgICAgIGIub2IkdHlwZSA9IFNrLmJ1aWx0aW4udHlwZQogICAgICAgIGIudHAkbmFtZSA9IGEKICAgICAgICBiLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgYSA9IGIuX19tb2R1bGVfXywKICAgICAgICAgICAgZCA9ICIiCiAgICAgICAgICBhICYmIChkID0gYS52ICsgIi4iKQogICAgICAgICAgdmFyIGUgPSAiY2xhc3MiCiAgICAgICAgICBhIHx8IGIuc2ska2xhc3MgfHwgU2suX19mdXR1cmVfXy5jbGFzc19yZXByIHx8IChlID0gInR5cGUiKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPCIgKyBlICsgIiAnIiArIGQgKyBiLnRwJG5hbWUgKyAiJz4iKQogICAgICAgIH0KICAgICAgICBiLnRwJHN0ciA9IHZvaWQgMAogICAgICAgIGIudHAkZ2V0YXR0ciA9IFNrLmJ1aWx0aW4udHlwZS5wcm90b3R5cGUudHAkZ2V0YXR0cgogICAgICAgIGIudHAkc2V0YXR0ciA9IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljU2V0QXR0cgogICAgICAgIGIudHAkcmljaGNvbXBhcmUgPSBTay5idWlsdGluLnR5cGUucHJvdG90eXBlLnRwJHJpY2hjb21wYXJlCiAgICAgICAgYi5zayR0eXBlID0gITAKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5vYiR0eXBlID0gU2suYnVpbHRpbi50eXBlCiAgICAgIFNrLmJ1aWx0aW4udHlwZS50cCRuYW1lID0gInR5cGUiCiAgICAgIFNrLmJ1aWx0aW4udHlwZS5zayR0eXBlID0gITAKICAgICAgU2suYnVpbHRpbi50eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIFNrLl9fZnV0dXJlX18uY2xhc3NfcmVwcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIjxjbGFzcyAndHlwZSc+IikKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uc3RyKCI8dHlwZSAndHlwZSc+IikKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUucHJvdG90eXBlLnRwJGdldGF0dHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMuJGQpIHsKICAgICAgICAgIHZhciBjID0gdGhpcy4kZC5tcCRsb29rdXAoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGEgPSBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cCh0aGlzLCBhKQogICAgICAgIGlmICh2b2lkIDAgIT09IGEgJiYgbnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEub2IkdHlwZSkKICAgICAgICAgIHZhciBkID0gYS50cCRkZXNjcl9nZXQKICAgICAgICBpZiAoZCkgcmV0dXJuIGQuY2FsbChhLCBTay5idWlsdGluLm5vbmUubm9uZSQsIHRoaXMsIGIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYSkgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUucHJvdG90eXBlLnRwJHNldGF0dHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdGhpc1thLiRqc3N0cigpXSA9IGIKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEudHAkbXJvLAogICAgICAgICAgZCwKICAgICAgICAgIGUgPSBiLiRqc3N0cigpCiAgICAgICAgaWYgKGMpCiAgICAgICAgICBmb3IgKGQgPSAwOyBkIDwgYy52Lmxlbmd0aDsgKytkKSB7CiAgICAgICAgICAgIGEgPSBjLnZbZF0KICAgICAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoZSkpIHJldHVybiBhW2VdCiAgICAgICAgICAgIHZhciBmID0gYS4kZC5tcCRsb29rdXAoYikKICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZikgcmV0dXJuIGYKICAgICAgICAgICAgaWYgKGEucHJvdG90eXBlICYmIHZvaWQgMCAhPT0gYS5wcm90b3R5cGVbZV0pIHJldHVybiBhLnByb3RvdHlwZVtlXQogICAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGEucHJvdG90eXBlKSByZXR1cm4gYS5wcm90b3R5cGVbZV0KICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUubXJvTWVyZ2VfID0gZnVuY3Rpb24oYSkgewogICAgICAgIGZvciAodmFyIGIsIGMsIGQsIGUsIGYsIGcsIGggPSBbXTsgOyApIHsKICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBhLmxlbmd0aCAmJiAoKGIgPSBhW2NdKSwgMCA9PT0gYi5sZW5ndGgpOyArK2MpOwogICAgICAgICAgaWYgKGMgPT09IGEubGVuZ3RoKSByZXR1cm4gaAogICAgICAgICAgZCA9IFtdCiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykKICAgICAgICAgICAgaWYgKCgoYiA9IGFbY10pLCAwICE9PSBiLmxlbmd0aCkpIHsKICAgICAgICAgICAgICBnID0gYlswXQogICAgICAgICAgICAgIGYgPSAwCiAgICAgICAgICAgICAgYTogZm9yICg7IGYgPCBhLmxlbmd0aDsgKytmKQogICAgICAgICAgICAgICAgZm9yIChlID0gYVtmXSwgYiA9IDE7IGIgPCBlLmxlbmd0aDsgKytiKSBpZiAoZVtiXSA9PT0gZykgYnJlYWsgYQogICAgICAgICAgICAgIGYgPT09IGEubGVuZ3RoICYmIGQucHVzaChnKQogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoMCA9PT0gZC5sZW5ndGgpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiSW5jb25zaXN0ZW50IHByZWNlZGVuY2VzIGluIHR5cGUgaGllcmFyY2h5IiwKICAgICAgICAgICAgKQogICAgICAgICAgZCA9IGRbMF0KICAgICAgICAgIGgucHVzaChkKQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGEubGVuZ3RoOyArK2MpCiAgICAgICAgICAgIChiID0gYVtjXSksIDAgPCBiLmxlbmd0aCAmJiBiWzBdID09PSBkICYmIGIuc3BsaWNlKDAsIDEpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5idWlsZE1ST18gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBbW2FdXSwKICAgICAgICAgIGMgPSBhLiRkLm1wJHN1YnNjcmlwdChTay5idWlsdGluLnR5cGUuYmFzZXNTdHJfKQogICAgICAgIGZvciAoYSA9IDA7IGEgPCBjLnYubGVuZ3RoOyArK2EpCiAgICAgICAgICBiLnB1c2goU2suYnVpbHRpbi50eXBlLmJ1aWxkTVJPXyhjLnZbYV0pKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYy52Lmxlbmd0aDsgKythKSBkLnB1c2goYy52W2FdKQogICAgICAgIGIucHVzaChkKQogICAgICAgIHJldHVybiBTay5idWlsdGluLnR5cGUubXJvTWVyZ2VfKGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLmJ1aWxkTVJPID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShTay5idWlsdGluLnR5cGUuYnVpbGRNUk9fKGEpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5wcm90b3R5cGUudHAkcmljaGNvbXBhcmUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEub2IkdHlwZSA9PSBTay5idWlsdGluLnR5cGUgJiYgdGhpcy4kciAmJiBhLiRyKSB7CiAgICAgICAgICB2YXIgYyA9IHRoaXMuJHIoKQogICAgICAgICAgYSA9IGEuJHIoKQogICAgICAgICAgcmV0dXJuIGMudHAkcmljaGNvbXBhcmUoYSwgYikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLnByb3RvdHlwZS5fX2Zvcm1hdF9fID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZm9ybWF0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUucHl0aG9uRnVuY3Rpb25zID0gWyJfX2Zvcm1hdF9fIl0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmFic3RyID0ge30KICAgICAgU2suYWJzdHIudHlwZU5hbWUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gYS50cCRuYW1lID8gYS50cCRuYW1lIDogIjxpbnZhbGlkIHR5cGU+IgogICAgICB9CiAgICAgIFNrLmFic3RyLmJpbm9wX3R5cGVfZXJyb3IgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgYiA9IFNrLmFic3RyLnR5cGVOYW1lKGIpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgInVuc3VwcG9ydGVkIG9wZXJhbmQgdHlwZShzKSBmb3IgIiArCiAgICAgICAgICAgIGMgKwogICAgICAgICAgICAiOiAnIiArCiAgICAgICAgICAgIGEgKwogICAgICAgICAgICAiJyBhbmQgJyIgKwogICAgICAgICAgICBiICsKICAgICAgICAgICAgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci51bm9wX3R5cGVfZXJyb3IgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgImJhZCBvcGVyYW5kIHR5cGUgZm9yIHVuYXJ5ICIgKwogICAgICAgICAgICB7IFVBZGQ6ICIrIiwgVVN1YjogIi0iLCBJbnZlcnQ6ICJ+IiB9W2JdICsKICAgICAgICAgICAgIjogJyIgKwogICAgICAgICAgICBhICsKICAgICAgICAgICAgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5ib05hbWVUb1Nsb3RGdW5jTGhzXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAobnVsbCAhPT0gYSkKICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICBjYXNlICJBZGQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJGFkZCA/IGEubmIkYWRkIDogYS5fX2FkZF9fCiAgICAgICAgICAgIGNhc2UgIlN1YiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkc3VidHJhY3QgPyBhLm5iJHN1YnRyYWN0IDogYS5fX3N1Yl9fCiAgICAgICAgICAgIGNhc2UgIk11bHQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJG11bHRpcGx5ID8gYS5uYiRtdWx0aXBseSA6IGEuX19tdWxfXwogICAgICAgICAgICBjYXNlICJNYXRNdWx0IjoKICAgICAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICAgICAgICAgICAgcmV0dXJuIGEudHAkbWF0bXVsID8gYS50cCRtYXRtdWwgOiBhLl9fbWF0bXVsX18KICAgICAgICAgICAgY2FzZSAiRGl2IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRkaXZpZGUgPyBhLm5iJGRpdmlkZSA6IGEuX19kaXZfXwogICAgICAgICAgICBjYXNlICJGbG9vckRpdiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkZmxvb3JfZGl2aWRlID8gYS5uYiRmbG9vcl9kaXZpZGUgOiBhLl9fZmxvb3JkaXZfXwogICAgICAgICAgICBjYXNlICJNb2QiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlbWFpbmRlciA/IGEubmIkcmVtYWluZGVyIDogYS5fX21vZF9fCiAgICAgICAgICAgIGNhc2UgIkRpdk1vZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkZGl2bW9kID8gYS5uYiRkaXZtb2QgOiBhLl9fZGl2bW9kX18KICAgICAgICAgICAgY2FzZSAiUG93IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRwb3dlciA/IGEubmIkcG93ZXIgOiBhLl9fcG93X18KICAgICAgICAgICAgY2FzZSAiTFNoaWZ0IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRsc2hpZnQgPyBhLm5iJGxzaGlmdCA6IGEuX19sc2hpZnRfXwogICAgICAgICAgICBjYXNlICJSU2hpZnQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJzaGlmdCA/IGEubmIkcnNoaWZ0IDogYS5fX3JzaGlmdF9fCiAgICAgICAgICAgIGNhc2UgIkJpdEFuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkYW5kID8gYS5uYiRhbmQgOiBhLl9fYW5kX18KICAgICAgICAgICAgY2FzZSAiQml0WG9yIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiR4b3IgPyBhLm5iJHhvciA6IGEuX194b3JfXwogICAgICAgICAgICBjYXNlICJCaXRPciI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkb3IgPyBhLm5iJG9yIDogYS5fX29yX18KICAgICAgICAgIH0KICAgICAgfQogICAgICBTay5hYnN0ci5ib05hbWVUb1Nsb3RGdW5jUmhzXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAobnVsbCAhPT0gYSkKICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICBjYXNlICJBZGQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9hZGQgPyBhLm5iJHJlZmxlY3RlZF9hZGQgOiBhLl9fcmFkZF9fCiAgICAgICAgICAgIGNhc2UgIlN1YiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX3N1YnRyYWN0CiAgICAgICAgICAgICAgICA/IGEubmIkcmVmbGVjdGVkX3N1YnRyYWN0CiAgICAgICAgICAgICAgICA6IGEuX19yc3ViX18KICAgICAgICAgICAgY2FzZSAiTXVsdCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX211bHRpcGx5CiAgICAgICAgICAgICAgICA/IGEubmIkcmVmbGVjdGVkX211bHRpcGx5CiAgICAgICAgICAgICAgICA6IGEuX19ybXVsX18KICAgICAgICAgICAgY2FzZSAiTWF0TXVsdCI6CiAgICAgICAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18ucHl0aG9uMykKICAgICAgICAgICAgICAgIHJldHVybiBhLnRwJHJlZmxlY3RlZF9tYXRtdWwKICAgICAgICAgICAgICAgICAgPyBhLnRwJHJlZmxlY3RlZF9tYXRtdWwKICAgICAgICAgICAgICAgICAgOiBhLl9fcm1hdG11bF9fCiAgICAgICAgICAgIGNhc2UgIkRpdiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2RpdmlkZSA/IGEubmIkcmVmbGVjdGVkX2RpdmlkZSA6IGEuX19yZGl2X18KICAgICAgICAgICAgY2FzZSAiRmxvb3JEaXYiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9mbG9vcl9kaXZpZGUKICAgICAgICAgICAgICAgID8gYS5uYiRyZWZsZWN0ZWRfZmxvb3JfZGl2aWRlCiAgICAgICAgICAgICAgICA6IGEuX19yZmxvb3JkaXZfXwogICAgICAgICAgICBjYXNlICJNb2QiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9yZW1haW5kZXIKICAgICAgICAgICAgICAgID8gYS5uYiRyZWZsZWN0ZWRfcmVtYWluZGVyCiAgICAgICAgICAgICAgICA6IGEuX19ybW9kX18KICAgICAgICAgICAgY2FzZSAiRGl2TW9kIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfZGl2bW9kCiAgICAgICAgICAgICAgICA/IGEubmIkcmVmbGVjdGVkX2Rpdm1vZAogICAgICAgICAgICAgICAgOiBhLl9fcmRpdm1vZF9fCiAgICAgICAgICAgIGNhc2UgIlBvdyI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX3Bvd2VyID8gYS5uYiRyZWZsZWN0ZWRfcG93ZXIgOiBhLl9fcnBvd19fCiAgICAgICAgICAgIGNhc2UgIkxTaGlmdCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2xzaGlmdAogICAgICAgICAgICAgICAgPyBhLm5iJHJlZmxlY3RlZF9sc2hpZnQKICAgICAgICAgICAgICAgIDogYS5fX3Jsc2hpZnRfXwogICAgICAgICAgICBjYXNlICJSU2hpZnQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9yc2hpZnQKICAgICAgICAgICAgICAgID8gYS5uYiRyZWZsZWN0ZWRfcnNoaWZ0CiAgICAgICAgICAgICAgICA6IGEuX19ycnNoaWZ0X18KICAgICAgICAgICAgY2FzZSAiQml0QW5kIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfYW5kID8gYS5uYiRyZWZsZWN0ZWRfYW5kIDogYS5fX3JhbmRfXwogICAgICAgICAgICBjYXNlICJCaXRYb3IiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF94b3IgPyBhLm5iJHJlZmxlY3RlZF94b3IgOiBhLl9fcnhvcl9fCiAgICAgICAgICAgIGNhc2UgIkJpdE9yIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfb3IgPyBhLm5iJHJlZmxlY3RlZF9vciA6IGEuX19yb3JfXwogICAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmFic3RyLmlib05hbWVUb1Nsb3RGdW5jXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgIGNhc2UgIkFkZCI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfYWRkID8gYS5uYiRpbnBsYWNlX2FkZCA6IGEuX19pYWRkX18KICAgICAgICAgIGNhc2UgIlN1YiI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2Vfc3VidHJhY3QgPyBhLm5iJGlucGxhY2Vfc3VidHJhY3QgOiBhLl9faXN1Yl9fCiAgICAgICAgICBjYXNlICJNdWx0IjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9tdWx0aXBseSA/IGEubmIkaW5wbGFjZV9tdWx0aXBseSA6IGEuX19pbXVsX18KICAgICAgICAgIGNhc2UgIk1hdE11bHQiOgogICAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICAgICAgICAgIHJldHVybiBhLnRwJGlucGxhY2VfbWF0bXVsID8gYS50cCRpbnBsYWNlX21hdG11bCA6IGEuX19pbWF0bXVsX18KICAgICAgICAgIGNhc2UgIkRpdiI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfZGl2aWRlID8gYS5uYiRpbnBsYWNlX2RpdmlkZSA6IGEuX19pZGl2X18KICAgICAgICAgIGNhc2UgIkZsb29yRGl2IjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9mbG9vcl9kaXZpZGUKICAgICAgICAgICAgICA/IGEubmIkaW5wbGFjZV9mbG9vcl9kaXZpZGUKICAgICAgICAgICAgICA6IGEuX19pZmxvb3JkaXZfXwogICAgICAgICAgY2FzZSAiTW9kIjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9yZW1haW5kZXIKICAgICAgICAgIGNhc2UgIlBvdyI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfcG93ZXIKICAgICAgICAgIGNhc2UgIkxTaGlmdCI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfbHNoaWZ0ID8gYS5uYiRpbnBsYWNlX2xzaGlmdCA6IGEuX19pbHNoaWZ0X18KICAgICAgICAgIGNhc2UgIlJTaGlmdCI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfcnNoaWZ0ID8gYS5uYiRpbnBsYWNlX3JzaGlmdCA6IGEuX19pcnNoaWZ0X18KICAgICAgICAgIGNhc2UgIkJpdEFuZCI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfYW5kCiAgICAgICAgICBjYXNlICJCaXRPciI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2Vfb3IKICAgICAgICAgIGNhc2UgIkJpdFhvciI6CiAgICAgICAgICAgIHJldHVybiBhLm5iJGlucGxhY2VfeG9yID8gYS5uYiRpbnBsYWNlX3hvciA6IGEuX19peG9yX18KICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYWJzdHIudW9OYW1lVG9TbG90RnVuY18gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKG51bGwgIT09IGEpCiAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgY2FzZSAiVVN1YiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkbmVnYXRpdmUgPyBhLm5iJG5lZ2F0aXZlIDogYS5fX25lZ19fCiAgICAgICAgICAgIGNhc2UgIlVBZGQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHBvc2l0aXZlID8gYS5uYiRwb3NpdGl2ZSA6IGEuX19wb3NfXwogICAgICAgICAgICBjYXNlICJJbnZlcnQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJGludmVydCA/IGEubmIkaW52ZXJ0IDogYS5fX2ludmVydF9fCiAgICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYWJzdHIuYmluYXJ5X29wXyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IGIuY29uc3RydWN0b3IucHJvdG90eXBlIGluc3RhbmNlb2YgYS5jb25zdHJ1Y3RvcgogICAgICAgIGlmIChkKSB7CiAgICAgICAgICB2YXIgZSA9IFNrLmFic3RyLmJvTmFtZVRvU2xvdEZ1bmNSaHNfKGIsIGMpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHZvaWQgMCAhPT0gZSAmJgogICAgICAgICAgICAoKGUgPSBlLmNhbGwgPyBlLmNhbGwoYiwgYSkgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZSwgW2IsIGFdKSksCiAgICAgICAgICAgIHZvaWQgMCAhPT0gZSAmJiBlICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICB9CiAgICAgICAgZSA9IFNrLmFic3RyLmJvTmFtZVRvU2xvdEZ1bmNMaHNfKGEsIGMpCiAgICAgICAgaWYgKAogICAgICAgICAgKHZvaWQgMCAhPT0gZSAmJgogICAgICAgICAgICAoKGUgPSBlLmNhbGwgPyBlLmNhbGwoYSwgYikgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZSwgW2EsIGJdKSksCiAgICAgICAgICAgIHZvaWQgMCAhPT0gZSAmJiBlICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkpIHx8CiAgICAgICAgICAoIWQgJiYKICAgICAgICAgICAgKChlID0gU2suYWJzdHIuYm9OYW1lVG9TbG90RnVuY1Joc18oYiwgYykpLAogICAgICAgICAgICB2b2lkIDAgIT09IGUgJiYKICAgICAgICAgICAgICAoKGUgPSBlLmNhbGwKICAgICAgICAgICAgICAgID8gZS5jYWxsKGIsIGEpCiAgICAgICAgICAgICAgICA6IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShlLCBbYiwgYV0pKSwKICAgICAgICAgICAgICB2b2lkIDAgIT09IGUgJiYgZSAhPT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpKSkKICAgICAgICApCiAgICAgICAgICByZXR1cm4gZQogICAgICAgIFNrLmFic3RyLmJpbm9wX3R5cGVfZXJyb3IoYSwgYiwgYykKICAgICAgfQogICAgICBTay5hYnN0ci5iaW5hcnlfaW9wXyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IFNrLmFic3RyLmlib05hbWVUb1Nsb3RGdW5jXyhhLCBjKQogICAgICAgIHJldHVybiB2b2lkIDAgIT09IGQgJiYKICAgICAgICAgICgoZCA9IGQuY2FsbCA/IGQuY2FsbChhLCBiKSA6IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShkLCBbYSwgYl0pKSwKICAgICAgICAgIHZvaWQgMCAhPT0gZCAmJiBkICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkKICAgICAgICAgID8gZAogICAgICAgICAgOiBTay5hYnN0ci5iaW5hcnlfb3BfKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suYWJzdHIudW5hcnlfb3BfID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gU2suYWJzdHIudW9OYW1lVG9TbG90RnVuY18oYSwgYikKICAgICAgICBpZiAoCiAgICAgICAgICB2b2lkIDAgIT09IGMgJiYKICAgICAgICAgICgoYyA9IGMuY2FsbCA/IGMuY2FsbChhKSA6IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjLCBbYV0pKSwKICAgICAgICAgIHZvaWQgMCAhPT0gYykKICAgICAgICApCiAgICAgICAgICByZXR1cm4gYwogICAgICAgIFNrLmFic3RyLnVub3BfdHlwZV9lcnJvcihhLCBiKQogICAgICB9CiAgICAgIFNrLmFic3RyLm51bU9wQW5kUHJvbW90ZSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBiKSB7CiAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhICYmICJudW1iZXIiID09PSB0eXBlb2YgYikKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAoYyA9IGMoYSwgYikpLAogICAgICAgICAgICAgIChjID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwKICAgICAgICAgICAgICAgIGMgPCAtU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQpICYmCiAgICAgICAgICAgICAgTWF0aC5mbG9vcihjKSA9PT0gYwogICAgICAgICAgICAgICAgPyBbU2suYnVpbHRpbi5sbmcuZnJvbUludCQoYSksIFNrLmJ1aWx0aW4ubG5nLmZyb21JbnQkKGIpXQogICAgICAgICAgICAgICAgOiBjCiAgICAgICAgICAgICkKICAgICAgICAgIGlmICh2b2lkIDAgPT09IGEgfHwgdm9pZCAwID09PSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5OYW1lRXJyb3IoIlVuZGVmaW5lZCB2YXJpYWJsZSBpbiBleHByZXNzaW9uIikKICAgICAgICAgIGlmIChhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmxuZykgcmV0dXJuIFthLCBiXQogICAgICAgICAgaWYgKAogICAgICAgICAgICAoYS5jb25zdHJ1Y3RvciAhPT0gU2suYnVpbHRpbi5pbnRfICYmCiAgICAgICAgICAgICAgYS5jb25zdHJ1Y3RvciAhPT0gU2suYnVpbHRpbi5mbG9hdF8pIHx8CiAgICAgICAgICAgIGIuY29uc3RydWN0b3IgIT09IFNrLmJ1aWx0aW4uY29tcGxleAogICAgICAgICAgKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICApCiAgICAgICAgICAgICAgcmV0dXJuIFthLCBiXQogICAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhKSByZXR1cm4gKGEgPSBTay5idWlsdGluLmFzc2skKGEpKSwgW2EsIGJdCiAgICAgICAgICB9IGVsc2UgcmV0dXJuIChhID0gbmV3IFNrLmJ1aWx0aW4uY29tcGxleChhKSksIFthLCBiXQogICAgICAgIH0KICAgICAgfQogICAgICBTay5hYnN0ci5ib051bVByb21vdGVfID0gewogICAgICAgIEFkZDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIGEgKyBiCiAgICAgICAgfSwKICAgICAgICBTdWI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhIC0gYgogICAgICAgIH0sCiAgICAgICAgTXVsdDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIGEgKiBiCiAgICAgICAgfSwKICAgICAgICBNb2Q6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGlmICgwID09PSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigiZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iKQogICAgICAgICAgYSAlPSBiCiAgICAgICAgICByZXR1cm4gMCA+IGEgKiBiID8gYSArIGIgOiBhCiAgICAgICAgfSwKICAgICAgICBEaXY6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGlmICgwID09PSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigiZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iKQogICAgICAgICAgcmV0dXJuIGEgLyBiCiAgICAgICAgfSwKICAgICAgICBGbG9vckRpdjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgaWYgKDAgPT09IGIpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKCJkaXZpc2lvbiBvciBtb2R1bG8gYnkgemVybyIpCiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihhIC8gYikKICAgICAgICB9LAogICAgICAgIFBvdzogTWF0aC5wb3csCiAgICAgICAgQml0QW5kOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICBhICY9IGIKICAgICAgICAgIDAgPiBhICYmIChhICs9IDQyOTQ5NjcyOTYpCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0sCiAgICAgICAgQml0T3I6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGEgfD0gYgogICAgICAgICAgMCA+IGEgJiYgKGEgKz0gNDI5NDk2NzI5NikKICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfSwKICAgICAgICBCaXRYb3I6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGEgXj0gYgogICAgICAgICAgMCA+IGEgJiYgKGEgKz0gNDI5NDk2NzI5NikKICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfSwKICAgICAgICBMU2hpZnQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGlmICgwID4gYikgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigibmVnYXRpdmUgc2hpZnQgY291bnQiKQogICAgICAgICAgdmFyIGMgPSBhIDw8IGIKICAgICAgICAgIHJldHVybiBjID4gYSA/IGMgOiBhICogTWF0aC5wb3coMiwgYikKICAgICAgICB9LAogICAgICAgIFJTaGlmdDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgaWYgKDAgPiBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICB2YXIgYyA9IGEgPj4gYgogICAgICAgICAgMCA8IGEgJiYgMCA+IGMgJiYgKGMgJj0gTWF0aC5wb3coMiwgMzIgLSBiKSAtIDEpCiAgICAgICAgICByZXR1cm4gYwogICAgICAgIH0sCiAgICAgIH0KICAgICAgU2suYWJzdHIubnVtYmVyQmluT3AgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5ib051bVByb21vdGVfW2NdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCkgewogICAgICAgICAgZCA9IFNrLmFic3RyLm51bU9wQW5kUHJvbW90ZShhLCBiLCBkKQogICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgZCkgcmV0dXJuIGQKICAgICAgICAgIGlmICgKICAgICAgICAgICAgKHZvaWQgMCAhPT0gZCAmJiBkLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmludF8pIHx8CiAgICAgICAgICAgICh2b2lkIDAgIT09IGQgJiYgZC5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5mbG9hdF8pIHx8CiAgICAgICAgICAgICh2b2lkIDAgIT09IGQgJiYgZC5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICB2b2lkIDAgIT09IGQgJiYgKChhID0gZFswXSksIChiID0gZFsxXSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5hYnN0ci5iaW5hcnlfb3BfKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5udW1iZXJCaW5PcCIsIFNrLmFic3RyLm51bWJlckJpbk9wKQogICAgICBTay5hYnN0ci5udW1iZXJJbnBsYWNlQmluT3AgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5ib051bVByb21vdGVfW2NdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCkgewogICAgICAgICAgZCA9IFNrLmFic3RyLm51bU9wQW5kUHJvbW90ZShhLCBiLCBkKQogICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgZCkgcmV0dXJuIGQKICAgICAgICAgIGlmICgKICAgICAgICAgICAgKHZvaWQgMCAhPT0gZCAmJiBkLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmludF8pIHx8CiAgICAgICAgICAgICh2b2lkIDAgIT09IGQgJiYgZC5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5mbG9hdF8pIHx8CiAgICAgICAgICAgICh2b2lkIDAgIT09IGQgJiYgZC5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICB2b2lkIDAgIT09IGQgJiYgKChhID0gZFswXSksIChiID0gZFsxXSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5hYnN0ci5iaW5hcnlfaW9wXyhhLCBiLCBjKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYWJzdHIubnVtYmVySW5wbGFjZUJpbk9wIiwKICAgICAgICBTay5hYnN0ci5udW1iZXJJbnBsYWNlQmluT3AsCiAgICAgICkKICAgICAgU2suYWJzdHIubnVtYmVyVW5hcnlPcCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoIk5vdCIgPT09IGIpCiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuaXNUcnVlKGEpCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ib29sKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgICBpZiAoIlVTdWIiID09PSBiKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XygtYykKICAgICAgICAgIGlmICgiVUFkZCIgPT09IGIpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpCiAgICAgICAgICBpZiAoIkludmVydCIgPT09IGIpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKH5jKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIlVTdWIiID09PSBiICYmIGEubmIkbmVnYXRpdmUpIHJldHVybiBhLm5iJG5lZ2F0aXZlKCkKICAgICAgICAgIGlmICgiVUFkZCIgPT09IGIgJiYgYS5uYiRwb3NpdGl2ZSkgcmV0dXJuIGEubmIkcG9zaXRpdmUoKQogICAgICAgICAgaWYgKCJJbnZlcnQiID09PSBiICYmIGEubmIkaW52ZXJ0KSByZXR1cm4gYS5uYiRpbnZlcnQoKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYWJzdHIudW5hcnlfb3BfKGEsIGIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5udW1iZXJVbmFyeU9wIiwgU2suYWJzdHIubnVtYmVyVW5hcnlPcCkKICAgICAgU2suYWJzdHIuZml4U2VxSW5kZXhfID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIDAgPiBiICYmIGEuc3EkbGVuZ3RoICYmIChiICs9IGEuc3EkbGVuZ3RoKCkpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZUNvbnRhaW5zID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmIChhLnNxJGNvbnRhaW5zKSByZXR1cm4gYS5zcSRjb250YWlucyhiKQogICAgICAgIHZhciBkID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kY29udGFpbnMpCiAgICAgICAgaWYgKG51bGwgIT0gZCkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGQsIFthLCBiXSkpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgICB0aHJvdyAoKGMgPSBTay5hYnN0ci50eXBlTmFtZShhKSksCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJhcmd1bWVudCBvZiB0eXBlICciICsgYyArICInIGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApKQogICAgICAgIGEgPSBTay5taXNjZXZhbC5pdGVyRm9yKAogICAgICAgICAgU2suYWJzdHIuaXRlcihhKSwKICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChhLCBiLCAiRXEiKQogICAgICAgICAgICAgID8gbmV3IFNrLm1pc2NldmFsLkJyZWFrKCEwKQogICAgICAgICAgICAgIDogITEKICAgICAgICAgIH0sCiAgICAgICAgICAhMSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGMgPyBhIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGEpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VDb25jYXQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEuc3EkY29uY2F0KSByZXR1cm4gYS5zcSRjb25jYXQoYikKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBhICsgIicgb2JqZWN0IGNhbid0IGJlIGNvbmNhdGVuYXRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlR2V0SW5kZXhPZiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoYS5pbmRleCkgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLmluZGV4LCBbYSwgYl0pCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkgewogICAgICAgICAgdmFyIGMgPSAwCiAgICAgICAgICB2YXIgZCA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICAgIGZvciAoYSA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBhOyBhID0gZC50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICAgIGlmIChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYiwgYSwgIkVxIikpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYykKICAgICAgICAgICAgYyArPSAxCiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAic2VxdWVuY2UuaW5kZXgoeCk6IHggbm90IGluIHNlcXVlbmNlIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgYiA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgImFyZ3VtZW50IG9mIHR5cGUgJyIgKyBiICsgIicgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VHZXRDb3VudE9mID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmIChhLmNvdW50KSByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEuY291bnQsIFthLCBiXSkKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKSB7CiAgICAgICAgICB2YXIgYyA9IDAKICAgICAgICAgIHZhciBkID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgICAgZm9yIChhID0gZC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGE7IGEgPSBkLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChiLCBhLCAiRXEiKSAmJiAoYyArPSAxKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYykKICAgICAgICB9CiAgICAgICAgYiA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgImFyZ3VtZW50IG9mIHR5cGUgJyIgKyBiICsgIicgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VHZXRJdGVtID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmIChhLm1wJHN1YnNjcmlwdCkgcmV0dXJuIGEubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCInIiArIGEgKyAiJyBvYmplY3QgaXMgdW5zdWJzY3JpcHRhYmxlIikKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZVNldEl0ZW0gPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgaWYgKGEubXAkYXNzX3N1YnNjcmlwdCkgcmV0dXJuIGEubXAkYXNzX3N1YnNjcmlwdChiLCBjKQogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICInIiArIGEgKyAiJyBvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCBpdGVtIGFzc2lnbm1lbnQiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZURlbEl0ZW0gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEuc3EkZGVsX2l0ZW0pIChiID0gU2suYWJzdHIuZml4U2VxSW5kZXhfKGEsIGIpKSwgYS5zcSRkZWxfaXRlbShiKQogICAgICAgIGVsc2UKICAgICAgICAgIHRocm93ICgoYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgYSArICInIG9iamVjdCBkb2VzIG5vdCBzdXBwb3J0IGl0ZW0gZGVsZXRpb24iLAogICAgICAgICAgKSkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZVJlcGVhdCA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBjID0gU2suYnVpbHRpbi5hc251bSQoYykKICAgICAgICBpZiAodm9pZCAwID09PSBTay5taXNjZXZhbC5hc0luZGV4KGMpKQogICAgICAgICAgdGhyb3cgKChhID0gU2suYWJzdHIudHlwZU5hbWUoYykpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiY2FuJ3QgbXVsdGlwbHkgc2VxdWVuY2UgYnkgbm9uLWludCBvZiB0eXBlICciICsgYSArICInIiwKICAgICAgICAgICkpCiAgICAgICAgcmV0dXJuIGEuY2FsbChiLCBjKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlR2V0U2xpY2UgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgaWYgKGEuc3Ekc2xpY2UpCiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAoYiA9IFNrLmFic3RyLmZpeFNlcUluZGV4XyhhLCBiKSksCiAgICAgICAgICAgIChjID0gU2suYWJzdHIuZml4U2VxSW5kZXhfKGEsIGMpKSwKICAgICAgICAgICAgYS5zcSRzbGljZShiLCBjKQogICAgICAgICAgKQogICAgICAgIGlmIChhLm1wJHN1YnNjcmlwdCkgcmV0dXJuIGEubXAkc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnNsaWNlKGIsIGMpKQogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiJyIgKyBhICsgIicgb2JqZWN0IGlzIHVuc2xpY2VhYmxlIikKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZURlbFNsaWNlID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmIChhLnNxJGRlbF9zbGljZSkKICAgICAgICAgIChiID0gU2suYWJzdHIuZml4U2VxSW5kZXhfKGEsIGIpKSwKICAgICAgICAgICAgKGMgPSBTay5hYnN0ci5maXhTZXFJbmRleF8oYSwgYykpLAogICAgICAgICAgICBhLnNxJGRlbF9zbGljZShiLCBjKQogICAgICAgIGVsc2UKICAgICAgICAgIHRocm93ICgoYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgYSArICInIGRvZXNuJ3Qgc3VwcG9ydCBzbGljZSBkZWxldGlvbiIsCiAgICAgICAgICApKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlU2V0U2xpY2UgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgaWYgKGEuc3EkYXNzX3NsaWNlKQogICAgICAgICAgKGIgPSBTay5hYnN0ci5maXhTZXFJbmRleF8oYSwgYikpLAogICAgICAgICAgICAoYyA9IFNrLmFic3RyLmZpeFNlcUluZGV4XyhhLCBjKSksCiAgICAgICAgICAgIGEuc3EkYXNzX3NsaWNlKGIsIGMsIGQpCiAgICAgICAgZWxzZSBpZiAoYS5tcCRhc3Nfc3Vic2NyaXB0KQogICAgICAgICAgYS5tcCRhc3Nfc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnNsaWNlKGIsIGMpLCBkKQogICAgICAgIGVsc2UKICAgICAgICAgIHRocm93ICgoYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgYSArICInIG9iamVjdCBkb2Vzbid0IHN1cHBvcnQgc2xpY2UgYXNzaWdubWVudCIsCiAgICAgICAgICApKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlVW5wYWNrID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gW10sCiAgICAgICAgICBkCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgYSA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKAogICAgICAgICAgZCA9IGEudHAkaXRlcm5leHQoKTsKICAgICAgICAgIHZvaWQgMCAhPT0gZCAmJiBjLmxlbmd0aCA8IGI7CiAgICAgICAgICBkID0gYS50cCRpdGVybmV4dCgpCiAgICAgICAgKQogICAgICAgICAgYy5wdXNoKGQpCiAgICAgICAgaWYgKGMubGVuZ3RoIDwgYikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICJuZWVkIG1vcmUgdGhhbiAiICsgYy5sZW5ndGggKyAiIHZhbHVlcyB0byB1bnBhY2siLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJ0b28gbWFueSB2YWx1ZXMgdG8gdW5wYWNrIikKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmFic3RyLm1hcHBpbmdVbnBhY2tJbnRvS2V5d29yZEFycmF5ID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgIGIudHAkZ2V0YXR0cihuZXcgU2suYnVpbHRpbi5zdHIoIml0ZW1zIikpLAogICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBpZiAoIWEpIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiT2JqZWN0IGlzIG5vdCBhIG1hcHBpbmciKQogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZChhKQogICAgICAgICAgfSwKICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLml0ZXJGb3IoU2suYWJzdHIuaXRlcihiKSwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgIGlmICghYiB8fCAhYi52KQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAiT2JqZWN0IGlzIG5vdCBhIG1hcHBpbmc7IGl0ZW1zKCkgZG9lcyBub3QgcmV0dXJuIHR1cGxlcyIsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgaWYgKCEoYi52WzBdIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAoYy50cCRuYW1lID8gYy50cCRuYW1lICsgIjoiIDogIiIpICsKICAgICAgICAgICAgICAgICAgICAia2V5d29yZHMgbXVzdCBiZSBzdHJpbmdzIiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBhLnB1c2goYi52WzBdLnYsIGIudlsxXSkKICAgICAgICAgICAgfSkKICAgICAgICAgIH0sCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmFic3RyLm9iamVjdEZvcm1hdCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGZvcm1hdCkKICAgICAgICBpZiAobnVsbCA9PSBjKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiVHlwZSAiICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiIGRvZXNuJ3QgZGVmaW5lIF9fZm9ybWF0X18iLAogICAgICAgICAgKQogICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYywgW2EsIGJdKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIl9fZm9ybWF0X18gbXVzdCByZXR1cm4gYSBzdHIsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5hYnN0ci5vYmplY3RBZGQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEubmIkYWRkKSByZXR1cm4gYS5uYiRhZGQoYikKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICBiID0gU2suYWJzdHIudHlwZU5hbWUoYikKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidW5zdXBwb3J0ZWQgb3BlcmFuZCB0eXBlKHMpIGZvciArOiAnIiArIGEgKyAiJyBhbmQgJyIgKyBiICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5vYmplY3ROZWdhdGl2ZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCAmJiAoYSA9IG5ldyBTay5idWlsdGluLmludF8oYikpCiAgICAgICAgaWYgKGEubmIkbmVnYXRpdmUpIHJldHVybiBhLm5iJG5lZ2F0aXZlKCkKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiYmFkIG9wZXJhbmQgdHlwZSBmb3IgdW5hcnkgLTogJyIgKyBhICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5vYmplY3RQb3NpdGl2ZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICAgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCAmJiAoYSA9IG5ldyBTay5idWlsdGluLmludF8oYykpCiAgICAgICAgaWYgKGEubmIkbmVnYXRpdmUpIHJldHVybiBhLm5iJHBvc2l0aXZlKCkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiYmFkIG9wZXJhbmQgdHlwZSBmb3IgdW5hcnkgKzogJyIgKyBiICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5vYmplY3REZWxJdGVtID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmIChudWxsICE9PSBhKSB7CiAgICAgICAgICBpZiAoYS5tcCRkZWxfc3Vic2NyaXB0KSB7CiAgICAgICAgICAgIGEubXAkZGVsX3N1YnNjcmlwdChiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICAgIGlmIChhLnNxJGFzc19pdGVtKSB7CiAgICAgICAgICAgIHZhciBjID0gU2subWlzY2V2YWwuYXNJbmRleChiKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBjKQogICAgICAgICAgICAgIHRocm93ICgoYSA9IFNrLmFic3RyLnR5cGVOYW1lKGIpKSwKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAic2VxdWVuY2UgaW5kZXggbXVzdCBiZSBpbnRlZ2VyLCBub3QgJyIgKyBhICsgIiciLAogICAgICAgICAgICAgICkpCiAgICAgICAgICAgIFNrLmFic3RyLnNlcXVlbmNlRGVsSXRlbShhLCBjKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgIiciICsgYSArICInIG9iamVjdCBkb2VzIG5vdCBzdXBwb3J0IGl0ZW0gZGVsZXRpb24iLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFic3RyLm9iamVjdERlbEl0ZW0iLCBTay5hYnN0ci5vYmplY3REZWxJdGVtKQogICAgICBTay5hYnN0ci5vYmplY3RHZXRJdGVtID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmIChudWxsICE9PSBhKSB7CiAgICAgICAgICBpZiAoYS50cCRnZXRpdGVtKSByZXR1cm4gYS50cCRnZXRpdGVtKGIsIGMpCiAgICAgICAgICBpZiAoYS5tcCRzdWJzY3JpcHQpIHJldHVybiBhLm1wJHN1YnNjcmlwdChiLCBjKQogICAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzSW5kZXgoYikgJiYgYS5zcSRpdGVtKQogICAgICAgICAgICByZXR1cm4gU2suYWJzdHIuc2VxdWVuY2VHZXRJdGVtKGEsIFNrLm1pc2NldmFsLmFzSW5kZXgoYiksIGMpCiAgICAgICAgfQogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiJyIgKyBhICsgIicgZG9lcyBub3Qgc3VwcG9ydCBpbmRleGluZyIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5vYmplY3RHZXRJdGVtIiwgU2suYWJzdHIub2JqZWN0R2V0SXRlbSkKICAgICAgU2suYWJzdHIub2JqZWN0U2V0SXRlbSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICBpZiAobnVsbCAhPT0gYSkgewogICAgICAgICAgaWYgKGEudHAkc2V0aXRlbSkgcmV0dXJuIGEudHAkc2V0aXRlbShiLCBjLCBkKQogICAgICAgICAgaWYgKGEubXAkYXNzX3N1YnNjcmlwdCkgcmV0dXJuIGEubXAkYXNzX3N1YnNjcmlwdChiLCBjLCBkKQogICAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzSW5kZXgoYikgJiYgYS5zcSRhc3NfaXRlbSkKICAgICAgICAgICAgcmV0dXJuIFNrLmFic3RyLnNlcXVlbmNlU2V0SXRlbShhLCBTay5taXNjZXZhbC5hc0luZGV4KGIpLCBjLCBkKQogICAgICAgIH0KICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBhICsgIicgZG9lcyBub3Qgc3VwcG9ydCBpdGVtIGFzc2lnbm1lbnQiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFic3RyLm9iamVjdFNldEl0ZW0iLCBTay5hYnN0ci5vYmplY3RTZXRJdGVtKQogICAgICBTay5hYnN0ci5nYXR0ciA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCwKICAgICAgICAgIGUgPSBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICAgIGYgPSBiLiRqc3N0cigpCiAgICAgICAgaWYgKG51bGwgPT09IGEpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgIiciICsgZSArICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsgZiArICInIiwKICAgICAgICAgICkKICAgICAgICB2b2lkIDAgIT09IGEudHAkZ2V0YXR0ciAmJiAoZCA9IGEudHAkZ2V0YXR0cihiLCBjKSkKICAgICAgICBkID0gU2subWlzY2V2YWwuY2hhaW4oZCwgZnVuY3Rpb24oYSkgewogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICAgIiciICsgZSArICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsgZiArICInIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9KQogICAgICAgIHJldHVybiBjID8gZCA6IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyhkKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYWJzdHIuZ2F0dHIiLCBTay5hYnN0ci5nYXR0cikKICAgICAgU2suYWJzdHIuc2F0dHIgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgdmFyIGUgPSBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICAgIGYgPSBiLiRqc3N0cigpCiAgICAgICAgaWYgKG51bGwgPT09IGEpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgIiciICsgZSArICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsgZiArICInIiwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBhLnRwJHNldGF0dHIpIHJldHVybiBhLnRwJHNldGF0dHIoYiwgYywgZCkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICInIiArIGUgKyAiJyBvYmplY3QgaGFzIG5vIGF0dHJpYnV0ZSAnIiArIGYgKyAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYWJzdHIuc2F0dHIiLCBTay5hYnN0ci5zYXR0cikKICAgICAgU2suYWJzdHIuaXRlcm5leHQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcm5leHQoYikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFic3RyLml0ZXJuZXh0IiwgU2suYWJzdHIuaXRlcm5leHQpCiAgICAgIFNrLmFic3RyLml0ZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICB0aGlzLmlkeCA9IDAKICAgICAgICAgICAgdGhpcy5teW9iaiA9IGEKICAgICAgICAgICAgdGhpcy5nZXRpdGVtID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kZ2V0aXRlbSkKICAgICAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheSh0aGlzLmdldGl0ZW0sIFsKICAgICAgICAgICAgICAgICAgdGhpcy5teW9iaiwKICAgICAgICAgICAgICAgICAgU2suZmZpLnJlbWFwVG9QeSh0aGlzLmlkeCksCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgIH0gY2F0Y2ggKGcpIHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uSW5kZXhFcnJvciB8fAogICAgICAgICAgICAgICAgICBnIGluc3RhbmNlb2YgU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgdGhyb3cgZwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmlkeCsrCiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIGlmICgKICAgICAgICAgIGEudHAkZ2V0YXR0ciAmJgogICAgICAgICAgKGIgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRpdGVyKSkKICAgICAgICApIHsKICAgICAgICAgIHZhciBkID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGIsIFthXSkKICAgICAgICAgIGlmIChkLnRwJGl0ZXJuZXh0KSByZXR1cm4gZAogICAgICAgIH0KICAgICAgICBpZiAoYS50cCRpdGVyKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCgoZCA9IGEudHAkaXRlcigpKSwgZC50cCRpdGVybmV4dCkpIHJldHVybiBkCiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIGlmIChTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtKSkgcmV0dXJuIG5ldyBjKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5pdGVyIiwgU2suYWJzdHIuaXRlcikKICAgICAgU2suYWJzdHIubG9va3VwU3BlY2lhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoYS5vYiR0eXBlKSBhID0gYS5vYiR0eXBlCiAgICAgICAgZWxzZSByZXR1cm4gbnVsbAogICAgICAgIHJldHVybiBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cChhLCBiKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYWJzdHIubG9va3VwU3BlY2lhbCIsIFNrLmFic3RyLmxvb2t1cFNwZWNpYWwpCiAgICAgIFNrLmFic3RyLm1hcmtVbmhhc2hhYmxlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSBhLnByb3RvdHlwZQogICAgICAgIGEuX19oYXNoX18gPSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICBhLnRwJGhhc2ggPSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfQogICAgICBTay5hYnN0ci5pbmhlcml0cyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBmdW5jdGlvbiBjKCkge30KICAgICAgICBjLnByb3RvdHlwZSA9IGIucHJvdG90eXBlCiAgICAgICAgYS5zdXBlckNsYXNzXyA9IGIucHJvdG90eXBlCiAgICAgICAgYS5wcm90b3R5cGUgPSBuZXcgYygpCiAgICAgICAgYS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBhCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5hYnN0ci5pbmhlcml0cyhiLCBjKQogICAgICAgIGIucHJvdG90eXBlLnRwJGJhc2UgPSBjCiAgICAgICAgYi5wcm90b3R5cGUudHAkbmFtZSA9IGEKICAgICAgICBiLnByb3RvdHlwZS5vYiR0eXBlID0gU2suYnVpbHRpbi50eXBlLm1ha2VJbnRvVHlwZU9iaihhLCBiKQogICAgICB9CiAgICAgIFNrLmFic3RyLnN1cGVyQ29uc3RydWN0b3IgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpCiAgICAgICAgYS5wcm90b3R5cGUudHAkYmFzZS5hcHBseShiLCBkKQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLm9iamVjdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5vYmplY3QKICAgICAgICAgID8gdGhpcwogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5vYmplY3QoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX2luaXRfXyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19pbml0X18uY29fa3dhcmdzID0gMQogICAgICBTay5idWlsdGluLl90cnlHZXRTdWJzY3JpcHQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBhLm1wJHN1YnNjcmlwdChiKQogICAgICAgIH0gY2F0Y2ggKGMpIHt9CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5idWlsdGluLl90cnlHZXRTdWJzY3JpcHQiLAogICAgICAgIFNrLmJ1aWx0aW4uX3RyeUdldFN1YnNjcmlwdCwKICAgICAgKQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMsCiAgICAgICAgICBkLAogICAgICAgICAgZSA9IGEuJGpzc3RyKCkKICAgICAgICB2YXIgZiA9IHRoaXMub2IkdHlwZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gZiwgIm9iamVjdCBoYXMgbm8gb2IkdHlwZSEiKQogICAgICAgIGlmICgoZCA9IHRoaXMuJGQgfHwgdGhpcy5jb25zdHJ1Y3Rvci4kZCkpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIChkLm1wJGxvb2t1cAogICAgICAgICAgICAgID8gKGMgPSBkLm1wJGxvb2t1cChhKSkKICAgICAgICAgICAgICA6IGQubXAkc3Vic2NyaXB0CiAgICAgICAgICAgICAgPyAoYyA9IFNrLmJ1aWx0aW4uX3RyeUdldFN1YnNjcmlwdChkLCBhKSkKICAgICAgICAgICAgICA6ICJvYmplY3QiID09PSB0eXBlb2YgZCAmJiAoYyA9IGRbZV0pLAogICAgICAgICAgICB2b2lkIDAgIT09IGMpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgZCA9IFNrLmJ1aWx0aW4udHlwZS50eXBlTG9va3VwKGYsIGEpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCAmJiBudWxsICE9PSBkICYmIChjID0gZC50cCRkZXNjcl9nZXQpKQogICAgICAgICAgcmV0dXJuIGMuY2FsbChkLCB0aGlzLCB0aGlzLm9iJHR5cGUsIGIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCkgcmV0dXJuIGQKICAgICAgICBkID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoZiwgU2suYnVpbHRpbi5zdHIuJGdldGF0dHIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCAmJiBudWxsICE9PSBkKSB7CiAgICAgICAgICB2YXIgZyA9IChjID0gZC50cCRkZXNjcl9nZXQpID8gYy5jYWxsKGQsIHRoaXMsIHRoaXMub2IkdHlwZSkgOiBkCiAgICAgICAgICBjID0gU2subWlzY2V2YWwudHJ5Q2F0Y2goCiAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoZywgW2FdKQogICAgICAgICAgICB9LAogICAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IpKSB0aHJvdyBhCiAgICAgICAgICAgIH0sCiAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gYiA/IGMgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYykKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIiLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljR2V0QXR0ciwKICAgICAgKQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1B5dGhvbkdldEF0dHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljR2V0QXR0ci5jYWxsKGEsIGIsICEwKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKGIpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uR2V0QXR0ciIsCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25HZXRBdHRyLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljU2V0QXR0ciA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IFNrLmFic3RyLnR5cGVOYW1lKHRoaXMpLAogICAgICAgICAgZSA9IGEuJGpzc3RyKCksCiAgICAgICAgICBmID0gdGhpcy5vYiR0eXBlLAogICAgICAgICAgZwogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gZiwgIm9iamVjdCBoYXMgbm8gb2IkdHlwZSEiKQogICAgICAgIHZhciBoID0gdGhpcy4kZCB8fCB0aGlzLmNvbnN0cnVjdG9yLiRkCiAgICAgICAgaWYgKCJfX2NsYXNzX18iID09IGUpIHsKICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIudHAkbXJvIHx8IHZvaWQgMCA9PT0gYi50cCRuYW1lKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImF0dGVtcHRlZCB0byBhc3NpZ24gbm9uLWNsYXNzIHRvIF9fY2xhc3NfXyIsCiAgICAgICAgICAgICkKICAgICAgICAgIHRoaXMub2IkdHlwZSA9IGIKICAgICAgICAgIHRoaXMudHAkbmFtZSA9IGIudHAkbmFtZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoZiwgYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGYgJiYgbnVsbCAhPT0gZiAmJiAoZyA9IGYudHAkZGVzY3Jfc2V0KSkKICAgICAgICAgICAgcmV0dXJuIGcuY2FsbChmLCB0aGlzLCBiLCBjKQogICAgICAgICAgaWYgKGgubXAkYXNzX3N1YnNjcmlwdCkgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ub2JqZWN0ICYmCiAgICAgICAgICAgICAgIXRoaXMub2IkdHlwZS5zayRrbGFzcyAmJgogICAgICAgICAgICAgIHZvaWQgMCA9PT0gaC5tcCRsb29rdXAoYSkKICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICAgICAgZCArCiAgICAgICAgICAgICAgICAgICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsKICAgICAgICAgICAgICAgICAgU2sudW5maXhSZXNlcnZlZChlKSArCiAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGgubXAkYXNzX3N1YnNjcmlwdChhLCBiKQogICAgICAgICAgfSBlbHNlICJvYmplY3QiID09PSB0eXBlb2YgaCAmJiAoaFtlXSA9IGIpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNTZXRBdHRyIiwKICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1NldEF0dHIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25TZXRBdHRyID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHJldHVybiBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1NldEF0dHIuY2FsbChhLCBiLCBjLCAhMCkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uU2V0QXR0ciIsCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25TZXRBdHRyLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5IYXNoTm90SW1wbGVtZW50ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidW5oYXNoYWJsZSB0eXBlOiAnIiArIFNrLmFic3RyLnR5cGVOYW1lKHRoaXMpICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUudHAkZ2V0YXR0ciA9CiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNHZXRBdHRyCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS50cCRzZXRhdHRyID0KICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1NldEF0dHIKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fZ2V0YXR0cmlidXRlX18gPQogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uR2V0QXR0cgogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19zZXRhdHRyX18gPQogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uU2V0QXR0cgogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUudHAkbmFtZSA9ICJvYmplY3QiCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiR0eXBlID0gU2suYnVpbHRpbi50eXBlLm1ha2VJbnRvVHlwZU9iaigKICAgICAgICAib2JqZWN0IiwKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUub2IkdHlwZS5zayRrbGFzcyA9IHZvaWQgMAogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUudHAkZGVzY3Jfc2V0ID0gdm9pZCAwCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX25ld19fID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbmV3X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITEpCiAgICAgICAgcmV0dXJuIG5ldyBhKFtdLCBbXSkKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19yZXByX18gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yZXByX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEuJHIoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX2Zvcm1hdF9fID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZm9ybWF0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICAgIGlmICgiIiAhPT0gYykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgICAiZm9ybWF0IHNwZWMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICAgICkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18uZXhjZXB0aW9ucykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQoKSBhcmd1bWVudCAyIG11c3QgYmUgc3RyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJmb3JtYXQgZXhwZWN0cyBhcmcgMiB0byBiZSBzdHJpbmcgb3IgdW5pY29kZSwgbm90ICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fc3RyX18gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zdHJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS4kcigpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9faGFzaF9fID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faGFzaF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLnRwJGhhc2goKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX2VxX18gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19lcV9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm9iJGVxKGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fbmVfXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX25lX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkbmUoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19sdF9fID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbHRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5vYiRsdChiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX2xlX18gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19sZV9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm9iJGxlKGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fZ3RfXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2d0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkZ3QoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19nZV9fID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2VfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5vYiRnZShiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIjxvYmplY3Q+IikKICAgICAgfQogICAgICBTay5idWlsdGluLmhhc2hDb3VudCA9IDEKICAgICAgU2suYnVpbHRpbi5pZENvdW50ID0gMQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUudHAkaGFzaCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuJHNhdmVkSGFzaF8gfHwKICAgICAgICAgICh0aGlzLiRzYXZlZEhhc2hfID0gbmV3IFNrLmJ1aWx0aW4uaW50XyhTay5idWlsdGluLmhhc2hDb3VudCsrKSkKICAgICAgICByZXR1cm4gdGhpcy4kc2F2ZWRIYXNoXwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiRlcSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcyA9PT0gYQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUub2IkbmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiRsdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUub2IkbGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLm9iJGd0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiRnZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5weXRob25GdW5jdGlvbnMgPSAiX19yZXByX18gX19zdHJfXyBfX2hhc2hfXyBfX2VxX18gX19uZV9fIF9fbHRfXyBfX2xlX18gX19ndF9fIF9fZ2VfXyBfX2dldGF0dHJpYnV0ZV9fIF9fc2V0YXR0cl9fIF9fZm9ybWF0X18iLnNwbGl0KAogICAgICAgICIgIiwKICAgICAgKQogICAgICBTay5idWlsdGluLm5vbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnYgPSBudWxsCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgiTm9uZVR5cGUiLCBTay5idWlsdGluLm5vbmUsIFNrLmJ1aWx0aW4ub2JqZWN0KQogICAgICBTay5idWlsdGluLm5vbmUucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiTm9uZSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ub25lLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oMCkKICAgICAgfQogICAgICBTay5idWlsdGluLm5vbmUubm9uZSQgPSBuZXcgU2suYnVpbHRpbi5ub25lKCkKICAgICAgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZCA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiTm90SW1wbGVtZW50ZWRUeXBlIiwKICAgICAgICBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiTm90SW1wbGVtZW50ZWQiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkID0gbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQoKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ubm9uZSIsIFNrLmJ1aWx0aW4ubm9uZSkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLk5vdEltcGxlbWVudGVkIiwgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZCkKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3MgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgYiA9IGIubGVuZ3RoCiAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gSW5maW5pdHkpCiAgICAgICAgZSAmJiAtLWIKICAgICAgICBmICYmIC0tYgogICAgICAgIGlmIChiIDwgYyB8fCBiID4gZCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgKGMgPT09IGQKICAgICAgICAgICAgICA/IGEgKyAiKCkgdGFrZXMgZXhhY3RseSAiICsgYyArICIgYXJndW1lbnRzIgogICAgICAgICAgICAgIDogYiA8IGMKICAgICAgICAgICAgICA/IGEgKyAiKCkgdGFrZXMgYXQgbGVhc3QgIiArIGMgKyAiIGFyZ3VtZW50cyIKICAgICAgICAgICAgICA6IGEgKyAiKCkgdGFrZXMgYXQgbW9zdCAiICsgZCArICIgYXJndW1lbnRzIikgKwogICAgICAgICAgICAgICgiICgiICsgYiArICIgZ2l2ZW4pIiksCiAgICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLnB5Q2hlY2tBcmdzIiwgU2suYnVpbHRpbi5weUNoZWNrQXJncykKICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICB2b2lkIDAgPT09IGQgJiYgKGQgPSBJbmZpbml0eSkKICAgICAgICBlICYmIC0tYgogICAgICAgIGYgJiYgLS1iCiAgICAgICAgaWYgKGIgPCBjIHx8IGIgPiBkKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAoYyA9PT0gZAogICAgICAgICAgICAgID8gYSArICIoKSB0YWtlcyBleGFjdGx5ICIgKyBjICsgIiBhcmd1bWVudHMiCiAgICAgICAgICAgICAgOiBiIDwgYwogICAgICAgICAgICAgID8gYSArICIoKSB0YWtlcyBhdCBsZWFzdCAiICsgYyArICIgYXJndW1lbnRzIgogICAgICAgICAgICAgIDogYSArICIoKSB0YWtlcyBhdCBtb3N0ICIgKyBkICsgIiBhcmd1bWVudHMiKSArCiAgICAgICAgICAgICAgKCIgKCIgKyBiICsgIiBnaXZlbikiKSwKICAgICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmICghYykgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKGEgKyAiIG11c3QgYmUgYSAiICsgYikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ucHlDaGVja1R5cGUiLCBTay5idWlsdGluLnB5Q2hlY2tUeXBlKQogICAgICBTay5idWlsdGluLmNoZWNrU2VxdWVuY2UgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IGEgJiYgdm9pZCAwICE9PSBhLm1wJHN1YnNjcmlwdAogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja1NlcXVlbmNlIiwgU2suYnVpbHRpbi5jaGVja1NlcXVlbmNlKQogICAgICBTay5idWlsdGluLmNoZWNrSXRlcmFibGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSAhMQogICAgICAgIGlmIChudWxsICE9PSBhKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChiID0gU2suYWJzdHIuaXRlcihhKSkgPyAhMCA6ICExCiAgICAgICAgICB9IGNhdGNoIChjKSB7CiAgICAgICAgICAgIGlmIChjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5UeXBlRXJyb3IpIHJldHVybiAhMQogICAgICAgICAgICB0aHJvdyBjCiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZSIsIFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZSkKICAgICAgU2suYnVpbHRpbi5jaGVja0NhbGxhYmxlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZnVuYyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubWV0aG9kIHx8CiAgICAgICAgICB2b2lkIDAgIT09IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGNhbGwpCiAgICAgICAgICA/ICEwCiAgICAgICAgICA6ICExCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jaGVja051bWJlciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgbnVsbCAhPT0gYSAmJgogICAgICAgICAgKCJudW1iZXIiID09PSB0eXBlb2YgYSB8fAogICAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyB8fAogICAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja051bWJlciIsIFNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIpCiAgICAgIFNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXguX2NvbXBsZXhfY2hlY2soYSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4IiwgU2suYnVpbHRpbi5jaGVja0NvbXBsZXgpCiAgICAgIFNrLmJ1aWx0aW4uY2hlY2tJbnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIG51bGwgIT09IGEgJiYKICAgICAgICAgICgoIm51bWJlciIgPT09IHR5cGVvZiBhICYmIGEgPT09IChhIHwgMCkpIHx8CiAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tJbnQiLCBTay5idWlsdGluLmNoZWNrSW50KQogICAgICBTay5idWlsdGluLmNoZWNrRmxvYXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IGEgJiYgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrRmxvYXQiLCBTay5idWlsdGluLmNoZWNrRmxvYXQpCiAgICAgIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IGEgJiYgYS5fX2NsYXNzX18gPT0gU2suYnVpbHRpbi5zdHIKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tTdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKQogICAgICBTay5idWlsdGluLmNoZWNrQ2xhc3MgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IGEgJiYgYS5zayR0eXBlCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrQ2xhc3MiLCBTay5idWlsdGluLmNoZWNrQ2xhc3MpCiAgICAgIFNrLmJ1aWx0aW4uY2hlY2tCb29sID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ib29sCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrQm9vbCIsIFNrLmJ1aWx0aW4uY2hlY2tCb29sKQogICAgICBTay5idWlsdGluLmNoZWNrTm9uZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja05vbmUiLCBTay5idWlsdGluLmNoZWNrTm9uZSkKICAgICAgU2suYnVpbHRpbi5jaGVja0Z1bmN0aW9uID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYS50cCRjYWxsCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrRnVuY3Rpb24iLCBTay5idWlsdGluLmNoZWNrRnVuY3Rpb24pCiAgICAgIFNrLmJ1aWx0aW4uZnVuYyA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mdW5jKSkKICAgICAgICAgIHRocm93IEVycm9yKCJidWlsdGluIGZ1bmMgc2hvdWxkIGJlIGNhbGxlZCBhcyBhIGNsYXNzIHdpdGggYG5ld2AiKQogICAgICAgIHZhciBlCiAgICAgICAgdGhpcy5mdW5jX2NvZGUgPSBhCiAgICAgICAgdGhpcy5mdW5jX2dsb2JhbHMgPSBiIHx8IG51bGwKICAgICAgICBpZiAodm9pZCAwICE9PSBkKSBmb3IgKGUgaW4gZCkgY1tlXSA9IGRbZV0KICAgICAgICB0aGlzLiRkID0geyBfX25hbWVfXzogYS5jb19uYW1lLCBfX2NsYXNzX186IFNrLmJ1aWx0aW4uZnVuYyB9CiAgICAgICAgdGhpcy5mdW5jX2Nsb3N1cmUgPSBjCiAgICAgICAgdGhpcy50cCRuYW1lID0KICAgICAgICAgICh0aGlzLmZ1bmNfY29kZSAmJgogICAgICAgICAgICB0aGlzLmZ1bmNfY29kZS5jb19uYW1lICYmCiAgICAgICAgICAgIHRoaXMuZnVuY19jb2RlLmNvX25hbWUudikgfHwKICAgICAgICAgIHRoaXMuZnVuY19jb2RlLm5hbWUgfHwKICAgICAgICAgICI8bmF0aXZlIEpTPiIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoImZ1bmN0aW9uIiwgU2suYnVpbHRpbi5mdW5jLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmZ1bmMiLCBTay5idWlsdGluLmZ1bmMpCiAgICAgIFNrLmJ1aWx0aW4uZnVuYy5wcm90b3R5cGUudHAkbmFtZSA9ICJmdW5jdGlvbiIKICAgICAgU2suYnVpbHRpbi5mdW5jLnByb3RvdHlwZS50cCRkZXNjcl9nZXQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoISh2b2lkIDAgPT09IGEgJiYgdm9pZCAwID09PSBiKSkKICAgICAgICByZXR1cm4gYiAmJiBiLnRwJG5hbWUgaW4gU2suYnVpbHRpbiAmJiBTay5idWlsdGluW2IudHAkbmFtZV0gPT09IGIKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubWV0aG9kKHRoaXMsIGEsIGIsICEwKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5tZXRob2QodGhpcywgYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmZ1bmMucHl0aG9uRnVuY3Rpb25zID0gWyJfX2dldF9fIl0KICAgICAgU2suYnVpbHRpbi5mdW5jLnByb3RvdHlwZS5fX2dldF9fID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITApCiAgICAgICAgaWYgKGIgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJiBjID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZ2V0X18oTm9uZSwgTm9uZSkgaXMgaW52YWxpZCIpCiAgICAgICAgcmV0dXJuIGEudHAkZGVzY3JfZ2V0KGIsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mdW5jLnByb3RvdHlwZS50cCRnZXRuYW1lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICh0aGlzLmZ1bmNfY29kZSAmJgogICAgICAgICAgICB0aGlzLmZ1bmNfY29kZS5jb19uYW1lICYmCiAgICAgICAgICAgIHRoaXMuZnVuY19jb2RlLmNvX25hbWUudikgfHwKICAgICAgICAgIHRoaXMuZnVuY19jb2RlLm5hbWUgfHwKICAgICAgICAgICI8bmF0aXZlIEpTPiIKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mdW5jLnByb3RvdHlwZS50cCRjYWxsID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gdGhpcy5mdW5jX2NvZGUuY29fYXJnY291bnQKICAgICAgICB2b2lkIDAgPT09IGMgJiYKICAgICAgICAgIChjID0gdGhpcy5mdW5jX2NvZGUuY29fdmFybmFtZXMKICAgICAgICAgICAgPyB0aGlzLmZ1bmNfY29kZS5jb192YXJuYW1lcy5sZW5ndGgKICAgICAgICAgICAgOiBhLmxlbmd0aCkKICAgICAgICBsZXQgZCA9IHRoaXMuZnVuY19jb2RlLmNvX3Zhcm5hbWVzIHx8IFtdCiAgICAgICAgdmFyIGUgPSB0aGlzLmZ1bmNfY29kZS5jb19rd29ubHlhcmdjb3VudCB8fCAwCiAgICAgICAgbGV0IGYgPSBjICsgZSwKICAgICAgICAgIGcKICAgICAgICB0aGlzLmZ1bmNfY29kZS5jb19rd2FyZ3MgJiYgKGcgPSBbXSkKICAgICAgICB2YXIgaCA9IGEubGVuZ3RoCiAgICAgICAgbGV0IGsgPSBhLmxlbmd0aCA8PSBjID8gYSA6IGEuc2xpY2UoMCwgYykKICAgICAgICBpZiAodGhpcy5mdW5jX2NvZGUuY29fdmFyYXJncykKICAgICAgICAgIChhID0gYS5sZW5ndGggPiBrLmxlbmd0aCA/IGEuc2xpY2Uoay5sZW5ndGgpIDogW10pLAogICAgICAgICAgICAoa1tmXSA9IG5ldyBTay5idWlsdGluLnR1cGxlKGEpKQogICAgICAgIGVsc2UgaWYgKGggPiBjKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICB0aGlzLnRwJGdldG5hbWUoKSArCiAgICAgICAgICAgICAgIigpIHRha2VzICIgKwogICAgICAgICAgICAgIGMgKwogICAgICAgICAgICAgICIgcG9zaXRpb25hbCBhcmd1bWVudCIgKwogICAgICAgICAgICAgICgxID09IGMgPyAiIiA6ICJzIikgKwogICAgICAgICAgICAgICIgYnV0ICIgKwogICAgICAgICAgICAgIGggKwogICAgICAgICAgICAgICgxID09IGggPyAiIHdhcyAiIDogIiB3ZXJlICIpICsKICAgICAgICAgICAgICAiIGdpdmVuIiwKICAgICAgICAgICkKICAgICAgICBpZiAoYikgewogICAgICAgICAgaWYgKHRoaXMuZnVuY19jb2RlLm5vX2t3KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgdGhpcy50cCRnZXRuYW1lKCkgKyAiKCkgdGFrZXMgbm8ga2V5d29yZCBhcmd1bWVudHMiLAogICAgICAgICAgICApCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYi5sZW5ndGg7IGEgKz0gMikgewogICAgICAgICAgICBoID0gYlthXQogICAgICAgICAgICB2YXIgbCA9IGJbYSArIDFdLAogICAgICAgICAgICAgIHIgPSBkLmluZGV4T2YoaCkKICAgICAgICAgICAgaWYgKDAgPD0gcikgewogICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGtbcl0pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAgIHRoaXMudHAkZ2V0bmFtZSgpICsKICAgICAgICAgICAgICAgICAgICAiKCkgZ290IG11bHRpcGxlIHZhbHVlcyBmb3IgYXJndW1lbnQgJyIgKwogICAgICAgICAgICAgICAgICAgIGggKwogICAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBrW3JdID0gbAogICAgICAgICAgICB9IGVsc2UgaWYgKGcpIGcucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoaCksIGwpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICB0aGlzLnRwJGdldG5hbWUoKSArCiAgICAgICAgICAgICAgICAgICIoKSBnb3QgYW4gdW5leHBlY3RlZCBrZXl3b3JkIGFyZ3VtZW50ICciICsKICAgICAgICAgICAgICAgICAgaCArCiAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGIgPSB0aGlzLmZ1bmNfY29kZS4kZGVmYXVsdHMgfHwgW10KICAgICAgICBhID0gMAogICAgICAgIGggPSBbXQogICAgICAgIGwgPSAhMQogICAgICAgIGZvciAociA9IGMgLSBiLmxlbmd0aDsgYSA8IHI7IGErKykKICAgICAgICAgIHZvaWQgMCA9PT0ga1thXSAmJiAoaC5wdXNoKGRbYV0pLCB2b2lkIDAgPT09IGRbYV0gJiYgKGwgPSAhMCkpCiAgICAgICAgaWYgKAogICAgICAgICAgMCAhPSBoLmxlbmd0aCAmJgogICAgICAgICAgKHRoaXMuZnVuY19jb2RlLmNvX2FyZ2NvdW50IHx8IHRoaXMuZnVuY19jb2RlLmNvX3Zhcm5hbWVzKQogICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgdGhpcy50cCRnZXRuYW1lKCkgKwogICAgICAgICAgICAgICIoKSBtaXNzaW5nICIgKwogICAgICAgICAgICAgIGgubGVuZ3RoICsKICAgICAgICAgICAgICAiIHJlcXVpcmVkIGFyZ3VtZW50IiArCiAgICAgICAgICAgICAgKDEgPT0gaC5sZW5ndGggPyAiIiA6ICJzIikgKwogICAgICAgICAgICAgIChsID8gIiIgOiAiOiAiICsgaC5qb2luKCIsICIpKSwKICAgICAgICAgICkKICAgICAgICBmb3IgKDsgYSA8IGM7IGErKykgdm9pZCAwID09PSBrW2FdICYmIChrW2FdID0gYlthIC0gcl0pCiAgICAgICAgaWYgKDAgPCBlKSB7CiAgICAgICAgICBlID0gW10KICAgICAgICAgIGIgPSB0aGlzLmZ1bmNfY29kZS4ka3dkZWZzCiAgICAgICAgICBmb3IgKGEgPSBjOyBhIDwgZjsgYSsrKQogICAgICAgICAgICB2b2lkIDAgPT09IGtbYV0gJiYKICAgICAgICAgICAgICAodm9pZCAwICE9PSBiW2EgLSBjXSA/IChrW2FdID0gYlthIC0gY10pIDogZS5wdXNoKGRbYV0pKQogICAgICAgICAgaWYgKDAgIT09IGUubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgdGhpcy50cCRnZXRuYW1lKCkgKwogICAgICAgICAgICAgICAgIigpIG1pc3NpbmcgIiArCiAgICAgICAgICAgICAgICBlLmxlbmd0aCArCiAgICAgICAgICAgICAgICAiIHJlcXVpcmVkIGtleXdvcmQgYXJndW1lbnQiICsKICAgICAgICAgICAgICAgICgxID09IGUubGVuZ3RoID8gIiIgOiAicyIpICsKICAgICAgICAgICAgICAgICI6ICIgKwogICAgICAgICAgICAgICAgZS5qb2luKCIsICIpLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmZ1bmNfY2xvc3VyZSkgewogICAgICAgICAgaWYgKGQpIGZvciAoYyA9IGsubGVuZ3RoOyBjIDwgZC5sZW5ndGg7IGMrKykgay5wdXNoKHZvaWQgMCkKICAgICAgICAgIGsucHVzaCh0aGlzLmZ1bmNfY2xvc3VyZSkKICAgICAgICB9CiAgICAgICAgZyAmJiBrLnVuc2hpZnQoZykKICAgICAgICByZXR1cm4gdGhpcy5mdW5jX2NvZGUuYXBwbHkodGhpcy5mdW5jX2dsb2JhbHMsIGspCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mdW5jLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gdGhpcy50cCRnZXRuYW1lKCkKICAgICAgICByZXR1cm4gYSBpbiBTay5idWlsdGlucyAmJiB0aGlzID09PSBTay5idWlsdGluc1thXQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIjxidWlsdC1pbiBmdW5jdGlvbiAiICsgYSArICI+IikKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uc3RyKCI8ZnVuY3Rpb24gIiArIGEgKyAiPiIpCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ucmFuZ2UgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBbXSwKICAgICAgICAgIGUKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyYW5nZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDMpCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgic3RhcnQiLCAiaW50ZWdlciIsIFNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpCiAgICAgICAgdm9pZCAwICE9PSBiICYmCiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJzdG9wIiwgImludGVnZXIiLCBTay5idWlsdGluLmNoZWNrSW50KGIpKQogICAgICAgIHZvaWQgMCAhPT0gYyAmJgogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgic3RlcCIsICJpbnRlZ2VyIiwgU2suYnVpbHRpbi5jaGVja0ludChjKSkKICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICBjID0gU2suYnVpbHRpbi5hc251bSQoYykKICAgICAgICB2b2lkIDAgPT09IGIgJiYgdm9pZCAwID09PSBjCiAgICAgICAgICA/ICgoYiA9IGEpLCAoYSA9IDApLCAoYyA9IDEpKQogICAgICAgICAgOiB2b2lkIDAgPT09IGMgJiYgKGMgPSAxKQogICAgICAgIGlmICgwID09PSBjKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgInJhbmdlKCkgc3RlcCBhcmd1bWVudCBtdXN0IG5vdCBiZSB6ZXJvIiwKICAgICAgICAgICkKICAgICAgICBpZiAoMCA8IGMpIGZvciAoZSA9IGE7IGUgPCBiOyBlICs9IGMpIGQucHVzaChuZXcgU2suYnVpbHRpbi5pbnRfKGUpKQogICAgICAgIGVsc2UgZm9yIChlID0gYTsgZSA+IGI7IGUgKz0gYykgZC5wdXNoKG5ldyBTay5idWlsdGluLmludF8oZSkpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmFzbnVtJCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhIHx8IG51bGwgPT09IGEKICAgICAgICAgID8gYQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lCiAgICAgICAgICA/IG51bGwKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbAogICAgICAgICAgPyBhLnYKICAgICAgICAgICAgPyAxCiAgICAgICAgICAgIDogMAogICAgICAgICAgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGEKICAgICAgICAgID8gYQogICAgICAgICAgOiAic3RyaW5nIiA9PT0gdHlwZW9mIGEKICAgICAgICAgID8gYQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IGEudgogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gYS52CiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBhLmNhbnRCZUludCgpCiAgICAgICAgICAgID8gYS5zdHIkKDEwLCAhMCkKICAgICAgICAgICAgOiBhLnRvSW50JCgpCiAgICAgICAgICA6IGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyAwIDwKICAgICAgICAgICAgICBhLnRydWVDb21wYXJlKAogICAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihTay5idWlsdGluLmludF8udGhyZXNob2xkJCksCiAgICAgICAgICAgICAgKSB8fAogICAgICAgICAgICAwID4KICAgICAgICAgICAgICBhLnRydWVDb21wYXJlKAogICAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcigtU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQpLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgPyBhLnRvU3RyaW5nKCkKICAgICAgICAgICAgOiBhLmludFZhbHVlKCkKICAgICAgICAgIDogYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5hc251bSQiLCBTay5idWlsdGluLmFzbnVtJCkKICAgICAgU2suYnVpbHRpbi5hc3NrJCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gMCA9PT0gYSAlIDEgPyBuZXcgU2suYnVpbHRpbi5pbnRfKGEpIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmFzc2skIiwgU2suYnVpbHRpbi5hc3NrJCkKICAgICAgU2suYnVpbHRpbi5hc251bSRub2Zsb2F0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEgfHwgbnVsbCA9PT0gYSkgcmV0dXJuIGEKICAgICAgICBpZiAoYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5ub25lKSByZXR1cm4gbnVsbAogICAgICAgIGlmIChhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmJvb2wpIHJldHVybiBhLnYgPyAxIDogMAogICAgICAgICJudW1iZXIiID09PSB0eXBlb2YgYSAmJiAoYSA9IGEudG9TdHJpbmcoKSkKICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmludF8gJiYgKGEgPSBhLnYudG9TdHJpbmcoKSkKICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmZsb2F0XyAmJiAoYSA9IGEudi50b1N0cmluZygpKQogICAgICAgIGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4ubG5nICYmIChhID0gYS5zdHIkKDEwLCAhMCkpCiAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyICYmIChhID0gYS50b1N0cmluZygpKQogICAgICAgIGlmICgwID4gYS5pbmRleE9mKCIuIikgJiYgMCA+IGEuaW5kZXhPZigiZSIpICYmIDAgPiBhLmluZGV4T2YoIkUiKSkKICAgICAgICAgIHJldHVybiBhCiAgICAgICAgdmFyIGIgPSAwCiAgICAgICAgaWYgKDAgPD0gYS5pbmRleE9mKCJlIikpIHsKICAgICAgICAgIHZhciBjID0gYS5zdWJzdHIoMCwgYS5pbmRleE9mKCJlIikpCiAgICAgICAgICBiID0gYS5zdWJzdHIoYS5pbmRleE9mKCJlIikgKyAxKQogICAgICAgIH0gZWxzZQogICAgICAgICAgMCA8PSBhLmluZGV4T2YoIkUiKQogICAgICAgICAgICA/ICgoYyA9IGEuc3Vic3RyKDAsIGEuaW5kZXhPZigiZSIpKSksCiAgICAgICAgICAgICAgKGIgPSBhLnN1YnN0cihhLmluZGV4T2YoIkUiKSArIDEpKSkKICAgICAgICAgICAgOiAoYyA9IGEpCiAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgIGEgPSBjLmluZGV4T2YoIi4iKQogICAgICAgIGlmICgwID4gYSkgewogICAgICAgICAgaWYgKDAgPD0gYikgewogICAgICAgICAgICBmb3IgKDsgMCA8IGItLTsgKSBjICs9ICIwIgogICAgICAgICAgICByZXR1cm4gYwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGMubGVuZ3RoID4gLWIgPyBjLnN1YnN0cigwLCBjLmxlbmd0aCArIGIpIDogMAogICAgICAgIH0KICAgICAgICBjID0KICAgICAgICAgIDAgPT09IGEKICAgICAgICAgICAgPyBjLnN1YnN0cigxKQogICAgICAgICAgICA6IGEgPCBjLmxlbmd0aAogICAgICAgICAgICA/IGMuc3Vic3RyKDAsIGEpICsgYy5zdWJzdHIoYSArIDEpCiAgICAgICAgICAgIDogYy5zdWJzdHIoMCwgYSkKICAgICAgICBmb3IgKGEgKz0gYjsgYSA+IGMubGVuZ3RoOyApIGMgKz0gIjAiCiAgICAgICAgcmV0dXJuIChjID0gMCA+PSBhID8gMCA6IGMuc3Vic3RyKDAsIGEpKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5hc251bSRub2Zsb2F0IiwgU2suYnVpbHRpbi5hc251bSRub2Zsb2F0KQogICAgICBTay5idWlsdGluLnJvdW5kID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJvdW5kIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYSkpIHsKICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0Z1bmN0aW9uKGEpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImEgZmxvYXQgaXMgcmVxdWlyZWQiKQogICAgICAgICAgaWYgKCFTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIiBpbnN0YW5jZSBoYXMgbm8gYXR0cmlidXRlICdfX2Zsb2F0X18nIiwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICkKICAgICAgICBpZiAoIVNrLl9fZnV0dXJlX18uZHVuZGVyX3JvdW5kICYmIGEucm91bmQkKSByZXR1cm4gYS5yb3VuZCQoYSwgYikKICAgICAgICB2YXIgYyA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJHJvdW5kKQogICAgICAgIGlmIChudWxsICE9IGMpCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jaGVja0Z1bmN0aW9uKGEpCiAgICAgICAgICAgID8gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIFthXSkKICAgICAgICAgICAgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYywgW2EsIGJdKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYSBmbG9hdCBpcyByZXF1aXJlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sZW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigibGVuIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEpCiAgICAgICAgfQogICAgICAgIHZhciBjID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpIHJldHVybiBiKGEpCiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAgICInIG9iamVjdCBjYW5ub3QgYmUgaW50ZXJwcmV0ZWQgYXMgYW4gaW50ZWdlciIsCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19sZW5fXygpIHNob3VsZCByZXR1cm4gYW4gaW50IikKICAgICAgICB9CiAgICAgICAgaWYgKGEuc3EkbGVuZ3RoKSByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oYS5zcSRsZW5ndGgoITApLCBjKQogICAgICAgIGlmIChhLm1wJGxlbmd0aCkgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKGEubXAkbGVuZ3RoKCksIGIpCiAgICAgICAgaWYgKGEudHAkbGVuZ3RoKQogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tGdW5jdGlvbihhKSkgewogICAgICAgICAgICBjID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kbGVuKQogICAgICAgICAgICBpZiAobnVsbCAhPSBjKSByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIFthXSkKICAgICAgICAgICAgaWYgKCFTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArICIgaW5zdGFuY2UgaGFzIG5vIGF0dHJpYnV0ZSAnX19sZW5fXyciLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0gZWxzZSByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oYS50cCRsZW5ndGgoITApLCBjKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJvYmplY3Qgb2YgdHlwZSAnIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgaGFzIG5vIGxlbigpIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5taW4gPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm1pbiIsIGFyZ3VtZW50cy5sZW5ndGgsIDEpCiAgICAgICAgdmFyIGIgPSBTay5taXNjZXZhbC5hcnJheUZyb21Bcmd1bWVudHMoYXJndW1lbnRzKQogICAgICAgIHZhciBjID0gYlswXQogICAgICAgIGlmICh2b2lkIDAgPT09IGMpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJtaW4oKSBhcmcgaXMgYW4gZW1wdHkgc2VxdWVuY2UiKQogICAgICAgIGZvciAoYSA9IDE7IGEgPCBiLmxlbmd0aDsgKythKQogICAgICAgICAgU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGJbYV0sIGMsICJMdCIpICYmIChjID0gYlthXSkKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWF4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJtYXgiLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIHZhciBiID0gU2subWlzY2V2YWwuYXJyYXlGcm9tQXJndW1lbnRzKGFyZ3VtZW50cykKICAgICAgICB2YXIgYyA9IGJbMF0KICAgICAgICBpZiAodm9pZCAwID09PSBjKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigibWF4KCkgYXJnIGlzIGFuIGVtcHR5IHNlcXVlbmNlIikKICAgICAgICBmb3IgKGEgPSAxOyBhIDwgYi5sZW5ndGg7ICsrYSkKICAgICAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChiW2FdLCBjLCAiR3QiKSAmJiAoYyA9IGJbYV0pCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBTay5idWlsdGluLmFueSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImFueSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNUcnVlKGIpKSByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmFsbCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImFsbCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzVHJ1ZShiKSkgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdW0gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzdW0iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoIml0ZXIiLCAiaXRlcmFibGUiLCBTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiBTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic3VtKCkgY2FuJ3Qgc3VtIHN0cmluZ3MgW3VzZSAnJy5qb2luKHNlcSkgaW5zdGVhZF0iLAogICAgICAgICAgKQogICAgICAgIHZhciBkID0gdm9pZCAwID09PSBiID8gbmV3IFNrLmJ1aWx0aW4uaW50XygwKSA6IGIKICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKGMgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYzsgYyA9IGUudHAkaXRlcm5leHQoKSkgewogICAgICAgICAgaWYgKGMgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgICB2YXIgZiA9ICEwCiAgICAgICAgICAgIGQgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyB8fAogICAgICAgICAgICAgIChkID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKFNrLmJ1aWx0aW4uYXNudW0kKGQpKSkKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgJiYKICAgICAgICAgICAgICAoZiB8fCBkIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwgKGQgPSBuZXcgU2suYnVpbHRpbi5sbmcoZCkpKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZC5uYiRhZGQpIHsKICAgICAgICAgICAgdmFyIGcgPSBkLm5iJGFkZChjKQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdm9pZCAwICE9PSBnICYmCiAgICAgICAgICAgICAgZyAhPT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgZCA9IGQubmIkYWRkKGMpCiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAidW5zdXBwb3J0ZWQgb3BlcmFuZCB0eXBlKHMpIGZvciArOiAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoZCkgKwogICAgICAgICAgICAgICInIGFuZCAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYykgKwogICAgICAgICAgICAgICInIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGQKICAgICAgfQogICAgICBTay5idWlsdGluLnppcCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhLCBiCiAgICAgICAgaWYgKDAgPT09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KFtdKQogICAgICAgIHZhciBjID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgYisrKQogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhcmd1bWVudHNbYl0pKQogICAgICAgICAgICBjLnB1c2goU2suYWJzdHIuaXRlcihhcmd1bWVudHNbYl0pKQogICAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImFyZ3VtZW50ICIgKyBiICsgIiBtdXN0IHN1cHBvcnQgaXRlcmF0aW9uIiwKICAgICAgICAgICAgKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGEgPSAhMTsgIWE7ICkgewogICAgICAgICAgdmFyIGUgPSBbXQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7IGIrKykgewogICAgICAgICAgICB2YXIgZiA9IGNbYl0udHAkaXRlcm5leHQoKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBmKSB7CiAgICAgICAgICAgICAgYSA9ICEwCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICBlLnB1c2goZikKICAgICAgICAgIH0KICAgICAgICAgIGEgfHwgZC5wdXNoKG5ldyBTay5idWlsdGluLnR1cGxlKGUpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChkKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYWJzID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImFicyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhNYXRoLmFicyhhLnYpKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE1hdGguYWJzKGEudikpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYSkpCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5hc3NrJChNYXRoLmFicyhTay5idWlsdGluLmFzbnVtJChhKSkpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4KGEpKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLl9fYWJzX18sIFthXSkKICAgICAgICBpZiAoYS50cCRnZXRhdHRyKSB7CiAgICAgICAgICB2YXIgYiA9IGEudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kYWJzKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiKQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKAogICAgICAgICAgImJhZCBvcGVyYW5kIHR5cGUgZm9yIGFicygpOiAnIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmZhYnMgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYWJzKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vcmQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigib3JkIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJvcmQoKSBleHBlY3RlZCBhIHN0cmluZyBvZiBsZW5ndGggMSwgYnV0ICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAiIGZvdW5kIiwKICAgICAgICAgICkKICAgICAgICBpZiAoMSAhPT0gYS52Lmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm9yZCgpIGV4cGVjdGVkIGEgY2hhcmFjdGVyLCBidXQgc3RyaW5nIG9mIGxlbmd0aCAiICsKICAgICAgICAgICAgICBhLnYubGVuZ3RoICsKICAgICAgICAgICAgICAiIGZvdW5kIiwKICAgICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhLnYuY2hhckNvZGVBdCgwKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNociA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjaHIiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0ludChhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYW4gaW50ZWdlciBpcyByZXF1aXJlZCIpCiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKDAgPiBhIHx8IDI1NSA8IGEpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJjaHIoKSBhcmcgbm90IGluIHJhbmdlKDI1NikiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoU3RyaW5nLmZyb21DaGFyQ29kZShhKSkKICAgICAgfQogICAgICBTay5idWlsdGluLnVuaWNociA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjaHIiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0ludChhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYW4gaW50ZWdlciBpcyByZXF1aXJlZCIpCiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoU3RyaW5nLmZyb21Db2RlUG9pbnQoYSkpCiAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgaWYgKGIgaW5zdGFuY2VvZiBSYW5nZUVycm9yKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKGIubWVzc2FnZSkKICAgICAgICAgIHRocm93IGIKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnQyc3RyXyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICB2YXIgZCA9ICIiCiAgICAgICAgICAyID09PSBiIHx8IFNrLl9fZnV0dXJlX18ucHl0aG9uMyB8fCAoZCA9ICJMIikKICAgICAgICAgIGIgPSBhLnN0ciQoYiwgITEpCiAgICAgICAgICByZXR1cm4gYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIi0iICsgYyArIGIgKyBkKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cihjICsgYiArIGQpCiAgICAgICAgfQogICAgICAgIGEgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgYiA9IGEudG9TdHJpbmcoYikKICAgICAgICByZXR1cm4gMCA+IGEKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCItIiArIGMgKyBiLnNsaWNlKDEpKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5zdHIoYyArIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5oZXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaGV4IiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzSW5kZXgoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJoZXgoKSBhcmd1bWVudCBjYW4ndCBiZSBjb252ZXJ0ZWQgdG8gaGV4IiwKICAgICAgICAgICkKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5pbnQyc3RyXyhhLCAxNiwgIjB4IikKICAgICAgfQogICAgICBTay5idWlsdGluLm9jdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJvY3QiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGlmICghU2subWlzY2V2YWwuaXNJbmRleChhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm9jdCgpIGFyZ3VtZW50IGNhbid0IGJlIGNvbnZlcnRlZCB0byBoZXgiLAogICAgICAgICAgKQogICAgICAgIHJldHVybiBTay5fX2Z1dHVyZV9fLm9jdGFsX251bWJlcl9saXRlcmFsCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uaW50MnN0cl8oYSwgOCwgIjBvIikKICAgICAgICAgIDogU2suYnVpbHRpbi5pbnQyc3RyXyhhLCA4LCAiMCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiYmluIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzSW5kZXgoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICInIG9iamVjdCBjYW4ndCBiZSBpbnRlcnByZXRlZCBhcyBhbiBpbmRleCIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50MnN0cl8oYSwgMiwgIjBiIikKICAgICAgfQogICAgICBTay5idWlsdGluLmRpciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiwgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImRpciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgdmFyIGQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICB2YXIgYiA9IG51bGwKICAgICAgICAgIGlmICgKICAgICAgICAgICAgLTEgIT09CiAgICAgICAgICAgICJfX2Jhc2VzX18gX19tcm9fXyBfX2NsYXNzX18gX19uYW1lX18gR2VuZXJpY0dldEF0dHIgR2VuZXJpY1NldEF0dHIgR2VuZXJpY1B5dGhvbkdldEF0dHIgR2VuZXJpY1B5dGhvblNldEF0dHIgcHl0aG9uRnVuY3Rpb25zIEhhc2hOb3RJbXBsZW1lbnRlZCBjb25zdHJ1Y3RvciBfX2RpY3RfXyIKICAgICAgICAgICAgICAuc3BsaXQoIiAiKQogICAgICAgICAgICAgIC5pbmRleE9mKGEpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICA7LTEgIT09IGEuaW5kZXhPZigiJCIpCiAgICAgICAgICAgID8gKGIgPSBTay5idWlsdGluLmRpci5zbG90TmFtZVRvUmljaE5hbWUoYSkpCiAgICAgICAgICAgIDogIl8iICE9PSBhLmNoYXJBdChhLmxlbmd0aCAtIDEpCiAgICAgICAgICAgID8gKGIgPSBhKQogICAgICAgICAgICA6ICJfIiA9PT0gYS5jaGFyQXQoMCkgJiYgKGIgPSBhKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgdmFyIGUgPSBbXQogICAgICAgIHZhciBmID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kZGlyKQogICAgICAgIGlmIChudWxsICE9IGYpIHsKICAgICAgICAgIHZhciBnID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGYsIFthXSkKICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja1NlcXVlbmNlKGcpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZGlyX18gbXVzdCByZXR1cm4gc2VxdWVuY2UuIikKICAgICAgICAgIGcgPSBTay5mZmkucmVtYXBUb0pzKGcpCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZy5sZW5ndGg7ICsrYikgZS5wdXNoKG5ldyBTay5idWlsdGluLnN0cihnW2JdKSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChiIGluIGEuY29uc3RydWN0b3IucHJvdG90eXBlKQogICAgICAgICAgICAoYyA9IGQoYikpICYmIGUucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoYykpCiAgICAgICAgICBpZiAoYS4kZCkKICAgICAgICAgICAgaWYgKGEuJGQudHAkaXRlcikKICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgZiA9IGEuJGQudHAkaXRlcigpLCBiID0gZi50cCRpdGVybmV4dCgpOwogICAgICAgICAgICAgICAgdm9pZCAwICE9PSBiOwogICAgICAgICAgICAgICAgYiA9IGYudHAkaXRlcm5leHQoKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIChjID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpKSwKICAgICAgICAgICAgICAgICAgKGMgPSBkKGMudikpICYmIGUucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoYykpCiAgICAgICAgICAgIGVsc2UgZm9yIChjIGluIGEuJGQpIGUucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoYykpCiAgICAgICAgICB2YXIgaCA9IGEudHAkbXJvCiAgICAgICAgICAhaCAmJiBhLm9iJHR5cGUgJiYgKGggPSBhLm9iJHR5cGUudHAkbXJvKQogICAgICAgICAgaWYgKGgpCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBoLnYubGVuZ3RoOyArK2IpCiAgICAgICAgICAgICAgZm9yIChnIGluICgoZiA9IGgudltiXSksIGYpKQogICAgICAgICAgICAgICAgZi5oYXNPd25Qcm9wZXJ0eShnKSAmJgogICAgICAgICAgICAgICAgICAoYyA9IGQoZykpICYmCiAgICAgICAgICAgICAgICAgIGUucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoYykpCiAgICAgICAgfQogICAgICAgIGUuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICByZXR1cm4gKGEudiA+IGIudikgLSAoYS52IDwgYi52KQogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoCiAgICAgICAgICBlLmZpbHRlcihmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgIHJldHVybiBhICE9PSBjW2IgKyAxXQogICAgICAgICAgfSksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGlyLnNsb3ROYW1lVG9SaWNoTmFtZSA9IGZ1bmN0aW9uKGEpIHt9CiAgICAgIFNrLmJ1aWx0aW4ucmVwciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZXByIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwub2JqZWN0UmVwcihhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub3BlbiA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJvcGVuIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMykKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBuZXcgU2suYnVpbHRpbi5zdHIoInIiKSkKICAgICAgICBpZiAoL1wrLy50ZXN0KGIudikpIHRocm93ICJ0b2RvOyBoYXZlbid0IGltcGxlbWVudGVkIHJlYWQvd3JpdGUgbW9kZSIKICAgICAgICBpZiAoCiAgICAgICAgICAoInciID09PSBiLnYgfHwgIndiIiA9PT0gYi52IHx8ICJhIiA9PT0gYi52IHx8ICJhYiIgPT09IGIudikgJiYKICAgICAgICAgICFTay5ub25yZWFkb3BlbgogICAgICAgICkKICAgICAgICAgIHRocm93ICJ0b2RvOyBoYXZlbid0IGltcGxlbWVudGVkIG5vbi1yZWFkIG9wZW5zIgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5maWxlKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pc2luc3RhbmNlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNpbnN0YW5jZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKCEoU2suYnVpbHRpbi5jaGVja0NsYXNzKGIpIHx8IGIgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImlzaW5zdGFuY2UoKSBhcmcgMiBtdXN0IGJlIGEgY2xhc3MsIHR5cGUsIG9yIHR1cGxlIG9mIGNsYXNzZXMgYW5kIHR5cGVzIiwKICAgICAgICAgICkKICAgICAgICBpZiAoYiA9PT0gU2suYnVpbHRpbi5ub25lLnByb3RvdHlwZS5vYiR0eXBlKQogICAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUKICAgICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgICAgOiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgaWYgKGEub2IkdHlwZSA9PT0gYikgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgIGlmIChiIGluc3RhbmNlb2YgU2suYnVpbHRpbi50dXBsZSkgewogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGIudi5sZW5ndGg7ICsrYykKICAgICAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzVHJ1ZShTay5idWlsdGluLmlzaW5zdGFuY2UoYSwgYi52W2NdKSkpCiAgICAgICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBiKSByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgdmFyIGQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICBpZiAoYSA9PT0gYikgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS4kZCkgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICAgIHZhciBjID0gYS4kZC5tcCRzdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXykKICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBjLnYubGVuZ3RoOyArK2EpCiAgICAgICAgICAgIGlmIChTay5taXNjZXZhbC5pc1RydWUoZChjLnZbYV0sIGIpKSkgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGQoYS5vYiR0eXBlLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaGFzaCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJoYXNoIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIE9iamVjdCkgewogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tOb25lKGEudHAkaGFzaCkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAgICAgICAidW5oYXNoYWJsZSB0eXBlOiAnIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIiciLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGEudHAkaGFzaCkgewogICAgICAgICAgICBpZiAoYS4kc2F2ZWRIYXNoXykgcmV0dXJuIGEuJHNhdmVkSGFzaF8KICAgICAgICAgICAgYS4kc2F2ZWRIYXNoXyA9IGEudHAkaGFzaCgpCiAgICAgICAgICAgIHJldHVybiBhLiRzYXZlZEhhc2hfCiAgICAgICAgICB9CiAgICAgICAgICB2b2lkIDAgPT09IGEuX19oYXNoICYmCiAgICAgICAgICAgICgoU2suYnVpbHRpbi5oYXNoQ291bnQgKz0gMSksIChhLl9faGFzaCA9IFNrLmJ1aWx0aW4uaGFzaENvdW50KSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEuX19oYXNoKQogICAgICAgIH0KICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhIHx8IG51bGwgPT09IGEgfHwgITAgPT09IGEgfHwgITEgPT09IGEpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoInVuc3VwcG9ydGVkIEphdmFzY3JpcHQgdHlwZSIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0eXBlb2YgYSArICIgIiArIFN0cmluZyhhKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmdldGF0dHIgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZ2V0YXR0ciIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDMpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhdHRyaWJ1dGUgbmFtZSBtdXN0IGJlIHN0cmluZyIpCiAgICAgICAgdmFyIGQgPSBiLiRqc3N0cigpCiAgICAgICAgdmFyIGUgPSBuZXcgU2suYnVpbHRpbi5zdHIoU2suZml4UmVzZXJ2ZWRXb3JkcyhkKSkKICAgICAgICBlID0gYS50cCRnZXRhdHRyKGUpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSkgewogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYykgcmV0dXJuIGMKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgaGFzIG5vIGF0dHJpYnV0ZSAnIiArCiAgICAgICAgICAgICAgZCArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0YXR0ciA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzZXRhdHRyIiwgYXJndW1lbnRzLmxlbmd0aCwgMywgMykKICAgICAgICBpZiAoCiAgICAgICAgICB2b2lkIDAgPT09IGEgfHwKICAgICAgICAgIHZvaWQgMCA9PT0gYS4kciB8fAogICAgICAgICAgInR5cGUiICE9PSBhLiRyKCkudi5zbGljZSgxLCA1KQogICAgICAgICkgewogICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImF0dHJpYnV0ZSBuYW1lIG11c3QgYmUgc3RyaW5nIikKICAgICAgICAgIHZhciBkID0gYi4kanNzdHIoKQogICAgICAgICAgaWYgKGEudHAkc2V0YXR0cikKICAgICAgICAgICAgYS50cCRzZXRhdHRyKG5ldyBTay5idWlsdGluLnN0cihTay5maXhSZXNlcnZlZFdvcmRzKGQpKSwgYykKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoIm9iamVjdCBoYXMgbm8gYXR0cmlidXRlICIgKyBkKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiY2FuJ3Qgc2V0IGF0dHJpYnV0ZXMgb2YgYnVpbHQtaW4vZXh0ZW5zaW9uIHR5cGUgJyIgKyBhLnRwJG5hbWUgKyAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ucmF3X2lucHV0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gYSA/IGEgOiAiIgogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbihTay5pbXBvcnRNb2R1bGUoInN5cyIsICExLCAhMCksIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBTay5pbnB1dGZ1blRha2VzUHJvbXB0CiAgICAgICAgICAgID8gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KFNrLmJ1aWx0aW4uZmlsZS4kcmVhZGxpbmUsIFsKICAgICAgICAgICAgICAgIGEuJGQuc3RkaW4sCiAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgYiwKICAgICAgICAgICAgICBdKQogICAgICAgICAgICA6IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoYS4kZC5zdGRvdXQud3JpdGUsIFsKICAgICAgICAgICAgICAgICAgICBhLiRkLnN0ZG91dCwKICAgICAgICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoYiksCiAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoCiAgICAgICAgICAgICAgICAgICAgYS4kZC5zdGRpbi5yZWFkbGluZSwKICAgICAgICAgICAgICAgICAgICBbYS4kZC5zdGRpbl0sCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgKQogICAgICAgIH0pCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnB1dCA9IFNrLmJ1aWx0aW4ucmF3X2lucHV0CiAgICAgIFNrLmJ1aWx0aW4uanNldmFsID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSBTay5nbG9iYWwuZXZhbChTay5mZmkucmVtYXBUb0pzKGEpKQogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gU2suZmZpLnJlbWFwVG9QeShhKQogICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgIGlmIChiLmNvbnN0cnVjdG9yID09PSBTay5hc3NlcnRzLkFzc2VydGlvbkVycm9yKQogICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgICB0aHJvdyBiCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uanNtaWxsaXMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoKS52YWx1ZU9mKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmV2YWxfID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigiZXZhbCBpcyBub3QgeWV0IGltcGxlbWVudGVkIikKICAgICAgfQogICAgICBTay5idWlsdGluLm1hcCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IFtdLAogICAgICAgICAgZCwKICAgICAgICAgIGUKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJtYXAiLCBhcmd1bWVudHMubGVuZ3RoLCAyKQogICAgICAgIGlmICgyIDwgYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgdmFyIGYgPSBbXQogICAgICAgICAgdmFyIGcgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuYXBwbHkoYXJndW1lbnRzKS5zbGljZSgxKQogICAgICAgICAgZm9yIChlID0gMDsgZSA8IGcubGVuZ3RoOyBlKyspIHsKICAgICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoZ1tlXSkpIHsKICAgICAgICAgICAgICB2YXIgaCA9IHBhcnNlSW50KGUsIDEwKSArIDIKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiYXJndW1lbnQgIiArIGggKyAiIHRvIG1hcCgpIG11c3Qgc3VwcG9ydCBpdGVyYXRpb24iLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfQogICAgICAgICAgICBnW2VdID0gU2suYWJzdHIuaXRlcihnW2VdKQogICAgICAgICAgfQogICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICB2YXIgayA9IFtdCiAgICAgICAgICAgIGZvciAoZSA9IGQgPSAwOyBlIDwgZy5sZW5ndGg7IGUrKykKICAgICAgICAgICAgICAoaCA9IGdbZV0udHAkaXRlcm5leHQoKSksCiAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGggPyAoay5wdXNoKFNrLmJ1aWx0aW4ubm9uZS5ub25lJCksIGQrKykgOiBrLnB1c2goaCkKICAgICAgICAgICAgaWYgKGQgIT09IGcubGVuZ3RoKSBmLnB1c2goaykKICAgICAgICAgICAgZWxzZSBicmVhawogICAgICAgICAgfQogICAgICAgICAgYiA9IG5ldyBTay5idWlsdGluLmxpc3QoZikKICAgICAgICB9CiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgU2subWlzY2V2YWwuaXRlckZvcihTay5hYnN0ci5pdGVyKGIpLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgIGlmIChhID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgICAgICAgYiBpbnN0YW5jZW9mIEFycmF5ICYmIChiID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoYikpLCBjLnB1c2goYikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBiIGluc3RhbmNlb2YgQXJyYXkgfHwgKGIgPSBbYl0pLAogICAgICAgICAgICAgICAgU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICAgIFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKGEsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGIpLAogICAgICAgICAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYy5wdXNoKGEpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKQogICAgICAgICAgfSksCiAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoYykKICAgICAgICAgIH0sCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ucmVkdWNlID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHZhciBkCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicmVkdWNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYikgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYikKICAgICAgICBpZiAodm9pZCAwID09PSBjICYmICgoYyA9IGUudHAkaXRlcm5leHQoKSksIHZvaWQgMCA9PT0gYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJyZWR1Y2UoKSBvZiBlbXB0eSBzZXF1ZW5jZSB3aXRoIG5vIGluaXRpYWwgdmFsdWUiLAogICAgICAgICAgKQogICAgICAgIHZhciBmID0gYwogICAgICAgIGZvciAoZCA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBkOyBkID0gZS50cCRpdGVybmV4dCgpKQogICAgICAgICAgZiA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLCBbZiwgZF0pCiAgICAgICAgcmV0dXJuIGYKICAgICAgfQogICAgICBTay5idWlsdGluLmZpbHRlciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImZpbHRlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBbXQogICAgICAgIH0KICAgICAgICB2YXIgZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGEucHVzaChiKQogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9CiAgICAgICAgdmFyIGYgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChhKQogICAgICAgIH0KICAgICAgICBiLl9fY2xhc3NfXyA9PT0gU2suYnVpbHRpbi5zdHIKICAgICAgICAgID8gKChkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiIikKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgIHJldHVybiBhLnNxJGNvbmNhdChiKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGYgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgfSkpCiAgICAgICAgICA6IGIuX19jbGFzc19fID09PSBTay5idWlsdGluLnR1cGxlICYmCiAgICAgICAgICAgIChmID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShhKQogICAgICAgICAgICB9KQogICAgICAgIHZhciBnID0gZCgpCiAgICAgICAgdmFyIGggPSBTay5hYnN0ci5pdGVyKGIpCiAgICAgICAgZm9yIChjID0gaC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGM7IGMgPSBoLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAoZCA9CiAgICAgICAgICAgIGEgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbChjKQogICAgICAgICAgICAgIDogU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEsIFtjXSkpLAogICAgICAgICAgICBTay5taXNjZXZhbC5pc1RydWUoZCkgJiYgKGcgPSBlKGcsIGMpKQogICAgICAgIHJldHVybiBmKGcpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5oYXNhdHRyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImhhc2F0dHIiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImhhc2F0dHIoKTogYXR0cmlidXRlIG5hbWUgbXVzdCBiZSBzdHJpbmciLAogICAgICAgICAgKQogICAgICAgIGlmIChhLnRwJGdldGF0dHIpCiAgICAgICAgICByZXR1cm4gYS50cCRnZXRhdHRyKGIpCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICAgIDogU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKCJPYmplY3QgaGFzIG5vIHRwJGdldGF0dHIgbWV0aG9kIikKICAgICAgfQogICAgICBTay5idWlsdGluLnBvdyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJwb3ciLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAzKQogICAgICAgIGMgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUgJiYgKGMgPSB2b2lkIDApCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4KGEpKSByZXR1cm4gYS5uYiRwb3dlcihiLCBjKQogICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICB2YXIgZSA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgdmFyIGYgPSBTay5idWlsdGluLmFzbnVtJChjKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja051bWJlcihhKSB8fCAhU2suYnVpbHRpbi5jaGVja051bWJlcihiKSkgewogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJ1bnN1cHBvcnRlZCBvcGVyYW5kIHR5cGUocykgZm9yIHBvdygpOiAnIiArCiAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgICAiJyBhbmQgJyIgKwogICAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYikgKwogICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJ1bnN1cHBvcnRlZCBvcGVyYW5kIHR5cGUocykgZm9yIHBvdygpOiAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICInLCAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYikgKwogICAgICAgICAgICAgICInLCAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYykgKwogICAgICAgICAgICAgICInIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgaWYgKDAgPiBkICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICJuZWdhdGl2ZSBudW1iZXIgY2Fubm90IGJlIHJhaXNlZCB0byBhIGZyYWN0aW9uYWwgcG93ZXIiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgPT09IGMpIHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfIHx8CiAgICAgICAgICAgIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyB8fAogICAgICAgICAgICAwID4gZQogICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE1hdGgucG93KGQsIGUpKQogICAgICAgICAgZiA9IG5ldyBTay5idWlsdGluLmludF8oZCkKICAgICAgICAgIGUgPSBuZXcgU2suYnVpbHRpbi5pbnRfKGUpCiAgICAgICAgICBlID0gZi5uYiRwb3dlcihlKQogICAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fCBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcoZSkKICAgICAgICAgICAgOiBlCiAgICAgICAgfQogICAgICAgIGlmICgKICAgICAgICAgICFTay5idWlsdGluLmNoZWNrSW50KGEpIHx8CiAgICAgICAgICAhU2suYnVpbHRpbi5jaGVja0ludChiKSB8fAogICAgICAgICAgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYykKICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJwb3coKSAzcmQgYXJndW1lbnQgbm90IGFsbG93ZWQgdW5sZXNzIGFsbCBhcmd1bWVudHMgYXJlIGludGVnZXJzIiwKICAgICAgICAgICkKICAgICAgICBpZiAoMCA+IGUpIHsKICAgICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgInBvdygpIDJuZCBhcmd1bWVudCBjYW5ub3QgYmUgbmVnYXRpdmUgd2hlbiAzcmQgYXJndW1lbnQgc3BlY2lmaWVkIiwKICAgICAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAicG93KCkgMm5kIGFyZ3VtZW50IGNhbm5vdCBiZSBuZWdhdGl2ZSB3aGVuIDNyZCBhcmd1bWVudCBzcGVjaWZpZWQiLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBpZiAoMCA9PT0gZikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoInBvdygpIDNyZCBhcmd1bWVudCBjYW5ub3QgYmUgMCIpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIEluZmluaXR5ID09PSBNYXRoLnBvdyhkLCBlKQogICAgICAgICAgPyAoKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYSkpLCBhLm5iJHBvd2VyKGIsIGMpKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKE1hdGgucG93KGQsIGUpKS5uYiRyZW1haW5kZXIoYykKICAgICAgfQogICAgICBTay5idWlsdGluLnF1aXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLnN0cihhKS52CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3lzdGVtRXhpdChhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaXNzdWJjbGFzcyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzc3ViY2xhc3MiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0NsYXNzKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJpc3N1YmNsYXNzKCkgYXJnIDEgbXVzdCBiZSBhIGNsYXNzIikKICAgICAgICBpZiAoIShTay5idWlsdGluLmNoZWNrQ2xhc3MoYikgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGUpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaXNzdWJjbGFzcygpIGFyZyAyIG11c3QgYmUgYSBjbGFzcyBvciB0dXBsZSBvZiBjbGFzc2VzIiwKICAgICAgICAgICkKICAgICAgICB2YXIgZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIGlmIChhID09PSBiKSByZXR1cm4gITAKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGEuJGQgJiYgYS4kZC5tcCRzdWJzY3JpcHQpCiAgICAgICAgICAgIGlmIChhLiRkLnNxJGNvbnRhaW5zKFNrLmJ1aWx0aW4udHlwZS5iYXNlc1N0cl8pKQogICAgICAgICAgICAgIHZhciBjID0gYS4kZC5tcCRzdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXykKICAgICAgICAgICAgZWxzZSByZXR1cm4gITEKICAgICAgICAgIGVsc2UgcmV0dXJuICExCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYy52Lmxlbmd0aDsgKythKSBpZiAoZChjLnZbYV0sIGIpKSByZXR1cm4gITAKICAgICAgICAgIHJldHVybiAhMQogICAgICAgIH0KICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0NsYXNzKGIpKSByZXR1cm4gYSA9PT0gYiA/ICEwIDogZChhLCBiKQogICAgICAgIGlmIChiIGluc3RhbmNlb2YgU2suYnVpbHRpbi50dXBsZSkgewogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGIudi5sZW5ndGg7ICsrYykKICAgICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uaXNzdWJjbGFzcyhhLCBiLnZbY10pKSByZXR1cm4gITAKICAgICAgICAgIHJldHVybiAhMQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLmdsb2JhbHMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGIgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgIGZvciAoYSBpbiBTay5nbG9iYWxzKQogICAgICAgICAgYi5tcCRhc3Nfc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnN0cihhKSwgU2suZ2xvYmFsc1thXSkKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGl2bW9kID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBTay5hYnN0ci5udW1iZXJCaW5PcChhLCBiLCAiRGl2TW9kIikKICAgICAgfQogICAgICBTay5idWlsdGluLmZvcm1hdCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJmb3JtYXQiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0cikKICAgICAgICByZXR1cm4gU2suYWJzdHIub2JqZWN0Rm9ybWF0KGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5yZXZlcnNlZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZXZlcnNlZCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgdmFyIGIgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRyZXZlcnNlZCkKICAgICAgICBpZiAobnVsbCAhPSBiKSByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGIsIFthXSkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTZXF1ZW5jZShhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiJyBvYmplY3QgaXMgbm90IGEgc2VxdWVuY2UiLAogICAgICAgICAgKQogICAgICAgIHJldHVybiBuZXcgKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHRoaXMuaWR4ID0gYS5zcSRsZW5ndGgoKSAtIDEKICAgICAgICAgIHRoaXMubXlvYmogPSBhCiAgICAgICAgICB0aGlzLmdldGl0ZW0gPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtKQogICAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghKDAgPiB0aGlzLmlkeCkpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkodGhpcy5nZXRpdGVtLCBbCiAgICAgICAgICAgICAgICAgIHRoaXMubXlvYmosCiAgICAgICAgICAgICAgICAgIFNrLmZmaS5yZW1hcFRvUHkodGhpcy5pZHgpLAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uSW5kZXhFcnJvcikgcmV0dXJuCiAgICAgICAgICAgICAgICB0aHJvdyBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuaWR4LS0KICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmlkID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlkIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2b2lkIDAgPT09IGEuX19pZCAmJgogICAgICAgICAgKChTay5idWlsdGluLmlkQ291bnQgKz0gMSksIChhLl9faWQgPSBTay5idWlsdGluLmlkQ291bnQpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEuX19pZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJ5dGVhcnJheSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiYnl0ZWFycmF5IGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNhbGxhYmxlID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNhbGxhYmxlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jaGVja0NhbGxhYmxlKGEpCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kZWxhdHRyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImRlbGF0dHIiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICh2b2lkIDAgIT09IGEuJGRbYi52XSkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uc2V0YXR0cihhLCBiLCB2b2lkIDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5zZXRhdHRyKGEuJGQsIGIsIHZvaWQgMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgIGlmIChjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcikKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAgICAgICAgICAgIiBpbnN0YW5jZSBoYXMgbm8gYXR0cmlidXRlICciICsKICAgICAgICAgICAgICAgICAgICAgICAgYi52ICsKICAgICAgICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgdGhyb3cgYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0sCiAgICAgICAgICApCiAgICAgICAgaWYgKCJ0eXBlIiAhPT0gYS4kcigpLnYuc2xpY2UoMSwgNSkpIHsKICAgICAgICAgIGlmIChhLm9iJHR5cGUgPT09IFNrLmJ1aWx0aW4udHlwZSAmJiB2b2lkIDAgIT09IGFbYi52XSkKICAgICAgICAgICAgcmV0dXJuIChhW2Iudl0gPSB2b2lkIDApLCBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArICIgaW5zdGFuY2UgaGFzIG5vIGF0dHJpYnV0ZSAnIiArIGIudiArICInIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgImNhbid0IHNldCBhdHRyaWJ1dGVzIG9mIGJ1aWx0LWluL2V4dGVuc2lvbiB0eXBlICciICsgYS50cCRuYW1lICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmV4ZWNmaWxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJleGVjZmlsZSBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mcm96ZW5zZXQgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImZyb3plbnNldCBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5oZWxwID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigiaGVscCBpcyBub3QgeWV0IGltcGxlbWVudGVkIikKICAgICAgfQogICAgICBTay5idWlsdGluLml0ZXIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXRlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKDEgPT09IGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pdGVyYXRvcihhKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0NhbGxhYmxlKGEpKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaXRlcmF0b3IoYSwgYikKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpdGVyKHYsIHcpOiB2IG11c3QgYmUgY2FsbGFibGUiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG9jYWxzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJsb2NhbHMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWVtb3J5dmlldyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAibWVtb3J5dmlldyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5uZXh0XyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJuZXh0IiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAoIWEudHAkaXRlcm5leHQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBhbiBpdGVyYXRvciIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBhLnRwJGl0ZXJuZXh0KCkKICAgICAgICBpZiAodm9pZCAwID09PSBjKSB7CiAgICAgICAgICBpZiAoYikgcmV0dXJuIGIKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN0b3BJdGVyYXRpb24oKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ucmVsb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJyZWxvYWQgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udmFycyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoInZhcnMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi54cmFuZ2UgPSBTay5idWlsdGluLnJhbmdlCiAgICAgIFNrLmJ1aWx0aW4uYXBwbHlfID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigiYXBwbHkgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5idWZmZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImJ1ZmZlciBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb2VyY2UgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImNvZXJjZSBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRlcm4gPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImludGVybiBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFN0cmluZy5mcm9tQ29kZVBvaW50IHx8CiAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGEgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBhID0ge30sCiAgICAgICAgICAgICAgICAgIGIgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkKICAgICAgICAgICAgICAgIHZhciBjID0gYihhLCAiZm9vIiwgYSkgJiYgYgogICAgICAgICAgICAgIH0gY2F0Y2ggKGgpIHt9CiAgICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgICAgfSkoKSwKICAgICAgICAgICAgYiA9IFN0cmluZy5mcm9tQ2hhckNvZGUsCiAgICAgICAgICAgIGMgPSBNYXRoLmZsb29yLAogICAgICAgICAgICBkID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgIHZhciBkID0gW10sCiAgICAgICAgICAgICAgICBlID0gLTEsCiAgICAgICAgICAgICAgICBoID0gYXJndW1lbnRzLmxlbmd0aAogICAgICAgICAgICAgIGlmICghaCkgcmV0dXJuICIiCiAgICAgICAgICAgICAgZm9yICh2YXIgayA9ICIiOyArK2UgPCBoOyApIHsKICAgICAgICAgICAgICAgIHZhciBsID0gTnVtYmVyKGFyZ3VtZW50c1tlXSkKICAgICAgICAgICAgICAgIGlmICghaXNGaW5pdGUobCkgfHwgMCA+IGwgfHwgMTExNDExMSA8IGwgfHwgYyhsKSAhPSBsKQogICAgICAgICAgICAgICAgICB0aHJvdyBSYW5nZUVycm9yKCJJbnZhbGlkIGNvZGUgcG9pbnQ6ICIgKyBsKQogICAgICAgICAgICAgICAgaWYgKDY1NTM1ID49IGwpIGQucHVzaChsKQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGwgLT0gNjU1MzYKICAgICAgICAgICAgICAgICAgdmFyIHIgPSAobCA+PiAxMCkgKyA1NTI5NgogICAgICAgICAgICAgICAgICBsID0gKGwgJSAxMDI0KSArIDU2MzIwCiAgICAgICAgICAgICAgICAgIGQucHVzaChyLCBsKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUgKyAxID09IGggfHwgMTYzODQgPCBkLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgKGsgKz0gYi5hcHBseShudWxsLCBkKSksIChkLmxlbmd0aCA9IDApCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBrCiAgICAgICAgICAgIH0KICAgICAgICAgIGEKICAgICAgICAgICAgPyBhKFN0cmluZywgImZyb21Db2RlUG9pbnQiLCB7CiAgICAgICAgICAgICAgICB2YWx1ZTogZCwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITAsCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgOiAoU3RyaW5nLmZyb21Db2RlUG9pbnQgPSBkKQogICAgICAgIH0pKCkKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIGEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyArK2IpCiAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGFbYl0gJiYgKGFbYl0gPSBuZXcgU2suYnVpbHRpbi5zdHIoYVtiXSkpCiAgICAgICAgdGhpcy5hcmdzID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoYSkKICAgICAgICB0aGlzLnRyYWNlYmFjayA9IFtdCiAgICAgICAgMyA8PSB0aGlzLmFyZ3Muc3EkbGVuZ3RoKCkgJiYKICAgICAgICAgIHRoaXMudHJhY2ViYWNrLnB1c2goewogICAgICAgICAgICBsaW5lbm86IHRoaXMuYXJncy52WzJdLAogICAgICAgICAgICBmaWxlbmFtZTogdGhpcy5hcmdzLnZbMV0udiB8fCAiPHVua25vd24+IiwKICAgICAgICAgIH0pCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiQmFzZUV4Y2VwdGlvbiIsCiAgICAgICAgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUudHAkc3RyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEKICAgICAgICB2YXIgYiA9ICIiICsgdGhpcy50cCRuYW1lCiAgICAgICAgdGhpcy5hcmdzICYmCiAgICAgICAgICAoYiArPSAiOiAiICsgKDAgPCB0aGlzLmFyZ3Mudi5sZW5ndGggPyB0aGlzLmFyZ3MudlswXS52IDogIiIpKQogICAgICAgIGIgPQogICAgICAgICAgMCAhPT0gdGhpcy50cmFjZWJhY2subGVuZ3RoCiAgICAgICAgICAgID8gYiArICgiIG9uIGxpbmUgIiArIHRoaXMudHJhY2ViYWNrWzBdLmxpbmVubykKICAgICAgICAgICAgOiBiICsgIiBhdCA8dW5rbm93bj4iCiAgICAgICAgaWYgKDQgPCB0aGlzLmFyZ3Mudi5sZW5ndGgpIHsKICAgICAgICAgIGIgKz0gIlxuIiArIHRoaXMuYXJncy52WzRdLnYgKyAiXG4iCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgdGhpcy5hcmdzLnZbM107ICsrYSkgYiArPSAiICIKICAgICAgICAgIGIgKz0gIl5cbiIKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy50cCRzdHIoKS52CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uLnByb3RvdHlwZS5hcmdzID0gewogICAgICAgIHRwJGRlc2NyX2dldDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIGEuYXJncwogICAgICAgIH0sCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLkJhc2VFeGNlcHRpb24iLCBTay5idWlsdGluLkJhc2VFeGNlcHRpb24pCiAgICAgIFNrLmJ1aWx0aW4uRXhjZXB0aW9uID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkV4Y2VwdGlvbikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLkV4Y2VwdGlvbi5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiRXhjZXB0aW9uIiwKICAgICAgICBTay5idWlsdGluLkV4Y2VwdGlvbiwKICAgICAgICBTay5idWlsdGluLkJhc2VFeGNlcHRpb24sCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLkV4Y2VwdGlvbiIsIFNrLmJ1aWx0aW4uRXhjZXB0aW9uKQogICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlN0YW5kYXJkRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLkV4Y2VwdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiU3RhbmRhcmRFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uRXhjZXB0aW9uLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yIiwgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yKQogICAgICBTay5idWlsdGluLkFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkFzc2VydGlvbkVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uQXNzZXJ0aW9uRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIkFzc2VydGlvbkVycm9yIiwKICAgICAgICBTay5idWlsdGluLkFzc2VydGlvbkVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uQXNzZXJ0aW9uRXJyb3IiLCBTay5idWlsdGluLkFzc2VydGlvbkVycm9yKQogICAgICBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIkF0dHJpYnV0ZUVycm9yIiwKICAgICAgICBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLkltcG9ydEVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkltcG9ydEVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uSW1wb3J0RXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIkltcG9ydEVycm9yIiwKICAgICAgICBTay5idWlsdGluLkltcG9ydEVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLkluZGVudGF0aW9uRXJyb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uSW5kZW50YXRpb25FcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLkluZGVudGF0aW9uRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIkluZGVudGF0aW9uRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uSW5kZW50YXRpb25FcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5JbmRleEVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkluZGV4RXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5JbmRleEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJJbmRleEVycm9yIiwKICAgICAgICBTay5idWlsdGluLkluZGV4RXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uS2V5RXJyb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uS2V5RXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5LZXlFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiS2V5RXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uS2V5RXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uTmFtZUVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLk5hbWVFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLk5hbWVFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiTmFtZUVycm9yIiwKICAgICAgICBTay5idWlsdGluLk5hbWVFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5VbmJvdW5kTG9jYWxFcnJvciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5VbmJvdW5kTG9jYWxFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlVuYm91bmRMb2NhbEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJVbmJvdW5kTG9jYWxFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5VbmJvdW5kTG9jYWxFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLk92ZXJmbG93RXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJPdmVyZmxvd0Vycm9yIiwKICAgICAgICBTay5idWlsdGluLk92ZXJmbG93RXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5TeW50YXhFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiU3ludGF4RXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uUnVudGltZUVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlJ1bnRpbWVFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlJ1bnRpbWVFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiUnVudGltZUVycm9yIiwKICAgICAgICBTay5idWlsdGluLlJ1bnRpbWVFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLlJ1bnRpbWVFcnJvciIsIFNrLmJ1aWx0aW4uUnVudGltZUVycm9yKQogICAgICBTay5idWlsdGluLlN1c3BlbnNpb25FcnJvciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5TdXNwZW5zaW9uRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5TdXNwZW5zaW9uRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlN1c3BlbnNpb25FcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5TdXNwZW5zaW9uRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5TdXNwZW5zaW9uRXJyb3IiLCBTay5idWlsdGluLlN1c3BlbnNpb25FcnJvcikKICAgICAgU2suYnVpbHRpbi5TeXN0ZW1FeGl0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlN5c3RlbUV4aXQpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5TeXN0ZW1FeGl0LnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJTeXN0ZW1FeGl0IiwKICAgICAgICBTay5idWlsdGluLlN5c3RlbUV4aXQsCiAgICAgICAgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5TeXN0ZW1FeGl0IiwgU2suYnVpbHRpbi5TeXN0ZW1FeGl0KQogICAgICBTay5idWlsdGluLlR5cGVFcnJvciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5UeXBlRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5UeXBlRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlR5cGVFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5UeXBlRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5UeXBlRXJyb3IiLCBTay5idWlsdGluLlR5cGVFcnJvcikKICAgICAgU2suYnVpbHRpbi5WYWx1ZUVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlZhbHVlRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5WYWx1ZUVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJWYWx1ZUVycm9yIiwKICAgICAgICBTay5idWlsdGluLlZhbHVlRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5WYWx1ZUVycm9yIiwgU2suYnVpbHRpbi5WYWx1ZUVycm9yKQogICAgICBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlplcm9EaXZpc2lvbkVycm9yIiwKICAgICAgICBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uVGltZUxpbWl0RXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlRpbWVMaW1pdEVycm9yIiwKICAgICAgICBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uVGltZUxpbWl0RXJyb3IiLCBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yKQogICAgICBTay5idWlsdGluLklPRXJyb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uSU9FcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLklPRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIklPRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uSU9FcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLklPRXJyb3IiLCBTay5idWlsdGluLklPRXJyb3IpCiAgICAgIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiTm90SW1wbGVtZW50ZWRFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uTmVnYXRpdmVQb3dlckVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiTmVnYXRpdmVQb3dlckVycm9yIiwKICAgICAgICBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5OZWdhdGl2ZVBvd2VyRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkV4dGVybmFsRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYyA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGMuY29uc3RydWN0b3IuYXBwbHkoYywgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGMKICAgICAgICB9CiAgICAgICAgYiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykKICAgICAgICB0aGlzLm5hdGl2ZUVycm9yID0gYlswXQogICAgICAgIGJbMF0gaW5zdGFuY2VvZiBTay5idWlsdGluLnN0ciB8fCAoYlswXSA9ICIiICsgYlswXSkKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYikKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJFeHRlcm5hbEVycm9yIiwKICAgICAgICBTay5idWlsdGluLkV4dGVybmFsRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yIiwgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKQogICAgICBTay5idWlsdGluLk9wZXJhdGlvbkVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLk9wZXJhdGlvbkVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uT3BlcmF0aW9uRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIk9wZXJhdGlvbkVycm9yIiwKICAgICAgICBTay5idWlsdGluLk9wZXJhdGlvbkVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uT3BlcmF0aW9uRXJyb3IiLCBTay5idWlsdGluLk9wZXJhdGlvbkVycm9yKQogICAgICBTay5idWlsdGluLlN5c3RlbUVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlN5c3RlbUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uU3lzdGVtRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlN5c3RlbUVycm9yIiwKICAgICAgICBTay5idWlsdGluLlN5c3RlbUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uU3lzdGVtRXJyb3IiLCBTay5idWlsdGluLlN5c3RlbUVycm9yKQogICAgICBTay5idWlsdGluLlN0b3BJdGVyYXRpb24gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlN0b3BJdGVyYXRpb24ucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLkV4Y2VwdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiU3RvcEl0ZXJhdGlvbiIsCiAgICAgICAgU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uLAogICAgICAgIFNrLmJ1aWx0aW4uRXhjZXB0aW9uLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uIiwgU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uKQogICAgICBTay5idWlsdGluLmdldEV4Y0luZm8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgIGEub2IkdHlwZSB8fCBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgICBhLAogICAgICAgICAgU2suYnVpbHRpbi5ub25lLm5vbmUkLAogICAgICAgIF0pCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLm1ldGhvZCkpIHsKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm1ldGhvZCIsIGFyZ3VtZW50cy5sZW5ndGgsIDMsIDMpCiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tDYWxsYWJsZShhKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGNhbGxhYmxlIikKICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIub2IkdHlwZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJTZWNvbmQgYXJndW1lbnQgbXVzdCBiZSBvYmplY3Qgb2Yga25vd24gdHlwZSIsCiAgICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5tZXRob2QoYSwgYiwgYykKICAgICAgICB9CiAgICAgICAgdGhpcy50cCRuYW1lID0gYS50cCRuYW1lCiAgICAgICAgdGhpcy5pbV9mdW5jID0gYQogICAgICAgIHRoaXMuaW1fc2VsZiA9IGIgfHwgU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgdGhpcy5pbV9jbGFzcyA9IGMgfHwgU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgdGhpcy5pbV9idWlsdGluID0gZAogICAgICAgIHRoaXMuJGQgPSB7IGltX2Z1bmM6IGEsIGltX3NlbGY6IGIsIGltX2NsYXNzOiBjIH0KICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ubWV0aG9kIiwgU2suYnVpbHRpbi5tZXRob2QpCiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgImluc3RhbmNlbWV0aG9kIiwKICAgICAgICBTay5idWlsdGluLm1ldGhvZCwKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLm1ldGhvZC5wcm90b3R5cGUudHAkbmFtZSA9ICJtZXRob2QiCiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kLnByb3RvdHlwZS5vYiRlcSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoCiAgICAgICAgICAodGhpcy5pbV9zZWxmID09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJgogICAgICAgICAgICBhLmltX3NlbGYgIT0gU2suYnVpbHRpbi5ub25lLm5vbmUkKSB8fAogICAgICAgICAgKGEuaW1fc2VsZiA9PSBTay5idWlsdGluLm5vbmUubm9uZSQgJiYKICAgICAgICAgICAgdGhpcy5pbV9zZWxmICE9IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICApCiAgICAgICAgICByZXR1cm4gITEKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKHRoaXMuaW1fc2VsZiwgYS5pbV9zZWxmLCAiRXEiLCAhMSkgJiYKICAgICAgICAgICAgdGhpcy5pbV9mdW5jID09IGEuaW1fZnVuYwogICAgICAgICAgKQogICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgIHJldHVybiAhMQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLm1ldGhvZC5wcm90b3R5cGUub2IkbmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuICF0aGlzLm9iJGVxKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLnRwJGhhc2ggPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9CiAgICAgICAgICB0aGlzLmltX3NlbGYgPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgICAgID8gMAogICAgICAgICAgICA6IFNrLmJ1aWx0aW4uYXNudW0kKFNrLmJ1aWx0aW4uaGFzaCh0aGlzLmltX3NlbGYpKQogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5hc251bSQoU2suYnVpbHRpbi5oYXNoKHRoaXMuaW1fZnVuYykpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYSArIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLnRwJGNhbGwgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdGhpcy5pbV9zZWxmICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQgJiYgYS51bnNoaWZ0KHRoaXMuaW1fc2VsZikKICAgICAgICBpZiAodGhpcy5pbV9zZWxmID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpIHsKICAgICAgICAgIHZhciBjID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICJ1bmJvdW5kIG1ldGhvZCAiICsKICAgICAgICAgICAgICB0aGlzLnRwJG5hbWUgKwogICAgICAgICAgICAgICIoKSBtdXN0IGJlIGNhbGxlZCB3aXRoICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKHRoaXMuaW1fY2xhc3MpICsKICAgICAgICAgICAgICAiIGluc3RhbmNlIGFzIGZpcnN0IGFyZ3VtZW50IChnb3QgIiArCiAgICAgICAgICAgICAgYSArCiAgICAgICAgICAgICAgIiBpbnN0ZWFkKSIKICAgICAgICAgICAgKQogICAgICAgICAgfS5iaW5kKHRoaXMpCiAgICAgICAgICBpZiAoMCA8IGEubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB0aGlzLmltX2NsYXNzICE9IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJgogICAgICAgICAgICAgICFTay5idWlsdGluLmlzc3ViY2xhc3MoYVswXS5vYiR0eXBlLCB0aGlzLmltX2NsYXNzKSAmJgogICAgICAgICAgICAgICF0aGlzLmltX2J1aWx0aW4KICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgIGMoU2suYWJzdHIudHlwZU5hbWUoYVswXS5vYiR0eXBlKSArICIgaW5zdGFuY2UiKSwKICAgICAgICAgICAgICApCiAgICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKGMoIm5vdGhpbmciKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuaW1fZnVuYy50cCRjYWxsKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLnRwJGRlc2NyX2dldCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5tZXRob2QodGhpcywgYSwgYiwgdGhpcy5pbV9idWlsdGluKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kLnB5dGhvbkZ1bmN0aW9ucyA9IFsiX19nZXRfXyJdCiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kLnByb3RvdHlwZS5fX2dldF9fID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITApCiAgICAgICAgaWYgKGIgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJiBjID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZ2V0X18oTm9uZSwgTm9uZSkgaXMgaW52YWxpZCIpCiAgICAgICAgcmV0dXJuIGMgJiYgYyAhPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uaXNzdWJjbGFzcyhjLCBhLmltX2NsYXNzKQogICAgICAgICAgICA/IGEudHAkZGVzY3JfZ2V0KGIsIGMpCiAgICAgICAgICAgIDogYQogICAgICAgICAgOiBhLnRwJGRlc2NyX2dldChiLCBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMuaW1fYnVpbHRpbikKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAgICI8YnVpbHQtaW4gbWV0aG9kICIgKyB0aGlzLnRwJG5hbWUgKyAiIG9mIHR5cGUgb2JqZWN0PiIsCiAgICAgICAgICApCiAgICAgICAgaWYgKHRoaXMuaW1fc2VsZiA9PT0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAgICAgIjx1bmJvdW5kIG1ldGhvZCAiICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZSh0aGlzLmltX2NsYXNzKSArCiAgICAgICAgICAgICAgIi4iICsKICAgICAgICAgICAgICB0aGlzLnRwJG5hbWUgKwogICAgICAgICAgICAgICI+IiwKICAgICAgICAgICkKICAgICAgICB2YXIgYSA9CiAgICAgICAgICB0aGlzLmltX2NsYXNzICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICAgICAgPyBTay5hYnN0ci50eXBlTmFtZSh0aGlzLmltX2NsYXNzKQogICAgICAgICAgICA6ICI/IgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAiPGJvdW5kIG1ldGhvZCAiICsKICAgICAgICAgICAgYSArCiAgICAgICAgICAgICIuIiArCiAgICAgICAgICAgIHRoaXMudHAkbmFtZSArCiAgICAgICAgICAgICIgb2YgIiArCiAgICAgICAgICAgIFNrLmZmaS5yZW1hcFRvSnMoU2subWlzY2V2YWwub2JqZWN0UmVwcih0aGlzLmltX3NlbGYpKSArCiAgICAgICAgICAgICI+IiwKICAgICAgICApCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLm1pc2NldmFsID0ge30KICAgICAgU2subWlzY2V2YWwuU3VzcGVuc2lvbiA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB0aGlzLiRpc1N1c3BlbnNpb24gPSAhMAogICAgICAgIHZvaWQgMCAhPT0gYSAmJgogICAgICAgICAgdm9pZCAwICE9PSBiICYmCiAgICAgICAgICAodGhpcy5yZXN1bWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGEoYi5yZXN1bWUoKSkKICAgICAgICAgIH0pCiAgICAgICAgdGhpcy5jaGlsZCA9IGIKICAgICAgICB0aGlzLm9wdGlvbmFsID0gdm9pZCAwICE9PSBiICYmIGIub3B0aW9uYWwKICAgICAgICB0aGlzLmRhdGEgPSB2b2lkIDAgPT09IGMgJiYgdm9pZCAwICE9PSBiID8gYi5kYXRhIDogYwogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuU3VzcGVuc2lvbiIsIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pCiAgICAgIFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBmb3IgKDsgYSBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb247ICkgewogICAgICAgICAgaWYgKCFhLm9wdGlvbmFsKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TdXNwZW5zaW9uRXJyb3IoCiAgICAgICAgICAgICAgYiB8fCAiQ2Fubm90IGNhbGwgYSBmdW5jdGlvbiB0aGF0IGJsb2NrcyBvciBzdXNwZW5kcyBoZXJlIiwKICAgICAgICAgICAgKQogICAgICAgICAgYSA9IGEucmVzdW1lKCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyIsCiAgICAgICAgU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93LAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLmlzSW5kZXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkgfHwKICAgICAgICAgIFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGluZGV4KQogICAgICAgICAgPyAhMAogICAgICAgICAgOiAhMQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuaXNJbmRleCIsIFNrLm1pc2NldmFsLmlzSW5kZXgpCiAgICAgIFNrLm1pc2NldmFsLmFzSW5kZXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChhKSAmJiBudWxsICE9PSBhKSB7CiAgICAgICAgICBpZiAoITAgPT09IGEpIHJldHVybiAxCiAgICAgICAgICBpZiAoITEgPT09IGEpIHJldHVybiAwCiAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhKSByZXR1cm4gYQogICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uaW50XykgcmV0dXJuIGEudgogICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4ubG5nKSByZXR1cm4gYS50cCRpbmRleCgpCiAgICAgICAgICBpZiAoYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5ib29sKSByZXR1cm4gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIGlmICgoYiA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGluZGV4KSkpIHsKICAgICAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYV0pCiAgICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0ludChhKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiX19pbmRleF9fIHJldHVybmVkIG5vbi0oaW50LGxvbmcpICh0eXBlICIgKwogICAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgICAgICIpIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgICAgfQogICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ0b2RvIGFzSW5kZXg7IikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2subWlzY2V2YWwuYXBwbHlTbGljZSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICByZXR1cm4gYS5zcSRzbGljZSAmJiBTay5taXNjZXZhbC5pc0luZGV4KGIpICYmIFNrLm1pc2NldmFsLmlzSW5kZXgoYykKICAgICAgICAgID8gKChiID0gU2subWlzY2V2YWwuYXNJbmRleChiKSksCiAgICAgICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IDApLAogICAgICAgICAgICAoYyA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYykpLAogICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSAxZTEwMCksCiAgICAgICAgICAgIFNrLmFic3RyLnNlcXVlbmNlR2V0U2xpY2UoYSwgYiwgYykpCiAgICAgICAgICA6IFNrLmFic3RyLm9iamVjdEdldEl0ZW0oYSwgbmV3IFNrLmJ1aWx0aW4uc2xpY2UoYiwgYywgbnVsbCksIGQpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5hcHBseVNsaWNlIiwgU2subWlzY2V2YWwuYXBwbHlTbGljZSkKICAgICAgU2subWlzY2V2YWwuYXNzaWduU2xpY2UgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgaWYgKGEuc3EkYXNzX3NsaWNlICYmIFNrLm1pc2NldmFsLmlzSW5kZXgoYikgJiYgU2subWlzY2V2YWwuaXNJbmRleChjKSkKICAgICAgICAgIChlID0gU2subWlzY2V2YWwuYXNJbmRleChiKSB8fCAwKSwKICAgICAgICAgICAgKGMgPSBTay5taXNjZXZhbC5hc0luZGV4KGMpIHx8IDFlMTAwKSwKICAgICAgICAgICAgbnVsbCA9PT0gZAogICAgICAgICAgICAgID8gU2suYWJzdHIuc2VxdWVuY2VEZWxTbGljZShhLCBlLCBjKQogICAgICAgICAgICAgIDogU2suYWJzdHIuc2VxdWVuY2VTZXRTbGljZShhLCBlLCBjLCBkKQogICAgICAgIGVsc2UKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIChjID0gbmV3IFNrLmJ1aWx0aW4uc2xpY2UoYiwgYykpLAogICAgICAgICAgICBudWxsID09PSBkCiAgICAgICAgICAgICAgPyBTay5hYnN0ci5vYmplY3REZWxJdGVtKGEsIGMpCiAgICAgICAgICAgICAgOiBTay5hYnN0ci5vYmplY3RTZXRJdGVtKGEsIGMsIGQsIGUpCiAgICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5hc3NpZ25TbGljZSIsIFNrLm1pc2NldmFsLmFzc2lnblNsaWNlKQogICAgICBTay5taXNjZXZhbC5hcnJheUZyb21Bcmd1bWVudHMgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMSAhPSBhLmxlbmd0aCkgcmV0dXJuIGEKICAgICAgICB2YXIgYyA9IGFbMF0KICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zZXQKICAgICAgICAgID8gKGMgPSBjLnRwJGl0ZXIoKS4kb2JqKQogICAgICAgICAgOiBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5kaWN0ICYmCiAgICAgICAgICAgIChjID0gU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5rZXlzLmZ1bmNfY29kZShjKSkKICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubGlzdCB8fCBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi50dXBsZSkKICAgICAgICAgIHJldHVybiBjLnYKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGMpKSB7CiAgICAgICAgICBhID0gW10KICAgICAgICAgIGMgPSBTay5hYnN0ci5pdGVyKGMpCiAgICAgICAgICBmb3IgKGIgPSBjLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGMudHAkaXRlcm5leHQoKSkgYS5wdXNoKGIpCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShjKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLmFycmF5RnJvbUFyZ3VtZW50cyIsCiAgICAgICAgU2subWlzY2V2YWwuYXJyYXlGcm9tQXJndW1lbnRzLAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLnN3YXBwZWRPcF8gPSB7CiAgICAgICAgRXE6ICJFcSIsCiAgICAgICAgTm90RXE6ICJOb3RFcSIsCiAgICAgICAgTHQ6ICJHdEUiLAogICAgICAgIEx0RTogIkd0IiwKICAgICAgICBHdDogIkx0RSIsCiAgICAgICAgR3RFOiAiTHQiLAogICAgICAgIElzOiAiSXNOb3QiLAogICAgICAgIElzTm90OiAiSXMiLAogICAgICAgIEluXzogIk5vdEluIiwKICAgICAgICBOb3RJbjogIkluXyIsCiAgICAgIH0KICAgICAgU2subWlzY2V2YWwub3BTeW1ib2xzID0gewogICAgICAgIEVxOiAiPT0iLAogICAgICAgIE5vdEVxOiAiIT0iLAogICAgICAgIEx0OiAiPCIsCiAgICAgICAgTHRFOiAiPD0iLAogICAgICAgIEd0OiAiPiIsCiAgICAgICAgR3RFOiAiPj0iLAogICAgICAgIElzOiAiaXMiLAogICAgICAgIElzTm90OiAiaXMgbm90IiwKICAgICAgICBJbl86ICJpbiIsCiAgICAgICAgTm90SW46ICJub3QgaW4iLAogICAgICB9CiAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgbnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEsCiAgICAgICAgICAicGFzc2VkIG51bGwgb3IgdW5kZWZpbmVkIHBhcmFtZXRlciB0byBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2wiLAogICAgICAgICkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgIG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiLAogICAgICAgICAgInBhc3NlZCBudWxsIG9yIHVuZGVmaW5lZCBwYXJhbWV0ZXIgdG8gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sIiwKICAgICAgICApCiAgICAgICAgdmFyIGYgPSBuZXcgU2suYnVpbHRpbi50eXBlKGEpCiAgICAgICAgdmFyIGcgPSBuZXcgU2suYnVpbHRpbi50eXBlKGIpCiAgICAgICAgaWYgKAogICAgICAgICAgIVNrLl9fZnV0dXJlX18ucHl0aG9uMyAmJgogICAgICAgICAgZiAhPT0gZyAmJgogICAgICAgICAgKCJHdEUiID09PSBjIHx8ICJHdCIgPT09IGMgfHwgIkx0RSIgPT09IGMgfHwgIkx0IiA9PT0gYykKICAgICAgICApIHsKICAgICAgICAgIHZhciBoID0gWwogICAgICAgICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi5ib29sLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgXQogICAgICAgICAgdmFyIGsgPSBbCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi5lbnVtZXJhdGUucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXy5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgICBTay5idWlsdGluLm1hcF8ucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgICBTay5idWlsdGluLnppcF8ucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICBdCiAgICAgICAgICB2YXIgbCA9IGguaW5kZXhPZihmKQogICAgICAgICAgdmFyIHIgPSBrLmluZGV4T2YoZikKICAgICAgICAgIGggPSBoLmluZGV4T2YoZykKICAgICAgICAgIGsgPSBrLmluZGV4T2YoZykKICAgICAgICAgIGlmIChmID09PSBTay5idWlsdGluLm5vbmUucHJvdG90eXBlLm9iJHR5cGUpCiAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgIGNhc2UgIkx0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICBjYXNlICJHdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgIH0KICAgICAgICAgIGlmIChnID09PSBTay5idWlsdGluLm5vbmUucHJvdG90eXBlLm9iJHR5cGUpCiAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgIGNhc2UgIkx0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICBjYXNlICJHdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgIH0KICAgICAgICAgIGlmICgtMSAhPT0gbCAmJiAtMSAhPT0gaykKICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgY2FzZSAiTHQiOgogICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgY2FzZSAiTHRFIjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgIGNhc2UgIkd0IjoKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgIGNhc2UgIkd0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKC0xICE9PSByICYmIC0xICE9PSBoKQogICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICBjYXNlICJMdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgY2FzZSAiR3RFIjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoLTEgIT09IHIgJiYgLTEgIT09IGspCiAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgICAgIHJldHVybiByIDwgawogICAgICAgICAgICAgIGNhc2UgIkx0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gciA8PSBrCiAgICAgICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICAgICAgcmV0dXJuIHIgPiBrCiAgICAgICAgICAgICAgY2FzZSAiR3RFIjoKICAgICAgICAgICAgICAgIHJldHVybiByID49IGsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIklzIiA9PT0gYykKICAgICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgICAgPyAwID09PSBhLm51bWJlckNvbXBhcmUoYikKICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8gJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICAgID8gMCA9PT0gYS5udW1iZXJDb21wYXJlKGIpCiAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgICA/IDAgPT09IGEubG9uZ0NvbXBhcmUoYikKICAgICAgICAgICAgOiBhID09PSBiCiAgICAgICAgaWYgKCJJc05vdCIgPT09IGMpCiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICAgID8gMCAhPT0gYS5udW1iZXJDb21wYXJlKGIpCiAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICA/IDAgIT09IGEubnVtYmVyQ29tcGFyZShiKQogICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgICAgPyAwICE9PSBhLmxvbmdDb21wYXJlKGIpCiAgICAgICAgICAgIDogYSAhPT0gYgogICAgICAgIGlmICgiSW4iID09PSBjKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICBTay5hYnN0ci5zZXF1ZW5jZUNvbnRhaW5zKGIsIGEsIGQpLAogICAgICAgICAgICBTay5taXNjZXZhbC5pc1RydWUsCiAgICAgICAgICApCiAgICAgICAgaWYgKCJOb3RJbiIgPT09IGMpCiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhiLCBhLCBkKSwgZnVuY3Rpb24oCiAgICAgICAgICAgIGEsCiAgICAgICAgICApIHsKICAgICAgICAgICAgcmV0dXJuICFTay5taXNjZXZhbC5pc1RydWUoYSkKICAgICAgICAgIH0pCiAgICAgICAgbCA9IHsKICAgICAgICAgIEVxOiAib2IkZXEiLAogICAgICAgICAgTm90RXE6ICJvYiRuZSIsCiAgICAgICAgICBHdDogIm9iJGd0IiwKICAgICAgICAgIEd0RTogIm9iJGdlIiwKICAgICAgICAgIEx0OiAib2IkbHQiLAogICAgICAgICAgTHRFOiAib2IkbGUiLAogICAgICAgIH0KICAgICAgICByID0gbFtjXQogICAgICAgIGlmICgKICAgICAgICAgIChkID0gYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkocikpICYmCiAgICAgICAgICAoZSA9IGFbcl0oYikpICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoZSkKICAgICAgICBsID0gbFtTay5taXNjZXZhbC5zd2FwcGVkT3BfW2NdXQogICAgICAgIGlmICgKICAgICAgICAgIChyID0gYi5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkobCkpICYmCiAgICAgICAgICAoZSA9IGJbbF0oYSkpICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoZSkKICAgICAgICBpZiAoCiAgICAgICAgICAoYS50cCRyaWNoY29tcGFyZSAmJgogICAgICAgICAgICB2b2lkIDAgIT09IChlID0gYS50cCRyaWNoY29tcGFyZShiLCBjKSkgJiYKICAgICAgICAgICAgZSAhPSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkgfHwKICAgICAgICAgIChiLnRwJHJpY2hjb21wYXJlICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gKGUgPSBiLnRwJHJpY2hjb21wYXJlKGEsIFNrLm1pc2NldmFsLnN3YXBwZWRPcF9bY10pKSAmJgogICAgICAgICAgICBlICE9IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKQogICAgICAgICkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoZSkKICAgICAgICBpZiAoCiAgICAgICAgICAoKGwgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLm1pc2NldmFsLm9wMm1ldGhvZF9bY10pKSAmJgogICAgICAgICAgICAhZCAmJgogICAgICAgICAgICAoKGUgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkobCwgW2EsIGJdKSksCiAgICAgICAgICAgIGUgIT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpKSB8fAogICAgICAgICAgKChkID0gU2suYWJzdHIubG9va3VwU3BlY2lhbCgKICAgICAgICAgICAgYiwKICAgICAgICAgICAgU2subWlzY2V2YWwub3AybWV0aG9kX1tTay5taXNjZXZhbC5zd2FwcGVkT3BfW2NdXSwKICAgICAgICAgICkpICYmCiAgICAgICAgICAgICFyICYmCiAgICAgICAgICAgICgoZSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShkLCBbYiwgYV0pKSwKICAgICAgICAgICAgZSAhPSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmlzVHJ1ZShlKQogICAgICAgIGlmICghU2suX19mdXR1cmVfXy5weXRob24zKSB7CiAgICAgICAgICBpZiAoKGQgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRjbXApKSkKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBlID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGQsIFthLCBiXSkKICAgICAgICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja051bWJlcihlKSkgewogICAgICAgICAgICAgICAgZSA9IFNrLmJ1aWx0aW4uYXNudW0kKGUpCiAgICAgICAgICAgICAgICBpZiAoIkVxIiA9PT0gYykgcmV0dXJuIDAgPT09IGUKICAgICAgICAgICAgICAgIGlmICgiTm90RXEiID09PSBjKSByZXR1cm4gMCAhPT0gZQogICAgICAgICAgICAgICAgaWYgKCJMdCIgPT09IGMpIHJldHVybiAwID4gZQogICAgICAgICAgICAgICAgaWYgKCJHdCIgPT09IGMpIHJldHVybiAwIDwgZQogICAgICAgICAgICAgICAgaWYgKCJMdEUiID09PSBjKSByZXR1cm4gMCA+PSBlCiAgICAgICAgICAgICAgICBpZiAoIkd0RSIgPT09IGMpIHJldHVybiAwIDw9IGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGUgIT09IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAiY29tcGFyaXNvbiBkaWQgbm90IHJldHVybiBhbiBpbnQiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjb21wYXJpc29uIGRpZCBub3QgcmV0dXJuIGFuIGludCIpCiAgICAgICAgICAgIH0KICAgICAgICAgIGlmICgoZCA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYiwgU2suYnVpbHRpbi5zdHIuJGNtcCkpKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGUgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZCwgW2IsIGFdKQogICAgICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTnVtYmVyKGUpKSB7CiAgICAgICAgICAgICAgICBlID0gU2suYnVpbHRpbi5hc251bSQoZSkKICAgICAgICAgICAgICAgIGlmICgiRXEiID09PSBjKSByZXR1cm4gMCA9PT0gZQogICAgICAgICAgICAgICAgaWYgKCJOb3RFcSIgPT09IGMpIHJldHVybiAwICE9PSBlCiAgICAgICAgICAgICAgICBpZiAoIkx0IiA9PT0gYykgcmV0dXJuIDAgPCBlCiAgICAgICAgICAgICAgICBpZiAoIkd0IiA9PT0gYykgcmV0dXJuIDAgPiBlCiAgICAgICAgICAgICAgICBpZiAoIkx0RSIgPT09IGMpIHJldHVybiAwIDw9IGUKICAgICAgICAgICAgICAgIGlmICgiR3RFIiA9PT0gYykgcmV0dXJuIDAgPj0gZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZSAhPT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAgICJjb21wYXJpc29uIGRpZCBub3QgcmV0dXJuIGFuIGludCIsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImNvbXBhcmlzb24gZGlkIG5vdCByZXR1cm4gYW4gaW50IikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lKSB8fAogICAgICAgICAgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJvb2wgJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkKICAgICAgICApIHsKICAgICAgICAgIGlmICgiRXEiID09PSBjKSByZXR1cm4gYS52ID09PSBiLnYKICAgICAgICAgIGlmICgiTm90RXEiID09PSBjKSByZXR1cm4gYS52ICE9PSBiLnYKICAgICAgICAgIGlmICgiR3QiID09PSBjKSByZXR1cm4gYS52ID4gYi52CiAgICAgICAgICBpZiAoIkd0RSIgPT09IGMpIHJldHVybiBhLnYgPj0gYi52CiAgICAgICAgICBpZiAoIkx0IiA9PT0gYykgcmV0dXJuIGEudiA8IGIudgogICAgICAgICAgaWYgKCJMdEUiID09PSBjKSByZXR1cm4gYS52IDw9IGIudgogICAgICAgIH0KICAgICAgICBpZiAoIkVxIiA9PT0gYykKICAgICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIgJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyCiAgICAgICAgICAgID8gYS52ID09PSBiLnYKICAgICAgICAgICAgOiBhID09PSBiCiAgICAgICAgaWYgKCJOb3RFcSIgPT09IGMpCiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cgogICAgICAgICAgICA/IGEudiAhPT0gYi52CiAgICAgICAgICAgIDogYSAhPT0gYgogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIGIgPSBTay5hYnN0ci50eXBlTmFtZShiKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICInIiArCiAgICAgICAgICAgIFNrLm1pc2NldmFsLm9wU3ltYm9sc1tjXSArCiAgICAgICAgICAgICInIG5vdCBzdXBwb3J0ZWQgYmV0d2VlbiBpbnN0YW5jZXMgb2YgJyIgKwogICAgICAgICAgICBhICsKICAgICAgICAgICAgIicgYW5kICciICsKICAgICAgICAgICAgYiArCiAgICAgICAgICAgICInIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2wiLAogICAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbCwKICAgICAgKQogICAgICBTay5taXNjZXZhbC5vYmplY3RSZXByID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYSwgInRyeWluZyB0byByZXByIHVuZGVmaW5lZCIpCiAgICAgICAgcmV0dXJuIG51bGwgPT09IGEgfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIk5vbmUiKQogICAgICAgICAgOiAhMCA9PT0gYQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIlRydWUiKQogICAgICAgICAgOiAhMSA9PT0gYQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIkZhbHNlIikKICAgICAgICAgIDogIm51bWJlciIgPT09IHR5cGVvZiBhCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnN0cigiIiArIGEpCiAgICAgICAgICA6ICJzdHJpbmciID09PSB0eXBlb2YgYQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgICAgIDogYS4kcgogICAgICAgICAgPyBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICA/IEluZmluaXR5ID09PSBhLnYKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnN0cigiaW5mIikKICAgICAgICAgICAgICA6IC1JbmZpbml0eSA9PT0gYS52CiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIi1pbmYiKQogICAgICAgICAgICAgIDogYS4kcigpCiAgICAgICAgICAgIDogYS4kcigpCiAgICAgICAgICA6IGEudHAkbmFtZQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIjwiICsgYS50cCRuYW1lICsgIiBvYmplY3Q+IikKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uc3RyKCI8dW5rbm93bj4iKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwub2JqZWN0UmVwciIsIFNrLm1pc2NldmFsLm9iamVjdFJlcHIpCiAgICAgIFNrLm1pc2NldmFsLm9wQWxsb3dzRXF1YWxpdHkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgY2FzZSAiRXEiOgogICAgICAgICAgY2FzZSAiR3RFIjoKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfQogICAgICAgIHJldHVybiAhMQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2subWlzY2V2YWwub3BBbGxvd3NFcXVhbGl0eSIsCiAgICAgICAgU2subWlzY2V2YWwub3BBbGxvd3NFcXVhbGl0eSwKICAgICAgKQogICAgICBTay5taXNjZXZhbC5pc1RydWUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEwID09PSBhKSByZXR1cm4gITAKICAgICAgICBpZiAoCiAgICAgICAgICAhMSA9PT0gYSB8fAogICAgICAgICAgbnVsbCA9PT0gYSB8fAogICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5ub25lIHx8CiAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuICExCiAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uYm9vbCkgcmV0dXJuIGEudgogICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEpIHJldHVybiAwICE9PSBhCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgcmV0dXJuIGEubmIkbm9uemVybygpCiAgICAgICAgaWYgKAogICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmZsb2F0XwogICAgICAgICkKICAgICAgICAgIHJldHVybiAwICE9PSBhLnYKICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKSB7CiAgICAgICAgICBpZiAoYS5fX2Jvb2xfXykgewogICAgICAgICAgICBhID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEuX19ib29sX18sIFthXSkKICAgICAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgIl9fYm9vbF9fIHNob3VsZCByZXR1cm4gYm9vbCwgcmV0dXJuZWQgIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGEudgogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYS5fX25vbnplcm9fXykgewogICAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLl9fbm9uemVyb19fLCBbYV0pCiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19ub256ZXJvX18gc2hvdWxkIHJldHVybiBhbiBpbnQiKQogICAgICAgICAgcmV0dXJuIDAgIT09IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgfQogICAgICAgIGlmIChhLl9fbGVuX18pIHsKICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX2xlbl9fLCBbYV0pCiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19sZW5fXyBzaG91bGQgcmV0dXJuIGFuIGludCIpCiAgICAgICAgICByZXR1cm4gMCAhPT0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEubXAkbGVuZ3RoCiAgICAgICAgICA/IDAgIT09IFNrLmJ1aWx0aW4uYXNudW0kKGEubXAkbGVuZ3RoKCkpCiAgICAgICAgICA6IGEuc3EkbGVuZ3RoCiAgICAgICAgICA/IDAgIT09IFNrLmJ1aWx0aW4uYXNudW0kKGEuc3EkbGVuZ3RoKCkpCiAgICAgICAgICA6ICEwCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5pc1RydWUiLCBTay5taXNjZXZhbC5pc1RydWUpCiAgICAgIFNrLm1pc2NldmFsLnNvZnRzcGFjZV8gPSAhMQogICAgICBTay5taXNjZXZhbC5wcmludF8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2subWlzY2V2YWwuc29mdHNwYWNlXyAmJgogICAgICAgICAgKCJcbiIgIT09IGEgJiYgU2sub3V0cHV0KCIgIiksIChTay5taXNjZXZhbC5zb2Z0c3BhY2VfID0gITEpKQogICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgU2suaW1wb3J0TW9kdWxlKCJzeXMiLCAhMSwgITApLAogICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHkoCiAgICAgICAgICAgICAgYS4kZC5zdGRvdXQud3JpdGUsCiAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgW2EuJGQuc3Rkb3V0LCBiXSwKICAgICAgICAgICAgKQogICAgICAgICAgfSwKICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYQogICAgICAgICAgICA7KGEgPSAwID09PSBiLnYubGVuZ3RoKSB8fAogICAgICAgICAgICAgICgoYSA9IGIudltiLnYubGVuZ3RoIC0gMV0pLAogICAgICAgICAgICAgIChhID0gISgiXG4iID09PSBhIHx8ICJcdCIgPT09IGEgfHwgIlxyIiA9PT0gYSkpKQogICAgICAgICAgICBpZiAoYSB8fCAiICIgPT09IGIudltiLnYubGVuZ3RoIC0gMV0pIFNrLm1pc2NldmFsLnNvZnRzcGFjZV8gPSAhMAogICAgICAgICAgfSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5wcmludF8iLCBTay5taXNjZXZhbC5wcmludF8pCiAgICAgIFNrLm1pc2NldmFsLmxvYWRuYW1lID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGIgPSBiW2FdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikKICAgICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYiAmJgogICAgICAgICAgICB2b2lkIDAgPT09IGIuJGQgJiYKICAgICAgICAgICAgdm9pZCAwID09PSBiLnRwJG5hbWUKICAgICAgICAgICAgPyBiKCkKICAgICAgICAgICAgOiBiCiAgICAgICAgYiA9IFNrLmJ1aWx0aW5zW2FdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgcmV0dXJuIGIKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5OYW1lRXJyb3IoCiAgICAgICAgICAibmFtZSAnIiArIFNrLnVuZml4UmVzZXJ2ZWQoYSkgKyAiJyBpcyBub3QgZGVmaW5lZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwubG9hZG5hbWUiLCBTay5taXNjZXZhbC5sb2FkbmFtZSkKICAgICAgU2subWlzY2V2YWwuY2FsbCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCA0KQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseShhLCBiLCBjLCBkLCBlKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuY2FsbCIsIFNrLm1pc2NldmFsLmNhbGwpCiAgICAgIFNrLm1pc2NldmFsLmNhbGxBc3luYyA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBmID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCA1KQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseUFzeW5jKGEsIGIsIGMsIGQsIGUsIGYpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5jYWxsQXN5bmMiLCBTay5taXNjZXZhbC5jYWxsQXN5bmMpCiAgICAgIFNrLm1pc2NldmFsLmNhbGxPclN1c3BlbmQgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgNCkKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgYiwgYywgZCwgZSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmNhbGxPclN1c3BlbmQiLCBTay5taXNjZXZhbC5jYWxsT3JTdXNwZW5kKQogICAgICBTay5taXNjZXZhbC5jYWxsc2ltID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5KGEsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5jYWxsc2ltIiwgU2subWlzY2V2YWwuY2FsbHNpbSkKICAgICAgU2subWlzY2V2YWwuY2FsbHNpbUFycmF5ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseShhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBiID8gYiA6IFtdKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuY2FsbHNpbUFycmF5IiwgU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KQogICAgICBTay5taXNjZXZhbC5jYWxsc2ltQXN5bmMgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgYyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMikKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlBc3luYyhhLCBiLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBjKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuY2FsbHNpbUFzeW5jIiwgU2subWlzY2V2YWwuY2FsbHNpbUFzeW5jKQogICAgICBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKGEsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kIiwKICAgICAgICBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kLAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgYiA/IGIgOiBbXSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSIsCiAgICAgICAgU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5LAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLmFwcGx5ID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSkgewogICAgICAgIGEgPSBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChhLCBiLCBjLCBkLCBlKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2subWlzY2V2YWwuU3VzcGVuc2lvbgogICAgICAgICAgPyBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYSkKICAgICAgICAgIDogYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuYXBwbHkiLCBTay5taXNjZXZhbC5hcHBseSkKICAgICAgU2subWlzY2V2YWwuYXN5bmNUb1Byb21pc2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsIGQpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIDsoZnVuY3Rpb24gZyhhKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoCiAgICAgICAgICAgICAgICAgIHZhciBmID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBnKGEucmVzdW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQocSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGsgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICA7KGEuZGF0YS5yZXN1bHQgPSBiKSwgZigpCiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQoRCkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGwgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICA7KGEuZGF0YS5lcnJvciA9IGIpLCBmKCkKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZChEKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5TdXNwZW5zaW9uOwoKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB2YXIgciA9IGIgJiYgKGJbYS5kYXRhLnR5cGVdIHx8IGJbIioiXSkKICAgICAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHIoYSkKICAgICAgICAgICAgICAgICAgICBpZiAobikgewogICAgICAgICAgICAgICAgICAgICAgbi50aGVuKGcsIGQpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKCJTay5wcm9taXNlIiA9PSBhLmRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgIGEuZGF0YS5wcm9taXNlLnRoZW4oaywgbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIlNrLnlpZWxkIiA9PSBhLmRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgIFNrLmdsb2JhbC5zZXRJbW1lZGlhdGUoZikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIlNrLmRlbGF5IiA9PSBhLmRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgIFNrLmdsb2JhbC5zZXRJbW1lZGlhdGUoZikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoYS5vcHRpb25hbCkgYSA9IGEucmVzdW1lKCkKICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN1c3BlbnNpb25FcnJvcigKICAgICAgICAgICAgICAgICAgICAgICJVbmhhbmRsZWQgbm9uLW9wdGlvbmFsIHN1c3BlbnNpb24gb2YgdHlwZSAnIiArCiAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0YS50eXBlICsKICAgICAgICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGMoYSkKICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7CiAgICAgICAgICAgICAgICBkKHEpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KShhKCkpCiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGQoZSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuYXN5bmNUb1Byb21pc2UiLCBTay5taXNjZXZhbC5hc3luY1RvUHJvbWlzZSkKICAgICAgU2subWlzY2V2YWwuYXBwbHlBc3luYyA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXN5bmNUb1Byb21pc2UoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYiwgYywgZCwgZSwgZikKICAgICAgICB9LCBhKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuYXBwbHlBc3luYyIsIFNrLm1pc2NldmFsLmFwcGx5QXN5bmMpCiAgICAgIFNrLm1pc2NldmFsLmNoYWluID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGZvciAodmFyIGMgPSAxLCBkID0gYSwgZSwgZjsgOyApIHsKICAgICAgICAgIGlmIChjID09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkCiAgICAgICAgICBpZiAoZCAmJiBkLiRpc1N1c3BlbnNpb24pIGJyZWFrCiAgICAgICAgICBkID0gYXJndW1lbnRzW2NdKGQpCiAgICAgICAgICBjKysKICAgICAgICB9CiAgICAgICAgZiA9IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSBjKQogICAgICAgIGZvciAoZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoIC0gYzsgZSsrKSBmW2VdID0gYXJndW1lbnRzW2MgKyBlXQogICAgICAgIGUgPSAwCiAgICAgICAgcmV0dXJuIChmdW5jdGlvbiBrKGEpIHsKICAgICAgICAgIGZvciAoOyBlIDwgZi5sZW5ndGg7ICkgewogICAgICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKGssIGEpCiAgICAgICAgICAgIGEgPSBmW2VdKGEpCiAgICAgICAgICAgIGUrKwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9KShkKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuY2hhaW4iLCBTay5taXNjZXZhbC5jaGFpbikKICAgICAgU2subWlzY2V2YWwudHJ5Q2F0Y2ggPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBjID0gYSgpCiAgICAgICAgfSBjYXRjaCAoZCkgewogICAgICAgICAgcmV0dXJuIGIoZCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5TdXNwZW5zaW9uCiAgICAgICAgICA/ICgoYSA9IG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKHZvaWQgMCwgYykpLAogICAgICAgICAgICAoYS5yZXN1bWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwudHJ5Q2F0Y2goYy5yZXN1bWUsIGIpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBhKQogICAgICAgICAgOiBjCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC50cnlDYXRjaCIsIFNrLm1pc2NldmFsLnRyeUNhdGNoKQogICAgICBTay5taXNjZXZhbC5pdGVyRm9yID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHZhciBkID0gYywKICAgICAgICAgIGUgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgIGQgPSBiCiAgICAgICAgICAgIHJldHVybiBiIGluc3RhbmNlb2YgU2subWlzY2V2YWwuQnJlYWsgPyBiIDogYS50cCRpdGVybmV4dCghMCkKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gKGZ1bmN0aW9uIGgoYSkgewogICAgICAgICAgZm9yICg7IHZvaWQgMCAhPT0gYTsgKSB7CiAgICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2subWlzY2V2YWwuU3VzcGVuc2lvbikKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLm1pc2NldmFsLlN1c3BlbnNpb24oaCwgYSkKICAgICAgICAgICAgaWYgKGEgPT09IFNrLm1pc2NldmFsLkJyZWFrIHx8IGEgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5CcmVhaykKICAgICAgICAgICAgICByZXR1cm4gYS5iclZhbHVlCiAgICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5jaGFpbihiKGEsIGQpLCBlKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGQKICAgICAgICB9KShhLnRwJGl0ZXJuZXh0KCEwKSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLml0ZXJGb3IiLCBTay5taXNjZXZhbC5pdGVyRm9yKQogICAgICBTay5taXNjZXZhbC5CcmVhayA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2subWlzY2V2YWwuQnJlYWspKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5taXNjZXZhbC5CcmVhayhhKQogICAgICAgIHRoaXMuYnJWYWx1ZSA9IGEKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLkJyZWFrIiwgU2subWlzY2V2YWwuQnJlYWspCiAgICAgIFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSkgewogICAgICAgIHZhciBmCiAgICAgICAgaWYgKG51bGwgPT09IGEgfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiJyBvYmplY3QgaXMgbm90IGNhbGxhYmxlIiwKICAgICAgICAgICkKICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSAmJgogICAgICAgICAgdm9pZCAwID09PSBhLnRwJGNhbGwgJiYKICAgICAgICAgIChhID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhhKSkKICAgICAgICB2YXIgZyA9IGEudHAkY2FsbAogICAgICAgIGlmICh2b2lkIDAgIT09IGcpIHsKICAgICAgICAgIGlmIChjKQogICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgIGMgPSBjLnRwJGl0ZXIoKSwgZiA9IGMudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgICB2b2lkIDAgIT09IGY7CiAgICAgICAgICAgICAgZiA9IGMudHAkaXRlcm5leHQoKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgZS5wdXNoKGYpCiAgICAgICAgICBpZiAoYikKICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICBjID0gU2suYWJzdHIuaXRlcihiKSwgZiA9IGMudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgICB2b2lkIDAgIT09IGY7CiAgICAgICAgICAgICAgZiA9IGMudHAkaXRlcm5leHQoKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoZikpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAgICJGdW5jdGlvbiBrZXl3b3JkcyBtdXN0IGJlIHN0cmluZ3MiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGQucHVzaChmLnYpCiAgICAgICAgICAgICAgZC5wdXNoKFNrLmFic3RyLm9iamVjdEdldEl0ZW0oYiwgZiwgITEpKQogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZy5jYWxsKGEsIGUsIGQsIGIpCiAgICAgICAgfQogICAgICAgIGcgPSBhLl9fY2FsbF9fCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZykgcmV0dXJuIGUudW5zaGlmdChhKSwgU2subWlzY2V2YWwuYXBwbHkoZywgYiwgYywgZCwgZSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgY2FsbGFibGUiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kIiwgU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQpCiAgICAgIFNrLm1pc2NldmFsLnByb21pc2VUb1N1c3BlbnNpb24gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBuZXcgU2subWlzY2V2YWwuU3VzcGVuc2lvbigpCiAgICAgICAgYi5yZXN1bWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChiLmRhdGEuZXJyb3IpIHRocm93IGIuZGF0YS5lcnJvcgogICAgICAgICAgcmV0dXJuIGIuZGF0YS5yZXN1bHQKICAgICAgICB9CiAgICAgICAgYi5kYXRhID0geyB0eXBlOiAiU2sucHJvbWlzZSIsIHByb21pc2U6IGEgfQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5taXNjZXZhbC5wcm9taXNlVG9TdXNwZW5zaW9uIiwKICAgICAgICBTay5taXNjZXZhbC5wcm9taXNlVG9TdXNwZW5zaW9uLAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLmJ1aWxkQ2xhc3MgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGYgPSBTay5idWlsdGluLnR5cGUsCiAgICAgICAgICBnID0ge30KICAgICAgICBiKGEsIGcsIHZvaWQgMCA9PT0gZSA/IHt9IDogZSkKICAgICAgICBnLl9fbW9kdWxlX18gPSBhLl9fbmFtZV9fCiAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLnN0cihjKQogICAgICAgIGQgPSBuZXcgU2suYnVpbHRpbi50dXBsZShkKQogICAgICAgIGIgPSBbXQogICAgICAgIGZvciAodmFyIGggaW4gZykKICAgICAgICAgIGcuaGFzT3duUHJvcGVydHkoaCkgJiYgKGIucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoaCkpLCBiLnB1c2goZ1toXSkpCiAgICAgICAgYiA9IG5ldyBTay5idWlsdGluLmRpY3QoYikKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGYsIFthLCBkLCBiXSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmJ1aWxkQ2xhc3MiLCBTay5taXNjZXZhbC5idWlsZENsYXNzKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5zZXF0eXBlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcigKICAgICAgICAgICJDYW5ub3QgaW5zdGFudGlhdGUgYWJzdHJhY3QgU2suYnVpbHRpbi5zZXF0eXBlIGNsYXNzIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiU2VxdWVuY2VUeXBlIiwKICAgICAgICBTay5idWlsdGluLnNlcXR5cGUsCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5zZXF0eXBlLnNrJGFic3RyYWN0ID0gITAKICAgICAgU2suYnVpbHRpbi5zZXF0eXBlLnByb3RvdHlwZS5fX2xlbl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19sZW5fXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhLnNxJGxlbmd0aCgpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pdGVyX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEudHAkaXRlcigpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2VxdHlwZS5wcm90b3R5cGUuX19jb250YWluc19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oCiAgICAgICAgICAiX19jb250YWluc19fIiwKICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGgsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgICExLAogICAgICAgICAgITAsCiAgICAgICAgKQogICAgICAgIHJldHVybiBhLnNxJGNvbnRhaW5zKGIpID8gU2suYnVpbHRpbi5ib29sLnRydWUkIDogU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9fZ2V0aXRlbV9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0aXRlbV9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm1wJHN1YnNjcmlwdChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9fYWRkX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19hZGRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5zcSRjb25jYXQoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXF0eXBlLnByb3RvdHlwZS5fX211bF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbXVsX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiY2FuJ3QgbXVsdGlwbHkgc2VxdWVuY2UgYnkgbm9uLWludCBvZiB0eXBlICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIHJldHVybiBhLnNxJHJlcGVhdChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9fcm11bF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcm11bF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLnNxJHJlcGVhdChiKQogICAgICB9KQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5saXN0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5saXN0KSBiID0gYiB8fCAhMQogICAgICAgIGVsc2UgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoYSwgYiB8fCAhMCkKICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4ubGlzdAogICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHZhciBjID0gW10KICAgICAgICBlbHNlIGlmICgiW29iamVjdCBBcnJheV0iID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KGEpKSBjID0gYQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkgewogICAgICAgICAgICBjID0gW10KICAgICAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICAgIHZhciBlID0gdGhpcwogICAgICAgICAgICByZXR1cm4gKGZ1bmN0aW9uIGgoYSkgewogICAgICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2subWlzY2V2YWwuU3VzcGVuc2lvbikKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKGgsIGEpCiAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBhKSByZXR1cm4gKGUudiA9IGMpLCBlCiAgICAgICAgICAgICAgICBjLnB1c2goYSkKICAgICAgICAgICAgICAgIGEgPSBkLnRwJGl0ZXJuZXh0KGIpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KShkLnRwJGl0ZXJuZXh0KGIpKQogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICB0aGlzLnYgPSB0aGlzLnYgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJsaXN0IiwgU2suYnVpbHRpbi5saXN0LCBTay5idWlsdGluLnNlcXR5cGUpCiAgICAgIFNrLmFic3RyLm1hcmtVbmhhc2hhYmxlKFNrLmJ1aWx0aW4ubGlzdCkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2NvbmNhdF8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoIWEuX19jbGFzc19fIHx8IGEuX19jbGFzc19fICE9IFNrLmJ1aWx0aW4ubGlzdCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuIG9ubHkgY29uY2F0ZW5hdGUgbGlzdCB0byBsaXN0IikKICAgICAgICB2YXIgYyA9IHRoaXMudi5zbGljZSgpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEudi5sZW5ndGg7ICsrYikgYy5wdXNoKGEudltiXSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjLCAhMSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZXh0ZW5kXyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIGlmICh0aGlzID09IGEpIHsKICAgICAgICAgIHZhciBjID0gW10KICAgICAgICAgIGEgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICBmb3IgKGIgPSBhLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGEudHAkaXRlcm5leHQoKSkgYy5wdXNoKGIpCiAgICAgICAgICB0aGlzLnYucHVzaC5hcHBseSh0aGlzLnYsIGMpCiAgICAgICAgfSBlbHNlCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBhID0gU2suYWJzdHIuaXRlcihhKSwgYiA9IGEudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgdm9pZCAwICE9PSBiOwogICAgICAgICAgICBiID0gYS50cCRpdGVybmV4dCgpCiAgICAgICAgICApCiAgICAgICAgICAgIHRoaXMudi5wdXNoKGIpCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZGVsX2l0ZW1fID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmICgwID4gYSB8fCBhID49IHRoaXMudi5sZW5ndGgpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbmRleEVycm9yKCJsaXN0IGFzc2lnbm1lbnQgaW5kZXggb3V0IG9mIHJhbmdlIikKICAgICAgICB0aGlzLmxpc3RfZGVsX3NsaWNlXyhhLCBhICsgMSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZGVsX3NsaWNlXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgYy51bnNoaWZ0KGIgLSBhKQogICAgICAgIGMudW5zaGlmdChhKQogICAgICAgIHRoaXMudi5zcGxpY2UuYXBwbHkodGhpcy52LCBjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9hc3NfaXRlbV8gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy52Lmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkluZGV4RXJyb3IoImxpc3QgYXNzaWdubWVudCBpbmRleCBvdXQgb2YgcmFuZ2UiKQogICAgICAgIHRoaXMudlthXSA9IGIKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfYXNzX3NsaWNlXyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGMpKQogICAgICAgICAgYyA9IG5ldyBTay5idWlsdGluLmxpc3QoYywgITEpLnYuc2xpY2UoMCkKICAgICAgICBlbHNlIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuIG9ubHkgYXNzaWduIGFuIGl0ZXJhYmxlIikKICAgICAgICBjLnVuc2hpZnQoYiAtIGEpCiAgICAgICAgYy51bnNoaWZ0KGEpCiAgICAgICAgdGhpcy52LnNwbGljZS5hcHBseSh0aGlzLnYsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiA9IFtdCiAgICAgICAgdmFyIGMgPSBTay5hYnN0ci5pdGVyKHRoaXMpCiAgICAgICAgZm9yIChhID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGE7IGEgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBhID09PSB0aGlzID8gYi5wdXNoKCJbLi4uXSIpIDogYi5wdXNoKFNrLm1pc2NldmFsLm9iamVjdFJlcHIoYSkudikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJbIiArIGIuam9pbigiLCAiKSArICJdIikKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnRwJHJpY2hjb21wYXJlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgaWYgKHRoaXMgPT09IGEgJiYgU2subWlzY2V2YWwub3BBbGxvd3NFcXVhbGl0eShiKSkgcmV0dXJuICEwCiAgICAgICAgaWYgKCFhLl9fY2xhc3NfXyB8fCBhLl9fY2xhc3NfXyAhPSBTay5idWlsdGluLmxpc3QpCiAgICAgICAgICByZXR1cm4gIkVxIiA9PT0gYgogICAgICAgICAgICA/ICExCiAgICAgICAgICAgIDogIk5vdEVxIiA9PT0gYgogICAgICAgICAgICA/ICEwCiAgICAgICAgICAgIDogU2suX19mdXR1cmVfXy5weXRob24zCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICAgICAgOiAhMQogICAgICAgIHZhciBkID0gdGhpcy52CiAgICAgICAgYSA9IGEudgogICAgICAgIHZhciBlID0gZC5sZW5ndGgKICAgICAgICB2YXIgZiA9IGEubGVuZ3RoCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGUgJiYgYyA8IGY7ICsrYykgewogICAgICAgICAgdmFyIGcgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZFtjXSwgYVtjXSwgIkVxIikKICAgICAgICAgIGlmICghZykgYnJlYWsKICAgICAgICB9CiAgICAgICAgaWYgKGMgPj0gZSB8fCBjID49IGYpCiAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgY2FzZSAiTHQiOgogICAgICAgICAgICAgIHJldHVybiBlIDwgZgogICAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgICAgIHJldHVybiBlIDw9IGYKICAgICAgICAgICAgY2FzZSAiRXEiOgogICAgICAgICAgICAgIHJldHVybiBlID09PSBmCiAgICAgICAgICAgIGNhc2UgIk5vdEVxIjoKICAgICAgICAgICAgICByZXR1cm4gZSAhPT0gZgogICAgICAgICAgICBjYXNlICJHdCI6CiAgICAgICAgICAgICAgcmV0dXJuIGUgPiBmCiAgICAgICAgICAgIGNhc2UgIkd0RSI6CiAgICAgICAgICAgICAgcmV0dXJuIGUgPj0gZgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgpCiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuICJFcSIgPT09IGIKICAgICAgICAgID8gITEKICAgICAgICAgIDogIk5vdEVxIiA9PT0gYgogICAgICAgICAgPyAhMAogICAgICAgICAgOiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZFtjXSwgYVtjXSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pdGVyX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMCwgITEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3RfaXRlcl8oYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3RfaXRlcl8odGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJGxlbmd0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnYubGVuZ3RoCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRjb25jYXQgPQogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9jb25jYXRfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubmIkYWRkID0gU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2NvbmNhdF8KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2V4dGVuZF8KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRyZXBlYXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsIGMKICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzSW5kZXgoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJjYW4ndCBtdWx0aXBseSBzZXF1ZW5jZSBieSBub24taW50IG9mIHR5cGUgJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICApCiAgICAgICAgYSA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYSkKICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGE7ICsrYykKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCB0aGlzLnYubGVuZ3RoOyArK2IpIGQucHVzaCh0aGlzLnZbYl0pCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoZCwgITEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5uYiRtdWx0aXBseSA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRyZXBlYXQKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5uYiRpbnBsYWNlX211bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc0luZGV4KGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiY2FuJ3QgbXVsdGlwbHkgc2VxdWVuY2UgYnkgbm9uLWludCBvZiB0eXBlICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIGEgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgdmFyIGQgPSB0aGlzLnYubGVuZ3RoCiAgICAgICAgZm9yIChjID0gMTsgYyA8IGE7ICsrYykgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgdGhpcy52LnB1c2godGhpcy52W2JdKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRhc3NfaXRlbSA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2Fzc19pdGVtXwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJGRlbF9pdGVtID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZGVsX2l0ZW1fCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuc3EkYXNzX3NsaWNlID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfYXNzX3NsaWNlXwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJGRlbF9zbGljZSA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9zbGljZV8KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRjb250YWlucyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIHZhciBjID0gdGhpcy50cCRpdGVyKCkKICAgICAgICBmb3IgKGIgPSBjLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGMudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGlmIChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYiwgYSwgIkVxIikpIHJldHVybiAhMAogICAgICAgIHJldHVybiAhMQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuX19jb250YWluc19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fY29udGFpbnNfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woYS5zcSRjb250YWlucyhiKSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X3N1YnNjcmlwdF8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzSW5kZXgoYSkpIHsKICAgICAgICAgIHZhciBiID0gU2subWlzY2V2YWwuYXNJbmRleChhKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgewogICAgICAgICAgICAwID4gYiAmJiAoYiA9IHRoaXMudi5sZW5ndGggKyBiKQogICAgICAgICAgICBpZiAoMCA+IGIgfHwgYiA+PSB0aGlzLnYubGVuZ3RoKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkluZGV4RXJyb3IoImxpc3QgaW5kZXggb3V0IG9mIHJhbmdlIikKICAgICAgICAgICAgcmV0dXJuIHRoaXMudltiXQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc2xpY2UpIHsKICAgICAgICAgIHZhciBjID0gW10KICAgICAgICAgIGEuc3NzaXRlciQodGhpcywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBjLnB1c2goYi52W2FdKQogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGMsICExKQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAibGlzdCBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9hc3Nfc3Vic2NyaXB0XyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChhKSkgewogICAgICAgICAgdmFyIGMgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBjKSB7CiAgICAgICAgICAgIDAgPiBjICYmIChjID0gdGhpcy52Lmxlbmd0aCArIGMpCiAgICAgICAgICAgIHRoaXMubGlzdF9hc3NfaXRlbV8oYywgYikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zbGljZSkgewogICAgICAgICAgYyA9IGEuc2xpY2VfaW5kaWNlc18odGhpcy52Lmxlbmd0aCkKICAgICAgICAgIGlmICgxID09PSBjWzJdKSB0aGlzLmxpc3RfYXNzX3NsaWNlXyhjWzBdLCBjWzFdLCBiKQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBkID0gW10KICAgICAgICAgICAgYS5zc3NpdGVyJCh0aGlzLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgZC5wdXNoKGEpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGEgPSAwCiAgICAgICAgICAgIGlmIChkLmxlbmd0aCAhPT0gYi52Lmxlbmd0aCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgImF0dGVtcHQgdG8gYXNzaWduIHNlcXVlbmNlIG9mIHNpemUgIiArCiAgICAgICAgICAgICAgICAgIGIudi5sZW5ndGggKwogICAgICAgICAgICAgICAgICAiIHRvIGV4dGVuZGVkIHNsaWNlIG9mIHNpemUgIiArCiAgICAgICAgICAgICAgICAgIGQubGVuZ3RoLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQubGVuZ3RoOyArK2MpCiAgICAgICAgICAgICAgdGhpcy52LnNwbGljZShkW2NdLCAxLCBiLnZbYV0pLCAoYSArPSAxKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJsaXN0IGluZGljZXMgbXVzdCBiZSBpbnRlZ2Vycywgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9zdWJzY3JpcHRfID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChTay5taXNjZXZhbC5pc0luZGV4KGEpKSB7CiAgICAgICAgICB2YXIgYiA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHsKICAgICAgICAgICAgMCA+IGIgJiYgKGIgPSB0aGlzLnYubGVuZ3RoICsgYikKICAgICAgICAgICAgdGhpcy5saXN0X2RlbF9pdGVtXyhiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnNsaWNlKSB7CiAgICAgICAgICBiID0gYS5zbGljZV9pbmRpY2VzXyh0aGlzLnYubGVuZ3RoKQogICAgICAgICAgaWYgKDEgPT09IGJbMl0pIHRoaXMubGlzdF9kZWxfc2xpY2VfKGJbMF0sIGJbMV0pCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzCiAgICAgICAgICAgIHZhciBkID0gMAogICAgICAgICAgICB2YXIgZSA9IDAgPCBiWzJdID8gMSA6IDAKICAgICAgICAgICAgYS5zc3NpdGVyJCh0aGlzLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgYy52LnNwbGljZShhIC0gZCwgMSkKICAgICAgICAgICAgICBkICs9IGUKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAibGlzdCBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMsIG5vdCAiICsgdHlwZW9mIGEsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubXAkc3Vic2NyaXB0ID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc3Vic2NyaXB0XwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLm1wJGFzc19zdWJzY3JpcHQgPQogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9hc3Nfc3Vic2NyaXB0XwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLm1wJGRlbF9zdWJzY3JpcHQgPQogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9kZWxfc3Vic2NyaXB0XwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLl9fZ2V0aXRlbV9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc3Vic2NyaXB0Xy5jYWxsKGEsIGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuX19zZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgICBjLAogICAgICApIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2Fzc19zdWJzY3JpcHRfLmNhbGwoYSwgYiwgYykKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5fX2RlbGl0ZW1fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9zdWJzY3JpcHRfLmNhbGwoYSwgYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X3NvcnRfID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgZiA9IHZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIGMgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIHZhciBnID0gdm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgJiYgYiAhPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZCkgdmFyIGggPSAhMQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKGQgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICAgIGggPSBTay5taXNjZXZhbC5pc1RydWUoZCkKICAgICAgICB9CiAgICAgICAgZCA9IG5ldyBTay5idWlsdGluLnRpbVNvcnQoYSkKICAgICAgICBhLnYgPSBbXQogICAgICAgIHZhciBrID0gbmV3IFNrLmJ1aWx0aW4uaW50XygwKQogICAgICAgIGlmIChmKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZC5sdCA9IGcKICAgICAgICAgICAgICA/IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYVswXSwgY1swXV0pCiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYSwgaywgIkx0IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChhWzBdLCBiWzBdLCAiTHQiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlID0gMDsKICAgICAgICAgICAgZSA8IGQubGlzdGxlbmd0aDsKICAgICAgICAgICAgZSsrCiAgICAgICAgICApIHsKICAgICAgICAgICAgZyA9IGQubGlzdC52W2VdCiAgICAgICAgICAgIHZhciBsID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIFtnXSkKICAgICAgICAgICAgZC5saXN0LnZbZV0gPSBbbCwgZ10KICAgICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgICBnICYmCiAgICAgICAgICAgIChkLmx0ID0gZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2EsIGNdKQogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYSwgaywgIkx0IikKICAgICAgICAgICAgfSkKICAgICAgICBoICYmIGQubGlzdC5saXN0X3JldmVyc2VfKGQubGlzdCkKICAgICAgICBkLnNvcnQoKQogICAgICAgIGggJiYgZC5saXN0Lmxpc3RfcmV2ZXJzZV8oZC5saXN0KQogICAgICAgIGlmIChmKQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQubGlzdGxlbmd0aDsgYysrKQogICAgICAgICAgICAoZyA9IGQubGlzdC52W2NdWzFdKSwgKGQubGlzdC52W2NdID0gZykKICAgICAgICBjID0gMCA8IGEuc3EkbGVuZ3RoKCkKICAgICAgICBhLnYgPSBkLmxpc3QudgogICAgICAgIGlmIChjKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5PcGVyYXRpb25FcnJvcigibGlzdCBtb2RpZmllZCBkdXJpbmcgc29ydCIpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9zb3J0Xy5jb192YXJuYW1lcyA9IFsKICAgICAgICAiX19zZWxmX18iLAogICAgICAgICJjbXAiLAogICAgICAgICJrZXkiLAogICAgICAgICJyZXZlcnNlIiwKICAgICAgXQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc29ydF8uJGRlZmF1bHRzID0gWwogICAgICAgIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgITEsCiAgICAgIF0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X3JldmVyc2VfID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJldmVyc2UiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHZhciBiID0gYS52Lmxlbmd0aAogICAgICAgIHZhciBjID0gYS52CiAgICAgICAgdmFyIGQgPSBbXQogICAgICAgIGZvciAoLS1iOyAtMSA8IGI7IC0tYikgZC5wdXNoKGNbYl0pCiAgICAgICAgYS52ID0gZAogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmFwcGVuZCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImFwcGVuZCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgYS52LnB1c2goYikKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuaW5zZXJ0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaW5zZXJ0IiwgYXJndW1lbnRzLmxlbmd0aCwgMywgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImFuIGludGVnZXIgaXMgcmVxdWlyZWQiKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIDAgPiBiICYmIChiICs9IGEudi5sZW5ndGgpCiAgICAgICAgMCA+IGIgPyAoYiA9IDApIDogYiA+IGEudi5sZW5ndGggJiYgKGIgPSBhLnYubGVuZ3RoKQogICAgICAgIGEudi5zcGxpY2UoYiwgMCwgYykKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuZXh0ZW5kID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZXh0ZW5kIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBhLmxpc3RfZXh0ZW5kXyhiKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5wb3AgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJwb3AiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IGEudi5sZW5ndGggLSAxKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja051bWJlcihiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYW4gaW50ZWdlciBpcyByZXF1aXJlZCIpCiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgMCA+IGIgJiYgKGIgKz0gYS52Lmxlbmd0aCkKICAgICAgICBpZiAoMCA+IGIgfHwgYiA+PSBhLnYubGVuZ3RoKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSW5kZXhFcnJvcigicG9wIGluZGV4IG91dCBvZiByYW5nZSIpCiAgICAgICAgdmFyIGMgPSBhLnZbYl0KICAgICAgICBhLnYuc3BsaWNlKGIsIDEpCiAgICAgICAgcmV0dXJuIGMKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5yZW1vdmUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZW1vdmUiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5pbmRleC5mdW5jX2NvZGUoYSwgYikKICAgICAgICBhLnYuc3BsaWNlKFNrLmJ1aWx0aW4uYXNudW0kKGMpLCAxKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5jbGVhciQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY2xlYXIiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGEudiA9IFtdCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuaW5kZXggPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgICBjLAogICAgICAgIGQsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImluZGV4IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgNCkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICFTay5idWlsdGluLmNoZWNrSW50KGMpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMiKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoZCkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoInNsaWNlIGluZGljZXMgbXVzdCBiZSBpbnRlZ2VycyIpCiAgICAgICAgdmFyIGUgPSBhLnYubGVuZ3RoCiAgICAgICAgdmFyIGYgPSBhLnYKICAgICAgICBjID0gdm9pZCAwID09PSBjID8gMCA6IGMudgogICAgICAgIDAgPiBjICYmIChjID0gMCA8PSBjICsgZSA/IGMgKyBlIDogMCkKICAgICAgICBkID0gdm9pZCAwID09PSBkID8gZSA6IGQudgogICAgICAgIDAgPiBkICYmIChkID0gMCA8PSBkICsgZSA/IGQgKyBlIDogMCkKICAgICAgICBmb3IgKGUgPSBjOyBlIDwgZDsgKytlKQogICAgICAgICAgaWYgKFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChmW2VdLCBiLCAiRXEiKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oZSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJsaXN0LmluZGV4KHgpOiB4IG5vdCBpbiBsaXN0IikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5jb3VudCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLCBkCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY291bnQiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIHZhciBlID0gYS52Lmxlbmd0aAogICAgICAgIHZhciBmID0gYS52CiAgICAgICAgZm9yIChjID0gZCA9IDA7IGMgPCBlOyArK2MpCiAgICAgICAgICBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZltjXSwgYiwgIkVxIikgJiYgKGQgKz0gMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhkKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmNvcHkgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNvcHkiLCBhcmd1bWVudHMubGVuZ3RoIC0gMSwgMCwgMCkKICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gZC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBkLnRwJGl0ZXJuZXh0KCkpIGMucHVzaChiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUucmV2ZXJzZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X3JldmVyc2VfLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuc29ydCA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X3NvcnRfLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5saXN0IiwgU2suYnVpbHRpbi5saXN0KQogICAgICBTay5idWlsdGluLmxpc3RfaXRlcl8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubGlzdF9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdF9pdGVyXyhhKQogICAgICAgIHRoaXMuJGluZGV4ID0gMAogICAgICAgIHRoaXMubHN0ID0gYS52LnNsaWNlKCkKICAgICAgICB0aGlzLnNxJGxlbmd0aCA9IHRoaXMubHN0Lmxlbmd0aAogICAgICAgIHRoaXMudHAkaXRlciA9IHRoaXMKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoISh0aGlzLiRpbmRleCA+PSB0aGlzLnNxJGxlbmd0aCkpIHJldHVybiB0aGlzLmxzdFt0aGlzLiRpbmRleCsrXQogICAgICAgIH0KICAgICAgICB0aGlzLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJsaXN0aXRlcmF0b3IiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgImxpc3RpdGVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi5saXN0X2l0ZXJfLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubGlzdF9pdGVyXy5wcm90b3R5cGUuX19jbGFzc19fID0gU2suYnVpbHRpbi5saXN0X2l0ZXJfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdF9pdGVyXy5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdF9pdGVyXy5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IGEudHAkaXRlcm5leHQoKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHRocm93IG5ldyBTay5idWlsdGluLlN0b3BJdGVyYXRpb24oKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uaW50ZXJuZWQgPSB7fQogICAgICBTay5idWlsdGluLnN0ciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzdHIiLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAxKQogICAgICAgIHZvaWQgMCA9PT0gYSAmJiAoYSA9ICIiKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpIHJldHVybiBhCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSkgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICAgIGlmICghMCA9PT0gYSkgdmFyIGIgPSAiVHJ1ZSIKICAgICAgICBlbHNlIGlmICghMSA9PT0gYSkgYiA9ICJGYWxzZSIKICAgICAgICBlbHNlIGlmIChudWxsID09PSBhIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUpIGIgPSAiTm9uZSIKICAgICAgICBlbHNlIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ib29sKSBiID0gYS52ID8gIlRydWUiIDogIkZhbHNlIgogICAgICAgIGVsc2UgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSkKICAgICAgICAgIChiID0gYS50b1N0cmluZygpKSwKICAgICAgICAgICAgIkluZmluaXR5IiA9PT0gYiA/IChiID0gImluZiIpIDogIi1JbmZpbml0eSIgPT09IGIgJiYgKGIgPSAiLWluZiIpCiAgICAgICAgZWxzZSBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSBiID0gYQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYS50cCRzdHIpIHsKICAgICAgICAgICAgYiA9IGEudHAkc3RyKCkKICAgICAgICAgICAgaWYgKCEoYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJfX3N0cl9fIGRpZG4ndCByZXR1cm4gYSBzdHIiKQogICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLm9iamVjdFJlcHIoYSkKICAgICAgICB9CiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uaW50ZXJuZWRbIjEiICsgYl0pIHJldHVybiBTay5idWlsdGluLmludGVybmVkWyIxIiArIGJdCiAgICAgICAgdGhpcy5fX2NsYXNzX18gPSBTay5idWlsdGluLnN0cgogICAgICAgIHRoaXMudiA9IHRoaXMudiA9IGIKICAgICAgICBTay5idWlsdGluLmludGVybmVkWyIxIiArIGJdID0gdGhpcwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLnN0ciIsIFNrLmJ1aWx0aW4uc3RyKQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJzdHIiLCBTay5idWlsdGluLnN0ciwgU2suYnVpbHRpbi5zZXF0eXBlKQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuJGpzc3RyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5tcCRzdWJzY3JpcHQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzSW5kZXgoYSkpIHsKICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgICAwID4gYSAmJiAoYSA9IHRoaXMudi5sZW5ndGggKyBhKQogICAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy52Lmxlbmd0aCkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSW5kZXhFcnJvcigic3RyaW5nIGluZGV4IG91dCBvZiByYW5nZSIpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMudi5jaGFyQXQoYSkpCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zbGljZSkgewogICAgICAgICAgdmFyIGIgPSAiIgogICAgICAgICAgYS5zc3NpdGVyJCh0aGlzLCBmdW5jdGlvbihhLCBkKSB7CiAgICAgICAgICAgIDAgPD0gYSAmJiBhIDwgZC52Lmxlbmd0aCAmJiAoYiArPSBkLnYuY2hhckF0KGEpKQogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYikKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgInN0cmluZyBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRsZW5ndGggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy52Lmxlbmd0aAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRjb25jYXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCFhIHx8ICFTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpKQogICAgICAgICAgdGhyb3cgKChhID0gU2suYWJzdHIudHlwZU5hbWUoYSkpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiY2Fubm90IGNvbmNhdGVuYXRlICdzdHInIGFuZCAnIiArIGEgKyAiJyBvYmplY3RzIiwKICAgICAgICAgICkpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLnYgKyBhLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLm5iJGFkZCA9IFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRjb25jYXQKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0KICAgICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3EkY29uY2F0CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRyZXBlYXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzSW5kZXgoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJjYW4ndCBtdWx0aXBseSBzZXF1ZW5jZSBieSBub24taW50IG9mIHR5cGUgJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICApCiAgICAgICAgYSA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYSkKICAgICAgICB2YXIgYyA9ICIiCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGE7ICsrYikgYyArPSB0aGlzLnYKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNxJHJlcGVhdAogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubmIkaW5wbGFjZV9tdWx0aXBseSA9CiAgICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNxJHJlcGVhdAogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3EkaXRlbSA9IGZ1bmN0aW9uKCkgewogICAgICAgIFNrLmFzc2VydHMuZmFpbCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNxJHNsaWNlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIDAgPiBhICYmIChhID0gMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMudi5zdWJzdHIoYSwgYiAtIGEpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRjb250YWlucyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoIShhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiVHlwZUVycm9yOiAnSW4gPHN0cmluZz4gcmVxdWlyZXMgc3RyaW5nIGFzIGxlZnQgb3BlcmFuZCIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIC0xICE9IHRoaXMudi5pbmRleE9mKGEudikKICAgICAgfQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyX2l0ZXJfKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cl9pdGVyXyh0aGlzKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS50cCRyaWNoY29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoIShhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpKQogICAgICAgICAgcmV0dXJuIFNrLl9fZnV0dXJlX18ucHl0aG9uMwogICAgICAgICAgICA/IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgICAgICAgIDogITEKICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMudiA8IGEudgogICAgICAgICAgY2FzZSAiTHRFIjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMudiA8PSBhLnYKICAgICAgICAgIGNhc2UgIkVxIjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMudiA9PT0gYS52CiAgICAgICAgICBjYXNlICJOb3RFcSI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLnYgIT09IGEudgogICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICByZXR1cm4gdGhpcy52ID4gYS52CiAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICByZXR1cm4gdGhpcy52ID49IGEudgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCkKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gIiciCiAgICAgICAgOy0xICE9PSB0aGlzLnYuaW5kZXhPZigiJyIpICYmIC0xID09PSB0aGlzLnYuaW5kZXhPZignIicpICYmIChiID0gJyInKQogICAgICAgIHZhciBjID0gdGhpcy52Lmxlbmd0aAogICAgICAgIHZhciBkID0gYgogICAgICAgIGZvciAoYSA9IDA7IGEgPCBjOyArK2EpIHsKICAgICAgICAgIHZhciBlID0gdGhpcy52LmNoYXJBdChhKQogICAgICAgICAgZSA9PT0gYiB8fCAiXFwiID09PSBlCiAgICAgICAgICAgID8gKGQgKz0gIlxcIiArIGUpCiAgICAgICAgICAgIDogIlx0IiA9PT0gZQogICAgICAgICAgICA/IChkICs9ICJcXHQiKQogICAgICAgICAgICA6ICJcbiIgPT09IGUKICAgICAgICAgICAgPyAoZCArPSAiXFxuIikKICAgICAgICAgICAgOiAiXHIiID09PSBlCiAgICAgICAgICAgID8gKGQgKz0gIlxcciIpCiAgICAgICAgICAgIDogIiAiID4gZSB8fCAxMjcgPD0gZQogICAgICAgICAgICA/ICgoZSA9IGUuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLAogICAgICAgICAgICAgIDIgPiBlLmxlbmd0aCAmJiAoZSA9ICIwIiArIGUpLAogICAgICAgICAgICAgIChkICs9ICJcXHgiICsgZSkpCiAgICAgICAgICAgIDogKGQgKz0gZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihkICsgYikKICAgICAgfQogICAgICBTay5idWlsdGluLnN0ci5yZV9lc2NhcGVfID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IFtdLAogICAgICAgICAgZCA9IC9eW0EtWmEtejAtOV0rJC8KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7ICsrYikgewogICAgICAgICAgdmFyIGUgPSBhLmNoYXJBdChiKQogICAgICAgICAgZC50ZXN0KGUpCiAgICAgICAgICAgID8gYy5wdXNoKGUpCiAgICAgICAgICAgIDogIlxcMDAwIiA9PT0gZQogICAgICAgICAgICA/IGMucHVzaCgiXFwwMDAiKQogICAgICAgICAgICA6IGMucHVzaCgiXFwiICsgZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMuam9pbigiIikKICAgICAgfQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubG93ZXIgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJsb3dlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhLnYudG9Mb3dlckNhc2UoKSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnVwcGVyID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigidXBwZXIiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYS52LnRvVXBwZXJDYXNlKCkpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5jYXBpdGFsaXplID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjYXBpdGFsaXplIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYyA9IGEudgogICAgICAgIGlmICgwID09PSBjLmxlbmd0aCkgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiIikKICAgICAgICB2YXIgZCA9IGMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkKICAgICAgICBmb3IgKGIgPSAxOyBiIDwgYy5sZW5ndGg7IGIrKykgZCArPSBjLmNoYXJBdChiKS50b0xvd2VyQ2FzZSgpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihkKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuam9pbiA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiam9pbiIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgic2VxIiwgIml0ZXJhYmxlIiwgU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGIpKQogICAgICAgIHZhciBkID0gW10KICAgICAgICB2YXIgZSA9IGIudHAkaXRlcigpCiAgICAgICAgZm9yIChjID0gZS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGM7IGMgPSBlLnRwJGl0ZXJuZXh0KCkpIHsKICAgICAgICAgIGlmIChjLmNvbnN0cnVjdG9yICE9PSBTay5idWlsdGluLnN0cikKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJUeXBlRXJyb3I6IHNlcXVlbmNlIGl0ZW0gIiArCiAgICAgICAgICAgICAgICBkLmxlbmd0aCArCiAgICAgICAgICAgICAgICAiOiBleHBlY3RlZCBzdHJpbmcsICIgKwogICAgICAgICAgICAgICAgdHlwZW9mIGMgKwogICAgICAgICAgICAgICAgIiBmb3VuZCIsCiAgICAgICAgICAgICkKICAgICAgICAgIGQucHVzaChjLnYpCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoZC5qb2luKGEudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcGxpdCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHZhciBkLCBlCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigic3BsaXQiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAzKQogICAgICAgIGlmICh2b2lkIDAgPT09IGIgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSkgYiA9IG51bGwKICAgICAgICBpZiAobnVsbCAhPT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiZXhwZWN0ZWQgYSBzdHJpbmciKQogICAgICAgIGlmIChudWxsICE9PSBiICYmICIiID09PSBiLnYpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJlbXB0eSBzZXBhcmF0b3IiKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImFuIGludGVnZXIgaXMgcmVxdWlyZWQiKQogICAgICAgIGMgPSBTay5idWlsdGluLmFzbnVtJChjKQogICAgICAgIHZhciBmID0gL1tcc1x4YTBdKy9nCiAgICAgICAgdmFyIGcgPSBhLnYKICAgICAgICBpZiAobnVsbCA9PT0gYikgZyA9IGcucmVwbGFjZSgvXltcc1x4YTBdKy8sICIiKQogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIGggPSBiLnYucmVwbGFjZSgvKFsuKis/PXxcXFwvKClcW1xdXHtcfV4kXSkvZywgIlxcJDEiKQogICAgICAgICAgZiA9IG5ldyBSZWdFeHAoaCwgImciKQogICAgICAgIH0KICAgICAgICB2YXIgayA9IFtdCiAgICAgICAgZm9yICgKICAgICAgICAgIGggPSBkID0gMDsKICAgICAgICAgIG51bGwgIT0gKGUgPSBmLmV4ZWMoZykpICYmCiAgICAgICAgICBlLmluZGV4ICE9PSBmLmxhc3RJbmRleCAmJgogICAgICAgICAgIShrLnB1c2gobmV3IFNrLmJ1aWx0aW4uc3RyKGcuc3Vic3RyaW5nKGQsIGUuaW5kZXgpKSksCiAgICAgICAgICAoZCA9IGYubGFzdEluZGV4KSwKICAgICAgICAgIChoICs9IDEpLAogICAgICAgICAgYyAmJiBoID49IGMpOwoKICAgICAgICApOwogICAgICAgIGcgPSBnLnN1YnN0cmluZyhkKQogICAgICAgIDsobnVsbCAhPT0gYiB8fCAwIDwgZy5sZW5ndGgpICYmIGsucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoZykpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoaykKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnN0cmlwID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigic3RyaXAiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIgJiYgIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoInN0cmlwIGFyZyBtdXN0IGJlIE5vbmUgb3Igc3RyIikKICAgICAgICBpZiAodm9pZCAwID09PSBiKSB2YXIgYyA9IC9eXHMrfFxzKyQvZwogICAgICAgIGVsc2UKICAgICAgICAgIChjID0gU2suYnVpbHRpbi5zdHIucmVfZXNjYXBlXyhiLnYpKSwKICAgICAgICAgICAgKGMgPSBuZXcgUmVnRXhwKCJeWyIgKyBjICsgIl0rfFsiICsgYyArICJdKyQiLCAiZyIpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYS52LnJlcGxhY2UoYywgIiIpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubHN0cmlwID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigibHN0cmlwIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJsc3RyaXAgYXJnIG11c3QgYmUgTm9uZSBvciBzdHIiKQogICAgICAgIGlmICh2b2lkIDAgPT09IGIpIHZhciBjID0gL15ccysvZwogICAgICAgIGVsc2UKICAgICAgICAgIChjID0gU2suYnVpbHRpbi5zdHIucmVfZXNjYXBlXyhiLnYpKSwKICAgICAgICAgICAgKGMgPSBuZXcgUmVnRXhwKCJeWyIgKyBjICsgIl0rIiwgImciKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEudi5yZXBsYWNlKGMsICIiKSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnJzdHJpcCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJzdHJpcCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigicnN0cmlwIGFyZyBtdXN0IGJlIE5vbmUgb3Igc3RyIikKICAgICAgICBpZiAodm9pZCAwID09PSBiKSB2YXIgYyA9IC9ccyskL2cKICAgICAgICBlbHNlCiAgICAgICAgICAoYyA9IFNrLmJ1aWx0aW4uc3RyLnJlX2VzY2FwZV8oYi52KSksCiAgICAgICAgICAgIChjID0gbmV3IFJlZ0V4cCgiWyIgKyBjICsgIl0rJCIsICJnIikpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhLnYucmVwbGFjZShjLCAiIikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5fX2Zvcm1hdF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mb3JtYXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpIHsKICAgICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgaWYgKCIiICE9PSBjICYmICJzIiAhPT0gYykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgICAiZm9ybWF0IHNwZWMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICAgICkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18uZXhjZXB0aW9ucykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQoKSBhcmd1bWVudCAyIG11c3QgYmUgc3RyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJmb3JtYXQgZXhwZWN0cyBhcmcgMiB0byBiZSBzdHJpbmcgb3IgdW5pY29kZSwgbm90ICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5wYXJ0aXRpb24gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJwYXJ0aXRpb24iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoInNlcCIsICJzdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgIHZhciBjID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpCiAgICAgICAgdmFyIGQgPSBhLnYuaW5kZXhPZihjLnYpCiAgICAgICAgcmV0dXJuIDAgPiBkCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0ciwKICAgICAgICAgICAgICBTay5idWlsdGluLnN0ci4kZW1wdHlzdHIsCiAgICAgICAgICAgIF0pCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoYS52LnN1YnN0cmluZygwLCBkKSksCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoYS52LnN1YnN0cmluZyhkICsgYy52Lmxlbmd0aCkpLAogICAgICAgICAgICBdKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUucnBhcnRpdGlvbiA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJwYXJ0aXRpb24iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoInNlcCIsICJzdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgIHZhciBjID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpCiAgICAgICAgdmFyIGQgPSBhLnYubGFzdEluZGV4T2YoYy52KQogICAgICAgIHJldHVybiAwID4gZAogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zdHIuJGVtcHR5c3RyLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0ciwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICBdKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc3RyKGEudi5zdWJzdHJpbmcoMCwgZCkpLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc3RyKGEudi5zdWJzdHJpbmcoZCArIGMudi5sZW5ndGgpKSwKICAgICAgICAgICAgXSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmNvdW50ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgICBkLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjb3VudCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDQpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJleHBlY3RlZCBhIGNoYXJhY3RlciBidWZmZXIgb2JqZWN0IikKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICFTay5idWlsdGluLmNoZWNrSW50KGMpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUgb3IgaGF2ZSBhbiBfX2luZGV4X18gbWV0aG9kIiwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmICFTay5idWlsdGluLmNoZWNrSW50KGQpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUgb3IgaGF2ZSBhbiBfX2luZGV4X18gbWV0aG9kIiwKICAgICAgICAgICkKICAgICAgICB2b2lkIDAgPT09IGMKICAgICAgICAgID8gKGMgPSAwKQogICAgICAgICAgOiAoKGMgPSBTay5idWlsdGluLmFzbnVtJChjKSksIChjID0gMCA8PSBjID8gYyA6IGEudi5sZW5ndGggKyBjKSkKICAgICAgICB2b2lkIDAgPT09IGQKICAgICAgICAgID8gKGQgPSBhLnYubGVuZ3RoKQogICAgICAgICAgOiAoKGQgPSBTay5idWlsdGluLmFzbnVtJChkKSksIChkID0gMCA8PSBkID8gZCA6IGEudi5sZW5ndGggKyBkKSkKICAgICAgICB2YXIgZSA9IGIudi5yZXBsYWNlKC9bLVtcXXt9KCkqKz8uLFxcXiR8I1xzXS9nLCAiXFwkJiIpCiAgICAgICAgZSA9IG5ldyBSZWdFeHAoZSwgImciKQogICAgICAgIHJldHVybiAoZSA9IGEudi5zbGljZShjLCBkKS5tYXRjaChlKSkKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uaW50XyhlLmxlbmd0aCkKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uaW50XygwKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubGp1c3QgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJsanVzdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDMpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSW50KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaW50ZWdlciBhcmd1bWVudCBleGVwY3RlZCwgZ290ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhjKSB8fCAxICE9PSBjLnYubGVuZ3RoKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm11c3QgYmUgY2hhciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShjKSwKICAgICAgICAgICkKICAgICAgICBjID0gdm9pZCAwID09PSBjID8gIiAiIDogYy52CiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgaWYgKGEudi5sZW5ndGggPj0gYikgcmV0dXJuIGEKICAgICAgICB2YXIgZCA9IEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwoCiAgICAgICAgICB7IGxlbmd0aDogTWF0aC5mbG9vcihiIC0gYS52Lmxlbmd0aCkgKyAxIH0sCiAgICAgICAgICBjLAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEudiArIGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5yanVzdCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJqdXN0IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJpbnRlZ2VyIGFyZ3VtZW50IGV4ZXBjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGMpIHx8IDEgIT09IGMudi5sZW5ndGgpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAibXVzdCBiZSBjaGFyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGMpLAogICAgICAgICAgKQogICAgICAgIGMgPSB2b2lkIDAgPT09IGMgPyAiICIgOiBjLnYKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICBpZiAoYS52Lmxlbmd0aCA+PSBiKSByZXR1cm4gYQogICAgICAgIHZhciBkID0gQXJyYXkucHJvdG90eXBlLmpvaW4uY2FsbCgKICAgICAgICAgIHsgbGVuZ3RoOiBNYXRoLmZsb29yKGIgLSBhLnYubGVuZ3RoKSArIDEgfSwKICAgICAgICAgIGMsCiAgICAgICAgKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoZCArIGEudikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmNlbnRlciA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNlbnRlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDMpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSW50KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaW50ZWdlciBhcmd1bWVudCBleGVwY3RlZCwgZ290ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhjKSB8fCAxICE9PSBjLnYubGVuZ3RoKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm11c3QgYmUgY2hhciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShjKSwKICAgICAgICAgICkKICAgICAgICBjID0gdm9pZCAwID09PSBjID8gIiAiIDogYy52CiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgaWYgKGEudi5sZW5ndGggPj0gYikgcmV0dXJuIGEKICAgICAgICB2YXIgZCA9IEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwoCiAgICAgICAgICB7IGxlbmd0aDogTWF0aC5mbG9vcigoYiAtIGEudi5sZW5ndGgpIC8gMikgKyAxIH0sCiAgICAgICAgICBjLAogICAgICAgICkKICAgICAgICBkID0gZCArIGEudiArIGQKICAgICAgICBkLmxlbmd0aCA8IGIgJiYgKGQgKz0gYykKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5maW5kID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZmluZCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDQpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJleHBlY3RlZCBhIGNoYXJhY3RlciBidWZmZXIgb2JqZWN0IikKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICFTay5idWlsdGluLmNoZWNrSW50KGMpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUgb3IgaGF2ZSBhbiBfX2luZGV4X18gbWV0aG9kIiwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmICFTay5idWlsdGluLmNoZWNrSW50KGQpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUgb3IgaGF2ZSBhbiBfX2luZGV4X18gbWV0aG9kIiwKICAgICAgICAgICkKICAgICAgICB2b2lkIDAgPT09IGMKICAgICAgICAgID8gKGMgPSAwKQogICAgICAgICAgOiAoKGMgPSBTay5idWlsdGluLmFzbnVtJChjKSksIChjID0gMCA8PSBjID8gYyA6IGEudi5sZW5ndGggKyBjKSkKICAgICAgICB2b2lkIDAgPT09IGQKICAgICAgICAgID8gKGQgPSBhLnYubGVuZ3RoKQogICAgICAgICAgOiAoKGQgPSBTay5idWlsdGluLmFzbnVtJChkKSksIChkID0gMCA8PSBkID8gZCA6IGEudi5sZW5ndGggKyBkKSkKICAgICAgICB2YXIgZSA9IGEudi5pbmRleE9mKGIudiwgYykKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhlID49IGMgJiYgZSA8IGQgPyBlIDogLTEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pbmRleCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaW5kZXgiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCA0KQogICAgICAgIHZhciBlID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEuZmluZCwgW2EsIGIsIGMsIGRdKQogICAgICAgIGlmICgtMSA9PT0gU2suYnVpbHRpbi5hc251bSQoZSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJzdWJzdHJpbmcgbm90IGZvdW5kIikKICAgICAgICByZXR1cm4gZQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUucmZpbmQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgICBjLAogICAgICAgIGQsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJmaW5kIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgNCkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImV4cGVjdGVkIGEgY2hhcmFjdGVyIGJ1ZmZlciBvYmplY3QiKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMgb3IgTm9uZSBvciBoYXZlIGFuIF9faW5kZXhfXyBtZXRob2QiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoZCkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMgb3IgTm9uZSBvciBoYXZlIGFuIF9faW5kZXhfXyBtZXRob2QiLAogICAgICAgICAgKQogICAgICAgIHZvaWQgMCA9PT0gYwogICAgICAgICAgPyAoYyA9IDApCiAgICAgICAgICA6ICgoYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGMpKSwgKGMgPSAwIDw9IGMgPyBjIDogYS52Lmxlbmd0aCArIGMpKQogICAgICAgIHZvaWQgMCA9PT0gZAogICAgICAgICAgPyAoZCA9IGEudi5sZW5ndGgpCiAgICAgICAgICA6ICgoZCA9IFNrLmJ1aWx0aW4uYXNudW0kKGQpKSwgKGQgPSAwIDw9IGQgPyBkIDogYS52Lmxlbmd0aCArIGQpKQogICAgICAgIHZhciBlID0gYS52Lmxhc3RJbmRleE9mKGIudiwgZCkKICAgICAgICBlID0gZSAhPT0gZCA/IGUgOiBhLnYubGFzdEluZGV4T2YoYi52LCBkIC0gMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhlID49IGMgJiYgZSA8IGQgPyBlIDogLTEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5yaW5kZXggPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgICBjLAogICAgICAgIGQsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJpbmRleCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDQpCiAgICAgICAgdmFyIGUgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5yZmluZCwgW2EsIGIsIGMsIGRdKQogICAgICAgIGlmICgtMSA9PT0gU2suYnVpbHRpbi5hc251bSQoZSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJzdWJzdHJpbmcgbm90IGZvdW5kIikKICAgICAgICByZXR1cm4gZQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3RhcnRzd2l0aCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInN0YXJ0c3dpdGgiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoInRndCIsICJzdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKDAgPT09IGEudi5pbmRleE9mKGIudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5lbmRzd2l0aCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImVuZHN3aXRoIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJ0Z3QiLCAic3RyaW5nIiwgU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbCgKICAgICAgICAgIC0xICE9PSBhLnYuaW5kZXhPZihiLnYsIGEudi5sZW5ndGggLSBiLnYubGVuZ3RoKSwKICAgICAgICApCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5yZXBsYWNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgICBkLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZXBsYWNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMywgNCkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJvbGRTIiwgInN0cmluZyIsIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgibmV3UyIsICJzdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGMpKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoZCkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJpbnRlZ2VyIGFyZ3VtZW50IGV4cGVjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGQpLAogICAgICAgICAgKQogICAgICAgIGQgPSBTay5idWlsdGluLmFzbnVtJChkKQogICAgICAgIHZhciBlID0gbmV3IFJlZ0V4cChTay5idWlsdGluLnN0ci5yZV9lc2NhcGVfKGIudiksICJnIikKICAgICAgICBpZiAodm9pZCAwID09PSBkIHx8IDAgPiBkKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhLnYucmVwbGFjZShlLCBjLnYpKQogICAgICAgIHZhciBmID0gMAogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICBhLnYucmVwbGFjZShlLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGYrKwogICAgICAgICAgICByZXR1cm4gZiA8PSBkID8gYy52IDogYQogICAgICAgICAgfSksCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuemZpbGwgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEudiwKICAgICAgICAgIGQgPSAiIgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInpmaWxsIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJpbnRlZ2VyIGFyZ3VtZW50IGV4ZXBlY3RlZCwgZ290ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICB2YXIgZSA9IGIudiAtIGMubGVuZ3RoCiAgICAgICAgdmFyIGYgPSAiKyIgPT09IGNbMF0gfHwgIi0iID09PSBjWzBdID8gMSA6IDAKICAgICAgICBmb3IgKHZhciBnID0gMDsgZyA8IGU7IGcrKykgZCArPSAiMCIKICAgICAgICBjID0gYy5zdWJzdHIoMCwgZikgKyBkICsgYy5zdWJzdHIoZikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc2RpZ2l0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNkaWdpdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woL15cZCskLy50ZXN0KGEudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc3NwYWNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNzcGFjZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woL15ccyskLy50ZXN0KGEudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5leHBhbmR0YWJzID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZXhwYW5kdGFicyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja0ludChiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImludGVnZXIgYXJndW1lbnQgZXhlcGVjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIGIgPSB2b2lkIDAgPT09IGIgPyA4IDogU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICB2YXIgYyA9IEFycmF5KGIgKyAxKS5qb2luKCIgIikKICAgICAgICB2YXIgZCA9IGEudi5yZXBsYWNlKC8oW15cclxuXHRdKilcdC9nLCBmdW5jdGlvbihhLCBkKSB7CiAgICAgICAgICByZXR1cm4gZCArIGMuc2xpY2UoZC5sZW5ndGggJSBiKQogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihkKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3dhcGNhc2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzd2FwY2FzZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgdmFyIGIgPSBhLnYucmVwbGFjZSgvW2Etel0vZ2ksIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHZhciBiID0gYS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICByZXR1cm4gYiA9PT0gYSA/IGEudG9VcHBlckNhc2UoKSA6IGIKICAgICAgICB9KQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNwbGl0bGluZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEudiwKICAgICAgICAgIGQsCiAgICAgICAgICBlID0gYS52Lmxlbmd0aCwKICAgICAgICAgIGYgPSBbXSwKICAgICAgICAgIGcgPSAwCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigic3BsaXRsaW5lcyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja0Jvb2woYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJib29sZWFuIGFyZ3VtZW50IGV4cGVjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIGIgPSB2b2lkIDAgPT09IGIgPyAhMSA6IGIudgogICAgICAgIGZvciAoZCA9IDA7IGQgPCBlOyBkKyspIHsKICAgICAgICAgIHZhciBoID0gYy5jaGFyQXQoZCkKICAgICAgICAgIGlmICgiXG4iID09PSBjLmNoYXJBdChkICsgMSkgJiYgIlxyIiA9PT0gaCkKICAgICAgICAgICAgKGggPSBkICsgMiksCiAgICAgICAgICAgICAgKGcgPSBjLnNsaWNlKGcsIGgpKSwKICAgICAgICAgICAgICBiIHx8IChnID0gZy5yZXBsYWNlKC8oXHJ8XG4pL2csICIiKSksCiAgICAgICAgICAgICAgZi5wdXNoKG5ldyBTay5idWlsdGluLnN0cihnKSksCiAgICAgICAgICAgICAgKGcgPSBoKQogICAgICAgICAgZWxzZSBpZiAoKCJcbiIgPT09IGggJiYgIlxyIiAhPT0gYy5jaGFyQXQoZCAtIDEpKSB8fCAiXHIiID09PSBoKQogICAgICAgICAgICAoaCA9IGQgKyAxKSwKICAgICAgICAgICAgICAoZyA9IGMuc2xpY2UoZywgaCkpLAogICAgICAgICAgICAgIGIgfHwgKGcgPSBnLnJlcGxhY2UoLyhccnxcbikvZywgIiIpKSwKICAgICAgICAgICAgICBmLnB1c2gobmV3IFNrLmJ1aWx0aW4uc3RyKGcpKSwKICAgICAgICAgICAgICAoZyA9IGgpCiAgICAgICAgfQogICAgICAgIGcgPCBlICYmCiAgICAgICAgICAoKGcgPSBjLnNsaWNlKGcsIGUpKSwKICAgICAgICAgIGIgfHwgKGcgPSBnLnJlcGxhY2UoLyhccnxcbikvZywgIiIpKSwKICAgICAgICAgIGYucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoZykpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGYpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS50aXRsZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInRpdGxlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYiA9IGEudi5yZXBsYWNlKC9bYS16XVthLXpdKi9naSwgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGFbMF0udG9VcHBlckNhc2UoKSArIGEuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCkKICAgICAgICB9KQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmlzYWxwaGEgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpc2FscGhhIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbChhLnYubGVuZ3RoICYmICEvW15hLXpBLVpdLy50ZXN0KGEudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc2FsbnVtID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNhbG51bSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woYS52Lmxlbmd0aCAmJiAhL1teYS16QS1aMC05XS8udGVzdChhLnYpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuaXNudW1lcmljID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNudW1lcmljIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbChhLnYubGVuZ3RoICYmICEvW14wLTldLy50ZXN0KGEudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc2xvd2VyID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNsb3dlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woCiAgICAgICAgICBhLnYubGVuZ3RoICYmIC9bYS16XS8udGVzdChhLnYpICYmICEvW0EtWl0vLnRlc3QoYS52KSwKICAgICAgICApCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc3VwcGVyID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXN1cHBlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woCiAgICAgICAgICBhLnYubGVuZ3RoICYmICEvW2Etel0vLnRlc3QoYS52KSAmJiAvW0EtWl0vLnRlc3QoYS52KSwKICAgICAgICApCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc3RpdGxlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBhLnYsCiAgICAgICAgICBjID0gITEsCiAgICAgICAgICBkID0gITEsCiAgICAgICAgICBlCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXN0aXRsZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgZm9yIChlID0gMDsgZSA8IGIubGVuZ3RoOyBlKyspIHsKICAgICAgICAgIHZhciBmID0gYi5jaGFyQXQoZSkKICAgICAgICAgIGlmICghL1thLXpdLy50ZXN0KGYpICYmIC9bQS1aXS8udGVzdChmKSkgewogICAgICAgICAgICBpZiAoZCkgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woITEpCiAgICAgICAgICAgIGMgPSBkID0gITAKICAgICAgICAgIH0gZWxzZSBpZiAoL1thLXpdLy50ZXN0KGYpICYmICEvW0EtWl0vLnRlc3QoZikpIHsKICAgICAgICAgICAgaWYgKCFkKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbCghMSkKICAgICAgICAgICAgYyA9ICEwCiAgICAgICAgICB9IGVsc2UgZCA9ICExCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5uYiRyZW1haW5kZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLnR1cGxlIHx8CiAgICAgICAgICAodm9pZCAwICE9PSBhLm1wJHN1YnNjcmlwdCAmJiBhLmNvbnN0cnVjdG9yICE9PSBTay5idWlsdGluLnN0cikgfHwKICAgICAgICAgIChhID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW2FdKSkKICAgICAgICB2YXIgYyA9IDAKICAgICAgICB2YXIgZCA9IHRoaXMudi5yZXBsYWNlKAogICAgICAgICAgLyUoXChbYS16QS1aMC05XStcKSk/KFsjMCArXC1dKyk/KFwqfFswLTldKyk/KFwuKFwqfFswLTldKykpP1tobExdPyhbZGlvdXhYZUVmRmdHY3JzJV0pL2csCiAgICAgICAgICBmdW5jdGlvbihkLCBmLCBnLCBoLCBrLCBsLCByKSB7CiAgICAgICAgICAgIHZhciBlLCBxLCBtLCB4LCBwCiAgICAgICAgICAgIGggPSBTay5idWlsdGluLmFzbnVtJChoKQogICAgICAgICAgICBrID0gU2suYnVpbHRpbi5hc251bSQoaykKICAgICAgICAgICAgOyh2b2lkIDAgIT09IGYgJiYgIiIgIT09IGYpIHx8ICIlIiA9PSByIHx8IChlID0gYysrKQogICAgICAgICAgICAiIiA9PT0gayAmJiAoayA9IHZvaWQgMCkKICAgICAgICAgICAgdmFyIEogPSAocSA9IG0gPSB4ID0gcCA9ICExKQogICAgICAgICAgICBnICYmCiAgICAgICAgICAgICAgKC0xICE9PSBnLmluZGV4T2YoIi0iKQogICAgICAgICAgICAgICAgPyAoeCA9ICEwKQogICAgICAgICAgICAgICAgOiAtMSAhPT0gZy5pbmRleE9mKCIwIikgJiYgKHAgPSAhMCksCiAgICAgICAgICAgICAgLTEgIT09IGcuaW5kZXhPZigiKyIpCiAgICAgICAgICAgICAgICA/IChxID0gITApCiAgICAgICAgICAgICAgICA6IC0xICE9PSBnLmluZGV4T2YoIiAiKSAmJiAobSA9ICEwKSwKICAgICAgICAgICAgICAoSiA9IC0xICE9PSBnLmluZGV4T2YoIiMiKSkpCiAgICAgICAgICAgIGsgJiYgKGsgPSBwYXJzZUludChrLnN1YnN0cigxKSwgMTApKQogICAgICAgICAgICBnID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgIHZhciBjCiAgICAgICAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgICAgICAgdmFyIGQgPSAhMQogICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEpIHsKICAgICAgICAgICAgICAgIDAgPiBhICYmICgoYSA9IC1hKSwgKGQgPSAhMCkpCiAgICAgICAgICAgICAgICB2YXIgZSA9IGEudG9TdHJpbmcoYikKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICAgICAgICA/ICgoZSA9IGEuc3RyJChiLCAhMSkpLAogICAgICAgICAgICAgICAgICAgIDIgPCBlLmxlbmd0aCAmJgogICAgICAgICAgICAgICAgICAgICAgIi4wIiA9PT0gZS5zdWJzdHIoLTIpICYmCiAgICAgICAgICAgICAgICAgICAgICAoZSA9IGUuc3Vic3RyKDAsIGUubGVuZ3RoIC0gMikpLAogICAgICAgICAgICAgICAgICAgIChkID0gYS5uYiRpc25lZ2F0aXZlKCkpKQogICAgICAgICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgICAgICAgICAgPyAoKGUgPSBhLnN0ciQoYiwgITEpKSwgKGQgPSBhLm5iJGlzbmVnYXRpdmUoKSkpCiAgICAgICAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nICYmCiAgICAgICAgICAgICAgICAgICAgKChlID0gYS5zdHIkKGIsICExKSksIChkID0gYS5uYiRpc25lZ2F0aXZlKCkpKQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gZSwgInVuaGFuZGxlZCBudW1iZXIgZm9ybWF0IikKICAgICAgICAgICAgICBhID0gITEKICAgICAgICAgICAgICBpZiAoaykgZm9yIChjID0gZS5sZW5ndGg7IGMgPCBrOyArK2MpIChlID0gIjAiICsgZSksIChhID0gITApCiAgICAgICAgICAgICAgYyA9ICIiCiAgICAgICAgICAgICAgZCA/IChjID0gIi0iKSA6IHEgPyAoYyA9ICIrIiArIGMpIDogbSAmJiAoYyA9ICIgIiArIGMpCiAgICAgICAgICAgICAgSiAmJgogICAgICAgICAgICAgICAgKDE2ID09PSBiCiAgICAgICAgICAgICAgICAgID8gKGMgKz0gIjB4IikKICAgICAgICAgICAgICAgICAgOiA4ICE9PSBiIHx8IGEgfHwgIjAiID09PSBlIHx8IChjICs9ICIwIikpCiAgICAgICAgICAgICAgcmV0dXJuIFtjLCBlXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgdmFyIGIgPSBhWzBdCiAgICAgICAgICAgICAgYSA9IGFbMV0KICAgICAgICAgICAgICBpZiAoaCkgewogICAgICAgICAgICAgICAgaCA9IHBhcnNlSW50KGgsIDEwKQogICAgICAgICAgICAgICAgdmFyIGMgPSBhLmxlbmd0aCArIGIubGVuZ3RoCiAgICAgICAgICAgICAgICBpZiAocCkgZm9yICg7IGMgPCBoOyArK2MpIGEgPSAiMCIgKyBhCiAgICAgICAgICAgICAgICBlbHNlIGlmICh4KSBmb3IgKDsgYyA8IGg7ICsrYykgYSArPSAiICIKICAgICAgICAgICAgICAgIGVsc2UgZm9yICg7IGMgPCBoOyArK2MpIGIgPSAiICIgKyBiCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBiICsgYQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLnR1cGxlKSBmID0gYS52W2VdCiAgICAgICAgICAgIGVsc2UgaWYgKHZvaWQgMCAhPT0gYS5tcCRzdWJzY3JpcHQgJiYgdm9pZCAwICE9PSBmKQogICAgICAgICAgICAgIChmID0gZi5zdWJzdHJpbmcoMSwgZi5sZW5ndGggLSAxKSksCiAgICAgICAgICAgICAgICAoZiA9IGEubXAkc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnN0cihmKSkpCiAgICAgICAgICAgIGVsc2UgaWYgKAogICAgICAgICAgICAgIGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uZGljdCB8fAogICAgICAgICAgICAgIGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4ubGlzdAogICAgICAgICAgICApCiAgICAgICAgICAgICAgZiA9IGEKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgICAgYS50cCRuYW1lICsgIiBpbnN0YW5jZSBoYXMgbm8gYXR0cmlidXRlICdtcCRzdWJzY3JpcHQnIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGlmICgiZCIgPT09IHIgfHwgImkiID09PSByKSByZXR1cm4gZChnKGYsIDEwKSkKICAgICAgICAgICAgaWYgKCJvIiA9PT0gcikgcmV0dXJuIGQoZyhmLCA4KSkKICAgICAgICAgICAgaWYgKCJ4IiA9PT0gcikgcmV0dXJuIGQoZyhmLCAxNikpCiAgICAgICAgICAgIGlmICgiWCIgPT09IHIpIHJldHVybiBkKGcoZiwgMTYpKS50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAiZiIgPT09IHIgfHwKICAgICAgICAgICAgICAiRiIgPT09IHIgfHwKICAgICAgICAgICAgICAiZSIgPT09IHIgfHwKICAgICAgICAgICAgICAiRSIgPT09IHIgfHwKICAgICAgICAgICAgICAiZyIgPT09IHIgfHwKICAgICAgICAgICAgICAiRyIgPT09IHIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgZSA9IFNrLmJ1aWx0aW4uYXNudW0kKGYpCiAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBlICYmIChlID0gTnVtYmVyKGUpKQogICAgICAgICAgICAgIGlmIChJbmZpbml0eSA9PT0gZSkgcmV0dXJuICJpbmYiCiAgICAgICAgICAgICAgaWYgKC1JbmZpbml0eSA9PT0gZSkgcmV0dXJuICItaW5mIgogICAgICAgICAgICAgIGlmIChpc05hTihlKSkgcmV0dXJuICJuYW4iCiAgICAgICAgICAgICAgZyA9IFsidG9FeHBvbmVudGlhbCIsICJ0b0ZpeGVkIiwgInRvUHJlY2lzaW9uIl1bCiAgICAgICAgICAgICAgICAiZWZnIi5pbmRleE9mKHIudG9Mb3dlckNhc2UoKSkKICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gayB8fCAiIiA9PT0gaykKICAgICAgICAgICAgICAgIGlmICgiZSIgPT09IHIgfHwgIkUiID09PSByKSBrID0gNgogICAgICAgICAgICAgICAgZWxzZSBpZiAoImYiID09PSByIHx8ICJGIiA9PT0gcikKICAgICAgICAgICAgICAgICAgayA9IFNrLl9fZnV0dXJlX18ucHl0aG9uMyA/IDYgOiA3CiAgICAgICAgICAgICAgZyA9IGVbZ10oaykKICAgICAgICAgICAgICBTay5idWlsdGluLmNoZWNrRmxvYXQoZikgJiYKICAgICAgICAgICAgICAgIDAgPT09IGUgJiYKICAgICAgICAgICAgICAgIC1JbmZpbml0eSA9PT0gMSAvIGUgJiYKICAgICAgICAgICAgICAgIChnID0gIi0iICsgZykKICAgICAgICAgICAgICBTay5fX2Z1dHVyZV9fLnB5dGhvbjMgJiYKICAgICAgICAgICAgICAgICg3IDw9IGcubGVuZ3RoICYmCiAgICAgICAgICAgICAgICAgICIwLjAwMDAiID09IGcuc2xpY2UoMCwgNikgJiYKICAgICAgICAgICAgICAgICAgKChiID0gcGFyc2VGbG9hdChnKSksIChnID0gYi50b0V4cG9uZW50aWFsKCkpKSwKICAgICAgICAgICAgICAgICItIiA9PSBnLmNoYXJBdChnLmxlbmd0aCAtIDIpICYmCiAgICAgICAgICAgICAgICAgIChnID0gZy5zbGljZSgwLCBnLmxlbmd0aCAtIDEpICsgIjAiICsgZy5jaGFyQXQoZy5sZW5ndGggLSAxKSkpCiAgICAgICAgICAgICAgOy0xICE9PSAiRUZHIi5pbmRleE9mKHIpICYmIChnID0gZy50b1VwcGVyQ2FzZSgpKQogICAgICAgICAgICAgIHJldHVybiBkKFsiIiwgZ10pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCJjIiA9PT0gcikgewogICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGYpIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGYpCiAgICAgICAgICAgICAgaWYgKGYgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGYudikKICAgICAgICAgICAgICBpZiAoZiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZi52KQogICAgICAgICAgICAgIGlmIChmIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShmLnN0ciQoMTAsICExKVswXSkKICAgICAgICAgICAgICBpZiAoZi5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5zdHIpIHJldHVybiBmLnYuc3Vic3RyKDAsIDEpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoInIiID09PSByKQogICAgICAgICAgICAgIHJldHVybiAociA9IFNrLmJ1aWx0aW4ucmVwcihmKSksIGsgPyByLnYuc3Vic3RyKDAsIGspIDogci52CiAgICAgICAgICAgIGlmICgicyIgPT09IHIpIHsKICAgICAgICAgICAgICByID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGYpCiAgICAgICAgICAgICAgciA9IHIuJGpzc3RyKCkKICAgICAgICAgICAgICBpZiAoaykgcmV0dXJuIHIuc3Vic3RyKDAsIGspCiAgICAgICAgICAgICAgaCAmJiAociA9IGQoWyIgIiwgcl0pKQogICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCIlIiA9PT0gcikgcmV0dXJuICIlIgogICAgICAgICAgfSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihkKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyX2l0ZXJfID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cl9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyX2l0ZXJfKGEpCiAgICAgICAgdGhpcy4kaW5kZXggPSAwCiAgICAgICAgdGhpcy4kb2JqID0gYS52LnNsaWNlKCkKICAgICAgICB0aGlzLnNxJGxlbmd0aCA9IHRoaXMuJG9iai5sZW5ndGgKICAgICAgICB0aGlzLnRwJGl0ZXIgPSB0aGlzCiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCEodGhpcy4kaW5kZXggPj0gdGhpcy5zcSRsZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMuJG9iai5zdWJzdHIodGhpcy4kaW5kZXgrKywgMSkpCiAgICAgICAgfQogICAgICAgIHRoaXMuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIml0ZXJhdG9yIikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJpdGVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8sCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8ucHJvdG90eXBlLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uc3RyX2l0ZXJfCiAgICAgIFNrLmJ1aWx0aW4uc3RyX2l0ZXJfLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pdGVyX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMCwgITEpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8ucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSBhLnRwJGl0ZXJuZXh0KCkKICAgICAgICBpZiAodm9pZCAwID09PSBhKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uKCkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBtID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0ge30KICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKAogICAgICAgICAgImZvcm1hdCIsCiAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgMCwKICAgICAgICAgIEluZmluaXR5LAogICAgICAgICAgITAsCiAgICAgICAgICAhMCwKICAgICAgICApCiAgICAgICAgdmFyIGMgPSBuZXcgU2suYnVpbHRpbnMudHVwbGUoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkKICAgICAgICB2YXIgZCA9IG5ldyBTay5idWlsdGlucy5kaWN0KGEpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYXJndW1lbnRzWzFdKSByZXR1cm4gYy52CiAgICAgICAgdmFyIGUgPSAwCiAgICAgICAgaWYgKDAgIT09IGQuc2l6ZSkgewogICAgICAgICAgZCA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZW1zLCBbZF0pCiAgICAgICAgICBmb3IgKHZhciBmIGluIGQudikgYltkLnZbZl0udlswXS52XSA9IGQudltmXS52WzFdCiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGcgaW4gYy52KSAiMCIgIT09IGcgJiYgKGJbZyAtIDFdID0gYy52W2ddKQogICAgICAgIGMgPSBjLnZbMF0udi5yZXBsYWNlKAogICAgICAgICAgL3soKCg/OlxkKyl8KD86XHcrKSk/KCg/OlwuKFx3KykpfCg/OlxbKCg/OlxkKyl8KD86XHcrKSlcXSk/KSk/KD86IShbcnNdKSk/KD86OigoPzooLik/KFs8Pj1cXl0pKT8oW1wrXC1cc10pPygjKT8oMCk/KFxkKyk/KCwpPyg/OlwuKFxkKykpPyhbYmNkZUVmRmdHbm9zeFglXSk/KSk/fS9nLAogICAgICAgICAgZnVuY3Rpb24oYSwgYywgZCwgZywgZiwgcSwgbSwgeCwgcCwgSiwgQSwgQywgSywgQiwgUywgRywgeiwgUCwgVikgewogICAgICAgICAgICB2YXIgaywgbCwgaCwgcgogICAgICAgICAgICBCID0gU2suYnVpbHRpbi5hc251bSQoQikKICAgICAgICAgICAgRyA9IFNrLmJ1aWx0aW4uYXNudW0kKEcpCiAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHEgJiYgIiIgIT09IHEpIHsKICAgICAgICAgICAgICBhID0gYltkXQogICAgICAgICAgICAgIHZhciBuID0KICAgICAgICAgICAgICAgIGEuY29uc3RydWN0b3IgPT09IEFycmF5CiAgICAgICAgICAgICAgICAgID8gYVtxXQogICAgICAgICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QKICAgICAgICAgICAgICAgICAgPyBTay5hYnN0ci5vYmplY3RHZXRJdGVtKGEsIG5ldyBTay5idWlsdGluLnN0cihxKSwgITEpCiAgICAgICAgICAgICAgICAgIDogU2suYWJzdHIub2JqZWN0R2V0SXRlbSgKICAgICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5pbnRfKHBhcnNlSW50KHEsIDEwKSksCiAgICAgICAgICAgICAgICAgICAgICAhMSwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgZSsrCiAgICAgICAgICAgIH0gZWxzZSBpZiAodm9pZCAwICE9PSBmICYmICIiICE9PSBmKSAobiA9IGJbZF1bZl0pLCBlKysKICAgICAgICAgICAgZWxzZSBpZiAodm9pZCAwICE9PSBkICYmICIiICE9PSBkKSAobiA9IGJbZF0pLCBlKysKICAgICAgICAgICAgZWxzZSBpZiAodm9pZCAwID09PSBjIHx8ICIiID09PSBjKSAocSA9IGJbZV0pLCBlKyssIChuID0gcSkKICAgICAgICAgICAgZWxzZSBpZiAoCiAgICAgICAgICAgICAgYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgICAgIGMgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyB8fAogICAgICAgICAgICAgIGMgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgICAgICFpc05hTihwYXJzZUludChjLCAxMCkpCiAgICAgICAgICAgICkKICAgICAgICAgICAgICAocSA9IGJbY10pLCBlKyssIChuID0gcSkKICAgICAgICAgICAgIiIgPT09IEcgJiYgKEcgPSB2b2lkIDApCiAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IHAgfHwgIiIgPT09IHApIHAgPSAiICIKICAgICAgICAgICAgdmFyIEQgPSAoayA9IGwgPSBoID0gITEpCiAgICAgICAgICAgIHggJiYKICAgICAgICAgICAgICAodm9pZCAwICE9PSBBICYmCiAgICAgICAgICAgICAgICAiIiAhPT0gQSAmJgogICAgICAgICAgICAgICAgKC0xICE9PSAiLSIuaW5kZXhPZihBKQogICAgICAgICAgICAgICAgICA/IChoID0gITApCiAgICAgICAgICAgICAgICAgIDogLTEgIT09ICIrIi5pbmRleE9mKEEpCiAgICAgICAgICAgICAgICAgID8gKGsgPSAhMCkKICAgICAgICAgICAgICAgICAgOiAtMSAhPT0gIiAiLmluZGV4T2YoQSkgJiYgKGwgPSAhMCkpLAogICAgICAgICAgICAgIEMgJiYgKEQgPSAtMSAhPT0gIiMiLmluZGV4T2YoQykpLAogICAgICAgICAgICAgIHZvaWQgMCA9PT0gQiB8fAogICAgICAgICAgICAgICAgIiIgPT09IEIgfHwKICAgICAgICAgICAgICAgICh2b2lkIDAgIT09IHAgJiYgIiIgIT09IHApIHx8CiAgICAgICAgICAgICAgICAocCA9ICIgIiksCiAgICAgICAgICAgICAgLTEgIT09ICIlIi5pbmRleE9mKHopICYmIChyID0gITApKQogICAgICAgICAgICBHICYmIChHID0gcGFyc2VJbnQoRywgMTApKQogICAgICAgICAgICB2YXIgSCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBtIHx8ICIiID09PSBtIHx8ICJzIiA9PSBtKQogICAgICAgICAgICAgICAgcmV0dXJuIChhID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpKSwgYS52CiAgICAgICAgICAgICAgaWYgKCJyIiA9PSBtKSByZXR1cm4gKGEgPSBTay5idWlsdGluLnJlcHIoYSkpLCBhLnYKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgTiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICBiID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgICAgIHIgJiYgKGIgKz0gIiUiKQogICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IEIgJiYgIiIgIT09IEIpIHsKICAgICAgICAgICAgICAgIEIgPSBwYXJzZUludChCLCAxMCkKICAgICAgICAgICAgICAgIHZhciBjID0gYi5sZW5ndGggKyBhLmxlbmd0aAogICAgICAgICAgICAgICAgaWYgKGgpIGZvciAoOyBjIDwgQjsgKytjKSBiICs9IHAKICAgICAgICAgICAgICAgIGVsc2UgaWYgKC0xICE9PSAiPiIuaW5kZXhPZihKKSkgZm9yICg7IGMgPCBCOyArK2MpIGEgPSBwICsgYQogICAgICAgICAgICAgICAgZWxzZSBpZiAoLTEgIT09ICJeIi5pbmRleE9mKEopKQogICAgICAgICAgICAgICAgICBmb3IgKDsgYyA8IEI7ICsrYykKICAgICAgICAgICAgICAgICAgICAwID09PSBjICUgMiA/IChhID0gcCArIGEpIDogMSA9PT0gYyAlIDIgJiYgKGIgKz0gcCkKICAgICAgICAgICAgICAgIGVsc2UgaWYgKC0xICE9PSAiPSIuaW5kZXhPZihKKSkgZm9yICg7IGMgPCBCOyArK2MpIGIgPSBwICsgYgogICAgICAgICAgICAgICAgZWxzZSBmb3IgKDsgYyA8IEI7ICsrYykgYiArPSBwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBIKGEgKyBiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEEgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgICAgICAgdmFyIGMgPSAhMQogICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IHgpIHJldHVybiBIKG4pCiAgICAgICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSkgewogICAgICAgICAgICAgICAgMCA+IGEgJiYgKChhID0gLWEpLCAoYyA9ICEwKSkKICAgICAgICAgICAgICAgIHZhciBkID0gYS50b1N0cmluZyhiKQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICAgICAgICAgID8gKChkID0gYS5zdHIkKGIsICExKSksCiAgICAgICAgICAgICAgICAgICAgMiA8IGQubGVuZ3RoICYmCiAgICAgICAgICAgICAgICAgICAgICAiLjAiID09PSBkLnN1YnN0cigtMikgJiYKICAgICAgICAgICAgICAgICAgICAgIChkID0gZC5zdWJzdHIoMCwgZC5sZW5ndGggLSAyKSksCiAgICAgICAgICAgICAgICAgICAgKGMgPSBhLm5iJGlzbmVnYXRpdmUoKSkpCiAgICAgICAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XwogICAgICAgICAgICAgICAgICA/ICgoZCA9IGEuc3RyJChiLCAhMSkpLCAoYyA9IGEubmIkaXNuZWdhdGl2ZSgpKSkKICAgICAgICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgICAgICAgICAgPyAoKGQgPSBhLnN0ciQoYiwgITEpKSwgKGMgPSBhLm5iJGlzbmVnYXRpdmUoKSkpCiAgICAgICAgICAgICAgICAgIDogKGQgPSBhKQogICAgICAgICAgICAgIEcgJiYKICAgICAgICAgICAgICAgICgoYSA9IE51bWJlcihkKSksCiAgICAgICAgICAgICAgICAwID4gYSAmJiAoKGEgPSAtYSksIChjID0gITApKSwKICAgICAgICAgICAgICAgIChkID0gYS50b0ZpeGVkKEcpKSkKICAgICAgICAgICAgICBhID0gIiIKICAgICAgICAgICAgICBjID8gKGEgPSAiLSIpIDogayA/IChhID0gIisiKSA6IGwgJiYgKGEgPSAiICIpCiAgICAgICAgICAgICAgRCAmJgogICAgICAgICAgICAgICAgKDE2ID09PSBiCiAgICAgICAgICAgICAgICAgID8gKGEgKz0gIjB4IikKICAgICAgICAgICAgICAgICAgOiA4ID09PSBiICYmICIwIiAhPT0gZAogICAgICAgICAgICAgICAgICA/IChhICs9ICIwbyIpCiAgICAgICAgICAgICAgICAgIDogMiA9PT0gYiAmJiAiMCIgIT09IGQgJiYgKGEgKz0gIjBiIikpCiAgICAgICAgICAgICAgIm4iID09PSB6CiAgICAgICAgICAgICAgICA/IChkID0gZC50b0xvY2FsZVN0cmluZygpKQogICAgICAgICAgICAgICAgOiAtMSAhPT0gIiwiLmluZGV4T2YoUykgJiYKICAgICAgICAgICAgICAgICAgKChiID0gZC50b1N0cmluZygpLnNwbGl0KCIuIikpLAogICAgICAgICAgICAgICAgICAoYlswXSA9IGJbMF0ucmVwbGFjZSgvXEIoPz0oXGR7M30pKyg/IVxkKSkvZywgIiwiKSksCiAgICAgICAgICAgICAgICAgIChkID0gYi5qb2luKCIuIikpKQogICAgICAgICAgICAgIHJldHVybiBOKGEsIGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCJkIiA9PT0geiB8fCAibiIgPT09IHogfHwgIiIgPT09IHogfHwgdm9pZCAwID09PSB6KQogICAgICAgICAgICAgIHJldHVybiBBKG4sIDEwKQogICAgICAgICAgICBpZiAoImIiID09PSB6KSByZXR1cm4gQShuLCAyKQogICAgICAgICAgICBpZiAoIm8iID09PSB6KSByZXR1cm4gQShuLCA4KQogICAgICAgICAgICBpZiAoIngiID09PSB6KSByZXR1cm4gQShuLCAxNikKICAgICAgICAgICAgaWYgKCJYIiA9PT0geikgcmV0dXJuIEEobiwgMTYpLnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICJmIiA9PT0geiB8fAogICAgICAgICAgICAgICJGIiA9PT0geiB8fAogICAgICAgICAgICAgICJlIiA9PT0geiB8fAogICAgICAgICAgICAgICJFIiA9PT0geiB8fAogICAgICAgICAgICAgICJnIiA9PT0geiB8fAogICAgICAgICAgICAgICJHIiA9PT0gegogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBpZiAoRCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAgICJBbHRlcm5hdGUgZm9ybSAoIykgbm90IGFsbG93ZWQgaW4gZmxvYXQgZm9ybWF0IHNwZWNpZmllciIsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgcSA9IFNrLmJ1aWx0aW4uYXNudW0kKG4pCiAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBxICYmIChxID0gTnVtYmVyKHEpKQogICAgICAgICAgICAgIGlmIChJbmZpbml0eSA9PT0gcSkgcmV0dXJuIE4oIiIsICJpbmYiKQogICAgICAgICAgICAgIGlmICgtSW5maW5pdHkgPT09IHEpIHJldHVybiBOKCItIiwgImluZiIpCiAgICAgICAgICAgICAgaWYgKGlzTmFOKHEpKSByZXR1cm4gTigiIiwgIm5hbiIpCiAgICAgICAgICAgICAgQyA9IFsidG9FeHBvbmVudGlhbCIsICJ0b0ZpeGVkIiwgInRvUHJlY2lzaW9uIl1bCiAgICAgICAgICAgICAgICAiZWZnIi5pbmRleE9mKHoudG9Mb3dlckNhc2UoKSkKICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gRyB8fCAiIiA9PT0gRykKICAgICAgICAgICAgICAgIGlmICgiZSIgPT09IHogfHwgIkUiID09PSB6IHx8ICIlIiA9PT0geikgRyA9IDYKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCJmIiA9PT0geiB8fCAiRiIgPT09IHopIEcgPSA2CiAgICAgICAgICAgICAgQyA9IHFbQ10oRykKICAgICAgICAgICAgICA7LTEgIT09ICJFRkciLmluZGV4T2YoeikgJiYgKEMgPSBDLnRvVXBwZXJDYXNlKCkpCiAgICAgICAgICAgICAgcmV0dXJuIEEoQywgMTApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCJjIiA9PT0geikgewogICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIG4pIHJldHVybiBOKCIiLCBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pKQogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIG4gaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgICAgICAgIG4gaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiBOKCIiLCBTdHJpbmcuZnJvbUNoYXJDb2RlKG4udikpCiAgICAgICAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgICAgICAgIHJldHVybiBOKCIiLCBTdHJpbmcuZnJvbUNoYXJDb2RlKG4uc3RyJCgxMCwgITEpWzBdKSkKICAgICAgICAgICAgICBpZiAobi5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5zdHIpCiAgICAgICAgICAgICAgICByZXR1cm4gTigiIiwgbi52LnN1YnN0cigwLCAxKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImFuIGludGVnZXIgaXMgcmVxdWlyZWQiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyKQogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICB2b2lkIDAgPT09IEcgJiYgKEcgPSA3KSwKICAgICAgICAgICAgICAgIEEobi5uYiRtdWx0aXBseShuZXcgU2suYnVpbHRpbi5pbnRfKDEwMCkpLCAxMCkKICAgICAgICAgICAgICApCiAgICAgICAgICB9LAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGMpCiAgICAgIH0KICAgICAgbS5jb19rd2FyZ3MgPSAhMAogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuZm9ybWF0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhtKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi50dXBsZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSkKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInR1cGxlIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMSksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnR1cGxlKGEpCiAgICAgICAgICApCiAgICAgICAgdm9pZCAwID09PSBhICYmIChhID0gW10pCiAgICAgICAgaWYgKCJbb2JqZWN0IEFycmF5XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkoYSkpIHRoaXMudiA9IGEKICAgICAgICBlbHNlIGlmIChTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpIHsKICAgICAgICAgIHRoaXMudiA9IFtdCiAgICAgICAgICB2YXIgYyA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICAgIGZvciAoYiA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgICB0aGlzLnYucHVzaChiKQogICAgICAgIH0gZWxzZSB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImV4cGVjdGluZyBBcnJheSBvciBpdGVyYWJsZSIpCiAgICAgICAgdGhpcy5fX2NsYXNzX18gPSBTay5idWlsdGluLnR1cGxlCiAgICAgICAgdGhpcy52ID0gdGhpcy52CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJ0dXBsZSIsIFNrLmJ1aWx0aW4udHVwbGUsIFNrLmJ1aWx0aW4uc2VxdHlwZSkKICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYQogICAgICAgIGlmICgwID09PSB0aGlzLnYubGVuZ3RoKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCIoKSIpCiAgICAgICAgdmFyIGIgPSBbXQogICAgICAgIGZvciAoYSA9IDA7IGEgPCB0aGlzLnYubGVuZ3RoOyArK2EpCiAgICAgICAgICBiW2FdID0gU2subWlzY2V2YWwub2JqZWN0UmVwcih0aGlzLnZbYV0pLnYKICAgICAgICBhID0gYi5qb2luKCIsICIpCiAgICAgICAgMSA9PT0gdGhpcy52Lmxlbmd0aCAmJiAoYSArPSAiLCIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiKCIgKyBhICsgIikiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLm1wJHN1YnNjcmlwdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChhKSkgewogICAgICAgICAgdmFyIGIgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBiKSB7CiAgICAgICAgICAgIDAgPiBiICYmIChiID0gdGhpcy52Lmxlbmd0aCArIGIpCiAgICAgICAgICAgIGlmICgwID4gYiB8fCBiID49IHRoaXMudi5sZW5ndGgpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSW5kZXhFcnJvcigidHVwbGUgaW5kZXggb3V0IG9mIHJhbmdlIikKICAgICAgICAgICAgcmV0dXJuIHRoaXMudltiXQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc2xpY2UpIHsKICAgICAgICAgIHZhciBjID0gW10KICAgICAgICAgIGEuc3NzaXRlciQodGhpcywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBjLnB1c2goYi52W2FdKQogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShjKQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidHVwbGUgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gMTAwMDAwMywKICAgICAgICAgIGMgPSAzNDMwMDA4LAogICAgICAgICAgZCA9IHRoaXMudi5sZW5ndGgKICAgICAgICBmb3IgKGEgPSAwOyBhIDwgZDsgKythKSB7CiAgICAgICAgICB2YXIgZSA9IFNrLmJ1aWx0aW4uaGFzaCh0aGlzLnZbYV0pLnYKICAgICAgICAgIGlmICgtMSA9PT0gZSkgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oLTEpCiAgICAgICAgICBjID0gKGMgXiBlKSAqIGIKICAgICAgICAgIGIgKz0gODI1MjAgKyBkICsgZAogICAgICAgIH0KICAgICAgICBjICs9IDk3NTMxCiAgICAgICAgOy0xID09PSBjICYmIChjID0gLTIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYyB8IDApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuc3EkcmVwZWF0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgYSA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYSkKICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGE7ICsrYykKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCB0aGlzLnYubGVuZ3RoOyArK2IpIGQucHVzaCh0aGlzLnZbYl0pCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKGQpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUubmIkbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJHJlcGVhdAogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5uYiRpbnBsYWNlX211bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5zcSRyZXBlYXQKICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2l0ZXJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlX2l0ZXJfKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnRwJGl0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGVfaXRlcl8odGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS50cCRyaWNoY29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGlmICgKICAgICAgICAgICFhLl9fY2xhc3NfXyB8fAogICAgICAgICAgIVNrLm1pc2NldmFsLmlzVHJ1ZShTay5idWlsdGluLmlzaW5zdGFuY2UoYSwgU2suYnVpbHRpbi50dXBsZSkpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuICJFcSIgPT09IGIKICAgICAgICAgICAgPyAhMQogICAgICAgICAgICA6ICJOb3RFcSIgPT09IGIKICAgICAgICAgICAgPyAhMAogICAgICAgICAgICA6IFNrLl9fZnV0dXJlX18ucHl0aG9uMwogICAgICAgICAgICA/IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgICAgICAgIDogITEKICAgICAgICB2YXIgZCA9IHRoaXMudgogICAgICAgIGEgPSBhLnYKICAgICAgICB2YXIgZSA9IGQubGVuZ3RoCiAgICAgICAgdmFyIGYgPSBhLmxlbmd0aAogICAgICAgIGZvciAoYyA9IDA7IGMgPCBlICYmIGMgPCBmOyArK2MpIHsKICAgICAgICAgIHZhciBnID0gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGRbY10sIGFbY10sICJFcSIpCiAgICAgICAgICBpZiAoIWcpIGJyZWFrCiAgICAgICAgfQogICAgICAgIGlmIChjID49IGUgfHwgYyA+PSBmKQogICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgICByZXR1cm4gZSA8IGYKICAgICAgICAgICAgY2FzZSAiTHRFIjoKICAgICAgICAgICAgICByZXR1cm4gZSA8PSBmCiAgICAgICAgICAgIGNhc2UgIkVxIjoKICAgICAgICAgICAgICByZXR1cm4gZSA9PT0gZgogICAgICAgICAgICBjYXNlICJOb3RFcSI6CiAgICAgICAgICAgICAgcmV0dXJuIGUgIT09IGYKICAgICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICAgIHJldHVybiBlID4gZgogICAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICAgIHJldHVybiBlID49IGYKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoKQogICAgICAgICAgfQogICAgICAgIHJldHVybiAiRXEiID09PSBiCiAgICAgICAgICA/ICExCiAgICAgICAgICA6ICJOb3RFcSIgPT09IGIKICAgICAgICAgID8gITAKICAgICAgICAgIDogU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGRbY10sIGFbY10sIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuc3EkY29uY2F0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhLl9fY2xhc3NfXyAhPSBTay5idWlsdGluLnR1cGxlKQogICAgICAgICAgdGhyb3cgKChhID0KICAgICAgICAgICAgJ2NhbiBvbmx5IGNvbmNhdGVuYXRlIHR1cGxlIChub3QgIicgKwogICAgICAgICAgICAoU2suYWJzdHIudHlwZU5hbWUoYSkgKyAnIikgdG8gdHVwbGUnKSksCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoYSkpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKHRoaXMudi5jb25jYXQoYS52KSkKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5zcSRjb250YWlucyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIHZhciBjID0gdGhpcy50cCRpdGVyKCkKICAgICAgICBmb3IgKGIgPSBjLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGMudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGlmIChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYiwgYSwgIkVxIikpIHJldHVybiAhMAogICAgICAgIHJldHVybiAhMQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLm5iJGFkZCA9IFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJGNvbmNhdAogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9CiAgICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuc3EkY29uY2F0CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJGxlbmd0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnYubGVuZ3RoCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuaW5kZXggPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEudi5sZW5ndGgsCiAgICAgICAgICBkID0gYS52CiAgICAgICAgZm9yIChhID0gMDsgYSA8IGM7ICsrYSkKICAgICAgICAgIGlmIChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZFthXSwgYiwgIkVxIikpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigidHVwbGUuaW5kZXgoeCk6IHggbm90IGluIHR1cGxlIikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuY291bnQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEudi5sZW5ndGgsCiAgICAgICAgICBkID0gYS52LAogICAgICAgICAgZSA9IDAKICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYzsgKythKQogICAgICAgICAgU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGRbYV0sIGIsICJFcSIpICYmIChlICs9IDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oZSkKICAgICAgfSkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLnR1cGxlIiwgU2suYnVpbHRpbi50dXBsZSkKICAgICAgU2suYnVpbHRpbi50dXBsZV9pdGVyXyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi50dXBsZV9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGVfaXRlcl8oYSkKICAgICAgICB0aGlzLiRpbmRleCA9IDAKICAgICAgICB0aGlzLiRvYmogPSBhLnYuc2xpY2UoKQogICAgICAgIHRoaXMuc3EkbGVuZ3RoID0gdGhpcy4kb2JqLmxlbmd0aAogICAgICAgIHRoaXMudHAkaXRlciA9IHRoaXMKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoISh0aGlzLiRpbmRleCA+PSB0aGlzLnNxJGxlbmd0aCkpIHJldHVybiB0aGlzLiRvYmpbdGhpcy4kaW5kZXgrK10KICAgICAgICB9CiAgICAgICAgdGhpcy4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigidHVwbGVpdGVyYXRvciIpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAidHVwbGVpdGVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi50dXBsZV9pdGVyXywKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLnR1cGxlX2l0ZXJfLnByb3RvdHlwZS5fX2NsYXNzX18gPSBTay5idWlsdGluLnR1cGxlX2l0ZXJfCiAgICAgIFNrLmJ1aWx0aW4udHVwbGVfaXRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICApIHsKICAgICAgICByZXR1cm4gYQogICAgICB9KQogICAgICBTay5idWlsdGluLnR1cGxlX2l0ZXJfLnByb3RvdHlwZS5uZXh0JCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhID0gYS50cCRpdGVybmV4dCgpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbigpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5kaWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBkCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZGljdCkpIHJldHVybiBuZXcgU2suYnVpbHRpbi5kaWN0KGEpCiAgICAgICAgdm9pZCAwID09PSBhICYmIChhID0gW10pCiAgICAgICAgdGhpcy5zaXplID0gMAogICAgICAgIHRoaXMuYnVja2V0cyA9IHt9CiAgICAgICAgaWYgKCJbb2JqZWN0IEFycmF5XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkoYSkpCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIgKz0gMikKICAgICAgICAgICAgdGhpcy5tcCRhc3Nfc3Vic2NyaXB0KGFbYl0sIGFbYiArIDFdKQogICAgICAgIGVsc2UgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QpIHsKICAgICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgICAgZm9yIChkID0gZS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBlLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAgIChiID0gYS5tcCRzdWJzY3JpcHQoZCkpLAogICAgICAgICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IG51bGwpLAogICAgICAgICAgICAgIHRoaXMubXAkYXNzX3N1YnNjcmlwdChkLCBiKQogICAgICAgIH0gZWxzZSBpZiAoU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZSA9IFNrLmFic3RyLml0ZXIoYSksIGIgPSBlLnRwJGl0ZXJuZXh0KCk7CiAgICAgICAgICAgIHZvaWQgMCAhPT0gYjsKICAgICAgICAgICAgYiA9IGUudHAkaXRlcm5leHQoKQogICAgICAgICAgKQogICAgICAgICAgICBpZiAoYi5tcCRzdWJzY3JpcHQpCiAgICAgICAgICAgICAgdGhpcy5tcCRhc3Nfc3Vic2NyaXB0KGIubXAkc3Vic2NyaXB0KDApLCBiLm1wJHN1YnNjcmlwdCgxKSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICJlbGVtZW50ICIgKyB0aGlzLnNpemUgKyAiIGlzIG5vdCBhIHNlcXVlbmNlIiwKICAgICAgICAgICAgICApCiAgICAgICAgZWxzZSB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIm9iamVjdCBpcyBub3QgaXRlcmFibGUiKQogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5kaWN0CiAgICAgICAgdGhpcy50cCRjYWxsID0gdm9pZCAwCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QudHAkY2FsbCA9IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImRpY3QiLCBhLCAwLCAxKQogICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5kaWN0KGFbMF0pCiAgICAgICAgaWYgKGMpCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYy5sZW5ndGg7IGIgKz0gMikKICAgICAgICAgICAgYS5tcCRhc3Nfc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnN0cihjW2JdKSwgY1tiICsgMV0pCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJkaWN0IiwgU2suYnVpbHRpbi5kaWN0LCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYWJzdHIubWFya1VuaGFzaGFibGUoU2suYnVpbHRpbi5kaWN0KQogICAgICB2YXIgYSA9IFNrLmJ1aWx0aW4uaGFzaAogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLmtleSRsb29rdXAgPSBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgdmFyIGIsIGUKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYS5pdGVtcy5sZW5ndGg7IGUrKykgewogICAgICAgICAgdmFyIGYgPSBhLml0ZW1zW2VdCiAgICAgICAgICBpZiAoKGIgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZi5saHMsIGMsICJFcSIpKSkgcmV0dXJuIGYKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGwKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLmtleSRwb3AgPSBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgdmFyIGIsIGUKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYS5pdGVtcy5sZW5ndGg7IGUrKykgewogICAgICAgICAgdmFyIGYgPSBhLml0ZW1zW2VdCiAgICAgICAgICBpZiAoKGIgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZi5saHMsIGMsICJFcSIpKSkKICAgICAgICAgICAgcmV0dXJuIGEuaXRlbXMuc3BsaWNlKGUsIDEpLCAtLXRoaXMuc2l6ZSwgZgogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm1wJGxvb2t1cCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB2YXIgYyA9IGEoYikKICAgICAgICBjID0gdGhpcy5idWNrZXRzW2Mudl0KICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmIChiID0gdGhpcy5rZXkkbG9va3VwKGMsIGIpKSkgcmV0dXJuIGIucmhzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5tcCRzdWJzY3JpcHQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiW10iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITEpCiAgICAgICAgdmFyIGIgPSB0aGlzLm1wJGxvb2t1cChhKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHJldHVybiBiCiAgICAgICAgYiA9IG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLktleUVycm9yKGIudikKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnNxJGNvbnRhaW5zID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT09IHRoaXMubXAkbG9va3VwKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5tcCRhc3Nfc3Vic2NyaXB0ID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgIHZhciBkID0gYShiKSwKICAgICAgICAgIGUgPSB0aGlzLmJ1Y2tldHNbZC52XQogICAgICAgIHZvaWQgMCA9PT0gZQogICAgICAgICAgPyAoKGUgPSB7ICRoYXNoOiBkLCBpdGVtczogW3sgbGhzOiBiLCByaHM6IGMgfV0gfSksCiAgICAgICAgICAgICh0aGlzLmJ1Y2tldHNbZC52XSA9IGUpLAogICAgICAgICAgICAodGhpcy5zaXplICs9IDEpKQogICAgICAgICAgOiAoZCA9IHRoaXMua2V5JGxvb2t1cChlLCBiKSkKICAgICAgICAgID8gKGQucmhzID0gYykKICAgICAgICAgIDogKGUuaXRlbXMucHVzaCh7IGxoczogYiwgcmhzOiBjIH0pLCAodGhpcy5zaXplICs9IDEpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkZGVsX3N1YnNjcmlwdCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJkZWwiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITEpCiAgICAgICAgdmFyIGMgPSBhKGIpCiAgICAgICAgYyA9IHRoaXMuYnVja2V0c1tjLnZdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYyAmJiAoKGMgPSB0aGlzLmtleSRwb3AoYywgYikpLCB2b2lkIDAgIT09IGMpKSByZXR1cm4KICAgICAgICBjID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uS2V5RXJyb3IoYy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGMgPSBbXQogICAgICAgIHZhciBkID0gU2suYWJzdHIuaXRlcih0aGlzKQogICAgICAgIGZvciAoYSA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBhOyBhID0gZC50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICB2YXIgZSA9IHRoaXMubXAkc3Vic2NyaXB0KGEpCiAgICAgICAgICB2b2lkIDAgPT09IGUgJiYgKGUgPSBudWxsKQogICAgICAgICAgZSA9PT0gdGhpcwogICAgICAgICAgICA/IGMucHVzaChTay5taXNjZXZhbC5vYmplY3RSZXByKGEpLnYgKyAiOiB7Li4ufSIpCiAgICAgICAgICAgIDogYy5wdXNoKAogICAgICAgICAgICAgICAgU2subWlzY2V2YWwub2JqZWN0UmVwcihhKS52ICsKICAgICAgICAgICAgICAgICAgIjogIiArCiAgICAgICAgICAgICAgICAgIFNrLm1pc2NldmFsLm9iamVjdFJlcHIoZSkudiwKICAgICAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoInsiICsgYy5qb2luKCIsICIpICsgIn0iKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkbGVuZ3RoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuZ2V0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBjLCBkKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZ2V0KCkiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITApCiAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgIHZhciBiID0gYS5tcCRsb29rdXAoYykKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBkKQogICAgICAgIHJldHVybiBiCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUucG9wID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicG9wKCkiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITApCiAgICAgICAgdmFyIGUgPSBhKGMpCiAgICAgICAgZSA9IGIuYnVja2V0c1tlLnZdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZSAmJiAoKGUgPSBiLmtleSRwb3AoZSwgYykpLCB2b2lkIDAgIT09IGUpKSByZXR1cm4gZS5yaHMKICAgICAgICBpZiAodm9pZCAwICE9PSBkKSByZXR1cm4gZAogICAgICAgIGUgPSBuZXcgU2suYnVpbHRpbi5zdHIoYykKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5LZXlFcnJvcihlLnYpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuaGFzX2tleSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImhhc19rZXkoKSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbChhLnNxJGNvbnRhaW5zKGMpKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZW1zID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXRlbXMoKSIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICB2YXIgYiwKICAgICAgICAgIGQgPSBbXQogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZS50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICB2YXIgZiA9IGEubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgICB2b2lkIDAgPT09IGYgJiYgKGYgPSBudWxsKQogICAgICAgICAgZC5wdXNoKG5ldyBTay5idWlsdGluLnR1cGxlKFtiLCBmXSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUua2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImtleXMoKSIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICB2YXIgYiwKICAgICAgICAgIGQgPSBbXQogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZS50cCRpdGVybmV4dCgpKSBkLnB1c2goYikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChkKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnZhbHVlcyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInZhbHVlcygpIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHZhciBiLAogICAgICAgICAgZCA9IFtdCiAgICAgICAgdmFyIGUgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gZS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBlLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAoYiA9IGEubXAkc3Vic2NyaXB0KGIpKSwgdm9pZCAwID09PSBiICYmIChiID0gbnVsbCksIGQucHVzaChiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuY2xlYXIgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjbGVhcigpIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHZhciBiCiAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gZC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBkLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBhLm1wJGRlbF9zdWJzY3JpcHQoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5zZXRkZWZhdWx0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBhLm1wJHN1YnNjcmlwdChjKQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIHZvaWQgMCA9PT0gZCAmJiAoZCA9IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCksCiAgICAgICAgICAgIGEubXAkYXNzX3N1YnNjcmlwdChjLCBkKSwKICAgICAgICAgICAgZAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5kaWN0X21lcmdlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QpIHsKICAgICAgICAgIHZhciBkID0gYS50cCRpdGVyKCkKICAgICAgICAgIGZvciAoYiA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZC50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICAgIHZhciBlID0gYS5tcCRzdWJzY3JpcHQoYikKICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgICAgICJjYW5ub3QgZ2V0IGl0ZW0gZm9yIGtleTogIiArIGIudiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHRoaXMubXAkYXNzX3N1YnNjcmlwdChiLCBlKQogICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZCA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLmtleXMsIFthXSksCiAgICAgICAgICAgICAgZCA9IFNrLmFic3RyLml0ZXIoZCksCiAgICAgICAgICAgICAgYiA9IGQudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgdm9pZCAwICE9PSBiOwogICAgICAgICAgICBiID0gZC50cCRpdGVybmV4dCgpCiAgICAgICAgICApIHsKICAgICAgICAgICAgZSA9IGEudHAkZ2V0aXRlbShiKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBlKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgICAgImNhbm5vdCBnZXQgaXRlbSBmb3Iga2V5OiAiICsgYi52LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgdGhpcy5tcCRhc3Nfc3Vic2NyaXB0KGIsIGUpCiAgICAgICAgICB9CiAgICAgIH0KICAgICAgbSA9IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmICgiZGljdCIgPT09IGQudHAkbmFtZSB8fCBkLmtleXMpKSBjLmRpY3RfbWVyZ2UoZCkKICAgICAgICBlbHNlIGlmICh2b2lkIDAgIT09IGQgJiYgU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGQpKSB7CiAgICAgICAgICB2YXIgYiwKICAgICAgICAgICAgZiA9IDAKICAgICAgICAgIGQgPSBTay5hYnN0ci5pdGVyKGQpCiAgICAgICAgICBmb3IgKGIgPSBkLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGQudHAkaXRlcm5leHQoKSwgZisrKSB7CiAgICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGIpKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICJjYW5ub3QgY29udmVydCBkaWN0aW9uYXJ5IHVwZGF0ZSBzZXF1ZW5jZSBlbGVtZW50ICMiICsKICAgICAgICAgICAgICAgICAgZiArCiAgICAgICAgICAgICAgICAgICIgdG8gYSBzZXF1ZW5jZSIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAoMiA9PT0gYi5zcSRsZW5ndGgoKSkgewogICAgICAgICAgICAgIHZhciBnID0gU2suYWJzdHIuaXRlcihiKQogICAgICAgICAgICAgIGIgPSBnLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICAgICBnID0gZy50cCRpdGVybmV4dCgpCiAgICAgICAgICAgICAgYy5tcCRhc3Nfc3Vic2NyaXB0KGIsIGcpCiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAiZGljdGlvbmFyeSB1cGRhdGUgc2VxdWVuY2UgZWxlbWVudCAjIiArCiAgICAgICAgICAgICAgICAgIGYgKwogICAgICAgICAgICAgICAgICAiIGhhcyBsZW5ndGggIiArCiAgICAgICAgICAgICAgICAgIGIuc3EkbGVuZ3RoKCkgKwogICAgICAgICAgICAgICAgICAiOyAyIGlzIHJlcXVpcmVkIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh2b2lkIDAgIT09IGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGQpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgYSA9IG5ldyBTay5idWlsdGlucy5kaWN0KGEpCiAgICAgICAgYy5kaWN0X21lcmdlKGEpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9CiAgICAgIG0uY29fa3dhcmdzID0gITAKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS51cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKG0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19jb250YWluc19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fY29udGFpbnNfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woYS5zcSRjb250YWlucyhjKSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5fX2NtcF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19kZWxpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19kZWxpdGVtX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkZGVsX3N1YnNjcmlwdC5jYWxsKGEsIGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19nZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19nZXRpdGVtX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkc3Vic2NyaXB0LmNhbGwoYSwgYykKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5fX3NldGl0ZW1fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIGQsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fc2V0aXRlbV9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMiwgITEsICEwKQogICAgICAgIHJldHVybiBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm1wJGFzc19zdWJzY3JpcHQuY2FsbChhLCBjLCBkKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLl9faGFzaF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19oYXNoX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUudHAkaGFzaC5jYWxsKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19sZW5fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbGVuX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkbGVuZ3RoLmNhbGwoYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5fX2dldGF0dHJpYnV0ZV9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oCiAgICAgICAgICAiX19nZXRhdHRyaWJ1dGVfXyIsCiAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgMSwKICAgICAgICAgIDEsCiAgICAgICAgICAhMSwKICAgICAgICAgICEwLAogICAgICAgICkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZ2V0YXR0cmlidXRlX18gcmVxdWlyZXMgYSBzdHJpbmciKQogICAgICAgIHJldHVybiBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnRwJGdldGF0dHIuY2FsbChhLCBjKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pdGVyX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmRpY3RfaXRlcl8oYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmRpY3RfaXRlcl8odGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLl9fcmVwcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yZXByX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuJHIuY2FsbChhKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm9iJGVxID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKHRoaXMgPT09IGEpIHJldHVybiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICBpZiAoIShhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5kaWN0KSkKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgIGlmICh0aGlzLnNpemUgIT09IGEuc2l6ZSkgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICB2YXIgZCA9IHRoaXMudHAkaXRlcigpCiAgICAgICAgZm9yIChiID0gZC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBkLnRwJGl0ZXJuZXh0KCkpIHsKICAgICAgICAgIHZhciBlID0gdGhpcy5tcCRzdWJzY3JpcHQoYikKICAgICAgICAgIGIgPSBhLm1wJHN1YnNjcmlwdChiKQogICAgICAgICAgaWYgKCFTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZSwgYiwgIkVxIikpCiAgICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm9iJG5lID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSB0aGlzLm9iJGVxKGEpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkCiAgICAgICAgICA/IGEKICAgICAgICAgIDogYS52CiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5jb3B5ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY29weSIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICB2YXIgYiwKICAgICAgICAgIGQgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZS50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICB2YXIgZiA9IGEubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgICB2b2lkIDAgPT09IGYgJiYgKGYgPSBudWxsKQogICAgICAgICAgZC5tcCRhc3Nfc3Vic2NyaXB0KGIsIGYpCiAgICAgICAgfQogICAgICAgIHJldHVybiBkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC4kZnJvbWtleXMgPSBmdW5jdGlvbihhLCBjLCBkKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QpIHsKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImZyb21rZXlzIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMiwgITEsICEwKQogICAgICAgICAgdmFyIGIgPSBhCiAgICAgICAgICB2YXIgZiA9IGMKICAgICAgICAgIHZhciBnID0gdm9pZCAwID09PSBkID8gU2suYnVpbHRpbi5ub25lLm5vbmUkIDogZAogICAgICAgIH0gZWxzZQogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZnJvbWtleXMiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITEpLAogICAgICAgICAgICAoYiA9IG5ldyBTay5idWlsdGluLmRpY3QoW10pKSwKICAgICAgICAgICAgKGYgPSBhKSwKICAgICAgICAgICAgKGcgPSB2b2lkIDAgPT09IGMgPyBTay5idWlsdGluLm5vbmUubm9uZSQgOiBjKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGYpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShmKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIHZhciBoID0gU2suYWJzdHIuaXRlcihmKQogICAgICAgIGZvciAoZiA9IGgudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBmOyBmID0gaC50cCRpdGVybmV4dCgpKQogICAgICAgICAgYi5tcCRhc3Nfc3Vic2NyaXB0KGYsIGcpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZXJpdGVtcyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC5pdGVyaXRlbXMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBTa3VscHQiLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5pdGVya2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC5pdGVya2V5cyBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZXJ2YWx1ZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImRpY3QuaXRlcnZhbHVlcyBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnBvcGl0ZW0gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImRpY3QucG9waXRlbSBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnZpZXdpdGVtcyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC52aWV3aXRlbXMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBTa3VscHQiLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS52aWV3a2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC52aWV3a2V5cyBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnZpZXd2YWx1ZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImRpY3Qudmlld3ZhbHVlcyBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uZGljdCIsIFNrLmJ1aWx0aW4uZGljdCkKICAgICAgU2suYnVpbHRpbi5kaWN0X2l0ZXJfID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBkCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZGljdF9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZGljdF9pdGVyXyhhKQogICAgICAgIHRoaXMuJGluZGV4ID0gMAogICAgICAgIHRoaXMuJG9iaiA9IGEKICAgICAgICB2YXIgZSA9IFtdCiAgICAgICAgdmFyIGYgPSBhLmJ1Y2tldHMKICAgICAgICBmb3IgKGIgaW4gZikKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZi5oYXNPd25Qcm9wZXJ0eShiKSAmJgogICAgICAgICAgICAoZCA9IGZbYl0pICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gZC4kaGFzaCAmJgogICAgICAgICAgICB2b2lkIDAgIT09IGQuaXRlbXMKICAgICAgICAgICkKICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGQuaXRlbXMubGVuZ3RoOyBhKyspIGUucHVzaChkLml0ZW1zW2FdLmxocykKICAgICAgICB0aGlzLiRrZXlzID0gZQogICAgICAgIHRoaXMudHAkaXRlciA9IHRoaXMKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoISh0aGlzLiRpbmRleCA+PSB0aGlzLiRrZXlzLmxlbmd0aCkpCiAgICAgICAgICAgIHJldHVybiB0aGlzLiRrZXlzW3RoaXMuJGluZGV4KytdCiAgICAgICAgfQogICAgICAgIHRoaXMuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoImRpY3Rpb25hcnkta2V5aXRlcmF0b3IiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgImRpY3Rpb25hcnkta2V5aXRlcmF0b3IiLAogICAgICAgIFNrLmJ1aWx0aW4uZGljdF9pdGVyXywKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLmRpY3RfaXRlcl8ucHJvdG90eXBlLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uZGljdF9pdGVyXwogICAgICBTay5idWlsdGluLmRpY3RfaXRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICApIHsKICAgICAgICByZXR1cm4gYQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3RfaXRlcl8ucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSBhLnRwJGl0ZXJuZXh0KCkKICAgICAgICBpZiAodm9pZCAwID09PSBhKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uKCkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLm51bXR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKAogICAgICAgICAgIkNhbm5vdCBpbnN0YW50aWF0ZSBhYnN0cmFjdCBTay5idWlsdGluLm51bXR5cGUgY2xhc3MiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJOdW1lcmljVHlwZSIsCiAgICAgICAgU2suYnVpbHRpbi5udW10eXBlLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5zayRhYnN0cmFjdCA9ICEwCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19hYnNfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkYWJzKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fYWJzX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19hYnNfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRhYnMoKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fbmVnX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJG5lZ2F0aXZlKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fbmVnX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19uZWdfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRuZWdhdGl2ZSgpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19wb3NfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcG9zaXRpdmUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19wb3NfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3Bvc19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHBvc2l0aXZlKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2ludF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRpbnRfKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9faW50X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pbnRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRpbnRfKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2xvbmdfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkbG5nKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fbG9uZ19fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbG9uZ19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJGxuZygpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19mbG9hdF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRmbG9hdF8pCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19mbG9hdF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZmxvYXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRmbG9hdF8oKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fYWRkX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRhZGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19hZGRfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2FkZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJGFkZChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fcmFkZF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcmVmbGVjdGVkX2FkZCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX3JhZGRfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3JhZGRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfYWRkKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19zdWJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHN1YnRyYWN0KQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fc3ViX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zdWJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRzdWJ0cmFjdChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fcnN1Yl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcmVmbGVjdGVkX3N1YnRyYWN0KQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcnN1Yl9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcnN1Yl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9zdWJ0cmFjdChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fbXVsX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRtdWx0aXBseSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX211bF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbXVsX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkbXVsdGlwbHkoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3JtdWxfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHJlZmxlY3RlZF9tdWx0aXBseSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX3JtdWxfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3JtdWxfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfbXVsdGlwbHkoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2Rpdl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkZGl2aWRlKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fZGl2X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19kaXZfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRkaXZpZGUoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3JkaXZfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHJlZmxlY3RlZF9kaXZpZGUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19yZGl2X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yZGl2X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2RpdmlkZShiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fZmxvb3JkaXZfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJGZsb29yX2RpdmlkZSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX2Zsb29yZGl2X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigKICAgICAgICAgICJfX2Zsb29yZGl2X18iLAogICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgIDEsCiAgICAgICAgICAxLAogICAgICAgICAgITEsCiAgICAgICAgICAhMCwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGEubmIkZmxvb3JfZGl2aWRlKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19yZmxvb3JkaXZfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHJlZmxlY3RlZF9mbG9vcl9kaXZpZGUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19yZmxvb3JkaXZfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKAogICAgICAgICAgIl9fcmZsb29yZGl2X18iLAogICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgIDEsCiAgICAgICAgICAxLAogICAgICAgICAgITEsCiAgICAgICAgICAhMCwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZShiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fbW9kX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZW1haW5kZXIpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19tb2RfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX21vZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlbWFpbmRlcihiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fcm1vZF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcmVmbGVjdGVkX3JlbWFpbmRlcikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX3Jtb2RfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3Jtb2RfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfcmVtYWluZGVyKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19kaXZtb2RfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJGRpdm1vZCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX2Rpdm1vZF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZGl2bW9kX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkZGl2bW9kKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19yZGl2bW9kX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZWZsZWN0ZWRfZGl2bW9kKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcmRpdm1vZF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcmRpdm1vZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9kaXZtb2QoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3Bvd19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcG93ZXIpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19wb3dfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3Bvd19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHBvd2VyKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19ycG93X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZWZsZWN0ZWRfcG93ZXIpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19ycG93X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19ycG93X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX3Bvd2VyKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19jb2VyY2VfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgIl9fY29lcmNlX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9hZGQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3N1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkaW5wbGFjZV9zdWJ0cmFjdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkcmVmbGVjdGVkX211bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkaW5wbGFjZV9tdWx0aXBseSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZpZGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9mbG9vcl9kaXZpZGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlbWFpbmRlciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9yZW1haW5kZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX3JlbWFpbmRlciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZtb2QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRwb3dlciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9wb3dlciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGlucGxhY2VfcG93ZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRhYnMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJG5lZ2F0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkbm9uemVybyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkaXNuZWdhdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkaXNwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgbnVsbCAhPSBhICYmCiAgICAgICAgICAoIm51bWJlciIgPT0gdHlwZW9mIGEKICAgICAgICAgICAgPyB0aGlzLmZyb21OdW1iZXIoYSwgYiwgYykKICAgICAgICAgICAgOiBudWxsID09IGIgJiYgInN0cmluZyIgIT0gdHlwZW9mIGEKICAgICAgICAgICAgPyB0aGlzLmZyb21TdHJpbmcoYSwgMjU2KQogICAgICAgICAgICA6IHRoaXMuZnJvbVN0cmluZyhhLCBiKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuY2FuYXJ5ID0gMHhkZWFkYmVlZmNhZmUKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmpfbG0gPQogICAgICAgIDE1NzE1MDcwID09IChTay5idWlsdGluLmJpZ2ludGVnZXIuY2FuYXJ5ICYgMTY3NzcyMTUpCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihudWxsKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW0xID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIGZvciAodmFyIGc7IDAgPD0gLS1mOyApCiAgICAgICAgICAoZyA9IGIgKiB0aGlzW2ErK10gKyBjW2RdICsgZSksCiAgICAgICAgICAgIChlID0gTWF0aC5mbG9vcihnIC8gNjcxMDg4NjQpKSwKICAgICAgICAgICAgKGNbZCsrXSA9IGcgJiA2NzEwODg2MykKICAgICAgICByZXR1cm4gZQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW0yID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIGZvciAodmFyIGcsIGgsIGsgPSBiICYgMzI3NjcsIGwgPSBiID4+IDE1OyAwIDw9IC0tZjsgKQogICAgICAgICAgKGggPSB0aGlzW2FdICYgMzI3NjcpLAogICAgICAgICAgICAoZyA9IHRoaXNbYSsrXSA+PiAxNSksCiAgICAgICAgICAgIChiID0gbCAqIGggKyBnICogayksCiAgICAgICAgICAgIChoID0gayAqIGggKyAoKGIgJiAzMjc2NykgPDwgMTUpICsgY1tkXSArIChlICYgMTA3Mzc0MTgyMykpLAogICAgICAgICAgICAoZSA9IChoID4+PiAzMCkgKyAoYiA+Pj4gMTUpICsgbCAqIGcgKyAoZSA+Pj4gMzApKSwKICAgICAgICAgICAgKGNbZCsrXSA9IGggJiAxMDczNzQxODIzKQogICAgICAgIHJldHVybiBlCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5hbTMgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgZm9yICh2YXIgZywgaCwgayA9IGIgJiAxNjM4MywgbCA9IGIgPj4gMTQ7IDAgPD0gLS1mOyApCiAgICAgICAgICAoaCA9IHRoaXNbYV0gJiAxNjM4MyksCiAgICAgICAgICAgIChnID0gdGhpc1thKytdID4+IDE0KSwKICAgICAgICAgICAgKGIgPSBsICogaCArIGcgKiBrKSwKICAgICAgICAgICAgKGggPSBrICogaCArICgoYiAmIDE2MzgzKSA8PCAxNCkgKyBjW2RdICsgZSksCiAgICAgICAgICAgIChlID0gKGggPj4gMjgpICsgKGIgPj4gMTQpICsgbCAqIGcpLAogICAgICAgICAgICAoY1tkKytdID0gaCAmIDI2ODQzNTQ1NSkKICAgICAgICByZXR1cm4gZQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW0gPSBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmFtMwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuZGJpdHMgPSAyOAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLkRCID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmRiaXRzCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuRE0gPQogICAgICAgICgxIDw8IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5kYml0cykgLSAxCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuRFYgPSAxIDw8IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5kYml0cwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfRlAgPSA1MgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLkZWID0gTWF0aC5wb3coCiAgICAgICAgMiwKICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfRlAsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5GMSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJJX0ZQIC0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmRiaXRzCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuRjIgPQogICAgICAgIDIgKiBTay5idWlsdGluLmJpZ2ludGVnZXIuZGJpdHMgLSBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfRlAKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJJX1JNID0gIjAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJJX1JDID0gW10KICAgICAgbSA9IDQ4CiAgICAgIGZvciAocCA9IDA7IDkgPj0gcDsgKytwKSBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfUkNbbSsrXSA9IHAKICAgICAgbSA9IDk3CiAgICAgIGZvciAocCA9IDEwOyAzNiA+IHA7ICsrcCkgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJJX1JDW20rK10gPSBwCiAgICAgIG0gPSA2NQogICAgICBmb3IgKHAgPSAxMDsgMzYgPiBwOyArK3ApIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9SQ1ttKytdID0gcAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50MmNoYXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9STS5jaGFyQXQoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50QXQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9SQ1thLmNoYXJDb2RlQXQoYildCiAgICAgICAgcmV0dXJuIG51bGwgPT0gYSA/IC0xIDogYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQ29weVRvID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgZm9yIChiID0gdGhpcy50IC0gMTsgMCA8PSBiOyAtLWIpIGFbYl0gPSB0aGlzW2JdCiAgICAgICAgYS50ID0gdGhpcy50CiAgICAgICAgYS5zID0gdGhpcy5zCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tSW50ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHRoaXMudCA9IDEKICAgICAgICB0aGlzLnMgPSAwID4gYSA/IC0xIDogMAogICAgICAgIDAgPCBhID8gKHRoaXNbMF0gPSBhKSA6IC0xID4gYSA/ICh0aGlzWzBdID0gYSArIHRoaXMuRFYpIDogKHRoaXMudCA9IDApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5idiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIobnVsbCkKICAgICAgICBiLmJucEZyb21JbnQoYSkKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRnJvbVN0cmluZyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGlmICgxNiA9PSBiKSB2YXIgZCA9IDQKICAgICAgICBlbHNlIGlmICg4ID09IGIpIGQgPSAzCiAgICAgICAgZWxzZSBpZiAoMjU2ID09IGIpIGQgPSA4CiAgICAgICAgZWxzZSBpZiAoMiA9PSBiKSBkID0gMQogICAgICAgIGVsc2UgaWYgKDMyID09IGIpIGQgPSA1CiAgICAgICAgZWxzZSBpZiAoNCA9PSBiKSBkID0gMgogICAgICAgIGVsc2UgewogICAgICAgICAgdGhpcy5mcm9tUmFkaXgoYSwgYikKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICB0aGlzLnMgPSB0aGlzLnQgPSAwCiAgICAgICAgdmFyIGUgPSBhLmxlbmd0aAogICAgICAgIHZhciBmID0gITEKICAgICAgICBmb3IgKGMgPSAwOyAwIDw9IC0tZTsgKQogICAgICAgICAgKGIgPSA4ID09IGQgPyBhW2VdICYgMjU1IDogU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmludEF0KGEsIGUpKSwKICAgICAgICAgICAgMCA+IGIKICAgICAgICAgICAgICA/ICItIiA9PSBhLmNoYXJBdChlKSAmJiAoZiA9ICEwKQogICAgICAgICAgICAgIDogKChmID0gITEpLAogICAgICAgICAgICAgICAgMCA9PT0gYwogICAgICAgICAgICAgICAgICA/ICh0aGlzW3RoaXMudCsrXSA9IGIpCiAgICAgICAgICAgICAgICAgIDogYyArIGQgPiB0aGlzLkRCCiAgICAgICAgICAgICAgICAgID8gKCh0aGlzW3RoaXMudCAtIDFdIHw9CiAgICAgICAgICAgICAgICAgICAgICAoYiAmICgoMSA8PCAodGhpcy5EQiAtIGMpKSAtIDEpKSA8PCBjKSwKICAgICAgICAgICAgICAgICAgICAodGhpc1t0aGlzLnQrK10gPSBiID4+ICh0aGlzLkRCIC0gYykpKQogICAgICAgICAgICAgICAgICA6ICh0aGlzW3RoaXMudCAtIDFdIHw9IGIgPDwgYyksCiAgICAgICAgICAgICAgICAoYyArPSBkKSwKICAgICAgICAgICAgICAgIGMgPj0gdGhpcy5EQiAmJiAoYyAtPSB0aGlzLkRCKSkKICAgICAgICA4ID09IGQgJiYKICAgICAgICAgIDAgIT09IChhWzBdICYgMTI4KSAmJgogICAgICAgICAgKCh0aGlzLnMgPSAtMSksCiAgICAgICAgICAwIDwgYyAmJiAodGhpc1t0aGlzLnQgLSAxXSB8PSAoKDEgPDwgKHRoaXMuREIgLSBjKSkgLSAxKSA8PCBjKSkKICAgICAgICB0aGlzLmNsYW1wKCkKICAgICAgICBmICYmIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPLnN1YlRvKHRoaXMsIHRoaXMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBDbGFtcCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIGEgPSB0aGlzLnMgJiB0aGlzLkRNOyAwIDwgdGhpcy50ICYmIHRoaXNbdGhpcy50IC0gMV0gPT0gYTsgKQogICAgICAgICAgLS10aGlzLnQKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuVG9TdHJpbmcgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMCA+IHRoaXMucykgcmV0dXJuICItIiArIHRoaXMubmVnYXRlKCkudG9TdHJpbmcoYSkKICAgICAgICBpZiAoMTYgPT0gYSkgdmFyIGMgPSA0CiAgICAgICAgZWxzZSBpZiAoOCA9PSBhKSBjID0gMwogICAgICAgIGVsc2UgaWYgKDIgPT0gYSkgYyA9IDEKICAgICAgICBlbHNlIGlmICgzMiA9PSBhKSBjID0gNQogICAgICAgIGVsc2UgaWYgKDQgPT0gYSkgYyA9IDIKICAgICAgICBlbHNlIHJldHVybiB0aGlzLnRvUmFkaXgoYSkKICAgICAgICB2YXIgZCA9ICgxIDw8IGMpIC0gMQogICAgICAgIHZhciBlID0gITEKICAgICAgICB2YXIgZiA9ICIiCiAgICAgICAgdmFyIGcgPSB0aGlzLnQKICAgICAgICBhID0gdGhpcy5EQiAtICgoZyAqIHRoaXMuREIpICUgYykKICAgICAgICBpZiAoMCA8IGctLSkKICAgICAgICAgIGZvciAoCiAgICAgICAgICAgIGEgPCB0aGlzLkRCICYmCiAgICAgICAgICAgIDAgPCAoYiA9IHRoaXNbZ10gPj4gYSkgJiYKICAgICAgICAgICAgKChlID0gITApLCAoZiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5pbnQyY2hhcihiKSkpOwogICAgICAgICAgICAwIDw9IGc7CgogICAgICAgICAgKQogICAgICAgICAgICBhIDwgYwogICAgICAgICAgICAgID8gKChiID0gKHRoaXNbZ10gJiAoKDEgPDwgYSkgLSAxKSkgPDwgKGMgLSBhKSksCiAgICAgICAgICAgICAgICAoYiB8PSB0aGlzWy0tZ10gPj4gKGEgKz0gdGhpcy5EQiAtIGMpKSkKICAgICAgICAgICAgICA6ICgoYiA9ICh0aGlzW2ddID4+IChhIC09IGMpKSAmIGQpLAogICAgICAgICAgICAgICAgMCA+PSBhICYmICgoYSArPSB0aGlzLkRCKSwgLS1nKSksCiAgICAgICAgICAgICAgMCA8IGIgJiYgKGUgPSAhMCksCiAgICAgICAgICAgICAgZSAmJiAoZiArPSBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50MmNoYXIoYikpCiAgICAgICAgcmV0dXJuIGUgPyBmIDogIjAiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk5lZ2F0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8uc3ViVG8odGhpcywgYSkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5BYnMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMucyA/IHRoaXMubmVnYXRlKCkgOiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkNvbXBhcmVUbyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMucyAtIGEucwogICAgICAgIGlmICgwICE9PSBiKSByZXR1cm4gYgogICAgICAgIHZhciBjID0gdGhpcy50CiAgICAgICAgYiA9IGMgLSBhLnQKICAgICAgICBpZiAoMCAhPT0gYikgcmV0dXJuIDAgPiB0aGlzLnMgPyAtYiA6IGIKICAgICAgICBmb3IgKDsgMCA8PSAtLWM7ICkgaWYgKDAgIT09IChiID0gdGhpc1tjXSAtIGFbY10pKSByZXR1cm4gYgogICAgICAgIHJldHVybiAwCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaXRzID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gMSwKICAgICAgICAgIGMKICAgICAgICAwICE9PSAoYyA9IGEgPj4+IDE2KSAmJiAoKGEgPSBjKSwgKGIgKz0gMTYpKQogICAgICAgIDAgIT09IChjID0gYSA+PiA4KSAmJiAoKGEgPSBjKSwgKGIgKz0gOCkpCiAgICAgICAgMCAhPT0gKGMgPSBhID4+IDQpICYmICgoYSA9IGMpLCAoYiArPSA0KSkKICAgICAgICAwICE9PSAoYyA9IGEgPj4gMikgJiYgKChhID0gYyksIChiICs9IDIpKQogICAgICAgIDAgIT09IGEgPj4gMSAmJiAoYiArPSAxKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJpdExlbmd0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwID49IHRoaXMudAogICAgICAgICAgPyAwCiAgICAgICAgICA6IHRoaXMuREIgKiAodGhpcy50IC0gMSkgKwogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYml0cyh0aGlzW3RoaXMudCAtIDFdIF4gKHRoaXMucyAmIHRoaXMuRE0pKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRExTaGlmdFRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgZm9yIChjID0gdGhpcy50IC0gMTsgMCA8PSBjOyAtLWMpIGJbYyArIGFdID0gdGhpc1tjXQogICAgICAgIGZvciAoYyA9IGEgLSAxOyAwIDw9IGM7IC0tYykgYltjXSA9IDAKICAgICAgICBiLnQgPSB0aGlzLnQgKyBhCiAgICAgICAgYi5zID0gdGhpcy5zCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBEUlNoaWZ0VG8gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBmb3IgKGMgPSBhOyBjIDwgdGhpcy50OyArK2MpIGJbYyAtIGFdID0gdGhpc1tjXQogICAgICAgIGIudCA9IE1hdGgubWF4KHRoaXMudCAtIGEsIDApCiAgICAgICAgYi5zID0gdGhpcy5zCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBMU2hpZnRUbyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEgJSB0aGlzLkRCLAogICAgICAgICAgZCA9IHRoaXMuREIgLSBjLAogICAgICAgICAgZSA9ICgxIDw8IGQpIC0gMQogICAgICAgIGEgPSBNYXRoLmZsb29yKGEgLyB0aGlzLkRCKQogICAgICAgIHZhciBmID0gKHRoaXMucyA8PCBjKSAmIHRoaXMuRE0sCiAgICAgICAgICBnCiAgICAgICAgZm9yIChnID0gdGhpcy50IC0gMTsgMCA8PSBnOyAtLWcpCiAgICAgICAgICAoYltnICsgYSArIDFdID0gKHRoaXNbZ10gPj4gZCkgfCBmKSwgKGYgPSAodGhpc1tnXSAmIGUpIDw8IGMpCiAgICAgICAgZm9yIChnID0gYSAtIDE7IDAgPD0gZzsgLS1nKSBiW2ddID0gMAogICAgICAgIGJbYV0gPSBmCiAgICAgICAgYi50ID0gdGhpcy50ICsgYSArIDEKICAgICAgICBiLnMgPSB0aGlzLnMKICAgICAgICBiLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucFJTaGlmdFRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGIucyA9IHRoaXMucwogICAgICAgIHZhciBjID0gTWF0aC5mbG9vcihhIC8gdGhpcy5EQikKICAgICAgICBpZiAoYyA+PSB0aGlzLnQpIGIudCA9IDAKICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBkID0gYSAlIHRoaXMuREIKICAgICAgICAgIHZhciBlID0gdGhpcy5EQiAtIGQKICAgICAgICAgIHZhciBmID0gKDEgPDwgZCkgLSAxCiAgICAgICAgICBiWzBdID0gdGhpc1tjXSA+PiBkCiAgICAgICAgICBmb3IgKGEgPSBjICsgMTsgYSA8IHRoaXMudDsgKythKQogICAgICAgICAgICAoYlthIC0gYyAtIDFdIHw9ICh0aGlzW2FdICYgZikgPDwgZSksIChiW2EgLSBjXSA9IHRoaXNbYV0gPj4gZCkKICAgICAgICAgIDAgPCBkICYmIChiW3RoaXMudCAtIGMgLSAxXSB8PSAodGhpcy5zICYgZikgPDwgZSkKICAgICAgICAgIGIudCA9IHRoaXMudCAtIGMKICAgICAgICAgIGIuY2xhbXAoKQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucFN1YlRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gMCwgZSA9IE1hdGgubWluKGEudCwgdGhpcy50KTsgYyA8IGU7ICkKICAgICAgICAgIChkICs9IHRoaXNbY10gLSBhW2NdKSwgKGJbYysrXSA9IGQgJiB0aGlzLkRNKSwgKGQgPj49IHRoaXMuREIpCiAgICAgICAgaWYgKGEudCA8IHRoaXMudCkgewogICAgICAgICAgZm9yIChkIC09IGEuczsgYyA8IHRoaXMudDsgKQogICAgICAgICAgICAoZCArPSB0aGlzW2NdKSwgKGJbYysrXSA9IGQgJiB0aGlzLkRNKSwgKGQgPj49IHRoaXMuREIpCiAgICAgICAgICBkICs9IHRoaXMucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGQgKz0gdGhpcy5zOyBjIDwgYS50OyApCiAgICAgICAgICAgIChkIC09IGFbY10pLCAoYltjKytdID0gZCAmIHRoaXMuRE0pLCAoZCA+Pj0gdGhpcy5EQikKICAgICAgICAgIGQgLT0gYS5zCiAgICAgICAgfQogICAgICAgIGIucyA9IDAgPiBkID8gLTEgOiAwCiAgICAgICAgOy0xID4gZCA/IChiW2MrK10gPSB0aGlzLkRWICsgZCkgOiAwIDwgZCAmJiAoYltjKytdID0gZCkKICAgICAgICBiLnQgPSBjCiAgICAgICAgYi5jbGFtcCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBNdWx0aXBseVRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gdGhpcy5hYnMoKSwKICAgICAgICAgIGQgPSBhLmFicygpLAogICAgICAgICAgZSA9IGMudAogICAgICAgIGZvciAoYi50ID0gZSArIGQudDsgMCA8PSAtLWU7ICkgYltlXSA9IDAKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgZC50OyArK2UpIGJbZSArIGMudF0gPSBjLmFtKDAsIGRbZV0sIGIsIGUsIDAsIGMudCkKICAgICAgICBiLnMgPSAwCiAgICAgICAgYi5jbGFtcCgpCiAgICAgICAgdGhpcy5zICE9IGEucyAmJiBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTy5zdWJUbyhiLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wU3F1YXJlVG8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgZm9yICh2YXIgYiwgYyA9IHRoaXMuYWJzKCksIGQgPSAoYS50ID0gMiAqIGMudCk7IDAgPD0gLS1kOyApIGFbZF0gPSAwCiAgICAgICAgZm9yIChkID0gMDsgZCA8IGMudCAtIDE7ICsrZCkKICAgICAgICAgIChiID0gYy5hbShkLCBjW2RdLCBhLCAyICogZCwgMCwgMSkpLAogICAgICAgICAgICAoYVtkICsgYy50XSArPSBjLmFtKAogICAgICAgICAgICAgIGQgKyAxLAogICAgICAgICAgICAgIDIgKiBjW2RdLAogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgMiAqIGQgKyAxLAogICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgYy50IC0gZCAtIDEsCiAgICAgICAgICAgICkpID49IGMuRFYgJiYgKChhW2QgKyBjLnRdIC09IGMuRFYpLCAoYVtkICsgYy50ICsgMV0gPSAxKSkKICAgICAgICAwIDwgYS50ICYmIChhW2EudCAtIDFdICs9IGMuYW0oZCwgY1tkXSwgYSwgMiAqIGQsIDAsIDEpKQogICAgICAgIGEucyA9IDAKICAgICAgICBhLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERpdlJlbVRvID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHZhciBkID0gYS5hYnMoKQogICAgICAgIGlmICghKDAgPj0gZC50KSkgewogICAgICAgICAgdmFyIGUgPSB0aGlzLmFicygpCiAgICAgICAgICBpZiAoZS50IDwgZC50KSBudWxsICE9IGIgJiYgYi5mcm9tSW50KDApLCBudWxsICE9IGMgJiYgdGhpcy5jb3B5VG8oYykKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBudWxsID09IGMgJiYgKGMgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkpCiAgICAgICAgICAgIHZhciBmID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgICAgIHZhciBnID0gdGhpcy5zCiAgICAgICAgICAgIHZhciBoID0gYS5zCiAgICAgICAgICAgIGEgPSB0aGlzLkRCIC0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaXRzKGRbZC50IC0gMV0pCiAgICAgICAgICAgIDAgPCBhCiAgICAgICAgICAgICAgPyAoZC5sU2hpZnRUbyhhLCBmKSwgZS5sU2hpZnRUbyhhLCBjKSkKICAgICAgICAgICAgICA6IChkLmNvcHlUbyhmKSwgZS5jb3B5VG8oYykpCiAgICAgICAgICAgIHZhciBrID0gZi50CiAgICAgICAgICAgIGQgPSBmW2sgLSAxXQogICAgICAgICAgICBpZiAoMCAhPT0gZCkgewogICAgICAgICAgICAgIHZhciBsID0gZCAqICgxIDw8IHRoaXMuRjEpICsgKDEgPCBrID8gZltrIC0gMl0gPj4gdGhpcy5GMiA6IDApCiAgICAgICAgICAgICAgZSA9IHRoaXMuRlYgLyBsCiAgICAgICAgICAgICAgdmFyIHIgPSAoMSA8PCB0aGlzLkYxKSAvIGwKICAgICAgICAgICAgICB2YXIgbiA9IDEgPDwgdGhpcy5GMgogICAgICAgICAgICAgIHZhciBxID0gYy50CiAgICAgICAgICAgICAgdmFyIG0gPSBxIC0gawogICAgICAgICAgICAgIHZhciBwID0gbnVsbCA9PSBiID8gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpIDogYgogICAgICAgICAgICAgIGYuZGxTaGlmdFRvKG0sIHApCiAgICAgICAgICAgICAgMCA8PSBjLmNvbXBhcmVUbyhwKSAmJiAoKGNbYy50KytdID0gMSksIGMuc3ViVG8ocCwgYykpCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORS5kbFNoaWZ0VG8oaywgcCkKICAgICAgICAgICAgICBmb3IgKHAuc3ViVG8oZiwgZik7IGYudCA8IGs7ICkgZltmLnQrK10gPSAwCiAgICAgICAgICAgICAgZm9yICg7IDAgPD0gLS1tOyApCiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICgobCA9CiAgICAgICAgICAgICAgICAgICAgY1stLXFdID09IGQKICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5ETQogICAgICAgICAgICAgICAgICAgICAgOiBNYXRoLmZsb29yKGNbcV0gKiBlICsgKGNbcSAtIDFdICsgbikgKiByKSksCiAgICAgICAgICAgICAgICAgIChjW3FdICs9IGYuYW0oMCwgbCwgYywgbSwgMCwgaykpIDwgbCkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgZm9yIChmLmRsU2hpZnRUbyhtLCBwKSwgYy5zdWJUbyhwLCBjKTsgY1txXSA8IC0tbDsgKQogICAgICAgICAgICAgICAgICAgIGMuc3ViVG8ocCwgYykKICAgICAgICAgICAgICBudWxsICE9IGIgJiYKICAgICAgICAgICAgICAgIChjLmRyU2hpZnRUbyhrLCBiKSwKICAgICAgICAgICAgICAgIGcgIT0gaCAmJiBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTy5zdWJUbyhiLCBiKSkKICAgICAgICAgICAgICBjLnQgPSBrCiAgICAgICAgICAgICAgYy5jbGFtcCgpCiAgICAgICAgICAgICAgMCA8IGEgJiYgYy5yU2hpZnRUbyhhLCBjKQogICAgICAgICAgICAgIDAgPiBnICYmIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPLnN1YlRvKGMsIGMpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1vZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuYWJzKCkuZGl2UmVtVG8oYSwgbnVsbCwgYikKICAgICAgICAwID4gdGhpcy5zICYmCiAgICAgICAgICAwIDwgYi5jb21wYXJlVG8oU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8pICYmCiAgICAgICAgICBhLnN1YlRvKGIsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aGlzLm0gPSBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jQ29udmVydCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gMCA+IGEucyB8fCAwIDw9IGEuY29tcGFyZVRvKHRoaXMubSkgPyBhLm1vZCh0aGlzLm0pIDogYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1JldmVydCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1JlZHVjZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhLmRpdlJlbVRvKHRoaXMubSwgbnVsbCwgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNNdWxUbyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBhLm11bHRpcGx5VG8oYiwgYykKICAgICAgICB0aGlzLnJlZHVjZShjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1NxclRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGEuc3F1YXJlVG8oYikKICAgICAgICB0aGlzLnJlZHVjZShiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5DbGFzc2ljLnByb3RvdHlwZS5jb252ZXJ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNDb252ZXJ0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5DbGFzc2ljLnByb3RvdHlwZS5yZXZlcnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1JldmVydAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYy5wcm90b3R5cGUucmVkdWNlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNSZWR1Y2UKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkNsYXNzaWMucHJvdG90eXBlLm11bFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNNdWxUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYy5wcm90b3R5cGUuc3FyVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1NxclRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wSW52RGlnaXQgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoMSA+IHRoaXMudCkgcmV0dXJuIDAKICAgICAgICB2YXIgYSA9IHRoaXNbMF0KICAgICAgICBpZiAoMCA9PT0gKGEgJiAxKSkgcmV0dXJuIDAKICAgICAgICB2YXIgYiA9IGEgJiAzCiAgICAgICAgYiA9IChiICogKDIgLSAoYSAmIDE1KSAqIGIpKSAmIDE1CiAgICAgICAgYiA9IChiICogKDIgLSAoYSAmIDI1NSkgKiBiKSkgJiAyNTUKICAgICAgICBiID0gKGIgKiAoMiAtICgoKGEgJiA2NTUzNSkgKiBiKSAmIDY1NTM1KSkpICYgNjU1MzUKICAgICAgICBiID0gKGIgKiAoMiAtICgoYSAqIGIpICUgdGhpcy5EVikpKSAlIHRoaXMuRFYKICAgICAgICByZXR1cm4gMCA8IGIgPyB0aGlzLkRWIC0gYiA6IC1iCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk1vbnRnb21lcnkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy5tID0gYQogICAgICAgIHRoaXMubXAgPSBhLmludkRpZ2l0KCkKICAgICAgICB0aGlzLm1wbCA9IHRoaXMubXAgJiAzMjc2NwogICAgICAgIHRoaXMubXBoID0gdGhpcy5tcCA+PiAxNQogICAgICAgIHRoaXMudW0gPSAoMSA8PCAoYS5EQiAtIDE1KSkgLSAxCiAgICAgICAgdGhpcy5tdDIgPSAyICogYS50CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250Q29udmVydCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIGEuYWJzKCkuZGxTaGlmdFRvKHRoaXMubS50LCBiKQogICAgICAgIGIuZGl2UmVtVG8odGhpcy5tLCBudWxsLCBiKQogICAgICAgIDAgPiBhLnMgJiYKICAgICAgICAgIDAgPCBiLmNvbXBhcmVUbyhTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykgJiYKICAgICAgICAgIHRoaXMubS5zdWJUbyhiLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250UmV2ZXJ0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgYS5jb3B5VG8oYikKICAgICAgICB0aGlzLnJlZHVjZShiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250UmVkdWNlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGZvciAodmFyIGIsIGMsIGQ7IGEudCA8PSB0aGlzLm10MjsgKSBhW2EudCsrXSA9IDAKICAgICAgICBmb3IgKGQgPSAwOyBkIDwgdGhpcy5tLnQ7ICsrZCkKICAgICAgICAgIGZvciAoCiAgICAgICAgICAgIGMgPSBhW2RdICYgMzI3NjcsCiAgICAgICAgICAgICAgYiA9CiAgICAgICAgICAgICAgICAoYyAqIHRoaXMubXBsICsKICAgICAgICAgICAgICAgICAgKCgoYyAqIHRoaXMubXBoICsgKGFbZF0gPj4gMTUpICogdGhpcy5tcGwpICYgdGhpcy51bSkgPDwKICAgICAgICAgICAgICAgICAgICAxNSkpICYKICAgICAgICAgICAgICAgIGEuRE0sCiAgICAgICAgICAgICAgYyA9IGQgKyB0aGlzLm0udCwKICAgICAgICAgICAgICBhW2NdICs9IHRoaXMubS5hbSgwLCBiLCBhLCBkLCAwLCB0aGlzLm0udCk7CiAgICAgICAgICAgIGFbY10gPj0gYS5EVjsKCiAgICAgICAgICApCiAgICAgICAgICAgIChhW2NdIC09IGEuRFYpLCBhWysrY10rKwogICAgICAgIGEuY2xhbXAoKQogICAgICAgIGEuZHJTaGlmdFRvKHRoaXMubS50LCBhKQogICAgICAgIDAgPD0gYS5jb21wYXJlVG8odGhpcy5tKSAmJiBhLnN1YlRvKHRoaXMubSwgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRTcXJUbyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBhLnNxdWFyZVRvKGIpCiAgICAgICAgdGhpcy5yZWR1Y2UoYikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRNdWxUbyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBhLm11bHRpcGx5VG8oYiwgYykKICAgICAgICB0aGlzLnJlZHVjZShjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5Nb250Z29tZXJ5LnByb3RvdHlwZS5jb252ZXJ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRDb252ZXJ0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5Nb250Z29tZXJ5LnByb3RvdHlwZS5yZXZlcnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubW9udFJldmVydAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTW9udGdvbWVyeS5wcm90b3R5cGUucmVkdWNlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRSZWR1Y2UKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk1vbnRnb21lcnkucHJvdG90eXBlLm11bFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRNdWxUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTW9udGdvbWVyeS5wcm90b3R5cGUuc3FyVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubW9udFNxclRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wSXNFdmVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDAgPT09ICgwIDwgdGhpcy50ID8gdGhpc1swXSAmIDEgOiB0aGlzLnMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBFeHAgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKDQyOTQ5NjcyOTUgPCBhIHx8IDEgPiBhKSByZXR1cm4gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdmFyIGQgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB2YXIgZSA9IGIuY29udmVydCh0aGlzKQogICAgICAgIHZhciBmID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaXRzKGEpIC0gMQogICAgICAgIGZvciAoZS5jb3B5VG8oYyk7IDAgPD0gLS1mOyApCiAgICAgICAgICBpZiAoKGIuc3FyVG8oYywgZCksIDAgPCAoYSAmICgxIDw8IGYpKSkpIGIubXVsVG8oZCwgZSwgYykKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgZyA9IGMKICAgICAgICAgICAgYyA9IGQKICAgICAgICAgICAgZCA9IGcKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gYi5yZXZlcnQoYykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTW9kUG93SW50ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGIgPQogICAgICAgICAgMjU2ID4gYSB8fCBiLmlzRXZlbigpCiAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5DbGFzc2ljKGIpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5Nb250Z29tZXJ5KGIpCiAgICAgICAgcmV0dXJuIHRoaXMuZXhwKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jb3B5VG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQ29weVRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZnJvbUludCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tSW50CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZnJvbVN0cmluZyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tU3RyaW5nCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2xhbXAgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQ2xhbXAKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5kbFNoaWZ0VG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRExTaGlmdFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZHJTaGlmdFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERSU2hpZnRUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmxTaGlmdFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucExTaGlmdFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuclNoaWZ0VG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wUlNoaWZ0VG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zdWJUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBTdWJUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm11bHRpcGx5VG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wTXVsdGlwbHlUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnNxdWFyZVRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucFNxdWFyZVRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZGl2UmVtVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRGl2UmVtVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5pbnZEaWdpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBJbnZEaWdpdAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmlzRXZlbiA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBJc0V2ZW4KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5leHAgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRXhwCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUudG9TdHJpbmcgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Ub1N0cmluZwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm5lZ2F0ZSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk5lZ2F0ZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmFicyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkFicwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNvbXBhcmVUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkNvbXBhcmVUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJpdExlbmd0aCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJpdExlbmd0aAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vZCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1vZAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vZFBvd0ludCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1vZFBvd0ludAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTyA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYnYoMCkKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYnYoMSkKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLmNvcHlUbyhhKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkludFZhbHVlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKDAgPiB0aGlzLnMpIHsKICAgICAgICAgIGlmICgxID09IHRoaXMudCkgcmV0dXJuIHRoaXNbMF0gLSB0aGlzLkRWCiAgICAgICAgICBpZiAoMCA9PT0gdGhpcy50KSByZXR1cm4gLTEKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKDEgPT0gdGhpcy50KSByZXR1cm4gdGhpc1swXQogICAgICAgICAgaWYgKDAgPT09IHRoaXMudCkgcmV0dXJuIDAKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgodGhpc1sxXSAmICgoMSA8PCAoMzIgLSB0aGlzLkRCKSkgLSAxKSkgPDwgdGhpcy5EQikgfCB0aGlzWzBdCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJ5dGVWYWx1ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwID09PSB0aGlzLnQgPyB0aGlzLnMgOiAodGhpc1swXSA8PCAyNCkgPj4gMjQKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2hvcnRWYWx1ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwID09PSB0aGlzLnQgPyB0aGlzLnMgOiAodGhpc1swXSA8PCAxNikgPj4gMTYKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENodW5rU2l6ZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoTWF0aC5MTjIgKiB0aGlzLkRCKSAvIE1hdGgubG9nKGEpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5TaWdOdW0gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMucwogICAgICAgICAgPyAtMQogICAgICAgICAgOiAwID49IHRoaXMudCB8fCAoMSA9PSB0aGlzLnQgJiYgMCA+PSB0aGlzWzBdKQogICAgICAgICAgPyAwCiAgICAgICAgICA6IDEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucFRvUmFkaXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgbnVsbCA9PSBhICYmIChhID0gMTApCiAgICAgICAgaWYgKDAgPT09IHRoaXMuc2lnbnVtKCkgfHwgMiA+IGEgfHwgMzYgPCBhKSByZXR1cm4gIjAiCiAgICAgICAgdmFyIGIgPSB0aGlzLmNodW5rU2l6ZShhKQogICAgICAgIHZhciBjID0gTWF0aC5wb3coYSwgYikKICAgICAgICBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5idihjKQogICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdmFyIGUgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB2YXIgZiA9ICIiCiAgICAgICAgZm9yICh0aGlzLmRpdlJlbVRvKGIsIGQsIGUpOyAwIDwgZC5zaWdudW0oKTsgKQogICAgICAgICAgKGYgPSAoYyArIGUuaW50VmFsdWUoKSkudG9TdHJpbmcoYSkuc3Vic3RyKDEpICsgZiksCiAgICAgICAgICAgIGQuZGl2UmVtVG8oYiwgZCwgZSkKICAgICAgICByZXR1cm4gZS5pbnRWYWx1ZSgpLnRvU3RyaW5nKGEpICsgZgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRnJvbVJhZGl4ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLCBkLCBlCiAgICAgICAgdGhpcy5mcm9tSW50KDApCiAgICAgICAgbnVsbCA9PSBiICYmIChiID0gMTApCiAgICAgICAgdmFyIGYgPSB0aGlzLmNodW5rU2l6ZShiKQogICAgICAgIHZhciBnID0gTWF0aC5wb3coYiwgZikKICAgICAgICB2YXIgaCA9ICExCiAgICAgICAgZm9yIChjID0gZSA9IGQgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykgewogICAgICAgICAgdmFyIGsgPSBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50QXQoYSwgYykKICAgICAgICAgIGlmICgwID4gaykgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgKCItIiA9PSBhLmNoYXJBdChjKSAmJiAwID09PSB0aGlzLnNpZ251bSgpICYmIChoID0gITApLAogICAgICAgICAgICAgICIuIiA9PSBhLmNoYXJBdChjKSkKICAgICAgICAgICAgKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgKGUgPSBiICogZSArIGspLAogICAgICAgICAgICAgICsrZCA+PSBmICYmCiAgICAgICAgICAgICAgICAodGhpcy5kTXVsdGlwbHkoZyksIHRoaXMuZEFkZE9mZnNldChlLCAwKSwgKGUgPSBkID0gMCkpCiAgICAgICAgfQogICAgICAgIDAgPCBkICYmICh0aGlzLmRNdWx0aXBseShNYXRoLnBvdyhiLCBkKSksIHRoaXMuZEFkZE9mZnNldChlLCAwKSkKICAgICAgICBoICYmIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPLnN1YlRvKHRoaXMsIHRoaXMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tTnVtYmVyID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmICgibnVtYmVyIiA9PSB0eXBlb2YgYikKICAgICAgICAgIGlmICgyID4gYSkgdGhpcy5mcm9tSW50KDEpCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAoCiAgICAgICAgICAgICAgdGhpcy5mcm9tTnVtYmVyKGEsIGMpLAogICAgICAgICAgICAgICAgdGhpcy50ZXN0Qml0KGEgLSAxKSB8fAogICAgICAgICAgICAgICAgICB0aGlzLmJpdHdpc2VUbygKICAgICAgICAgICAgICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuT05FLnNoaWZ0TGVmdChhIC0gMSksCiAgICAgICAgICAgICAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX29yLAogICAgICAgICAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB0aGlzLmlzRXZlbigpICYmIHRoaXMuZEFkZE9mZnNldCgxLCAwKTsKICAgICAgICAgICAgICAhdGhpcy5pc1Byb2JhYmxlUHJpbWUoYik7CgogICAgICAgICAgICApCiAgICAgICAgICAgICAgdGhpcy5kQWRkT2Zmc2V0KDIsIDApLAogICAgICAgICAgICAgICAgdGhpcy5iaXRMZW5ndGgoKSA+IGEgJiYKICAgICAgICAgICAgICAgICAgdGhpcy5zdWJUbyhTay5idWlsdGluLmJpZ2ludGVnZXIuT05FLnNoaWZ0TGVmdChhIC0gMSksIHRoaXMpCiAgICAgICAgdGhpcy5mcm9tU3RyaW5nKGEgKyAiIikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuVG9CeXRlQXJyYXkgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGIgPSB0aGlzLnQsCiAgICAgICAgICBjID0gW10KICAgICAgICBjWzBdID0gdGhpcy5zCiAgICAgICAgdmFyIGQgPSB0aGlzLkRCIC0gKChiICogdGhpcy5EQikgJSA4KQogICAgICAgIHZhciBlID0gMAogICAgICAgIGlmICgwIDwgYi0tKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZCA8IHRoaXMuREIgJiYKICAgICAgICAgICAgKGEgPSB0aGlzW2JdID4+IGQpICE9ICh0aGlzLnMgJiB0aGlzLkRNKSA+PiBkICYmCiAgICAgICAgICAgIChjW2UrK10gPSBhIHwgKHRoaXMucyA8PCAodGhpcy5EQiAtIGQpKSk7CiAgICAgICAgICAgIDAgPD0gYjsKCiAgICAgICAgICApCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAoOCA+IGQKICAgICAgICAgICAgICAgID8gKChhID0gKHRoaXNbYl0gJiAoKDEgPDwgZCkgLSAxKSkgPDwgKDggLSBkKSksCiAgICAgICAgICAgICAgICAgIChhIHw9IHRoaXNbLS1iXSA+PiAoZCArPSB0aGlzLkRCIC0gOCkpKQogICAgICAgICAgICAgICAgOiAoKGEgPSAodGhpc1tiXSA+PiAoZCAtPSA4KSkgJiAyNTUpLAogICAgICAgICAgICAgICAgICAwID49IGQgJiYgKChkICs9IHRoaXMuREIpLCAtLWIpKSwKICAgICAgICAgICAgICAwICE9PSAoYSAmIDEyOCkgJiYgKGEgfD0gLTI1NiksCiAgICAgICAgICAgICAgMCA9PT0gZSAmJiAodGhpcy5zICYgMTI4KSAhPSAoYSAmIDEyOCkgJiYgKytlLAogICAgICAgICAgICAgIDAgPCBlIHx8IGEgIT0gdGhpcy5zKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgY1tlKytdID0gYQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkVxdWFscyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5jb21wYXJlVG8oYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTWluID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiAwID4gdGhpcy5jb21wYXJlVG8oYSkgPyB0aGlzIDogYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5NYXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIDAgPCB0aGlzLmNvbXBhcmVUbyhhKSA/IHRoaXMgOiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBCaXR3aXNlVG8gPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQsCiAgICAgICAgICBlID0gTWF0aC5taW4oYS50LCB0aGlzLnQpCiAgICAgICAgZm9yIChkID0gMDsgZCA8IGU7ICsrZCkgY1tkXSA9IGIodGhpc1tkXSwgYVtkXSkKICAgICAgICBpZiAoYS50IDwgdGhpcy50KSB7CiAgICAgICAgICB2YXIgZiA9IGEucyAmIHRoaXMuRE0KICAgICAgICAgIGZvciAoZCA9IGU7IGQgPCB0aGlzLnQ7ICsrZCkgY1tkXSA9IGIodGhpc1tkXSwgZikKICAgICAgICAgIGMudCA9IHRoaXMudAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmID0gdGhpcy5zICYgdGhpcy5ETQogICAgICAgICAgZm9yIChkID0gZTsgZCA8IGEudDsgKytkKSBjW2RdID0gYihmLCBhW2RdKQogICAgICAgICAgYy50ID0gYS50CiAgICAgICAgfQogICAgICAgIGMucyA9IGIodGhpcy5zLCBhLnMpCiAgICAgICAgYy5jbGFtcCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSAmIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQW5kID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5iaXR3aXNlVG8oYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZCwgYikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5vcF9vciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSB8IGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuT3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBTay5idWlsdGluLmJpZ2ludGVnZXIub3Bfb3IsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIub3BfeG9yID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBhIF4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Yb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBTay5idWlsdGluLmJpZ2ludGVnZXIub3BfeG9yLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZG5vdCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSAmIH5iCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkFuZE5vdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuYml0d2lzZVRvKGEsIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5vcF9hbmRub3QsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTm90ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudDsgKythKSBiW2FdID0gdGhpcy5ETSAmIH50aGlzW2FdCiAgICAgICAgYi50ID0gdGhpcy50CiAgICAgICAgYi5zID0gfnRoaXMucwogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNoaWZ0TGVmdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIDAgPiBhID8gdGhpcy5yU2hpZnRUbygtYSwgYikgOiB0aGlzLmxTaGlmdFRvKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2hpZnRSaWdodCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIDAgPiBhID8gdGhpcy5sU2hpZnRUbygtYSwgYikgOiB0aGlzLnJTaGlmdFRvKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubGJpdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoMCA9PT0gYSkgcmV0dXJuIC0xCiAgICAgICAgdmFyIGIgPSAwCiAgICAgICAgMCA9PT0gKGEgJiA2NTUzNSkgJiYgKChhID4+PSAxNiksIChiICs9IDE2KSkKICAgICAgICAwID09PSAoYSAmIDI1NSkgJiYgKChhID4+PSA4KSwgKGIgKz0gOCkpCiAgICAgICAgMCA9PT0gKGEgJiAxNSkgJiYgKChhID4+PSA0KSwgKGIgKz0gNCkpCiAgICAgICAgMCA9PT0gKGEgJiAzKSAmJiAoKGEgPj49IDIpLCAoYiArPSAyKSkKICAgICAgICAwID09PSAoYSAmIDEpICYmICsrYgogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkdldExvd2VzdFNldEJpdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhCiAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudDsgKythKQogICAgICAgICAgaWYgKDAgIT09IHRoaXNbYV0pCiAgICAgICAgICAgIHJldHVybiBhICogdGhpcy5EQiArIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sYml0KHRoaXNbYV0pCiAgICAgICAgcmV0dXJuIDAgPiB0aGlzLnMgPyB0aGlzLnQgKiB0aGlzLkRCIDogLTEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuY2JpdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBmb3IgKHZhciBiID0gMDsgMCAhPT0gYTsgKSAoYSAmPSBhIC0gMSksICsrYgogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJpdENvdW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gMCwKICAgICAgICAgIGMgPSB0aGlzLnMgJiB0aGlzLkRNCiAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudDsgKythKQogICAgICAgICAgYiArPSBTay5idWlsdGluLmJpZ2ludGVnZXIuY2JpdCh0aGlzW2FdIF4gYykKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5UZXN0Qml0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gTWF0aC5mbG9vcihhIC8gdGhpcy5EQikKICAgICAgICByZXR1cm4gYiA+PSB0aGlzLnQgPyAwICE9PSB0aGlzLnMgOiAwICE9PSAodGhpc1tiXSAmICgxIDw8IGEgJSB0aGlzLkRCKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENoYW5nZUJpdCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORS5zaGlmdExlZnQoYSkKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBiLCBhKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNldEJpdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VCaXQoYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX29yKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5DbGVhckJpdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VCaXQoYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZG5vdCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuRmxpcEJpdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VCaXQoYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX3hvcikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEFkZFRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gMCwgZSA9IE1hdGgubWluKGEudCwgdGhpcy50KTsgYyA8IGU7ICkKICAgICAgICAgIChkICs9IHRoaXNbY10gKyBhW2NdKSwgKGJbYysrXSA9IGQgJiB0aGlzLkRNKSwgKGQgPj49IHRoaXMuREIpCiAgICAgICAgaWYgKGEudCA8IHRoaXMudCkgewogICAgICAgICAgZm9yIChkICs9IGEuczsgYyA8IHRoaXMudDsgKQogICAgICAgICAgICAoZCArPSB0aGlzW2NdKSwgKGJbYysrXSA9IGQgJiB0aGlzLkRNKSwgKGQgPj49IHRoaXMuREIpCiAgICAgICAgICBkICs9IHRoaXMucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGQgKz0gdGhpcy5zOyBjIDwgYS50OyApCiAgICAgICAgICAgIChkICs9IGFbY10pLCAoYltjKytdID0gZCAmIHRoaXMuRE0pLCAoZCA+Pj0gdGhpcy5EQikKICAgICAgICAgIGQgKz0gYS5zCiAgICAgICAgfQogICAgICAgIGIucyA9IDAgPiBkID8gLTEgOiAwCiAgICAgICAgMCA8IGQgPyAoYltjKytdID0gZCkgOiAtMSA+IGQgJiYgKGJbYysrXSA9IHRoaXMuRFYgKyBkKQogICAgICAgIGIudCA9IGMKICAgICAgICBiLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQWRkID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5hZGRUbyhhLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblN1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5zdWJUbyhhLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk11bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5tdWx0aXBseVRvKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuRGl2aWRlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCBiLCBudWxsKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblJlbWFpbmRlciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuZGl2UmVtVG8oYSwgbnVsbCwgYikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5EaXZpZGVBbmRSZW1haW5kZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCksCiAgICAgICAgICBjID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCBiLCBjKQogICAgICAgIHJldHVybiBbYiwgY10KICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERNdWx0aXBseSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aGlzW3RoaXMudF0gPSB0aGlzLmFtKDAsIGEgLSAxLCB0aGlzLCAwLCAwLCB0aGlzLnQpCiAgICAgICAgKyt0aGlzLnQKICAgICAgICB0aGlzLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERBZGRPZmZzZXQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKDAgIT09IGEpIHsKICAgICAgICAgIGZvciAoOyB0aGlzLnQgPD0gYjsgKSB0aGlzW3RoaXMudCsrXSA9IDAKICAgICAgICAgIGZvciAodGhpc1tiXSArPSBhOyB0aGlzW2JdID49IHRoaXMuRFY7ICkKICAgICAgICAgICAgKHRoaXNbYl0gLT0gdGhpcy5EViksCiAgICAgICAgICAgICAgKytiID49IHRoaXMudCAmJiAodGhpc1t0aGlzLnQrK10gPSAwKSwKICAgICAgICAgICAgICArK3RoaXNbYl0KICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk51bGxFeHAgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk5vcCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk11bFRvID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGEubXVsdGlwbHlUbyhiLCBjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUublNxclRvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGEuc3F1YXJlVG8oYikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTnVsbEV4cC5wcm90b3R5cGUuY29udmVydCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5uTm9wCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5OdWxsRXhwLnByb3RvdHlwZS5yZXZlcnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk5vcAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTnVsbEV4cC5wcm90b3R5cGUubXVsVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk11bFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5OdWxsRXhwLnByb3RvdHlwZS5zcXJUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5uU3FyVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblBvdyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5leHAoYSwgbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5OdWxsRXhwKCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBNdWx0aXBseUxvd2VyVG8gPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQsCiAgICAgICAgICBlID0gTWF0aC5taW4odGhpcy50ICsgYS50LCBiKQogICAgICAgIGMucyA9IDAKICAgICAgICBmb3IgKGMudCA9IGU7IDAgPCBlOyApIGNbLS1lXSA9IDAKICAgICAgICBmb3IgKGQgPSBjLnQgLSB0aGlzLnQ7IGUgPCBkOyArK2UpCiAgICAgICAgICBjW2UgKyB0aGlzLnRdID0gdGhpcy5hbSgwLCBhW2VdLCBjLCBlLCAwLCB0aGlzLnQpCiAgICAgICAgZm9yIChkID0gTWF0aC5taW4oYS50LCBiKTsgZSA8IGQ7ICsrZSkgdGhpcy5hbSgwLCBhW2VdLCBjLCBlLCAwLCBiIC0gZSkKICAgICAgICBjLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE11bHRpcGx5VXBwZXJUbyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAtLWIKICAgICAgICB2YXIgZCA9IChjLnQgPSB0aGlzLnQgKyBhLnQgLSBiKQogICAgICAgIGZvciAoYy5zID0gMDsgMCA8PSAtLWQ7ICkgY1tkXSA9IDAKICAgICAgICBmb3IgKGQgPSBNYXRoLm1heChiIC0gdGhpcy50LCAwKTsgZCA8IGEudDsgKytkKQogICAgICAgICAgY1t0aGlzLnQgKyBkIC0gYl0gPSB0aGlzLmFtKGIgLSBkLCBhW2RdLCBjLCAwLCAwLCB0aGlzLnQgKyBkIC0gYikKICAgICAgICBjLmNsYW1wKCkKICAgICAgICBjLmRyU2hpZnRUbygxLCBjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CYXJyZXR0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHRoaXMucjIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLnEzID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORS5kbFNoaWZ0VG8oMiAqIGEudCwgdGhpcy5yMikKICAgICAgICB0aGlzLm11ID0gdGhpcy5yMi5kaXZpZGUoYSkKICAgICAgICB0aGlzLm0gPSBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0Q29udmVydCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoMCA+IGEucyB8fCBhLnQgPiAyICogdGhpcy5tLnQpIHJldHVybiBhLm1vZCh0aGlzLm0pCiAgICAgICAgaWYgKDAgPiBhLmNvbXBhcmVUbyh0aGlzLm0pKSByZXR1cm4gYQogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgYS5jb3B5VG8oYikKICAgICAgICB0aGlzLnJlZHVjZShiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0UmV2ZXJ0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0UmVkdWNlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEuZHJTaGlmdFRvKHRoaXMubS50IC0gMSwgdGhpcy5yMikKICAgICAgICBhLnQgPiB0aGlzLm0udCArIDEgJiYgKChhLnQgPSB0aGlzLm0udCArIDEpLCBhLmNsYW1wKCkpCiAgICAgICAgdGhpcy5tdS5tdWx0aXBseVVwcGVyVG8odGhpcy5yMiwgdGhpcy5tLnQgKyAxLCB0aGlzLnEzKQogICAgICAgIGZvciAoCiAgICAgICAgICB0aGlzLm0ubXVsdGlwbHlMb3dlclRvKHRoaXMucTMsIHRoaXMubS50ICsgMSwgdGhpcy5yMik7CiAgICAgICAgICAwID4gYS5jb21wYXJlVG8odGhpcy5yMik7CgogICAgICAgICkKICAgICAgICAgIGEuZEFkZE9mZnNldCgxLCB0aGlzLm0udCArIDEpCiAgICAgICAgZm9yIChhLnN1YlRvKHRoaXMucjIsIGEpOyAwIDw9IGEuY29tcGFyZVRvKHRoaXMubSk7ICkgYS5zdWJUbyh0aGlzLm0sIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0U3FyVG8gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgYS5zcXVhcmVUbyhiKQogICAgICAgIHRoaXMucmVkdWNlKGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0TXVsVG8gPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgYS5tdWx0aXBseVRvKGIsIGMpCiAgICAgICAgdGhpcy5yZWR1Y2UoYykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQmFycmV0dC5wcm90b3R5cGUuY29udmVydCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0Q29udmVydAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQmFycmV0dC5wcm90b3R5cGUucmV2ZXJ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJhcnJldHRSZXZlcnQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJhcnJldHQucHJvdG90eXBlLnJlZHVjZSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0UmVkdWNlCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CYXJyZXR0LnByb3RvdHlwZS5tdWxUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0TXVsVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJhcnJldHQucHJvdG90eXBlLnNxclRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJhcnJldHRTcXJUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTW9kUG93ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gYS5iaXRMZW5ndGgoKQogICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5idigxKQogICAgICAgIGlmICgwID49IGMpIHJldHVybiBkCiAgICAgICAgdmFyIGUgPSAxOCA+IGMgPyAxIDogNDggPiBjID8gMyA6IDE0NCA+IGMgPyA0IDogNzY4ID4gYyA/IDUgOiA2CiAgICAgICAgdmFyIGYgPQogICAgICAgICAgOCA+IGMKICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkNsYXNzaWMoYikKICAgICAgICAgICAgOiBiLmlzRXZlbigpCiAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CYXJyZXR0KGIpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5Nb250Z29tZXJ5KGIpCiAgICAgICAgYiA9IFtdCiAgICAgICAgdmFyIGcgPSAzCiAgICAgICAgdmFyIGggPSBlIC0gMQogICAgICAgIHZhciBrID0gKDEgPDwgZSkgLSAxCiAgICAgICAgYlsxXSA9IGYuY29udmVydCh0aGlzKQogICAgICAgIGlmICgxIDwgZSkKICAgICAgICAgIGZvciAoYyA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKSwgZi5zcXJUbyhiWzFdLCBjKTsgZyA8PSBrOyApCiAgICAgICAgICAgIChiW2ddID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpKSwKICAgICAgICAgICAgICBmLm11bFRvKGMsIGJbZyAtIDJdLCBiW2ddKSwKICAgICAgICAgICAgICAoZyArPSAyKQogICAgICAgIHZhciBsID0gYS50IC0gMQogICAgICAgIHZhciByID0gITAKICAgICAgICB2YXIgbiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIGZvciAoYyA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYml0cyhhW2xdKSAtIDE7IDAgPD0gbDsgKSB7CiAgICAgICAgICBpZiAoYyA+PSBoKSB2YXIgcSA9IChhW2xdID4+IChjIC0gaCkpICYgawogICAgICAgICAgZWxzZQogICAgICAgICAgICAocSA9IChhW2xdICYgKCgxIDw8IChjICsgMSkpIC0gMSkpIDw8IChoIC0gYykpLAogICAgICAgICAgICAgIDAgPCBsICYmIChxIHw9IGFbbCAtIDFdID4+ICh0aGlzLkRCICsgYyAtIGgpKQogICAgICAgICAgZm9yIChnID0gZTsgMCA9PT0gKHEgJiAxKTsgKSAocSA+Pj0gMSksIC0tZwogICAgICAgICAgMCA+IChjIC09IGcpICYmICgoYyArPSB0aGlzLkRCKSwgLS1sKQogICAgICAgICAgaWYgKHIpIGJbcV0uY29weVRvKGQpLCAociA9ICExKQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZvciAoOyAxIDwgZzsgKSBmLnNxclRvKGQsIG4pLCBmLnNxclRvKG4sIGQpLCAoZyAtPSAyKQogICAgICAgICAgICAwIDwgZyA/IGYuc3FyVG8oZCwgbikgOiAoKGcgPSBkKSwgKGQgPSBuKSwgKG4gPSBnKSkKICAgICAgICAgICAgZi5tdWxUbyhuLCBiW3FdLCBkKQogICAgICAgICAgfQogICAgICAgICAgZm9yICg7IDAgPD0gbCAmJiAwID09PSAoYVtsXSAmICgxIDw8IGMpKTsgKQogICAgICAgICAgICBmLnNxclRvKGQsIG4pLAogICAgICAgICAgICAgIChnID0gZCksCiAgICAgICAgICAgICAgKGQgPSBuKSwKICAgICAgICAgICAgICAobiA9IGcpLAogICAgICAgICAgICAgIDAgPiAtLWMgJiYgKChjID0gdGhpcy5EQiAtIDEpLCAtLWwpCiAgICAgICAgfQogICAgICAgIHJldHVybiBmLnJldmVydChkKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5HQ0QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSAwID4gdGhpcy5zID8gdGhpcy5uZWdhdGUoKSA6IHRoaXMuY2xvbmUoKQogICAgICAgIGEgPSAwID4gYS5zID8gYS5uZWdhdGUoKSA6IGEuY2xvbmUoKQogICAgICAgIGlmICgwID4gYi5jb21wYXJlVG8oYSkpIHsKICAgICAgICAgIHZhciBjID0gYgogICAgICAgICAgYiA9IGEKICAgICAgICAgIGEgPSBjCiAgICAgICAgfQogICAgICAgIGMgPSBiLmdldExvd2VzdFNldEJpdCgpCiAgICAgICAgdmFyIGQgPSBhLmdldExvd2VzdFNldEJpdCgpCiAgICAgICAgaWYgKDAgPiBkKSByZXR1cm4gYgogICAgICAgIGMgPCBkICYmIChkID0gYykKICAgICAgICAwIDwgZCAmJiAoYi5yU2hpZnRUbyhkLCBiKSwgYS5yU2hpZnRUbyhkLCBhKSkKICAgICAgICBmb3IgKDsgMCA8IGIuc2lnbnVtKCk7ICkKICAgICAgICAgIDAgPCAoYyA9IGIuZ2V0TG93ZXN0U2V0Qml0KCkpICYmIGIuclNoaWZ0VG8oYywgYiksCiAgICAgICAgICAgIDAgPCAoYyA9IGEuZ2V0TG93ZXN0U2V0Qml0KCkpICYmIGEuclNoaWZ0VG8oYywgYSksCiAgICAgICAgICAgIDAgPD0gYi5jb21wYXJlVG8oYSkKICAgICAgICAgICAgICA/IChiLnN1YlRvKGEsIGIpLCBiLnJTaGlmdFRvKDEsIGIpKQogICAgICAgICAgICAgIDogKGEuc3ViVG8oYiwgYSksIGEuclNoaWZ0VG8oMSwgYSkpCiAgICAgICAgMCA8IGQgJiYgYS5sU2hpZnRUbyhkLCBhKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBNb2RJbnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMCA+PSBhKSByZXR1cm4gMAogICAgICAgIHZhciBjID0gdGhpcy5EViAlIGEKICAgICAgICB2YXIgZCA9IDAgPiB0aGlzLnMgPyBhIC0gMSA6IDAKICAgICAgICBpZiAoMCA8IHRoaXMudCkKICAgICAgICAgIGlmICgwID09PSBjKSBkID0gdGhpc1swXSAlIGEKICAgICAgICAgIGVsc2UgZm9yIChiID0gdGhpcy50IC0gMTsgMCA8PSBiOyAtLWIpIGQgPSAoYyAqIGQgKyB0aGlzW2JdKSAlIGEKICAgICAgICByZXR1cm4gZAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Nb2RJbnZlcnNlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IGEuaXNFdmVuKCkKICAgICAgICBpZiAoKHRoaXMuaXNFdmVuKCkgJiYgYykgfHwgMCA9PT0gYS5zaWdudW0oKSkKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTwogICAgICAgIHZhciBkID0gYS5jbG9uZSgpCiAgICAgICAgdmFyIGUgPSB0aGlzLmNsb25lKCkKICAgICAgICB2YXIgZiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYnYoMSkKICAgICAgICB2YXIgZyA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYnYoMCkKICAgICAgICB2YXIgaCA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYnYoMCkKICAgICAgICBmb3IgKGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KDEpOyAwICE9PSBkLnNpZ251bSgpOyApIHsKICAgICAgICAgIGZvciAoOyBkLmlzRXZlbigpOyApCiAgICAgICAgICAgIGQuclNoaWZ0VG8oMSwgZCksCiAgICAgICAgICAgICAgYwogICAgICAgICAgICAgICAgPyAoKGYuaXNFdmVuKCkgJiYgZy5pc0V2ZW4oKSkgfHwKICAgICAgICAgICAgICAgICAgICAoZi5hZGRUbyh0aGlzLCBmKSwgZy5zdWJUbyhhLCBnKSksCiAgICAgICAgICAgICAgICAgIGYuclNoaWZ0VG8oMSwgZikpCiAgICAgICAgICAgICAgICA6IGcuaXNFdmVuKCkgfHwgZy5zdWJUbyhhLCBnKSwKICAgICAgICAgICAgICBnLnJTaGlmdFRvKDEsIGcpCiAgICAgICAgICBmb3IgKDsgZS5pc0V2ZW4oKTsgKQogICAgICAgICAgICBlLnJTaGlmdFRvKDEsIGUpLAogICAgICAgICAgICAgIGMKICAgICAgICAgICAgICAgID8gKChoLmlzRXZlbigpICYmIGIuaXNFdmVuKCkpIHx8CiAgICAgICAgICAgICAgICAgICAgKGguYWRkVG8odGhpcywgaCksIGIuc3ViVG8oYSwgYikpLAogICAgICAgICAgICAgICAgICBoLnJTaGlmdFRvKDEsIGgpKQogICAgICAgICAgICAgICAgOiBiLmlzRXZlbigpIHx8IGIuc3ViVG8oYSwgYiksCiAgICAgICAgICAgICAgYi5yU2hpZnRUbygxLCBiKQogICAgICAgICAgMCA8PSBkLmNvbXBhcmVUbyhlKQogICAgICAgICAgICA/IChkLnN1YlRvKGUsIGQpLCBjICYmIGYuc3ViVG8oaCwgZiksIGcuc3ViVG8oYiwgZykpCiAgICAgICAgICAgIDogKGUuc3ViVG8oZCwgZSksIGMgJiYgaC5zdWJUbyhmLCBoKSwgYi5zdWJUbyhnLCBiKSkKICAgICAgICB9CiAgICAgICAgaWYgKDAgIT09IGUuY29tcGFyZVRvKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUpKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPCiAgICAgICAgaWYgKDAgPD0gYi5jb21wYXJlVG8oYSkpIHJldHVybiBiLnN1YnRyYWN0KGEpCiAgICAgICAgaWYgKDAgPiBiLnNpZ251bSgpKSBiLmFkZFRvKGEsIGIpCiAgICAgICAgZWxzZSByZXR1cm4gYgogICAgICAgIHJldHVybiAwID4gYi5zaWdudW0oKSA/IGIuYWRkKGEpIDogYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMgPSBbCiAgICAgICAgMiwKICAgICAgICAzLAogICAgICAgIDUsCiAgICAgICAgNywKICAgICAgICAxMSwKICAgICAgICAxMywKICAgICAgICAxNywKICAgICAgICAxOSwKICAgICAgICAyMywKICAgICAgICAyOSwKICAgICAgICAzMSwKICAgICAgICAzNywKICAgICAgICA0MSwKICAgICAgICA0MywKICAgICAgICA0NywKICAgICAgICA1MywKICAgICAgICA1OSwKICAgICAgICA2MSwKICAgICAgICA2NywKICAgICAgICA3MSwKICAgICAgICA3MywKICAgICAgICA3OSwKICAgICAgICA4MywKICAgICAgICA4OSwKICAgICAgICA5NywKICAgICAgICAxMDEsCiAgICAgICAgMTAzLAogICAgICAgIDEwNywKICAgICAgICAxMDksCiAgICAgICAgMTEzLAogICAgICAgIDEyNywKICAgICAgICAxMzEsCiAgICAgICAgMTM3LAogICAgICAgIDEzOSwKICAgICAgICAxNDksCiAgICAgICAgMTUxLAogICAgICAgIDE1NywKICAgICAgICAxNjMsCiAgICAgICAgMTY3LAogICAgICAgIDE3MywKICAgICAgICAxNzksCiAgICAgICAgMTgxLAogICAgICAgIDE5MSwKICAgICAgICAxOTMsCiAgICAgICAgMTk3LAogICAgICAgIDE5OSwKICAgICAgICAyMTEsCiAgICAgICAgMjIzLAogICAgICAgIDIyNywKICAgICAgICAyMjksCiAgICAgICAgMjMzLAogICAgICAgIDIzOSwKICAgICAgICAyNDEsCiAgICAgICAgMjUxLAogICAgICAgIDI1NywKICAgICAgICAyNjMsCiAgICAgICAgMjY5LAogICAgICAgIDI3MSwKICAgICAgICAyNzcsCiAgICAgICAgMjgxLAogICAgICAgIDI4MywKICAgICAgICAyOTMsCiAgICAgICAgMzA3LAogICAgICAgIDMxMSwKICAgICAgICAzMTMsCiAgICAgICAgMzE3LAogICAgICAgIDMzMSwKICAgICAgICAzMzcsCiAgICAgICAgMzQ3LAogICAgICAgIDM0OSwKICAgICAgICAzNTMsCiAgICAgICAgMzU5LAogICAgICAgIDM2NywKICAgICAgICAzNzMsCiAgICAgICAgMzc5LAogICAgICAgIDM4MywKICAgICAgICAzODksCiAgICAgICAgMzk3LAogICAgICAgIDQwMSwKICAgICAgICA0MDksCiAgICAgICAgNDE5LAogICAgICAgIDQyMSwKICAgICAgICA0MzEsCiAgICAgICAgNDMzLAogICAgICAgIDQzOSwKICAgICAgICA0NDMsCiAgICAgICAgNDQ5LAogICAgICAgIDQ1NywKICAgICAgICA0NjEsCiAgICAgICAgNDYzLAogICAgICAgIDQ2NywKICAgICAgICA0NzksCiAgICAgICAgNDg3LAogICAgICAgIDQ5MSwKICAgICAgICA0OTksCiAgICAgICAgNTAzLAogICAgICAgIDUwOSwKICAgICAgXQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubHBsaW0gPQogICAgICAgIDY3MTA4ODY0IC8KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzWwogICAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lcy5sZW5ndGggLSAxCiAgICAgICAgXQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuSXNQcm9iYWJsZVByaW1lID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYywKICAgICAgICAgIGQgPSB0aGlzLmFicygpCiAgICAgICAgaWYgKAogICAgICAgICAgMSA9PSBkLnQgJiYKICAgICAgICAgIGRbMF0gPD0KICAgICAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lc1sKICAgICAgICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzLmxlbmd0aCAtIDEKICAgICAgICAgICAgXQogICAgICAgICkgewogICAgICAgICAgZm9yIChjID0gMDsgYyA8IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoOyArK2MpCiAgICAgICAgICAgIGlmIChkWzBdID09IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXNbY10pIHJldHVybiAhMAogICAgICAgICAgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIGlmIChkLmlzRXZlbigpKSByZXR1cm4gITEKICAgICAgICBmb3IgKGMgPSAxOyBjIDwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lcy5sZW5ndGg7ICkgewogICAgICAgICAgdmFyIGUgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzW2NdCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBiID0gYyArIDE7CiAgICAgICAgICAgIGIgPCBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzLmxlbmd0aCAmJgogICAgICAgICAgICBlIDwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxwbGltOwoKICAgICAgICAgICkKICAgICAgICAgICAgZSAqPSBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzW2IrK10KICAgICAgICAgIGZvciAoZSA9IGQubW9kSW50KGUpOyBjIDwgYjsgKQogICAgICAgICAgICBpZiAoMCA9PT0gZSAlIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXNbYysrXSkgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIHJldHVybiBkLm1pbGxlclJhYmluKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBNaWxsZXJSYWJpbiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGMsCiAgICAgICAgICBkID0gdGhpcy5zdWJ0cmFjdChTay5idWlsdGluLmJpZ2ludGVnZXIuT05FKSwKICAgICAgICAgIGUgPSBkLmdldExvd2VzdFNldEJpdCgpCiAgICAgICAgaWYgKDAgPj0gZSkgcmV0dXJuICExCiAgICAgICAgdmFyIGYgPSBkLnNoaWZ0UmlnaHQoZSkKICAgICAgICBhID0gKGEgKyAxKSA+PiAxCiAgICAgICAgYSA+IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoICYmCiAgICAgICAgICAoYSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoKQogICAgICAgIHZhciBnID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGE7ICsrYykgewogICAgICAgICAgZy5mcm9tSW50KFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXNbY10pCiAgICAgICAgICB2YXIgaCA9IGcubW9kUG93KGYsIHRoaXMpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIDAgIT09IGguY29tcGFyZVRvKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUpICYmCiAgICAgICAgICAgIDAgIT09IGguY29tcGFyZVRvKGQpCiAgICAgICAgICApIHsKICAgICAgICAgICAgZm9yIChiID0gMTsgYisrIDwgZSAmJiAwICE9PSBoLmNvbXBhcmVUbyhkKTsgKQogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICgoaCA9IGgubW9kUG93SW50KDIsIHRoaXMpKSwKICAgICAgICAgICAgICAgIDAgPT09IGguY29tcGFyZVRvKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUpKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICBpZiAoMCAhPT0gaC5jb21wYXJlVG8oZCkpIHJldHVybiAhMQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gITAKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmlzbmVnYXRpdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMucwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuaXNwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMucwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUudHJ1ZUNvbXBhcmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIDAgPD0gdGhpcy5zICYmIDAgPiBhLnMKICAgICAgICAgID8gMQogICAgICAgICAgOiAwID4gdGhpcy5zICYmIDAgPD0gYS5zCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IHRoaXMuY29tcGFyZShhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2h1bmtTaXplID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENodW5rU2l6ZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnRvUmFkaXggPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wVG9SYWRpeAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmZyb21SYWRpeCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tUmFkaXgKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5mcm9tTnVtYmVyID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEZyb21OdW1iZXIKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iaXR3aXNlVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQml0d2lzZVRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2hhbmdlQml0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENoYW5nZUJpdAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmFkZFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEFkZFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZE11bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERNdWx0aXBseQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRBZGRPZmZzZXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wREFkZE9mZnNldAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm11bHRpcGx5TG93ZXJUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBNdWx0aXBseUxvd2VyVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tdWx0aXBseVVwcGVyVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wTXVsdGlwbHlVcHBlclRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubW9kSW50ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE1vZEludAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1pbGxlclJhYmluID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE1pbGxlclJhYmluCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2xvbmUgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5DbG9uZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmludFZhbHVlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuSW50VmFsdWUKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ieXRlVmFsdWUgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5CeXRlVmFsdWUKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zaG9ydFZhbHVlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2hvcnRWYWx1ZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnNpZ251bSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNpZ051bQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnRvQnl0ZUFycmF5ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuVG9CeXRlQXJyYXkKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5lcXVhbHMgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5FcXVhbHMKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jb21wYXJlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNvbXBhcmVUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1pbiA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1pbgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1heCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1heAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmFuZCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkFuZAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm9yID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk9yCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUueG9yID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuWG9yCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW5kTm90ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQW5kTm90CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubm90ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTm90CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuc2hpZnRMZWZ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2hpZnRMZWZ0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuc2hpZnRSaWdodCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNoaWZ0UmlnaHQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5nZXRMb3dlc3RTZXRCaXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5HZXRMb3dlc3RTZXRCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iaXRDb3VudCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJpdENvdW50CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUudGVzdEJpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblRlc3RCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zZXRCaXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5TZXRCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jbGVhckJpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkNsZWFyQml0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZmxpcEJpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkZsaXBCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5hZGQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5BZGQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zdWJ0cmFjdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblN1YnRyYWN0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5NdWx0aXBseQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkRpdmlkZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnJlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblJlbWFpbmRlcgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRpdmlkZUFuZFJlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkRpdmlkZUFuZFJlbWFpbmRlcgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vZFBvdyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1vZFBvdwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vZEludmVyc2UgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Nb2RJbnZlcnNlCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUucG93ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuUG93CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZ2NkID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuR0NECiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuaXNQcm9iYWJsZVByaW1lID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuSXNQcm9iYWJsZVByaW1lCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLmludF8gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEsIGIpCiAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLmJvb2wpIHJldHVybiB0aGlzCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgdm9pZCAwID09PSBiKQogICAgICAgICAgcmV0dXJuICh0aGlzLnYgPSBhLnYpLCB0aGlzCiAgICAgICAgaWYgKAogICAgICAgICAgYiAhPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkICYmCiAgICAgICAgICB2b2lkIDAgIT09IGIgJiYKICAgICAgICAgICFTay5idWlsdGluLmNoZWNrSW50KGIpCiAgICAgICAgKSB7CiAgICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0Zsb2F0KGIpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImludGVnZXIgYXJndW1lbnQgZXhwZWN0ZWQsIGdvdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICAgICkKICAgICAgICAgIGlmIChiLl9faW5kZXhfXykgYiA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLl9faW5kZXhfXywgW2JdKQogICAgICAgICAgZWxzZSBpZiAoYi5fX2ludF9fKSBiID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGIuX19pbnRfXywgW2JdKQogICAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSArCiAgICAgICAgICAgICAgICAiIGluc3RhbmNlIGhhcyBubyBhdHRyaWJ1dGUgJ19faW5kZXhfXycgb3IgJ19faW50X18nIiwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSB7CiAgICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICAgIGIgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJiAoYiA9IDEwKQogICAgICAgICAgdmFyIGMgPSBTay5zdHIybnVtYmVyKAogICAgICAgICAgICBhLnYsCiAgICAgICAgICAgIGIsCiAgICAgICAgICAgIHBhcnNlSW50LAogICAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC1hCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJpbnQiLAogICAgICAgICAgKQogICAgICAgICAgaWYgKGMgPiBTay5idWlsdGluLmludF8udGhyZXNob2xkJCB8fCBjIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGEsIGIpCiAgICAgICAgICB0aGlzLnYgPSBjCiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmIGIgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImludCgpIGNhbid0IGNvbnZlcnQgbm9uLXN0cmluZyB3aXRoIGV4cGxpY2l0IGJhc2UiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEgfHwgYSA9PT0gU2suYnVpbHRpbi5ub25lKSBhID0gMAogICAgICAgIGlmICgKICAgICAgICAgIHZvaWQgMCAhPT0gYSAmJgogICAgICAgICAgYS50cCRnZXRhdHRyICYmCiAgICAgICAgICAoYyA9IGEudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kaW50XykpCiAgICAgICAgKSB7CiAgICAgICAgICB2YXIgZCA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjKQogICAgICAgICAgdmFyIGUgPSAiX19pbnRfXyIKICAgICAgICB9IGVsc2UKICAgICAgICAgIHZvaWQgMCAhPT0gYSAmJiBhLl9faW50X18KICAgICAgICAgICAgPyAoKGQgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX2ludF9fLCBbYV0pKSwgKGUgPSAiX19pbnRfXyIpKQogICAgICAgICAgICA6IHZvaWQgMCAhPT0gYSAmJgogICAgICAgICAgICAgIGEudHAkZ2V0YXR0ciAmJgogICAgICAgICAgICAgIChjID0gYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiR0cnVuYykpCiAgICAgICAgICAgID8gKChkID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMpKSwgKGUgPSAiX190cnVuY19fIikpCiAgICAgICAgICAgIDogdm9pZCAwICE9PSBhICYmCiAgICAgICAgICAgICAgYS5fX3RydW5jX18gJiYKICAgICAgICAgICAgICAoKGQgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX3RydW5jX18sIFthXSkpLAogICAgICAgICAgICAgIChlID0gIl9fdHJ1bmNfXyIpKQogICAgICAgIGlmICh2b2lkIDAgPT09IGQgfHwgU2suYnVpbHRpbi5jaGVja0ludChkKSkgdm9pZCAwICE9PSBkICYmIChhID0gZCkKICAgICAgICBlbHNlCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgIGUgKyAiIHJldHVybmVkIG5vbi1JbnRlZ3JhbCAodHlwZSAiICsgU2suYWJzdHIudHlwZU5hbWUoZCkgKyAiKSIsCiAgICAgICAgICApCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaW50KCkgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyBvciBhIG51bWJlciwgbm90ICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmIChhID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwgYSA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoYSkKICAgICAgICA7LTEgPCBhICYmIDEgPiBhICYmIChhID0gMCkKICAgICAgICB0aGlzLnYgPSBwYXJzZUludChhLCBiKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLiRzaGlmdGNvbnN0cyA9IFsKICAgICAgICAwLjUsCiAgICAgICAgMSwKICAgICAgICAyLAogICAgICAgIDQsCiAgICAgICAgOCwKICAgICAgICAxNiwKICAgICAgICAzMiwKICAgICAgICA2NCwKICAgICAgICAxMjgsCiAgICAgICAgMjU2LAogICAgICAgIDUxMiwKICAgICAgICAxMDI0LAogICAgICAgIDIwNDgsCiAgICAgICAgNDA5NiwKICAgICAgICA4MTkyLAogICAgICAgIDE2Mzg0LAogICAgICAgIDMyNzY4LAogICAgICAgIDY1NTM2LAogICAgICAgIDEzMTA3MiwKICAgICAgICAyNjIxNDQsCiAgICAgICAgNTI0Mjg4LAogICAgICAgIDEwNDg1NzYsCiAgICAgICAgMjA5NzE1MiwKICAgICAgICA0MTk0MzA0LAogICAgICAgIDgzODg2MDgsCiAgICAgICAgMTY3NzcyMTYsCiAgICAgICAgMzM1NTQ0MzIsCiAgICAgICAgNjcxMDg4NjQsCiAgICAgICAgMTM0MjE3NzI4LAogICAgICAgIDI2ODQzNTQ1NiwKICAgICAgICA1MzY4NzA5MTIsCiAgICAgICAgMTA3Mzc0MTgyNCwKICAgICAgICAyMTQ3NDgzNjQ4LAogICAgICAgIDQyOTQ5NjcyOTYsCiAgICAgICAgODU4OTkzNDU5MiwKICAgICAgICAxNzE3OTg2OTE4NCwKICAgICAgICAzNDM1OTczODM2OCwKICAgICAgICA2ODcxOTQ3NjczNiwKICAgICAgICAxMzc0Mzg5NTM0NzIsCiAgICAgICAgMjc0ODc3OTA2OTQ0LAogICAgICAgIDU0OTc1NTgxMzg4OCwKICAgICAgICAxMDk5NTExNjI3Nzc2LAogICAgICAgIDIxOTkwMjMyNTU1NTIsCiAgICAgICAgNDM5ODA0NjUxMTEwNCwKICAgICAgICA4Nzk2MDkzMDIyMjA4LAogICAgICAgIDE3NTkyMTg2MDQ0NDE2LAogICAgICAgIDM1MTg0MzcyMDg4ODMyLAogICAgICAgIDcwMzY4NzQ0MTc3NjY0LAogICAgICAgIDB4ODAwMDAwMDAwMDAwLAogICAgICAgIDI4MTQ3NDk3NjcxMDY1NiwKICAgICAgICA1NjI5NDk5NTM0MjEzMTIsCiAgICAgICAgMHg0MDAwMDAwMDAwMDAwLAogICAgICAgIDB4ODAwMDAwMDAwMDAwMCwKICAgICAgICA0NTAzNTk5NjI3MzcwNDk2LAogICAgICAgIDkwMDcxOTkyNTQ3NDA5OTIsCiAgICAgIF0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgiaW50IiwgU2suYnVpbHRpbi5pbnRfLCBTay5idWlsdGluLm51bXR5cGUpCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW50XyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRmbG9hdF8gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudikKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGxuZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuX190cnVuY19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5fX2luZGV4X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYQogICAgICB9KQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLl9fY29tcGxleF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUudHAkaW5kZXggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy52CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8odGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkID0gTWF0aC5wb3coMiwgNTMpIC0gMQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8odGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYWRkID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSB7CiAgICAgICAgICB2YXIgYiA9IHRoaXMudiArIGEudgogICAgICAgICAgcmV0dXJuIGIgPiBTay5idWlsdGluLmludF8udGhyZXNob2xkJCB8fAogICAgICAgICAgICBiIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkCiAgICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJGFkZChhKSkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKGIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJGFkZChhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpKSwgYi5uYiRhZGQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfYWRkID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGFkZC5jYWxsKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRzdWJ0cmFjdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgewogICAgICAgICAgdmFyIGIgPSB0aGlzLnYgLSBhLnYKICAgICAgICAgIHJldHVybiBiID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwKICAgICAgICAgICAgYiA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJAogICAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRzdWJ0cmFjdChhKSkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKGIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJHN1YnRyYWN0KGEpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudikpLCBiLm5iJHN1YnRyYWN0KGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3N1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uYiRuZWdhdGl2ZSgpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYWRkLmNhbGwoYiwgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSB7CiAgICAgICAgICB2YXIgYiA9IHRoaXMudiAqIGEudgogICAgICAgICAgcmV0dXJuIGIgPiBTay5idWlsdGluLmludF8udGhyZXNob2xkJCB8fAogICAgICAgICAgICBiIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkCiAgICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJG11bHRpcGx5KGEpKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmludF8oYikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGIubmIkbXVsdGlwbHkoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KSksIGIubmIkbXVsdGlwbHkoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfbXVsdGlwbHkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbXVsdGlwbHkuY2FsbCh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkZGl2aWRlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmRpdmlzaW9uKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpCiAgICAgICAgICByZXR1cm4gYi5uYiRkaXZpZGUoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gdGhpcy5uYiRmbG9vcl9kaXZpZGUoYSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRkaXZpZGUoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KSksIGIubmIkZGl2aWRlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5uYiRyZWZsZWN0ZWRfZmxvb3JfZGl2aWRlKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIGlmICgwID09PSBhLnYpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oTWF0aC5mbG9vcih0aGlzLnYgLyBhLnYpKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpCiAgICAgICAgICByZXR1cm4gYi5uYiRmbG9vcl9kaXZpZGUoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KSksIGIubmIkZmxvb3JfZGl2aWRlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XwogICAgICAgICAgPyBhLm5iJGRpdmlkZSh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVtYWluZGVyID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSB7CiAgICAgICAgICB2YXIgYiA9IFNrLmFic3RyLm51bWJlckJpbk9wKHRoaXMsIGEsICJGbG9vckRpdiIpCiAgICAgICAgICBiID0gU2suYWJzdHIubnVtYmVyQmluT3AoYiwgYSwgIk11bHQiKQogICAgICAgICAgYiA9IFNrLmFic3RyLm51bWJlckJpbk9wKHRoaXMsIGIsICJTdWIiKQogICAgICAgICAgYiA9IGIudgogICAgICAgICAgMCA+IGEudiAmJiAwID09PSBiCiAgICAgICAgICAgID8gKGIgPSAtMCkKICAgICAgICAgICAgOiAwID09PSBiICYmIC1JbmZpbml0eSA9PT0gSW5maW5pdHkgLyBiICYmIChiID0gMCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJHJlbWFpbmRlcihhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpKSwgYi5uYiRyZW1haW5kZXIoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfcmVtYWluZGVyID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IGEubmIkcmVtYWluZGVyKHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRkaXZtb2QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICB0aGlzLm5iJGZsb29yX2RpdmlkZShhKSwKICAgICAgICAgICAgdGhpcy5uYiRyZW1haW5kZXIoYSksCiAgICAgICAgICBdKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikKICAgICAgICAgIHJldHVybiBiLm5iJGRpdm1vZChhKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpKSwgYi5uYiRkaXZtb2QoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfZGl2bW9kID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICBhLm5iJGZsb29yX2RpdmlkZSh0aGlzKSwKICAgICAgICAgICAgICBhLm5iJHJlbWFpbmRlcih0aGlzKSwKICAgICAgICAgICAgXSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHBvd2VyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICgKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYKICAgICAgICAgICh2b2lkIDAgPT09IGIgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykKICAgICAgICApIHsKICAgICAgICAgIHZhciBjID0gTWF0aC5wb3codGhpcy52LCBhLnYpCiAgICAgICAgICBjID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwgYyA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJAogICAgICAgICAgICA/ICgoYyA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgKGMgPSBjLm5iJHBvd2VyKGEsIGIpKSkKICAgICAgICAgICAgOiAoYyA9IDAgPiBhLnYgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYykgOiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgewogICAgICAgICAgICBpZiAoMCA+IGEudikKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAicG93KCkgMm5kIGFyZ3VtZW50IGNhbm5vdCBiZSBuZWdhdGl2ZSB3aGVuIDNyZCBhcmd1bWVudCBzcGVjaWZpZWQiLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGMubmIkcmVtYWluZGVyKGIpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYwogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYyA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYy5uYiRwb3dlcihhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpKSwgYi5uYiRwb3dlcihhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9wb3dlciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XwogICAgICAgICAgPyBhLm5iJHBvd2VyKHRoaXMsIGIpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRhYnMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhNYXRoLmFicyh0aGlzLnYpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYW5kID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSB7CiAgICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIHZhciBiID0gdGhpcy52ICYgYQogICAgICAgICAgdm9pZCAwICE9PSBiICYmIDAgPiBiICYmIChiICs9IDQyOTQ5NjcyOTYpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBiKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRhbmQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfYW5kID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGFuZAogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJG9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSB7CiAgICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIHZhciBiID0gdGhpcy52IHwgYQogICAgICAgICAgdm9pZCAwICE9PSBiICYmIDAgPiBiICYmIChiICs9IDQyOTQ5NjcyOTYpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBiKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRhbmQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfb3IgPQogICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkb3IKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiR4b3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgICAgdmFyIGIgPSB0aGlzLnYgXiBhCiAgICAgICAgICB2b2lkIDAgIT09IGIgJiYgMCA+IGIgJiYgKGIgKz0gNDI5NDk2NzI5NikKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJHhvcihhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF94b3IgPQogICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkeG9yCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbHNoaWZ0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmICgwID09PSB0aGlzLnYpIHJldHVybiB0aGlzCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHsKICAgICAgICAgICAgaWYgKDAgPiBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICAgIGlmICg1MyA8IGIpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpLm5iJGxzaGlmdCgKICAgICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmludF8oYiksCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB2YXIgYyA9IDIgKiB0aGlzLnYgKiBTay5idWlsdGluLmludF8uJHNoaWZ0Y29uc3RzW2JdCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBjID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwKICAgICAgICAgICAgICBjIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkCiAgICAgICAgICAgICkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGMpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAodm9pZCAwICE9PSBjKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhjKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYyA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYy5uYiRsc2hpZnQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfbHNoaWZ0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IGEubmIkbHNoaWZ0KHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyc2hpZnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHsKICAgICAgICAgICAgaWYgKDAgPiBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICAgIHZhciBjID0gdGhpcy52ID4+IGIKICAgICAgICAgICAgMCA8IHRoaXMudiAmJiAwID4gYyAmJiAoYyAmPSBNYXRoLnBvdygyLCAzMiAtIGIpIC0gMSkKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gKChjID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBjLm5iJHJzaGlmdChhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9yc2hpZnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gYS5uYiRyc2hpZnQodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGludmVydCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKH50aGlzLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRhZGQKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3N1YnRyYWN0ID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHN1YnRyYWN0CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9tdWx0aXBseSA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRtdWx0aXBseQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGRpdmlkZQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfcmVtYWluZGVyID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlbWFpbmRlcgogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfZmxvb3JfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfcG93ZXIgPQogICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcG93ZXIKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FuZCA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRhbmQKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX29yID0gU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRvcgogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfeG9yID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHhvcgogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfbHNoaWZ0ID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGxzaGlmdAogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfcnNoaWZ0ID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJzaGlmdAogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJG5lZ2F0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oLXRoaXMudikKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbm9uemVybyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwICE9PSB0aGlzLnYKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlzbmVnYXRpdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaXNwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubnVtYmVyQ29tcGFyZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XwogICAgICAgICAgPyB0aGlzLnYgLSBhLnYKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IC1hLmxvbmdDb21wYXJlKHRoaXMpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAtYS5udW1iZXJDb21wYXJlKHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5vYiRlcSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID09IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5vYiRuZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwICE9IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm9iJGx0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPiB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5vYiRsZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID49IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm9iJGd0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPCB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5vYiRnZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwIDw9IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLnJvdW5kJCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3JvdW5kX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIgJiYgIVNrLm1pc2NldmFsLmlzSW5kZXgoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYikgKwogICAgICAgICAgICAgICInIG9iamVjdCBjYW5ub3QgYmUgaW50ZXJwcmV0ZWQgYXMgYW4gaW5kZXgiLAogICAgICAgICAgKQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICB2YXIgZCA9IHZvaWQgMCA9PT0gYiA/IDAgOiBTay5taXNjZXZhbC5hc0luZGV4KGIpCiAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18uYmFua2Vyc19yb3VuZGluZykgewogICAgICAgICAgYyAqPSBNYXRoLnBvdygxMCwgZCkKICAgICAgICAgIHZhciBlID0gTWF0aC5yb3VuZChjKQogICAgICAgICAgZCA9CiAgICAgICAgICAgICgwLjUgPT09ICgwIDwgYyA/IGMgOiAtYykgJSAxID8gKDAgPT09IGUgJSAyID8gZSA6IGUgLSAxKSA6IGUpIC8KICAgICAgICAgICAgTWF0aC5wb3coMTAsIGQpCiAgICAgICAgfSBlbHNlIChkID0gTWF0aC5wb3coMTAsIGQpKSwgKGQgPSBNYXRoLnJvdW5kKGMgKiBkKSAvIGQpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLl9fZm9ybWF0X18gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mb3JtYXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpIHsKICAgICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgaWYgKCIiICE9PSBjKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQgc3BlYyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICAgKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImZvcm1hdCgpIGFyZ3VtZW50IDIgbXVzdCBiZSBzdHIsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImZvcm1hdCBleHBlY3RzIGFyZyAyIHRvIGJlIHN0cmluZyBvciB1bmljb2RlLCBub3QgIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLmNvbmp1Z2F0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEudikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS50cCRzdHIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMuc3RyJCgxMCwgITApKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuc3RyJCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSAhMCkKICAgICAgICBiID0gYiA/IHRoaXMudiA6IE1hdGguYWJzKHRoaXMudikKICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhIHx8IDEwID09PSBhID8gYi50b1N0cmluZygpIDogYi50b1N0cmluZyhhKQogICAgICB9CiAgICAgIFNrLnN0cjJudW1iZXIgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGYgPSBhLAogICAgICAgICAgZyA9ICExLAogICAgICAgICAgaAogICAgICAgIGEgPSBhLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAiIikKICAgICAgICAiLSIgPT09IGEuY2hhckF0KDApICYmICgoZyA9ICEwKSwgKGEgPSBhLnN1YnN0cmluZygxKSkpCiAgICAgICAgIisiID09PSBhLmNoYXJBdCgwKSAmJiAoYSA9IGEuc3Vic3RyaW5nKDEpKQogICAgICAgIGlmIChudWxsID09PSBiIHx8IHZvaWQgMCA9PT0gYikgYiA9IDEwCiAgICAgICAgaWYgKCgyID4gYiB8fCAzNiA8IGIpICYmIDAgIT09IGIpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKGUgKyAiKCkgYmFzZSBtdXN0IGJlID49IDIgYW5kIDw9IDM2IikKICAgICAgICBpZiAoIjB4IiA9PT0gYS5zdWJzdHJpbmcoMCwgMikudG9Mb3dlckNhc2UoKSkKICAgICAgICAgIGlmICgxNiA9PT0gYiB8fCAwID09PSBiKSAoYSA9IGEuc3Vic3RyaW5nKDIpKSwgKGIgPSAxNikKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAoMzQgPiBiKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAiaW52YWxpZCBsaXRlcmFsIGZvciAiICsKICAgICAgICAgICAgICAgICAgZSArCiAgICAgICAgICAgICAgICAgICIoKSB3aXRoIGJhc2UgIiArCiAgICAgICAgICAgICAgICAgIGIgKwogICAgICAgICAgICAgICAgICAiOiAnIiArCiAgICAgICAgICAgICAgICAgIGYgKwogICAgICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKCIwYiIgPT09IGEuc3Vic3RyaW5nKDAsIDIpLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgICBpZiAoMiA9PT0gYiB8fCAwID09PSBiKSAoYSA9IGEuc3Vic3RyaW5nKDIpKSwgKGIgPSAyKQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICgxMiA+IGIpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICJpbnZhbGlkIGxpdGVyYWwgZm9yICIgKwogICAgICAgICAgICAgICAgICBlICsKICAgICAgICAgICAgICAgICAgIigpIHdpdGggYmFzZSAiICsKICAgICAgICAgICAgICAgICAgYiArCiAgICAgICAgICAgICAgICAgICI6ICciICsKICAgICAgICAgICAgICAgICAgZiArCiAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIjBvIiA9PT0gYS5zdWJzdHJpbmcoMCwgMikudG9Mb3dlckNhc2UoKSkKICAgICAgICAgIGlmICg4ID09PSBiIHx8IDAgPT09IGIpIChhID0gYS5zdWJzdHJpbmcoMikpLCAoYiA9IDgpCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKDI1ID4gYikKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgImludmFsaWQgbGl0ZXJhbCBmb3IgIiArCiAgICAgICAgICAgICAgICAgIGUgKwogICAgICAgICAgICAgICAgICAiKCkgd2l0aCBiYXNlICIgKwogICAgICAgICAgICAgICAgICBiICsKICAgICAgICAgICAgICAgICAgIjogJyIgKwogICAgICAgICAgICAgICAgICBmICsKICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICBlbHNlIGlmICgiMCIgPT09IGEuY2hhckF0KDApKSB7CiAgICAgICAgICBpZiAoIjAiID09PSBhKSByZXR1cm4gMAogICAgICAgICAgaWYgKDggPT09IGIgfHwgMCA9PT0gYikgYiA9IDgKICAgICAgICB9CiAgICAgICAgMCA9PT0gYiAmJiAoYiA9IDEwKQogICAgICAgIGlmICgwID09PSBhLmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICJpbnZhbGlkIGxpdGVyYWwgZm9yICIgKyBlICsgIigpIHdpdGggYmFzZSAiICsgYiArICI6ICciICsgZiArICInIiwKICAgICAgICAgICkKICAgICAgICBmb3IgKGggPSAwOyBoIDwgYS5sZW5ndGg7IGggKz0gMSkgewogICAgICAgICAgdmFyIGsgPSBhLmNoYXJDb2RlQXQoaCkKICAgICAgICAgIHZhciBsID0gYgogICAgICAgICAgNDggPD0gayAmJiA1NyA+PSBrCiAgICAgICAgICAgID8gKGwgPSBrIC0gNDgpCiAgICAgICAgICAgIDogNjUgPD0gayAmJiA5MCA+PSBrCiAgICAgICAgICAgID8gKGwgPSBrIC0gNjUgKyAxMCkKICAgICAgICAgICAgOiA5NyA8PSBrICYmIDEyMiA+PSBrICYmIChsID0gayAtIDk3ICsgMTApCiAgICAgICAgICBpZiAobCA+PSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICJpbnZhbGlkIGxpdGVyYWwgZm9yICIgKwogICAgICAgICAgICAgICAgZSArCiAgICAgICAgICAgICAgICAiKCkgd2l0aCBiYXNlICIgKwogICAgICAgICAgICAgICAgYiArCiAgICAgICAgICAgICAgICAiOiAnIiArCiAgICAgICAgICAgICAgICBmICsKICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBsID0gYyhhLCBiKQogICAgICAgIGcgJiYgKGwgPSBkKGwpKQogICAgICAgIHJldHVybiBsCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmludF8iLCBTay5idWlsdGluLmludF8pCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLmJvb2wgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiYm9vbCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmlzVHJ1ZShhKQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoImJvb2wiLCBTay5idWlsdGluLmJvb2wsIFNrLmJ1aWx0aW4uaW50XykKICAgICAgU2suYnVpbHRpbi5ib29sLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnYgPyBuZXcgU2suYnVpbHRpbi5zdHIoIlRydWUiKSA6IG5ldyBTay5idWlsdGluLnN0cigiRmFsc2UiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYm9vbC5wcm90b3R5cGUudHAkaGFzaCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKHRoaXMudikKICAgICAgfQogICAgICBTay5idWlsdGluLmJvb2wucHJvdG90eXBlLl9faW50X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhKQogICAgICB9KQogICAgICBTay5idWlsdGluLmJvb2wucHJvdG90eXBlLl9fZmxvYXRfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oU2suZmZpLnJlbWFwVG9KcyhhKSkKICAgICAgfSkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmJvb2wiLCBTay5idWlsdGluLmJvb2wpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLmZsb2F0XyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSByZXR1cm4gU2suYnVpbHRpbi5fc3RyX3RvX2Zsb2F0KGEudikKICAgICAgICBpZiAoCiAgICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIGEgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgKSB7CiAgICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIHJldHVybiBTay5idWlsdGluLl9zdHJfdG9fZmxvYXQoYSkKICAgICAgICAgIHRoaXMudiA9IGEKICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ib29sKQogICAgICAgICAgcmV0dXJuICh0aGlzLnYgPSBTay5idWlsdGluLmFzbnVtJChhKSksIHRoaXMKICAgICAgICBpZiAoImJvb2xlYW4iID09PSB0eXBlb2YgYSkgcmV0dXJuICh0aGlzLnYgPSBhID8gMSA6IDApLCB0aGlzCiAgICAgICAgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgcmV0dXJuICh0aGlzLnYgPSBwYXJzZUZsb2F0KGEpKSwgdGhpcwogICAgICAgIHZhciBiID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kZmxvYXRfKQogICAgICAgIGlmIChudWxsICE9IGIpIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2FdKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJmbG9hdCgpIGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcgb3IgYSBudW1iZXIiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJmbG9hdCIsIFNrLmJ1aWx0aW4uZmxvYXRfLCBTay5idWlsdGluLm51bXR5cGUpCiAgICAgIFNrLmJ1aWx0aW4uX3N0cl90b19mbG9hdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYS5tYXRjaCgvXi1pbmYkL2kpKSBhID0gLUluZmluaXR5CiAgICAgICAgZWxzZSBpZiAoYS5tYXRjaCgvXlsrXT9pbmYkL2kpKSBhID0gSW5maW5pdHkKICAgICAgICBlbHNlIGlmIChhLm1hdGNoKC9eWy0rXT9uYW4kL2kpKSBhID0gTmFOCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBpZiAoaXNOYU4oYSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgImZsb2F0OiBBcmd1bWVudDogIiArIGEgKyAiIGlzIG5vdCBudW1iZXIiLAogICAgICAgICAgICApCiAgICAgICAgICBhID0gcGFyc2VGbG9hdChhKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGludF8gPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9IHRoaXMudgogICAgICAgIGEgPSAwID4gYSA/IE1hdGguY2VpbChhKSA6IE1hdGguZmxvb3IoYSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRmbG9hdF8gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRsbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5QeUZsb2F0X0NoZWNrID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IGEKICAgICAgICAgID8gITEKICAgICAgICAgIDogU2suYnVpbHRpbi5jaGVja051bWJlcihhKSB8fAogICAgICAgICAgICBTay5idWlsdGluLmNoZWNrRmxvYXQoYSkgfHwKICAgICAgICAgICAgU2suYnVpbHRpbi5pc3N1YmNsYXNzKGEub2IkdHlwZSwgU2suYnVpbHRpbi5mbG9hdF8pCiAgICAgICAgICA/ICEwCiAgICAgICAgICA6ICExCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8uUHlGbG9hdF9DaGVja19FeGFjdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jaGVja0Zsb2F0KGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8uUHlGbG9hdF9Bc0RvdWJsZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSAmJiBTay5idWlsdGluLmZsb2F0Xy5QeUZsb2F0X0NoZWNrKGEpKSByZXR1cm4gU2suZmZpLnJlbWFwVG9KcyhhKQogICAgICAgIGlmIChudWxsID09IGEpCiAgICAgICAgICB0aHJvdyBFcnJvcigiYmFkIGFyZ3VtZW50IGZvciBpbnRlcm5hbCBQeUZsb2F0X0FzRG91YmxlIGZ1bmN0aW9uIikKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4udHlwZS50eXBlTG9va3VwKGEub2IkdHlwZSwgU2suYnVpbHRpbi5zdHIuJGZsb2F0XykKICAgICAgICBpZiAobnVsbCA9PSBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImEgZmxvYXQgaXMgcmVxdWlyZWQiKQogICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2FdKQogICAgICAgIGlmICghU2suYnVpbHRpbi5mbG9hdF8uUHlGbG9hdF9DaGVjayhhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigibmJfZmxvYXQgc2hvdWxkIHJldHVybiBmbG9hdCBvYmplY3QiKQogICAgICAgIHJldHVybiBTay5mZmkucmVtYXBUb0pzKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLnRwJGluZGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubmIkaW50XygpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLnRvRml4ZWQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgcmV0dXJuIHRoaXMudi50b0ZpeGVkKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudiArIGEudikKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYgKyBwYXJzZUZsb2F0KGEuc3RyJCgxMCwgITApKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2FkZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGFkZC5jYWxsKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52IC0gYS52KQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudiAtIHBhcnNlRmxvYXQoYS5zdHIkKDEwLCAhMCkpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfc3VidHJhY3QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLm5iJG5lZ2F0aXZlKCkKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGFkZC5jYWxsKGIsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52ICogYS52KQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudiAqIHBhcnNlRmxvYXQoYS5zdHIkKDEwLCAhMCkpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfbXVsdGlwbHkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRtdWx0aXBseS5jYWxsKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIGlmICgwID09PSBhLnYpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIEluZmluaXR5ID09PSB0aGlzLnYKICAgICAgICAgICAgPyBJbmZpbml0eSA9PT0gYS52IHx8IC1JbmZpbml0eSA9PT0gYS52CiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oTmFOKQogICAgICAgICAgICAgIDogYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XygtSW5maW5pdHkpCiAgICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oSW5maW5pdHkpCiAgICAgICAgICAgIDogLUluZmluaXR5ID09PSB0aGlzLnYKICAgICAgICAgICAgPyBJbmZpbml0eSA9PT0gYS52IHx8IC1JbmZpbml0eSA9PT0gYS52CiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oTmFOKQogICAgICAgICAgICAgIDogYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XyhJbmZpbml0eSkKICAgICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmZsb2F0XygtSW5maW5pdHkpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudiAvIGEudikKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPT09IGEubG9uZ0NvbXBhcmUoU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8pKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigKICAgICAgICAgICAgICAiaW50ZWdlciBkaXZpc2lvbiBvciBtb2R1bG8gYnkgemVybyIsCiAgICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBJbmZpbml0eSA9PT0gdGhpcy52CiAgICAgICAgICAgID8gYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XygtSW5maW5pdHkpCiAgICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oSW5maW5pdHkpCiAgICAgICAgICAgIDogLUluZmluaXR5ID09PSB0aGlzLnYKICAgICAgICAgICAgPyBhLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKEluZmluaXR5KQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC1JbmZpbml0eSkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52IC8gcGFyc2VGbG9hdChhLnN0ciQoMTAsICEwKSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfZGl2aWRlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IGEubmIkZGl2aWRlKHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIGlmIChJbmZpbml0eSA9PT0gdGhpcy52IHx8IC1JbmZpbml0eSA9PT0gdGhpcy52KQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICAgIGlmICgwID09PSBhLnYpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIEluZmluaXR5ID09PSBhLnYKICAgICAgICAgICAgPyB0aGlzLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC0xKQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApCiAgICAgICAgICAgIDogLUluZmluaXR5ID09PSBhLnYKICAgICAgICAgICAgPyB0aGlzLm5iJGlzbmVnYXRpdmUoKSB8fCAhdGhpcy5uYiRub256ZXJvKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XygwKQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC0xKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmZsb2F0XyhNYXRoLmZsb29yKHRoaXMudiAvIGEudikpCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIGlmICgwID09PSBhLmxvbmdDb21wYXJlKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IoCiAgICAgICAgICAgICAgImludGVnZXIgZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gSW5maW5pdHkgPT09IHRoaXMudiB8fCAtSW5maW5pdHkgPT09IHRoaXMudgogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XyhOYU4pCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKAogICAgICAgICAgICAgICAgTWF0aC5mbG9vcih0aGlzLnYgLyBwYXJzZUZsb2F0KGEuc3RyJCgxMCwgITApKSksCiAgICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICBhID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBhLm5iJGZsb29yX2RpdmlkZSh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRyZW1haW5kZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICBpZiAoMCA9PT0gYS52KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigKICAgICAgICAgICAgICAiaW50ZWdlciBkaXZpc2lvbiBvciBtb2R1bG8gYnkgemVybyIsCiAgICAgICAgICAgICkKICAgICAgICAgIGlmICgwID09PSB0aGlzLnYpIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMCkKICAgICAgICAgIGlmIChJbmZpbml0eSA9PT0gYS52KQogICAgICAgICAgICByZXR1cm4gSW5maW5pdHkgPT09IHRoaXMudiB8fCAtSW5maW5pdHkgPT09IHRoaXMudgogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICAgICAgICA6IHRoaXMubmIkaXNwb3NpdGl2ZSgpCiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKEluZmluaXR5KQogICAgICAgICAgdmFyIGIgPSB0aGlzLnYgJSBhLnYKICAgICAgICAgIDAgPiB0aGlzLnYKICAgICAgICAgICAgPyAwIDwgYS52ICYmIDAgPiBiICYmIChiICs9IGEudikKICAgICAgICAgICAgOiAwID4gYS52ICYmIDAgIT09IGIgJiYgKGIgKz0gYS52KQogICAgICAgICAgMCA+IGEudiAmJiAwID09PSBiCiAgICAgICAgICAgID8gKGIgPSAtMCkKICAgICAgICAgICAgOiAwID09PSBiICYmIC1JbmZpbml0eSA9PT0gSW5maW5pdHkgLyBiICYmIChiID0gMCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYikKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPT09IGEubG9uZ0NvbXBhcmUoU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8pKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigKICAgICAgICAgICAgICAiaW50ZWdlciBkaXZpc2lvbiBvciBtb2R1bG8gYnkgemVybyIsCiAgICAgICAgICAgICkKICAgICAgICAgIGlmICgwID09PSB0aGlzLnYpIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMCkKICAgICAgICAgIHZhciBjID0gcGFyc2VGbG9hdChhLnN0ciQoMTAsICEwKSkKICAgICAgICAgIGIgPSB0aGlzLnYgJSBjCiAgICAgICAgICAwID4gYiA/IDAgPCBjICYmIDAgIT09IGIgJiYgKGIgKz0gYykgOiAwID4gYyAmJiAwICE9PSBiICYmIChiICs9IGMpCiAgICAgICAgICBhLm5iJGlzbmVnYXRpdmUoKSAmJiAwID09PSBiCiAgICAgICAgICAgID8gKGIgPSAtMCkKICAgICAgICAgICAgOiAwID09PSBiICYmIC1JbmZpbml0eSA9PT0gSW5maW5pdHkgLyBiICYmIChiID0gMCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9yZW1haW5kZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhhKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gYS5uYiRyZW1haW5kZXIodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkZGl2bW9kID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICB0aGlzLm5iJGZsb29yX2RpdmlkZShhKSwKICAgICAgICAgICAgICB0aGlzLm5iJHJlbWFpbmRlcihhKSwKICAgICAgICAgICAgXSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Rpdm1vZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICBhID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgYS5uYiRmbG9vcl9kaXZpZGUodGhpcyksCiAgICAgICAgICAgICAgYS5uYiRyZW1haW5kZXIodGhpcyksCiAgICAgICAgICAgIF0pCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHBvd2VyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgaWYgKDAgPiB0aGlzLnYgJiYgMCAhPT0gYS52ICUgMSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTmVnYXRpdmVQb3dlckVycm9yKAogICAgICAgICAgICAgICJjYW5ub3QgcmFpc2UgYSBuZWdhdGl2ZSBudW1iZXIgdG8gYSBmcmFjdGlvbmFsIHBvd2VyIiwKICAgICAgICAgICAgKQogICAgICAgICAgaWYgKDAgPT09IHRoaXMudiAmJiAwID4gYS52KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5OZWdhdGl2ZVBvd2VyRXJyb3IoCiAgICAgICAgICAgICAgImNhbm5vdCByYWlzZSB6ZXJvIHRvIGEgbmVnYXRpdmUgcG93ZXIiLAogICAgICAgICAgICApCiAgICAgICAgICBiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE1hdGgucG93KHRoaXMudiwgYS52KSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgSW5maW5pdHkgPT09IE1hdGguYWJzKGIudikgJiYKICAgICAgICAgICAgSW5maW5pdHkgIT09IE1hdGguYWJzKHRoaXMudikgJiYKICAgICAgICAgICAgSW5maW5pdHkgIT09IE1hdGguYWJzKGEudikKICAgICAgICAgICkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uT3ZlcmZsb3dFcnJvcigiTnVtZXJpY2FsIHJlc3VsdCBvdXQgb2YgcmFuZ2UiKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPT09IHRoaXMudiAmJiAwID4gYS5sb25nQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvcigKICAgICAgICAgICAgICAiY2Fubm90IHJhaXNlIHplcm8gdG8gYSBuZWdhdGl2ZSBwb3dlciIsCiAgICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oCiAgICAgICAgICAgIE1hdGgucG93KHRoaXMudiwgcGFyc2VGbG9hdChhLnN0ciQoMTAsICEwKSkpLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3Bvd2VyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IGEubmIkcG93ZXIodGhpcywgYikKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkYWJzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhNYXRoLmFicyh0aGlzLnYpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9CiAgICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGFkZAogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9zdWJ0cmFjdCA9CiAgICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHN1YnRyYWN0CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX211bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkbXVsdGlwbHkKICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGlucGxhY2VfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkZGl2aWRlCiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3JlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHJlbWFpbmRlcgogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9mbG9vcl9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUKICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGlucGxhY2VfcG93ZXIgPQogICAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRwb3dlcgogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkbmVnYXRpdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC10aGlzLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRub256ZXJvID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDAgIT09IHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRpc25lZ2F0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDAgPiB0aGlzLnYKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaXNwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5udW1iZXJDb21wYXJlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykKICAgICAgICAgIHJldHVybiAoSW5maW5pdHkgPT0gdGhpcy52ICYmIEluZmluaXR5ID09IGEudikgfHwKICAgICAgICAgICAgKC1JbmZpbml0eSA9PSB0aGlzLnYgJiYgLUluZmluaXR5ID09IGEudikKICAgICAgICAgICAgPyAwCiAgICAgICAgICAgIDogdGhpcy52IC0gYS52CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPT09IHRoaXMudiAlIDEpIHsKICAgICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KQogICAgICAgICAgICByZXR1cm4gKGEgPSBiLmxvbmdDb21wYXJlKGEpKQogICAgICAgICAgfQogICAgICAgICAgYSA9IHRoaXMubmIkc3VidHJhY3QoYSkKICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHJldHVybiBhLnYKICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICAgIHJldHVybiBhLmxvbmdDb21wYXJlKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUub2IkZXEgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA9PSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5vYiRuZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwICE9IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUub2IkbHQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA+IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUub2IkbGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA+PSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm9iJGd0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPCB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm9iJGdlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPD0gdGhpcy5udW1iZXJDb21wYXJlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5yb3VuZCQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yb3VuZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgdmFyIGQgPSB2b2lkIDAgPT09IGIgPyAwIDogU2subWlzY2V2YWwuYXNJbmRleChiKQogICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmJhbmtlcnNfcm91bmRpbmcpIHsKICAgICAgICAgIGMgKj0gTWF0aC5wb3coMTAsIGQpCiAgICAgICAgICB2YXIgZSA9IE1hdGgucm91bmQoYykKICAgICAgICAgIGQgPQogICAgICAgICAgICAoMC41ID09PSAoMCA8IGMgPyBjIDogLWMpICUgMSA/ICgwID09PSBlICUgMiA/IGUgOiBlIC0gMSkgOiBlKSAvCiAgICAgICAgICAgIE1hdGgucG93KDEwLCBkKQogICAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYgogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmludF8oZCkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oZCkKICAgICAgICB9CiAgICAgICAgZCA9IE1hdGgucG93KDEwLCBkKQogICAgICAgIGQgPSBNYXRoLnJvdW5kKGMgKiBkKSAvIGQKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGQpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLl9fZm9ybWF0X18gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mb3JtYXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpIHsKICAgICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgaWYgKCIiICE9PSBjKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQgc3BlYyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICAgKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImZvcm1hdCgpIGFyZ3VtZW50IDIgbXVzdCBiZSBzdHIsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImZvcm1hdCBleHBlY3RzIGFyZyAyIHRvIGJlIHN0cmluZyBvciB1bmljb2RlLCBub3QgIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUuY29uanVnYXRlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhhLnYpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLnN0ciQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGlzTmFOKHRoaXMudikpIHJldHVybiAibmFuIgogICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9ICEwKQogICAgICAgIGlmIChJbmZpbml0eSA9PSB0aGlzLnYpIHJldHVybiAiaW5mIgogICAgICAgIGlmICgtSW5maW5pdHkgPT0gdGhpcy52ICYmIGIpIHJldHVybiAiLWluZiIKICAgICAgICBpZiAoLUluZmluaXR5ID09IHRoaXMudiAmJiAhYikgcmV0dXJuICJpbmYiCiAgICAgICAgYiA9IGIgPyB0aGlzLnYgOiBNYXRoLmFicyh0aGlzLnYpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSB8fCAxMCA9PT0gYSkgewogICAgICAgICAgdmFyIGMgPSBTay5fX2Z1dHVyZV9fLnB5dGhvbjMgPyBiLnRvUHJlY2lzaW9uKDE2KSA6IGIudG9QcmVjaXNpb24oMTIpCiAgICAgICAgICB2YXIgZCA9IGMuaW5kZXhPZigiLiIpCiAgICAgICAgICBhID0gYi50b1N0cmluZygpLnNsaWNlKDAsIGQpCiAgICAgICAgICBkID0gYi50b1N0cmluZygpLnNsaWNlKGQpCiAgICAgICAgICBhLm1hdGNoKC9eLT8wJC8pICYmCiAgICAgICAgICAgIGQuc2xpY2UoMSkubWF0Y2goL14wezQsfS8pICYmCiAgICAgICAgICAgIChjID0gMTIgPiBjLmxlbmd0aCA/IGIudG9FeHBvbmVudGlhbCgpIDogYi50b0V4cG9uZW50aWFsKDExKSkKICAgICAgICAgIGlmICgwID4gYy5pbmRleE9mKCJlIikgJiYgMCA8PSBjLmluZGV4T2YoIi4iKSkgewogICAgICAgICAgICBmb3IgKDsgIjAiID09IGMuY2hhckF0KGMubGVuZ3RoIC0gMSk7ICkKICAgICAgICAgICAgICBjID0gYy5zdWJzdHJpbmcoMCwgYy5sZW5ndGggLSAxKQogICAgICAgICAgICAiLiIgPT0gYy5jaGFyQXQoYy5sZW5ndGggLSAxKSAmJiAoYyArPSAiMCIpCiAgICAgICAgICB9CiAgICAgICAgICBjID0gYy5yZXBsYWNlKC9cLjArZS8sICJlIiwgImkiKQogICAgICAgICAgYyA9IGMucmVwbGFjZSgvKGVbLStdKShbMS05XSkkLywgIiQxMCQyIikKICAgICAgICAgIGMgPSBjLnJlcGxhY2UoLzArKGUuKikvLCAiJDEiKQogICAgICAgIH0gZWxzZSBjID0gYi50b1N0cmluZyhhKQogICAgICAgIDAgPT09IHRoaXMudiAmJiAtSW5maW5pdHkgPT09IDEgLyB0aGlzLnYgJiYgKGMgPSAiLSIgKyBjKQogICAgICAgIDAgPiBjLmluZGV4T2YoIi4iKSAmJgogICAgICAgICAgMCA+IGMuaW5kZXhPZigiRSIpICYmCiAgICAgICAgICAwID4gYy5pbmRleE9mKCJlIikgJiYKICAgICAgICAgIChjICs9ICIuMCIpCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgdmFyIGEgPSBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKCJTay5idWlsdGluLm5tYmVyIGlzIGRlcHJlY2F0ZWQuIikKICAgICAgU2suYnVpbHRpbi5ubWJlciA9IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKAogICAgICAgICAgIlNrLmJ1aWx0aW4ubm1iZXIgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHJlcGxhY2Ugd2l0aCBTay5idWlsdGluLmludF8sIFNrLmJ1aWx0aW4uZmxvYXRfLCBvciBTay5idWlsdGluLmFzc2skLiIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLnRwJGluZGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLnRwJGhhc2ggPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5mcm9tSW50JCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUudG9GaXhlZCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkYWRkID0gZnVuY3Rpb24oYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRzdWJ0cmFjdCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkbXVsdGlwbHkgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlID0gZnVuY3Rpb24oYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRyZW1haW5kZXIgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkcG93ZXIgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGFuZCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkb3IgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHhvciA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkbHNoaWZ0ID0gZnVuY3Rpb24oYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRyc2hpZnQgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRhZGQKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9zdWJ0cmFjdCA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkc3VidHJhY3QKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9tdWx0aXBseSA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkbXVsdGlwbHkKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGRpdmlkZQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpbnBsYWNlX3JlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkcmVtYWluZGVyCiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfZmxvb3JfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9wb3dlciA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkcG93ZXIKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9hbmQgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGFuZAogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpbnBsYWNlX29yID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRvcgogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpbnBsYWNlX3hvciA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkeG9yCiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfbHNoaWZ0ID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRsc2hpZnQKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9yc2hpZnQgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHJzaGlmdAogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRuZWdhdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRub256ZXJvID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlzbmVnYXRpdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaXNwb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5udW1iZXJDb21wYXJlID0gZnVuY3Rpb24oYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5fX2VxX18gPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLl9fbmVfXyA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19sdF9fID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5fX2xlX18gPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLl9fZ3RfXyA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19nZV9fID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5yb3VuZCQgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5zdHIkID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ubm1iZXIiLCBTay5idWlsdGluLm5tYmVyKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5sbmcgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSkgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyhhLCBiKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEpCiAgICAgICAgICByZXR1cm4gKHRoaXMuYmlnaW50ZWdlciA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoMCkpLCB0aGlzCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgIHJldHVybiAodGhpcy5iaWdpbnRlZ2VyID0gYS5iaWdpbnRlZ2VyLmNsb25lKCkpLCB0aGlzCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIpCiAgICAgICAgICByZXR1cm4gKHRoaXMuYmlnaW50ZWdlciA9IGEpLCB0aGlzCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTdHJpbmcgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhKQogICAgICAgICAgcmV0dXJuIFNrLmxvbmdGcm9tU3RyKGEsIGIpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cikgcmV0dXJuIFNrLmxvbmdGcm9tU3RyKGEudiwgYikKICAgICAgICBpZiAoCiAgICAgICAgICB2b2lkIDAgIT09IGEgJiYKICAgICAgICAgICFTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpICYmCiAgICAgICAgICAhU2suYnVpbHRpbi5jaGVja051bWJlcihhKQogICAgICAgICkKICAgICAgICAgIGlmICghMCA9PT0gYSkgYSA9IDEKICAgICAgICAgIGVsc2UgaWYgKCExID09PSBhKSBhID0gMAogICAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImxvbmcoKSBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nIG9yIGEgbnVtYmVyLCBub3QgJyIgKwogICAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICApCiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kbm9mbG9hdChhKQogICAgICAgIHRoaXMuYmlnaW50ZWdlciA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoYSkKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoImxvbmciLCBTay5idWlsdGluLmxuZywgU2suYnVpbHRpbi5udW10eXBlKQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUudHAkaW5kZXggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5zdHIkKDEwLCAhMCksIDEwKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8odGhpcy50cCRpbmRleCgpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnRfID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2FudEJlSW50KCkKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMpCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmludF8odGhpcy50b0ludCQoKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuX19mb3JtYXRfXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2Zvcm1hdF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkgewogICAgICAgICAgdmFyIGMgPSBTay5mZmkucmVtYXBUb0pzKGIpCiAgICAgICAgICBpZiAoIiIgIT09IGMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICAgImZvcm1hdCBzcGVjIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgICApCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiZm9ybWF0KCkgYXJndW1lbnQgMiBtdXN0IGJlIHN0ciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiZm9ybWF0IGV4cGVjdHMgYXJnIDIgdG8gYmUgc3RyaW5nIG9yIHVuaWNvZGUsIG5vdCAiICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5yb3VuZCQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yb3VuZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgdmFyIGQgPSB2b2lkIDAgPT09IGIgPyAwIDogU2subWlzY2V2YWwuYXNJbmRleChiKQogICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmJhbmtlcnNfcm91bmRpbmcpIHsKICAgICAgICAgIGMgKj0gTWF0aC5wb3coMTAsIGQpCiAgICAgICAgICB2YXIgZSA9IE1hdGgucm91bmQoYykKICAgICAgICAgIGQgPQogICAgICAgICAgICAoMC41ID09PSAoMCA8IGMgPyBjIDogLWMpICUgMSA/ICgwID09PSBlICUgMiA/IGUgOiBlIC0gMSkgOiBlKSAvCiAgICAgICAgICAgIE1hdGgucG93KDEwLCBkKQogICAgICAgIH0gZWxzZSAoZCA9IE1hdGgucG93KDEwLCBkKSksIChkID0gTWF0aC5yb3VuZChjICogZCkgLyBkKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuX19pbmRleF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEubmIkaW50XyhhKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkbG5nXyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGZsb2F0XyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oU2suZmZpLnJlbWFwVG9Kcyh0aGlzKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5NQVhfSU5UJCA9IG5ldyBTay5idWlsdGluLmxuZyhTay5idWlsdGluLmludF8udGhyZXNob2xkJCkKICAgICAgU2suYnVpbHRpbi5sbmcuTUlOX0lOVCQgPSBuZXcgU2suYnVpbHRpbi5sbmcoLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkKQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuY2FudEJlSW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIDAgPCB0aGlzLmxvbmdDb21wYXJlKFNrLmJ1aWx0aW4ubG5nLk1BWF9JTlQkKSB8fAogICAgICAgICAgMCA+IHRoaXMubG9uZ0NvbXBhcmUoU2suYnVpbHRpbi5sbmcuTUlOX0lOVCQpCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLmZyb21JbnQkID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoYSkKICAgICAgfQogICAgICBTay5sb25nRnJvbVN0ciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBhID0gU2suc3RyMm51bWJlcigKICAgICAgICAgIGEsCiAgICAgICAgICBiLAogICAgICAgICAgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICByZXR1cm4gMTAgPT09IGIKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoYSkKICAgICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoYSwgYikKICAgICAgICAgIH0sCiAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJldHVybiBhLm5lZ2F0ZSgpCiAgICAgICAgICB9LAogICAgICAgICAgImxvbmciLAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGEpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5sb25nRnJvbVN0ciIsIFNrLmxvbmdGcm9tU3RyKQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUudG9JbnQkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmlnaW50ZWdlci5pbnRWYWx1ZSgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5jb25qdWdhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gYS5jbG9uZSgpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhZGQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRhZGQoYSkKICAgICAgICB9CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5hZGQoYS5iaWdpbnRlZ2VyKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLmFkZChhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2FkZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGFkZC5jYWxsKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0gU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGFkZAogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkc3VidHJhY3QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRzdWJ0cmFjdChhKQogICAgICAgIH0KICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnN1YnRyYWN0KGEuYmlnaW50ZWdlcikpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5zdWJ0cmFjdChhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3N1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uYiRuZWdhdGl2ZSgpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhZGQuY2FsbChiLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX3N1YnRyYWN0ID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkc3VidHJhY3QKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMuc3RyJCgxMCwgITApKQogICAgICAgICAgcmV0dXJuIGIubmIkbXVsdGlwbHkoYSkKICAgICAgICB9CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5tdWx0aXBseShhLmJpZ2ludGVnZXIpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5iaWdpbnRlZ2VyCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIubXVsdGlwbHkoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9tdWx0aXBseSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJG11bHRpcGx5LmNhbGwodGhpcywgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9tdWx0aXBseSA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJG11bHRpcGx5CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRkaXZpZGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRkaXZpZGUoYSkKICAgICAgICB9CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIGIgPSB0aGlzLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgdmFyIGMgPSBhLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgaWYgKChiICYmICFjKSB8fCAoYyAmJiAhYikpIHsKICAgICAgICAgICAgYSA9IHRoaXMuYmlnaW50ZWdlci5kaXZpZGVBbmRSZW1haW5kZXIoYS5iaWdpbnRlZ2VyKQogICAgICAgICAgICBpZiAoMCA9PT0gYVsxXS50cnVlQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyhhWzBdKQogICAgICAgICAgICBhID0gYVswXS5zdWJ0cmFjdChTay5idWlsdGluLmJpZ2ludGVnZXIuT05FKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGEpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5kaXZpZGUoYS5iaWdpbnRlZ2VyKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZpZGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gYS5uYiRkaXZpZGUodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMuc3RyJCgxMCwgITApKQogICAgICAgICAgcmV0dXJuIGIubmIkZmxvb3JfZGl2aWRlKGEpCiAgICAgICAgfQogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IGEubmIkZGl2aWRlKHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgdGhpcy5uYiRmbG9vcl9kaXZpZGUoYSksCiAgICAgICAgICAgICAgdGhpcy5uYiRyZW1haW5kZXIoYSksCiAgICAgICAgICAgIF0pCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZtb2QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICAgIGEubmIkZmxvb3JfZGl2aWRlKHRoaXMpLAogICAgICAgICAgICAgIGEubmIkcmVtYWluZGVyKHRoaXMpLAogICAgICAgICAgICBdKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGRpdmlkZQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkZGl2aWRlCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfZmxvb3JfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2RpdmlkZQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9mbG9vcl9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlbWFpbmRlciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoMCA9PT0gdGhpcy5iaWdpbnRlZ2VyLnRydWVDb21wYXJlKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPKSkKICAgICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMCkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5sbmcoMCkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnN0ciQoMTAsICEwKSkKICAgICAgICAgIHJldHVybiBiLm5iJHJlbWFpbmRlcihhKQogICAgICAgIH0KICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnJlbWFpbmRlcihhLmJpZ2ludGVnZXIpKSksCiAgICAgICAgICAgIHRoaXMubmIkaXNuZWdhdGl2ZSgpCiAgICAgICAgICAgICAgPyBhLm5iJGlzcG9zaXRpdmUoKSAmJgogICAgICAgICAgICAgICAgYi5uYiRub256ZXJvKCkgJiYKICAgICAgICAgICAgICAgIChiID0gYi5uYiRhZGQoYSkubmIkcmVtYWluZGVyKGEpKQogICAgICAgICAgICAgIDogYS5uYiRpc25lZ2F0aXZlKCkgJiYgYi5uYiRub256ZXJvKCkgJiYgKGIgPSBiLm5iJGFkZChhKSksCiAgICAgICAgICAgIGIpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9yZW1haW5kZXIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gYS5uYiRyZW1haW5kZXIodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9yZW1haW5kZXIgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZW1haW5kZXIKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhID09PSBTay5idWlsdGluLmJvb2wudHJ1ZSQgJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoMSkpCiAgICAgICAgYSA9PT0gU2suYnVpbHRpbi5ib29sLmZhbHNlJCAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZygwKSkKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgIHRoaXMubmIkZmxvb3JfZGl2aWRlKGEpLAogICAgICAgICAgICB0aGlzLm5iJHJlbWFpbmRlcihhKSwKICAgICAgICAgIF0pCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRkaXZtb2QoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHBvd2VyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICh2b2lkIDAgIT09IGIpCiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAoYSA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoU2suYnVpbHRpbi5hc251bSQoYSkpKSwKICAgICAgICAgICAgKGIgPSBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKFNrLmJ1aWx0aW4uYXNudW0kKGIpKSksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIubW9kUG93SW50KGEsIGIpKQogICAgICAgICAgKQogICAgICAgIGlmICgKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyB8fAogICAgICAgICAgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgMCA+IGEudikKICAgICAgICApCiAgICAgICAgICByZXR1cm4gKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpKSwgYi5uYiRwb3dlcihhKQogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IHZvaWQgMCAhPT0gYgogICAgICAgICAgICA/ICgoYSA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoU2suYnVpbHRpbi5hc251bSQoYSkpKSwKICAgICAgICAgICAgICAoYiA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoU2suYnVpbHRpbi5hc251bSQoYikpKSwKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLm1vZFBvd0ludChhLCBiKSkpCiAgICAgICAgICAgIDogYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpKSwgYi5uYiRwb3dlcihhKSkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnBvdyhhLmJpZ2ludGVnZXIpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5iaWdpbnRlZ2VyCiAgICAgICAgICA/IHZvaWQgMCAhPT0gYgogICAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoU2suYnVpbHRpbi5hc251bSQoYikpKSwKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLm1vZFBvd0ludChhLCBiKSkpCiAgICAgICAgICAgIDogYS5pc25lZ2F0aXZlKCkKICAgICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpKSwgYi5uYiRwb3dlcihhKSkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnBvdyhhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3Bvd2VyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IGEubmIkcG93ZXIodGhpcywgYikKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9wb3dlciA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHBvd2VyCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhYnMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5ibkFicygpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRsc2hpZnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIGlmICgwID4gYS5iaWdpbnRlZ2VyLnNpZ251bSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5zaGlmdExlZnQoYS5iaWdpbnRlZ2VyKSkKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIpIHsKICAgICAgICAgIGlmICgwID4gYS5zaWdudW0oKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigibmVnYXRpdmUgc2hpZnQgY291bnQiKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuc2hpZnRMZWZ0KGEpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2xzaGlmdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBhLm5iJGxzaGlmdCh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX2xzaGlmdCA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGxzaGlmdAogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcnNoaWZ0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICBpZiAoMCA+IGEuYmlnaW50ZWdlci5zaWdudW0oKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigibmVnYXRpdmUgc2hpZnQgY291bnQiKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuc2hpZnRSaWdodChhLmJpZ2ludGVnZXIpKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcikgewogICAgICAgICAgaWYgKDAgPiBhLnNpZ251bSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5zaGlmdFJpZ2h0KGEpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3JzaGlmdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBhLm5iJHJzaGlmdCh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX3JzaGlmdCA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJzaGlmdAogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkYW5kID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuYW5kKGEuYmlnaW50ZWdlcikpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5hbmQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9hbmQgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhbmQKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2VfYW5kID0gU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGFuZAogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkb3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5vcihhLmJpZ2ludGVnZXIpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5iaWdpbnRlZ2VyCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIub3IoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9vciA9IFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRvcgogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9vciA9IFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRvcgogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkeG9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIueG9yKGEuYmlnaW50ZWdlcikpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci54b3IoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF94b3IgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiR4b3IKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2VfeG9yID0gU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHhvcgogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkbmVnYXRpdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5uZWdhdGUoKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW52ZXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIubm90KCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRub256ZXJvID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDAgIT09IHRoaXMuYmlnaW50ZWdlci50cnVlQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaXNuZWdhdGl2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmJpZ2ludGVnZXIuaXNuZWdhdGl2ZSgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlzcG9zaXRpdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gIXRoaXMuYmlnaW50ZWdlci5pc25lZ2F0aXZlKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubG9uZ0NvbXBhcmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEpKQogICAgICAgIGlmICgKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8gJiYgMCA9PT0gYS52ICUgMSkKICAgICAgICApCiAgICAgICAgICByZXR1cm4gKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSksIHRoaXMubG9uZ0NvbXBhcmUoYSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzKQogICAgICAgICAgcmV0dXJuIGIubnVtYmVyQ29tcGFyZShhKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IHRoaXMuYmlnaW50ZWdlci5zdWJ0cmFjdChhLmJpZ2ludGVnZXIpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gdGhpcy5iaWdpbnRlZ2VyLnN1YnRyYWN0KGEpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJGVxID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPT0gdGhpcy5sb25nQ29tcGFyZShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJG5lID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgIT0gdGhpcy5sb25nQ29tcGFyZShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUub2IkbHQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA+IHRoaXMubG9uZ0NvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJGxlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPj0gdGhpcy5sb25nQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUub2IkZ3QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA8IHRoaXMubG9uZ0NvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJGdlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPD0gdGhpcy5sb25nQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9IFNrLl9fZnV0dXJlX18ucHl0aG9uMyA/ICIiIDogIkwiCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLnN0ciQoMTAsICEwKSArIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLnN0ciQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gITApCiAgICAgICAgYiA9IGIgPyB0aGlzLmJpZ2ludGVnZXIgOiB0aGlzLmJpZ2ludGVnZXIuYWJzKCkKICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhIHx8IDEwID09PSBhID8gYi50b1N0cmluZygpIDogYi50b1N0cmluZyhhKQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBNYXRoLmh5cG90ID0KICAgICAgICBNYXRoLmh5cG90IHx8CiAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICBmb3IgKHZhciBhID0gMCwgYiA9IGFyZ3VtZW50cy5sZW5ndGgsIGMgPSAwOyBjIDwgYjsgYysrKSB7CiAgICAgICAgICAgIGlmIChJbmZpbml0eSA9PT0gYXJndW1lbnRzW2NdIHx8IC1JbmZpbml0eSA9PT0gYXJndW1lbnRzW2NdKQogICAgICAgICAgICAgIHJldHVybiBJbmZpbml0eQogICAgICAgICAgICBhICs9IGFyZ3VtZW50c1tjXSAqIGFyZ3VtZW50c1tjXQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIE1hdGguc3FydChhKQogICAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNvbXBsZXgiLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAyKQogICAgICAgIHZhciBjLAogICAgICAgICAgZCA9ICExLAogICAgICAgICAgZSA9ICExCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uY29tcGxleCkpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleChhLCBiKQogICAgICAgIHZhciBmID0gbnVsbCA9PSBhID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJCA6IGEKICAgICAgICBpZiAoZiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uY29tcGxleCAmJiBudWxsID09IGIpIHJldHVybiBhCiAgICAgICAgaWYgKG51bGwgIT0gZiAmJiBTay5idWlsdGluLmNoZWNrU3RyaW5nKGYpKSB7CiAgICAgICAgICBpZiAobnVsbCAhPSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImNvbXBsZXgoKSBjYW4ndCB0YWtlIHNlY29uZCBhcmcgaWYgZmlyc3QgaXMgYSBzdHJpbmciLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jb21wbGV4LmNvbXBsZXhfc3VidHlwZV9mcm9tX3N0cmluZyhmKQogICAgICAgIH0KICAgICAgICBpZiAobnVsbCAhPSBiICYmIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJjb21wbGV4KCkgc2Vjb25kIGFyZyBjYW4ndCBiZSBhIHN0cmluZyIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGcgPSBTay5idWlsdGluLmNvbXBsZXgudHJ5X2NvbXBsZXhfc3BlY2lhbF9tZXRob2QoZikKICAgICAgICBpZiAobnVsbCAhPSBnICYmIGcgIT09IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKSB7CiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4KGcpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIl9fY29tcGxleF9fIHNob3VsZCByZXR1cm4gYSBjb21wbGV4IG9iamVjdCIsCiAgICAgICAgICAgICkKICAgICAgICAgIGYgPSBnCiAgICAgICAgfQogICAgICAgIGcgPSBTay5idWlsdGluLmFzbnVtJChmKQogICAgICAgIG51bGwgIT0gYiAmJiAoYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpKQogICAgICAgIHZhciBoID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgaWYgKAogICAgICAgICAgICBTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpIHx8CiAgICAgICAgICAgIHZvaWQgMCAhPT0KICAgICAgICAgICAgICBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cChhLm9iJHR5cGUsIFNrLmJ1aWx0aW4uc3RyLiRmbG9hdF8pCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICBudWxsID09IGcgfHwKICAgICAgICAgICghaChmKSAmJiAhU2suYnVpbHRpbi5jaGVja0NvbXBsZXgoZikpIHx8CiAgICAgICAgICAobnVsbCAhPSBiICYmIChudWxsID09IGMgfHwgKCFoKGIpICYmICFTay5idWlsdGluLmNoZWNrQ29tcGxleChiKSkpKQogICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImNvbXBsZXgoKSBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nIG9yIG51bWJlciIsCiAgICAgICAgICApCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayhmKSkKICAgICAgICAgIChjID0gZi5yZWFsLnYpLCAoZiA9IGYuaW1hZy52KSwgKGQgPSAhMCkKICAgICAgICBlbHNlIHsKICAgICAgICAgIGcgPSBTay5idWlsdGluLmZsb2F0Xy5QeUZsb2F0X0FzRG91YmxlKGYpCiAgICAgICAgICBpZiAobnVsbCA9PSBnKSByZXR1cm4gbnVsbAogICAgICAgICAgYyA9IGcKICAgICAgICAgIGYgPSAwCiAgICAgICAgfQogICAgICAgIGlmIChudWxsID09IGIpIGcgPSAwCiAgICAgICAgZWxzZSBpZiAoU2suYnVpbHRpbi5jb21wbGV4Ll9jb21wbGV4X2NoZWNrKGIpKSB7CiAgICAgICAgICBnID0gYi5yZWFsLnYKICAgICAgICAgIHZhciBrID0gYi5pbWFnLnYKICAgICAgICAgIGUgPSAhMAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnID0gU2suYnVpbHRpbi5mbG9hdF8uUHlGbG9hdF9Bc0RvdWJsZShiKQogICAgICAgICAgaWYgKG51bGwgPT0gZykgcmV0dXJuIG51bGwKICAgICAgICAgIGsgPSAwCiAgICAgICAgfQogICAgICAgICEwID09PSBlICYmIChjIC09IGspCiAgICAgICAgITAgPT09IGQgJiYgKGcgKz0gZikKICAgICAgICAwID09PSBjICYmICgwID4gZyB8fCBTay5idWlsdGluLmNvbXBsZXguX2lzTmVnYXRpdmVaZXJvKGcpKSAmJiAoYyA9IC0wKQogICAgICAgIHRoaXMucmVhbCA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhjKQogICAgICAgIHRoaXMuaW1hZyA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhnKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiY29tcGxleCIsCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LAogICAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZSwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uY29tcGxleAogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGludF8gPSBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImNhbid0IGNvbnZlcnQgY29tcGxleCB0byBpbnQiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkZmxvYXRfID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjYW4ndCBjb252ZXJ0IGNvbXBsZXggdG8gZmxvYXQiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkbG5nID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjYW4ndCBjb252ZXJ0IGNvbXBsZXggdG8gbG9uZyIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2RvY19fID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJjb21wbGV4KHJlYWxbLCBpbWFnXSkgLT4gY29tcGxleCBudW1iZXJcblxuQ3JlYXRlIGEgY29tcGxleCBudW1iZXIgZnJvbSBhIHJlYWwgcGFydCBhbmQgYW4gb3B0aW9uYWwgaW1hZ2luYXJ5IHBhcnQuXG5UaGlzIGlzIGVxdWl2YWxlbnQgdG8gKHJlYWwgKyBpbWFnKjFqKSB3aGVyZSBpbWFnIGRlZmF1bHRzIHRvIDAuIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXguX2lzTmVnYXRpdmVaZXJvID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiAwICE9PSBhID8gITEgOiAtSW5maW5pdHkgPT09IDEgLyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnRyeV9jb21wbGV4X3NwZWNpYWxfbWV0aG9kID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChudWxsID09IGEpIHJldHVybiBudWxsCiAgICAgICAgdmFyIGIgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRjb21wbGV4KQogICAgICAgIHJldHVybiBudWxsICE9IGIgPyAoYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYV0pKSA6IG51bGwKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpICYmICJjb21wbGV4IiAhPT0gYS50cCRuYW1lKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAidW5zdXBwb3J0ZWQgb3BlcmFuZCB0eXBlKHMpIGZvciArOiAnY29tcGxleCcgYW5kICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYSkgJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5jb21wbGV4KGEpKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LmNvbXBsZXhfc3VidHlwZV9mcm9tX3N0cmluZyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IDAsCiAgICAgICAgICBjID0gMCwKICAgICAgICAgIGQgPSAhMQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpKSBhID0gU2suZmZpLnJlbWFwVG9KcyhhKQogICAgICAgIGVsc2UgaWYgKCJzdHJpbmciICE9PSB0eXBlb2YgYSkKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInByb3ZpZGVkIHVuc3VwcG9ydGVkIHN0cmluZy1hbGlrZSBhcmd1bWVudCIpCiAgICAgICAgaWYgKC0xICE9PSBhLmluZGV4T2YoIlx4MDAiKSB8fCAwID09PSBhLmxlbmd0aCB8fCAiIiA9PT0gYSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoImNvbXBsZXgoKSBhcmcgaXMgYSBtYWxmb3JtZWQgc3RyaW5nIikKICAgICAgICB2YXIgZSA9IDAKICAgICAgICBhID0gYS5yZXBsYWNlKC9pbmZ8aW5maW5pdHkvZ2ksICJJbmZpbml0eSIpCiAgICAgICAgZm9yIChhID0gYS5yZXBsYWNlKC9uYW4vZ2ksICJOYU4iKTsgIiAiID09PSBhW2VdOyApIGUrKwogICAgICAgIGlmICgiKCIgPT09IGFbZV0pIGZvciAoZCA9ICEwLCBlKys7ICIgIiA9PT0gYVtlXTsgKSBlKysKICAgICAgICB2YXIgZiA9IC9eKD86WystXT8oPzooPzooPzpcZCpcLlxkKyl8KD86XGQrXC4/KSkoPzpbZUVdWystXT9cZCspP3xOYU58SW5maW5pdHkpKS8KICAgICAgICB2YXIgZyA9IGEuc3Vic3RyKGUpCiAgICAgICAgdmFyIGggPSBnLm1hdGNoKGYpCiAgICAgICAgaWYgKG51bGwgIT09IGgpCiAgICAgICAgICBpZiAoKChlICs9IGhbMF0ubGVuZ3RoKSwgImoiID09PSBhW2VdIHx8ICJKIiA9PT0gYVtlXSkpCiAgICAgICAgICAgIChjID0gcGFyc2VGbG9hdChoWzBdKSksIGUrKwogICAgICAgICAgZWxzZSBpZiAoIisiID09PSBhW2VdIHx8ICItIiA9PT0gYVtlXSkgewogICAgICAgICAgICBiID0gcGFyc2VGbG9hdChoWzBdKQogICAgICAgICAgICBoID0gYS5zdWJzdHIoZSkubWF0Y2goZikKICAgICAgICAgICAgbnVsbCAhPT0gaAogICAgICAgICAgICAgID8gKChjID0gcGFyc2VGbG9hdChoWzBdKSksIChlICs9IGhbMF0ubGVuZ3RoKSkKICAgICAgICAgICAgICA6ICgoYyA9ICIrIiA9PT0gYVtlXSA/IDEgOiAtMSksIGUrKykKICAgICAgICAgICAgaWYgKCJqIiAhPT0gYVtlXSAmJiAiSiIgIT09IGFbZV0pCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICJjb21wbGV4KCkgYXJnIGlzIG1hbGZvcm1lZCBzdHJpbmciLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZSsrCiAgICAgICAgICB9IGVsc2UgYiA9IHBhcnNlRmxvYXQoaFswXSkKICAgICAgICBlbHNlCiAgICAgICAgICAoaCA9IGggPSBnLm1hdGNoKC9eKFsrLV0/W2pKXSkvKSksCiAgICAgICAgICAgIG51bGwgIT09IGggJiYKICAgICAgICAgICAgICAoKGMgPSAxID09PSBoWzBdLmxlbmd0aCA/IDEgOiAiKyIgPT09IGhbMF1bMF0gPyAxIDogLTEpLAogICAgICAgICAgICAgIChlICs9IGhbMF0ubGVuZ3RoKSkKICAgICAgICBmb3IgKDsgIiAiID09PSBhW2VdOyApIGUrKwogICAgICAgIGlmIChkKSB7CiAgICAgICAgICBpZiAoIikiICE9PSBhW2VdKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJjb21wbGV4KCkgYXJnIGlzIG1hbGZvcm1lZCBzdHJpbmciKQogICAgICAgICAgZm9yIChlKys7ICIgIiA9PT0gYVtlXTsgKSBlKysKICAgICAgICB9CiAgICAgICAgaWYgKGEubGVuZ3RoICE9PSBlKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigiY29tcGxleCgpIGFyZyBpcyBtYWxmb3JtZWQgc3RyaW5nIikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhjKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oCiAgICAgICAgICAxMDAwMDAzICogdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRpbWFnKS52ICsKICAgICAgICAgICAgdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZWFsKS52LAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5jb21wbGV4LmNoZWNrX251bWJlcl9vcl9jb21wbGV4KGEpCiAgICAgICAgdmFyIGIgPQogICAgICAgICAgdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZWFsKS52ICsKICAgICAgICAgIGEudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcmVhbCkudgogICAgICAgIGEgPQogICAgICAgICAgdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRpbWFnKS52ICsKICAgICAgICAgIGEudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kaW1hZykudgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5jb21wbGV4KAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGIpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguX2NfZGlmZiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEucmVhbC5uYiRzdWJ0cmFjdC5jYWxsKGEucmVhbCwgYi5yZWFsKQogICAgICAgIGEgPSBhLmltYWcubmIkc3VidHJhY3QuY2FsbChhLmltYWcsIGIuaW1hZykKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleChjLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkc3VidHJhY3QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgodGhpcykKICAgICAgICBhID0gU2suYnVpbHRpbi5jb21wbGV4LmNoZWNrX251bWJlcl9vcl9jb21wbGV4KGEpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5fY19kaWZmKGIsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRtdWx0aXBseSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uY29tcGxleC5jaGVja19udW1iZXJfb3JfY29tcGxleChhKQogICAgICAgIGEgPSB0aGlzLnJlYWwudiAqIGIucmVhbC52IC0gdGhpcy5pbWFnLnYgKiBiLmltYWcudgogICAgICAgIGIgPSB0aGlzLnJlYWwudiAqIGIuaW1hZy52ICsgdGhpcy5pbWFnLnYgKiBiLnJlYWwudgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5jb21wbGV4KAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGIpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5jb21wbGV4LmNoZWNrX251bWJlcl9vcl9jb21wbGV4KGEpCiAgICAgICAgdmFyIGIgPSBhLnJlYWwudgogICAgICAgIHZhciBjID0gYS5pbWFnLnYKICAgICAgICBhID0gdGhpcy5yZWFsLnYKICAgICAgICB2YXIgZCA9IHRoaXMuaW1hZy52CiAgICAgICAgdmFyIGUgPSBNYXRoLmFicyhiKQogICAgICAgIHZhciBmID0gTWF0aC5hYnMoYykKICAgICAgICBpZiAoZSA+PSBmKSB7CiAgICAgICAgICBpZiAoMCA9PT0gZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IoImNvbXBsZXggZGl2aXNpb24gYnkgemVybyIpCiAgICAgICAgICBlID0gYyAvIGIKICAgICAgICAgIGYgPSBiICsgYyAqIGUKICAgICAgICAgIGIgPSAoYSArIGQgKiBlKSAvIGYKICAgICAgICAgIGEgPSAoZCAtIGEgKiBlKSAvIGYKICAgICAgICB9IGVsc2UKICAgICAgICAgIGYgPj0gZQogICAgICAgICAgICA/ICgoZSA9IGIgLyBjKSwKICAgICAgICAgICAgICAoZiA9IGIgKiBlICsgYyksCiAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCAhPT0gYyksCiAgICAgICAgICAgICAgKGIgPSAoYSAqIGUgKyBkKSAvIGYpLAogICAgICAgICAgICAgIChhID0gKGQgKiBlIC0gYSkgLyBmKSkKICAgICAgICAgICAgOiAoYSA9IGIgPSBOYU4pCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmNvbXBsZXgoCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYiksCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuJ3QgdGFrZSBmbG9vciBvZiBjb21wbGV4IG51bWJlci4iKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkcmVtYWluZGVyID0gZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuJ3QgbW9kIGNvbXBsZXggbnVtYmVycy4iKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkcG93ZXIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKG51bGwgIT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja05vbmUoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJjb21wbGV4IG1vZHVsbyIpCiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uY29tcGxleC5jaGVja19udW1iZXJfb3JfY29tcGxleChhKQogICAgICAgIGEgPSBiLnJlYWwudiB8IDAKICAgICAgICByZXR1cm4gMCA9PT0gYi5pbWFnLnYgJiYgYi5yZWFsLnYgPT09IGEKICAgICAgICAgID8gU2suYnVpbHRpbi5jb21wbGV4LmNfcG93aSh0aGlzLCBhKQogICAgICAgICAgOiBTay5idWlsdGluLmNvbXBsZXguY19wb3codGhpcywgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguY19wb3cgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBiLnJlYWwudgogICAgICAgIGIgPSBiLmltYWcudgogICAgICAgIHZhciBkID0gYS5yZWFsLnYKICAgICAgICB2YXIgZSA9IGEuaW1hZy52CiAgICAgICAgaWYgKDAgPT09IGMgJiYgMCA9PT0gYikgKGIgPSAxKSwgKGEgPSAwKQogICAgICAgIGVsc2UgaWYgKDAgPT09IGQgJiYgMCA9PT0gZSkgewogICAgICAgICAgaWYgKDAgIT09IGIgfHwgMCA+IGMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKCJjb21wbGV4IGRpdmlzaW9uIGJ5IHplcm8iKQogICAgICAgICAgYSA9IGIgPSAwCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBmID0gTWF0aC5oeXBvdChkLCBlKQogICAgICAgICAgYSA9IE1hdGgucG93KGYsIGMpCiAgICAgICAgICBkID0gTWF0aC5hdGFuMihlLCBkKQogICAgICAgICAgYyAqPSBkCiAgICAgICAgICAwICE9PSBiICYmICgoYSAvPSBNYXRoLmV4cChkICogYikpLCAoYyArPSBiICogTWF0aC5sb2coZikpKQogICAgICAgICAgYiA9IGEgKiBNYXRoLmNvcyhjKQogICAgICAgICAgYSAqPSBNYXRoLnNpbihjKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LmNfcG93aSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gMTAwIDwgYiB8fCAtMTAwID4gYgogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5jb21wbGV4KAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMCksCiAgICAgICAgICAgICkpLAogICAgICAgICAgICBTay5idWlsdGluLmNvbXBsZXguY19wb3coYSwgYikpCiAgICAgICAgICA6IDAgPCBiCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uY29tcGxleC5jX3Bvd3UoYSwgYikKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMSksCiAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApLAogICAgICAgICAgICApLm5iJGRpdmlkZShTay5idWlsdGluLmNvbXBsZXguY19wb3d1KGEsIC1iKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguY19wb3d1ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLAogICAgICAgICAgZCA9IDEKICAgICAgICBmb3IgKAogICAgICAgICAgYyA9IG5ldyBTay5idWlsdGluLmNvbXBsZXgoCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XygxKSwKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApLAogICAgICAgICAgKTsKICAgICAgICAgIDAgPCBkICYmIGIgPj0gZDsKCiAgICAgICAgKQogICAgICAgICAgYiAmIGQgJiYgKGMgPSBjLm5iJG11bHRpcGx5KGEpKSwgKGQgPDw9IDEpLCAoYSA9IGEubmIkbXVsdGlwbHkoYSkpCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0KICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGFkZAogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGlucGxhY2Vfc3VidHJhY3QgPQogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkc3VidHJhY3QKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRpbnBsYWNlX211bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJG11bHRpcGx5CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkaW5wbGFjZV9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkZGl2aWRlCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkaW5wbGFjZV9yZW1haW5kZXIgPQogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkcmVtYWluZGVyCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkaW5wbGFjZV9mbG9vcl9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkaW5wbGFjZV9wb3dlciA9CiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRwb3dlcgogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJG5lZ2F0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLnJlYWwudgogICAgICAgIHZhciBiID0gLXRoaXMuaW1hZy52CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmNvbXBsZXgoCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLWEpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGIpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5jaGVja19udW1iZXJfb3JfY29tcGxleCh0aGlzKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhCiAgICAgICAgICA/ICExCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmNvbXBsZXggfHwKICAgICAgICAgICAgKGEudHAkbmFtZSAmJiAiY29tcGxleCIgPT09IGEudHAkbmFtZSkgfHwKICAgICAgICAgICAgU2suYnVpbHRpbi5pc3N1YmNsYXNzKG5ldyBTay5idWlsdGluLnR5cGUoYSksIFNrLmJ1aWx0aW4uY29tcGxleCkKICAgICAgICAgID8gITAKICAgICAgICAgIDogITEKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLnRwJHJpY2hjb21wYXJlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICgiRXEiICE9PSBiICYmICJOb3RFcSIgIT09IGIpIHsKICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpIHx8IFNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayhhKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJubyBvcmRlcmluZyByZWxhdGlvbiBpcyBkZWZpbmVkIGZvciBjb21wbGV4IG51bWJlcnMiLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICB9CiAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgodGhpcykKICAgICAgICB2YXIgZCA9IGMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcmVhbCkudgogICAgICAgIGMgPSBjLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJGltYWcpLnYKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0ludChhKSkgewogICAgICAgICAgaWYgKDAgPT09IGMpCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgKGQgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2wobmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGQpLCBhLCBiKSksCiAgICAgICAgICAgICAgKGIgPSBuZXcgU2suYnVpbHRpbi5ib29sKGQpKQogICAgICAgICAgICApCiAgICAgICAgICBkID0gITEKICAgICAgICB9IGVsc2UgaWYgKFNrLmJ1aWx0aW4uY2hlY2tGbG9hdChhKSkKICAgICAgICAgIGQgPSBkID09PSBTay5idWlsdGluLmZsb2F0Xy5QeUZsb2F0X0FzRG91YmxlKGEpICYmIDAgPT09IGMKICAgICAgICBlbHNlIGlmIChTay5idWlsdGluLmNvbXBsZXguX2NvbXBsZXhfY2hlY2soYSkpIHsKICAgICAgICAgIHZhciBlID0gYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZWFsKS52CiAgICAgICAgICBhID0gYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRpbWFnKS52CiAgICAgICAgICBkID0gZCA9PT0gZSAmJiBjID09PSBhCiAgICAgICAgfSBlbHNlIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICJOb3RFcSIgPT09IGIgJiYgKGQgPSAhZCkKICAgICAgICByZXR1cm4gKGIgPSBuZXcgU2suYnVpbHRpbi5ib29sKGQpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19lcV9fID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLnRwJHJpY2hjb21wYXJlLmNhbGwoYSwgYiwgIkVxIikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbmVfXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS50cCRyaWNoY29tcGFyZS5jYWxsKGEsIGIsICJOb3RFcSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2x0X18gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgInVub3JkZXJhYmxlIHR5cGVzOiAiICsKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAiIDwgIiArCiAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbGVfXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidW5vcmRlcmFibGUgdHlwZXM6ICIgKwogICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICIgPD0gIiArCiAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fZ3RfXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidW5vcmRlcmFibGUgdHlwZXM6ICIgKwogICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICIgPiAiICsKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19nZV9fID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJ1bm9yZGVyYWJsZSB0eXBlczogIiArCiAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgIiA+PSAiICsKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19mbG9hdF9fID0gZnVuY3Rpb24oYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuJ3QgY29udmVydCBjb21wbGV4IHRvIGZsb2F0IikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9faW50X18gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjYW4ndCBjb252ZXJ0IGNvbXBsZXggdG8gaW50IikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9pbnRlcm5hbEdlbmVyaWNHZXRBdHRyID0KICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS50cCRnZXRhdHRyID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChudWxsICE9IGEgJiYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhKSkgewogICAgICAgICAgdmFyIGIgPSBhCiAgICAgICAgICBTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpICYmIChiID0gU2suZmZpLnJlbWFwVG9KcyhhKSkKICAgICAgICAgIGlmICgicmVhbCIgPT09IGIgfHwgImltYWciID09PSBiKSByZXR1cm4gdGhpc1tiXQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJuYWxHZW5lcmljR2V0QXR0cihhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUudHAkc2V0YXR0ciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoCiAgICAgICAgICBudWxsICE9IGEgJiYKICAgICAgICAgIChTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpIHx8ICJzdHJpbmciID09PSB0eXBlb2YgYSkgJiYKICAgICAgICAgICgoYiA9IGEpLAogICAgICAgICAgU2suYnVpbHRpbi5jaGVja1N0cmluZyhhKSAmJiAoYiA9IFNrLmZmaS5yZW1hcFRvSnMoYSkpLAogICAgICAgICAgInJlYWwiID09PSBiIHx8ICJpbWFnIiA9PT0gYikKICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigicmVhZG9ubHkgYXR0cmlidXRlIikKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICInY29tcGxleCcgb2JqZWN0IGF0dHJpYnV0ZSAnIiArIGEgKyAiJyBpcyByZWFkb25seSIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5jb21wbGV4X2Zvcm1hdCA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBpZiAobnVsbCA9PSBhIHx8ICFTay5idWlsdGluLmNvbXBsZXguX2NvbXBsZXhfY2hlY2soYSkpCiAgICAgICAgICB0aHJvdyBFcnJvcigKICAgICAgICAgICAgIkludmFsaWQgaW50ZXJuYWwgbWV0aG9kIGNhbGw6IFNrLmNvbXBsZXguY29tcGxleF9mb3JtYXQoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIHZhbHVlIHR5cGUuIiwKICAgICAgICAgICkKICAgICAgICB2YXIgZCA9ICIiLAogICAgICAgICAgZSA9ICIiCiAgICAgICAgaWYgKDAgPT09IGEucmVhbC52ICYmIDEgPT0gKDAgPiBhLnJlYWwudiA/IC0xIDogMSkpIHsKICAgICAgICAgIHZhciBmID0gIiIKICAgICAgICAgIGIgPSBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nKGEuaW1hZy52LCBjLCBiLCAwLCBudWxsKQogICAgICAgIH0gZWxzZQogICAgICAgICAgKGYgPSBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nKAogICAgICAgICAgICBhLnJlYWwudiwKICAgICAgICAgICAgYywKICAgICAgICAgICAgYiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICkpLAogICAgICAgICAgICAoYiA9IFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcoCiAgICAgICAgICAgICAgYS5pbWFnLnYsCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcuUHlfRFRTRl9TSUdOLAogICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICkpLAogICAgICAgICAgICAwID09PSBhLmltYWcudiAmJgogICAgICAgICAgICAgIC1JbmZpbml0eSA9PT0gMSAvIGEuaW1hZy52ICYmCiAgICAgICAgICAgICAgYiAmJgogICAgICAgICAgICAgICItIiAhPT0gYlswXSAmJgogICAgICAgICAgICAgIChiID0gIi0iICsgYiksCiAgICAgICAgICAgIChkID0gIigiKSwKICAgICAgICAgICAgKGUgPSAiKSIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiIiArIGQgKyBmICsgYiArICJqIiArIGUpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXguY29tcGxleF9mb3JtYXQodGhpcywgMCwgInIiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUudHAkc3RyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5jb21wbGV4X2Zvcm1hdCh0aGlzLCBudWxsLCAiZyIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZm9ybWF0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmIChudWxsID09IGIpIHJldHVybiBudWxsCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICByZXR1cm4gKGEgPSBTay5idWlsdGluLmNvbXBsZXguX1B5Q29tcGxleF9Gb3JtYXRBZHZhbmNlZChhLCBiKSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZm9ybWF0X18gcmVxdWlyZXMgc3RyIG9yIHVuaWNvZGUiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGZvcm1hdC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2Zvcm1hdF9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fZm9ybWF0X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGZvcm1hdCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXguX1B5Q29tcGxleF9Gb3JtYXRBZHZhbmNlZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgIl9fZm9ybWF0X18gaXMgbm90IGltcGxlbWVudGVkIGZvciBjb21wbGV4IHR5cGUuIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4Ll9pc19maW5pdGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuICFpc05hTihhKSAmJiBJbmZpbml0eSAhPT0gYSAmJiAtSW5maW5pdHkgIT09IGEKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguX2lzX2luZmluaXR5ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBJbmZpbml0eSA9PT0gYSB8fCAtSW5maW5pdHkgPT09IGEKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhYnMgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSBhLnJlYWwudgogICAgICAgIGEgPSBhLmltYWcudgogICAgICAgIGlmICgKICAgICAgICAgICFTay5idWlsdGluLmNvbXBsZXguX2lzX2Zpbml0ZShiKSB8fAogICAgICAgICAgIVNrLmJ1aWx0aW4uY29tcGxleC5faXNfZmluaXRlKGEpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5faXNfaW5maW5pdHkoYikKICAgICAgICAgICAgPyAoKGIgPSBNYXRoLmFicyhiKSksIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSkKICAgICAgICAgICAgOiBTay5idWlsdGluLmNvbXBsZXguX2lzX2luZmluaXR5KGEpCiAgICAgICAgICAgID8gKChiID0gTWF0aC5hYnMoYSkpLCBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYikpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICBiID0gTWF0aC5oeXBvdChiLCBhKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jb21wbGV4Ll9pc19maW5pdGUoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yKCJhYnNvbHV0ZSB2YWx1ZSB0b28gbGFyZ2UiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhYnMuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19hYnNfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2Fic19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhYnMsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkYm9vbCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbCgKICAgICAgICAgIGEudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcmVhbCkudiB8fAogICAgICAgICAgICBhLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJHJlYWwpLnYsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGJvb2wuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19ib29sX18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19ib29sX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGJvb2wsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkdHJ1ZWRpdiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3RydWVkaXZfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICEwKQogICAgICAgIHJldHVybiBhLm5iJGRpdmlkZS5jYWxsKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkdHJ1ZWRpdi5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX3RydWVkaXZfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX3RydWVkaXZfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkdHJ1ZWRpdiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRoYXNoID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faGFzaF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIGEudHAkaGFzaC5jYWxsKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkaGFzaC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2hhc2hfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2hhc2hfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkaGFzaCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhZGQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19hZGRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICEwKQogICAgICAgIHJldHVybiBhLm5iJGFkZC5jYWxsKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkYWRkLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fYWRkX18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19hZGRfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkYWRkLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHJlcHIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yZXByX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMCkKICAgICAgICByZXR1cm4gYS5yJC5jYWxsKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcmVwci5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX3JlcHJfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX3JlcHJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcmVwciwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRzdHIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zdHJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICEwKQogICAgICAgIHJldHVybiBhLnRwJHN0ci5jYWxsKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkc3RyLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fc3RyX18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19zdHJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkc3RyLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHN1YiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3N1Yl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkc3VidHJhY3QuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHN1Yi5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX3N1Yl9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fc3ViX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHN1YiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRtdWwgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19tdWxfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICEwKQogICAgICAgIHJldHVybiBhLm5iJG11bHRpcGx5LmNhbGwoYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRtdWwuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19tdWxfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX211bF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRtdWwsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZGl2ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZGl2X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRkaXZpZGUuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdi5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2Rpdl9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fZGl2X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRmbG9vcmRpdiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2Zsb29yZGl2X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRmbG9vcl9kaXZpZGUuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGZsb29yZGl2LmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fZmxvb3JkaXZfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2Zsb29yZGl2X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGZsb29yZGl2LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG1vZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX21vZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkcmVtYWluZGVyLmNhbGwoYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRtb2QuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19tb2RfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX21vZF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRtb2QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG93ID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcG93X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRwb3dlci5jYWxsKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG93LmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fcG93X18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19wb3dfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG93LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG5lZyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX25lZ19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIGEubmIkbmVnYXRpdmUuY2FsbChhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19uZWdfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkbmVnLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHBvcyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3Bvc19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIGEubmIkcG9zaXRpdmUuY2FsbChhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHBvcy5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX3Bvc19fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fcG9zX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHBvcywKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRjb25qdWdhdGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY29uanVnYXRlIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmNvbXBsZXgoYS5yZWFsLCBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLWEuaW1hZy52KSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRjb25qdWdhdGUuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiY29uanVnYXRlIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmNvbmp1Z2F0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkY29uanVnYXRlLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdm1vZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2Rpdm1vZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITApCiAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgoYSkKICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4uY29tcGxleC5jaGVja19udW1iZXJfb3JfY29tcGxleChiKQogICAgICAgIHZhciBlID0gYy5uYiRkaXZpZGUuY2FsbChjLCBkKQogICAgICAgIGUucmVhbCA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhNYXRoLmZsb29yKGUucmVhbC52KSkKICAgICAgICBlLmltYWcgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMCkKICAgICAgICBjID0gYy5uYiRzdWJ0cmFjdC5jYWxsKGMsIGQubmIkbXVsdGlwbHkuY2FsbChkLCBlKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW2UsIGNdKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdm1vZC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2Rpdm1vZF9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fZGl2bW9kX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdm1vZCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRnZXRuZXdhcmdzID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0bmV3YXJnc19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFthLnJlYWwsIGEuaW1hZ10pCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZ2V0bmV3YXJncy5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2dldG5ld2FyZ3NfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2dldG5ld2FyZ3NfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZ2V0bmV3YXJncywKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRub256ZXJvID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbm9uemVyb19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIDAgIT09IGEucmVhbC52IHx8IDAgIT09IGEuaW1hZy52CiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkbm9uemVyby5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX25vbnplcm9fXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX25vbnplcm9fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkbm9uemVybywKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY29tcGxleCIsIFNrLmJ1aWx0aW4uY29tcGxleCkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZyA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBlID0gITEKICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgIGNhc2UgImUiOgogICAgICAgICAgY2FzZSAiZiI6CiAgICAgICAgICBjYXNlICJnIjoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgIkUiOgogICAgICAgICAgICBlID0gITAKICAgICAgICAgICAgYiA9ICJlIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSAiRiI6CiAgICAgICAgICAgIGUgPSAhMAogICAgICAgICAgICBiID0gImYiCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlICJyIjoKICAgICAgICAgICAgaWYgKDAgIT09IGMpIHRocm93IEVycm9yKCJCYWQgaW50ZXJuYWxsIGNhbGwiKQogICAgICAgICAgICBjID0gMTcKICAgICAgICAgICAgYiA9ICJnIgogICAgICAgICAgICBicmVhawogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIkJhZCBpbnRlcm5hbGwgY2FsbCIpCiAgICAgICAgfQogICAgICAgIGlmIChpc05hTihhKSkgYSA9ICJuYW4iCiAgICAgICAgZWxzZSBpZiAoSW5maW5pdHkgPT09IGEpIGEgPSAiaW5mIgogICAgICAgIGVsc2UgaWYgKC1JbmZpbml0eSA9PT0gYSkgYSA9ICItaW5mIgogICAgICAgIGVsc2UgewogICAgICAgICAgZCAmIFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcuUHlfRFRTRl9BRERfRE9UXzAgJiYKICAgICAgICAgICAgKGIgPSAiZyIpCiAgICAgICAgICB2YXIgZiA9CiAgICAgICAgICAgICIlIiArCiAgICAgICAgICAgIChkICYgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNGX0FMVAogICAgICAgICAgICAgID8gIiMiCiAgICAgICAgICAgICAgOiAiIikKICAgICAgICAgIG51bGwgIT0gYyAmJiAoZiA9IGYgKyAiLiIgKyBjKQogICAgICAgICAgZiA9IG5ldyBTay5idWlsdGluLnN0cihmICsgYikKICAgICAgICAgIGEgPSBmLm5iJHJlbWFpbmRlcihuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkpCiAgICAgICAgICBhID0gYS52CiAgICAgICAgfQogICAgICAgIGQgJiBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU0ZfU0lHTiAmJgogICAgICAgICAgIi0iICE9PSBhWzBdICYmCiAgICAgICAgICAoYSA9ICIrIiArIGEpCiAgICAgICAgZSAmJiAoYSA9IGEudG9VcHBlckNhc2UoKSkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcuUHlfRFRTRl9TSUdOID0gMQogICAgICBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU0ZfQUREX0RPVF8wID0gMgogICAgICBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU0ZfQUxUID0gNAogICAgICBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU1RfRklOSVRFID0gMAogICAgICBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU1RfSU5GSU5JVEUgPSAxCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcuUHlfRFRTVF9OQU4gPSAyCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLnNsaWNlID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInNsaWNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMywgITEsICExKQogICAgICAgIGlmICgKICAgICAgICAgIHZvaWQgMCAhPT0gYyAmJgogICAgICAgICAgU2subWlzY2V2YWwuaXNJbmRleChjKSAmJgogICAgICAgICAgMCA9PT0gU2subWlzY2V2YWwuYXNJbmRleChjKQogICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoInNsaWNlIHN0ZXAgY2Fubm90IGJlIHplcm8iKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnNsaWNlKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zbGljZShhLCBiLCBjKQogICAgICAgIHZvaWQgMCA9PT0gYiAmJiB2b2lkIDAgPT09IGMgJiYgKChiID0gYSksIChhID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKSkKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgIHRoaXMuc3RhcnQgPSBhCiAgICAgICAgdGhpcy5zdG9wID0gYgogICAgICAgIHRoaXMuc3RlcCA9IGMKICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uc2xpY2UKICAgICAgICB0aGlzLiRkID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbCiAgICAgICAgICBTay5idWlsdGluLnNsaWNlJHN0YXJ0LAogICAgICAgICAgdGhpcy5zdGFydCwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2xpY2Ukc3RvcCwKICAgICAgICAgIHRoaXMuc3RvcCwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2xpY2Ukc3RlcCwKICAgICAgICAgIHRoaXMuc3RlcCwKICAgICAgICBdKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgic2xpY2UiLCBTay5idWlsdGluLnNsaWNlLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9IFNrLmJ1aWx0aW4ucmVwcih0aGlzLnN0YXJ0KS52LAogICAgICAgICAgYiA9IFNrLmJ1aWx0aW4ucmVwcih0aGlzLnN0b3ApLnYsCiAgICAgICAgICBjID0gU2suYnVpbHRpbi5yZXByKHRoaXMuc3RlcCkudgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoInNsaWNlKCIgKyBhICsgIiwgIiArIGIgKyAiLCAiICsgYyArICIpIikKICAgICAgfQogICAgICBTay5idWlsdGluLnNsaWNlLnByb3RvdHlwZS50cCRyaWNoY29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoIWEuX19jbGFzc19fIHx8IGEuX19jbGFzc19fICE9IFNrLmJ1aWx0aW4uc2xpY2UpCiAgICAgICAgICByZXR1cm4gIkVxIiA9PT0gYgogICAgICAgICAgICA/ICExCiAgICAgICAgICAgIDogIk5vdEVxIiA9PT0gYgogICAgICAgICAgICA/ICEwCiAgICAgICAgICAgIDogU2suX19mdXR1cmVfXy5weXRob24zCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICAgICAgOiAhMQogICAgICAgIHZhciBjID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW3RoaXMuc3RhcnQsIHRoaXMuc3RvcCwgdGhpcy5zdGVwXSkKICAgICAgICBhID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW2Euc3RhcnQsIGEuc3RvcCwgYS5zdGVwXSkKICAgICAgICByZXR1cm4gYy50cCRyaWNoY29tcGFyZShhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2xpY2UucHJvdG90eXBlLnNsaWNlX2luZGljZXNfID0gZnVuY3Rpb24oYSkgewogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZSh0aGlzLnN0YXJ0KSkgdmFyIGIgPSBudWxsCiAgICAgICAgZWxzZSBpZiAoU2subWlzY2V2YWwuaXNJbmRleCh0aGlzLnN0YXJ0KSkKICAgICAgICAgIGIgPSBTay5taXNjZXZhbC5hc0luZGV4KHRoaXMuc3RhcnQpCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUiLAogICAgICAgICAgKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZSh0aGlzLnN0b3ApKSB2YXIgYyA9IG51bGwKICAgICAgICBlbHNlIGlmIChTay5taXNjZXZhbC5pc0luZGV4KHRoaXMuc3RvcCkpCiAgICAgICAgICBjID0gU2subWlzY2V2YWwuYXNJbmRleCh0aGlzLnN0b3ApCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUiLAogICAgICAgICAgKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZSh0aGlzLnN0ZXApKSB2YXIgZCA9IG51bGwKICAgICAgICBlbHNlIGlmIChTay5taXNjZXZhbC5pc0luZGV4KHRoaXMuc3RlcCkpCiAgICAgICAgICBkID0gU2subWlzY2V2YWwuYXNJbmRleCh0aGlzLnN0ZXApCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUiLAogICAgICAgICAgKQogICAgICAgIG51bGwgPT09IGQgJiYgKGQgPSAxKQogICAgICAgIDAgPCBkCiAgICAgICAgICA/IChudWxsID09PSBiICYmIChiID0gMCksCiAgICAgICAgICAgIG51bGwgPT09IGMgJiYgKGMgPSBhKSwKICAgICAgICAgICAgYyA+IGEgJiYgKGMgPSBhKSwKICAgICAgICAgICAgMCA+IGIgJiYgKChiID0gYSArIGIpLCAwID4gYiAmJiAoYiA9IDApKSwKICAgICAgICAgICAgMCA+IGMgJiYgKGMgPSBhICsgYykpCiAgICAgICAgICA6IChudWxsID09PSBiICYmIChiID0gYSAtIDEpLAogICAgICAgICAgICBiID49IGEgJiYgKGIgPSBhIC0gMSksCiAgICAgICAgICAgIG51bGwgPT09IGMgPyAoYyA9IC0xKSA6IDAgPiBjICYmICgoYyA9IGEgKyBjKSwgMCA+IGMgJiYgKGMgPSAtMSkpLAogICAgICAgICAgICAwID4gYiAmJiAoYiA9IGEgKyBiKSkKICAgICAgICByZXR1cm4gW2IsIGMsIGRdCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUuaW5kaWNlcyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImluZGljZXMiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyLCAhMSwgITEpCiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgdmFyIGMgPSBhLnNsaWNlX2luZGljZXNfKGIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgIG5ldyBTay5idWlsdGluLmludF8oY1swXSksCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5pbnRfKGNbMV0pLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uaW50XyhjWzJdKSwKICAgICAgICBdKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNsaWNlLnByb3RvdHlwZS5zc3NpdGVyJCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpLAogICAgICAgICAgZCA9IHRoaXMuc2xpY2VfaW5kaWNlc18oIm51bWJlciIgPT09IHR5cGVvZiBjID8gYyA6IGEudi5sZW5ndGgpCiAgICAgICAgaWYgKDAgPCBkWzJdKSBmb3IgKGEgPSBkWzBdOyBhIDwgZFsxXSAmJiAhMSAhPT0gYihhLCBjKTsgYSArPSBkWzJdKTsKICAgICAgICBlbHNlIGZvciAoYSA9IGRbMF07IGEgPiBkWzFdICYmICExICE9PSBiKGEsIGMpOyBhICs9IGRbMl0pOwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2xpY2Ukc3RhcnQgPSBuZXcgU2suYnVpbHRpbi5zdHIoInN0YXJ0IikKICAgICAgU2suYnVpbHRpbi5zbGljZSRzdG9wID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJzdG9wIikKICAgICAgU2suYnVpbHRpbi5zbGljZSRzdGVwID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJzdGVwIikKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc2V0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc2V0KSkKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInNldCIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDEpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zZXQoYSkKICAgICAgICAgICkKICAgICAgICAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSBbXSkKICAgICAgICB0aGlzLnNldF9yZXNldF8oKQogICAgICAgIHZhciBjID0gbmV3IFNrLmJ1aWx0aW4ubGlzdChhKQogICAgICAgIGMgPSBTay5hYnN0ci5pdGVyKGMpCiAgICAgICAgZm9yIChiID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuYWRkLmZ1bmNfY29kZSh0aGlzLCBiKQogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5zZXQKICAgICAgICB0aGlzLnYgPSB0aGlzLnYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoInNldCIsIFNrLmJ1aWx0aW4uc2V0LCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYWJzdHIubWFya1VuaGFzaGFibGUoU2suYnVpbHRpbi5zZXQpCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zZXRfcmVzZXRfID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy52ID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbXSkKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGIgPSBbXQogICAgICAgIHZhciBjID0gU2suYWJzdHIuaXRlcih0aGlzKQogICAgICAgIGZvciAoYSA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBhOyBhID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgYi5wdXNoKFNrLm1pc2NldmFsLm9iamVjdFJlcHIoYSkudikKICAgICAgICByZXR1cm4gU2suX19mdXR1cmVfXy5zZXRfcmVwcgogICAgICAgICAgPyAwID09PSBiLmxlbmd0aAogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnN0cigic2V0KCkiKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cigieyIgKyBiLmpvaW4oIiwgIikgKyAifSIpCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cigic2V0KFsiICsgYi5qb2luKCIsICIpICsgIl0pIikKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUub2IkZXEgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnNldCAmJgogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwodGhpcykgPT09CiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKGEpCiAgICAgICAgICA/IHRoaXMuaXNzdWJzZXQuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUub2IkbmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zZXQgJiYKICAgICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKHRoaXMpID09PQogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbChhKQogICAgICAgICAgPyB0aGlzLmlzc3Vic2V0LmZ1bmNfY29kZSh0aGlzLCBhKS52CiAgICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUub2IkbHQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEgfHwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbCh0aGlzKSA+PQogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiB0aGlzLmlzc3Vic2V0LmZ1bmNfY29kZSh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5vYiRsZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcyA9PT0gYQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKHRoaXMpID4KICAgICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKGEpCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICAgIDogdGhpcy5pc3N1YnNldC5mdW5jX2NvZGUodGhpcywgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUub2IkZ3QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEgfHwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbCh0aGlzKSA8PQogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiB0aGlzLmlzc3VwZXJzZXQuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm9iJGdlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB0aGlzID09PSBhCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwodGhpcykgPAogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiB0aGlzLmlzc3VwZXJzZXQuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm5iJGFuZCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3Rpb24uZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm5iJG9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB0aGlzLnVuaW9uLmZ1bmNfY29kZSh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5uYiR4b3IgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ltbWV0cmljX2RpZmZlcmVuY2UuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB0aGlzLmRpZmZlcmVuY2UuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pdGVyX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnNldF9pdGVyXyhhKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUudHAkaXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zZXRfaXRlcl8odGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudi5tcCRsZW5ndGgoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRjb250YWlucyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy52LnNxJGNvbnRhaW5zKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmlzZGlzam9pbnQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzZGlzam9pbnQiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShiKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIHZhciBkID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYyA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBjOyBjID0gZC50cCRpdGVybmV4dCgpKQogICAgICAgICAgaWYgKChjID0gU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhiLCBjKSkpCiAgICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICB9KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuaXNzdWJzZXQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpc3N1YnNldCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBhLnNxJGxlbmd0aCgpCiAgICAgICAgdmFyIGQgPSBiLnNxJGxlbmd0aCgpCiAgICAgICAgaWYgKGMgPiBkKSByZXR1cm4gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIGMgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChkID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBpZiAoKChkID0gU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhiLCBkKSksICFkKSkKICAgICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5pc3N1cGVyc2V0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNzdXBlcnNldCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5pc3N1YnNldC5mdW5jX2NvZGUoYiwgYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVuaW9uID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJ1bmlvbiIsIGFyZ3VtZW50cy5sZW5ndGgsIDEpCiAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLnNldC5wcm90b3R5cGUuY29weS5mdW5jX2NvZGUoYSkKICAgICAgICB2YXIgZCA9IFtjXQogICAgICAgIGZvciAoYiA9IDE7IGIgPCBhcmd1bWVudHMubGVuZ3RoOyBiKyspIGQucHVzaChhcmd1bWVudHNbYl0pCiAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVwZGF0ZS5mdW5jX2NvZGUuYXBwbHkobnVsbCwgZCkKICAgICAgICByZXR1cm4gYwogICAgICB9KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuaW50ZXJzZWN0aW9uID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpbnRlcnNlY3Rpb24iLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmNvcHkuZnVuY19jb2RlKGEpCiAgICAgICAgdmFyIGQgPSBbY10KICAgICAgICBmb3IgKGIgPSAxOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgYisrKSBkLnB1c2goYXJndW1lbnRzW2JdKQogICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5pbnRlcnNlY3Rpb25fdXBkYXRlLmZ1bmNfY29kZS5hcHBseShudWxsLCBkKQogICAgICAgIHJldHVybiBjCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaWZmZXJlbmNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJkaWZmZXJlbmNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMikKICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5jb3B5LmZ1bmNfY29kZShhKQogICAgICAgIHZhciBlID0gW2RdCiAgICAgICAgZm9yIChjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykgZS5wdXNoKGFyZ3VtZW50c1tjXSkKICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuZGlmZmVyZW5jZV91cGRhdGUuZnVuY19jb2RlLmFwcGx5KG51bGwsIGUpCiAgICAgICAgcmV0dXJuIGQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnN5bW1ldHJpY19kaWZmZXJlbmNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICB2YXIgYwogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigKICAgICAgICAgICAgInN5bW1ldHJpY19kaWZmZXJlbmNlIiwKICAgICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgICAgMiwKICAgICAgICAgICAgMiwKICAgICAgICAgICkKICAgICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVuaW9uLmZ1bmNfY29kZShhLCBiKQogICAgICAgICAgdmFyIGUgPSBTay5hYnN0ci5pdGVyKGQpCiAgICAgICAgICBmb3IgKGMgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYzsgYyA9IGUudHAkaXRlcm5leHQoKSkKICAgICAgICAgICAgU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhhLCBjKSAmJgogICAgICAgICAgICAgIFNrLmFic3RyLnNlcXVlbmNlQ29udGFpbnMoYiwgYykgJiYKICAgICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuZGlzY2FyZC5mdW5jX2NvZGUoZCwgYykKICAgICAgICAgIHJldHVybiBkCiAgICAgICAgfSwKICAgICAgKQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuY29weSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNvcHkiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zZXQoYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVwZGF0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLCBkCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigidXBkYXRlIiwgYXJndW1lbnRzLmxlbmd0aCwgMikKICAgICAgICBmb3IgKGMgPSAxOyBjIDwgYXJndW1lbnRzLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICB2YXIgZSA9IGFyZ3VtZW50c1tjXQogICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShlKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgICApCiAgICAgICAgICBlID0gU2suYWJzdHIuaXRlcihlKQogICAgICAgICAgZm9yIChkID0gZS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBlLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5hZGQuZnVuY19jb2RlKGEsIGQpCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmludGVyc2VjdGlvbl91cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHZhciBjLCBkCiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpbnRlcnNlY3Rpb25fdXBkYXRlIiwgYXJndW1lbnRzLmxlbmd0aCwgMikKICAgICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspCiAgICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGFyZ3VtZW50c1tjXSkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYXJndW1lbnRzW2NdKSArCiAgICAgICAgICAgICAgICAgICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgICAgICkKICAgICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgICAgZm9yIChkID0gZS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBlLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspCiAgICAgICAgICAgICAgaWYgKCFTay5hYnN0ci5zZXF1ZW5jZUNvbnRhaW5zKGFyZ3VtZW50c1tjXSwgZCkpIHsKICAgICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaXNjYXJkLmZ1bmNfY29kZShhLCBkKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgfSwKICAgICAgKQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuZGlmZmVyZW5jZV91cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgdmFyIGMsIGQKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJkaWZmZXJlbmNlX3VwZGF0ZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDIpCiAgICAgICAgZm9yIChjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykKICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGFyZ3VtZW50c1tjXSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYXJndW1lbnRzW2NdKSArCiAgICAgICAgICAgICAgICAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICAgKQogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoZCA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBkOyBkID0gZS50cCRpdGVybmV4dCgpKQogICAgICAgICAgZm9yIChjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykKICAgICAgICAgICAgaWYgKFNrLmFic3RyLnNlcXVlbmNlQ29udGFpbnMoYXJndW1lbnRzW2NdLCBkKSkgewogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaXNjYXJkLmZ1bmNfY29kZShhLCBkKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zeW1tZXRyaWNfZGlmZmVyZW5jZV91cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oCiAgICAgICAgICAgICJzeW1tZXRyaWNfZGlmZmVyZW5jZV91cGRhdGUiLAogICAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgICAyLAogICAgICAgICAgICAyLAogICAgICAgICAgKQogICAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3ltbWV0cmljX2RpZmZlcmVuY2UuZnVuY19jb2RlKGEsIGIpCiAgICAgICAgICBhLnNldF9yZXNldF8oKQogICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVwZGF0ZS5mdW5jX2NvZGUoYSwgYykKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICB9LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5hZGQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJhZGQiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGEudi5tcCRhc3Nfc3Vic2NyaXB0KGIsICEwKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmRpc2NhcmQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJkaXNjYXJkIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnBvcC5mdW5jX2NvZGUoYS52LCBiLCBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUucG9wID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicG9wIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoMCA9PT0gYS5zcSRsZW5ndGgoKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLktleUVycm9yKCJwb3AgZnJvbSBhbiBlbXB0eSBzZXQiKQogICAgICAgIHZhciBiID0gU2suYWJzdHIuaXRlcihhKS50cCRpdGVybmV4dCgpCiAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmRpc2NhcmQuZnVuY19jb2RlKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnJlbW92ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJlbW92ZSIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgYS52Lm1wJGRlbF9zdWJzY3JpcHQoYikKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5zZXQiLCBTay5idWlsdGluLnNldCkKICAgICAgU2suYnVpbHRpbi5zZXRfaXRlcl8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsIGMKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zZXRfaXRlcl8pKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnNldF9pdGVyXyhhKQogICAgICAgIHRoaXMuJG9iaiA9IGEKICAgICAgICB0aGlzLnRwJGl0ZXIgPSB0aGlzCiAgICAgICAgdmFyIGQgPSBbXQogICAgICAgIHZhciBlID0gYS52LmJ1Y2tldHMKICAgICAgICBmb3IgKGIgaW4gZSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5oYXNPd25Qcm9wZXJ0eShiKSAmJgogICAgICAgICAgICAoYyA9IGVbYl0pICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gYy4kaGFzaCAmJgogICAgICAgICAgICB2b2lkIDAgIT09IGMuaXRlbXMKICAgICAgICAgICkKICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGMuaXRlbXMubGVuZ3RoOyBhKyspIGQucHVzaChjLml0ZW1zW2FdLmxocykKICAgICAgICB0aGlzLiRpbmRleCA9IDAKICAgICAgICB0aGlzLiRrZXlzID0gZAogICAgICAgIHRoaXMudHAkaXRlcm5leHQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICghKHRoaXMuJGluZGV4ID49IHRoaXMuJGtleXMubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGtleXNbdGhpcy4kaW5kZXgrK10KICAgICAgICB9CiAgICAgICAgdGhpcy4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigic2V0aXRlcmF0b3IiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgInNldGl0ZXJhdG9yIiwKICAgICAgICBTay5idWlsdGluLnNldF9pdGVyXywKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLnNldF9pdGVyXy5wcm90b3R5cGUuX19jbGFzc19fID0gU2suYnVpbHRpbi5zZXRfaXRlcl8KICAgICAgU2suYnVpbHRpbi5zZXRfaXRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbigKICAgICAgICBhLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2l0ZXJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICEwLCAhMSkKICAgICAgICByZXR1cm4gYQogICAgICB9KQogICAgICBTay5idWlsdGluLnNldF9pdGVyXy5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IGEudHAkaXRlcm5leHQoKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHRocm93IG5ldyBTay5idWlsdGluLlN0b3BJdGVyYXRpb24oKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIG0gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigKICAgICAgICAgICJwcmludCIsCiAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgMCwKICAgICAgICAgIEluZmluaXR5LAogICAgICAgICAgITAsCiAgICAgICAgICAhMSwKICAgICAgICApCiAgICAgICAgdmFyIGIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLAogICAgICAgICAgYyA9IG5ldyBTay5idWlsdGlucy5kaWN0KGEpCiAgICAgICAgU2suZmZpLnJlbWFwVG9KcyhjKQogICAgICAgIHZhciBkID0geyBzZXA6ICIgIiwgZW5kOiAiXG4iLCBmaWxlOiBudWxsIH0KICAgICAgICB2YXIgZSA9IGMubXAkbG9va3VwKG5ldyBTay5idWlsdGluLnN0cigic2VwIikpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZSkgewogICAgICAgICAgdmFyIGYgPSBTay5idWlsdGluLmNoZWNrTm9uZShlKQogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoZSkgfHwgZikKICAgICAgICAgICAgZC5zZXAgPSBmID8gZC5zZXAgOiBTay5mZmkucmVtYXBUb0pzKGUpCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAic2VwIG11c3QgYmUgTm9uZSBvciBhIHN0cmluZywgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShlKSwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBlID0gYy5tcCRsb29rdXAobmV3IFNrLmJ1aWx0aW4uc3RyKCJlbmQiKSkKICAgICAgICBpZiAodm9pZCAwICE9PSBlKQogICAgICAgICAgaWYgKCgoZiA9IFNrLmJ1aWx0aW4uY2hlY2tOb25lKGUpKSwgU2suYnVpbHRpbi5jaGVja1N0cmluZyhlKSB8fCBmKSkKICAgICAgICAgICAgZC5lbmQgPSBmID8gZC5lbmQgOiBTay5mZmkucmVtYXBUb0pzKGUpCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiZW5kIG11c3QgYmUgTm9uZSBvciBhIHN0cmluZywgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShlKSwKICAgICAgICAgICAgKQogICAgICAgIGUgPSBjLm1wJGxvb2t1cChuZXcgU2suYnVpbHRpbi5zdHIoImZpbGUiKSkKICAgICAgICBpZiAodm9pZCAwICE9PSBlKQogICAgICAgICAgaWYgKChmID0gU2suYnVpbHRpbi5jaGVja05vbmUoZSkpIHx8IHZvaWQgMCAhPT0gZS50cCRnZXRhdHRyKCJ3cml0ZSIpKQogICAgICAgICAgICBkLmZpbGUgPSBmID8gZC5maWxlIDogZQogICAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShlKSArICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICd3cml0ZSciLAogICAgICAgICAgICApCiAgICAgICAgdmFyIGcgPSAiIgogICAgICAgIGZvciAoYyA9IDA7IGMgPCBiLmxlbmd0aDsgYysrKQogICAgICAgICAgKGcgKz0gbmV3IFNrLmJ1aWx0aW4uc3RyKGJbY10pLnYpLCAoZyArPSBkLnNlcCkKICAgICAgICAwIDwgYi5sZW5ndGggJiYKICAgICAgICAgIDAgPCBkLnNlcC5sZW5ndGggJiYKICAgICAgICAgIChnID0gZy5zdWJzdHJpbmcoMCwgZy5sZW5ndGggLSBkLnNlcC5sZW5ndGgpKQogICAgICAgIGcgKz0gZC5lbmQKICAgICAgICBpZiAobnVsbCAhPT0gZC5maWxlKQogICAgICAgICAgU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGQuZmlsZS53cml0ZSwgWwogICAgICAgICAgICBkLmZpbGUsCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cihnKSwKICAgICAgICAgIF0pCiAgICAgICAgZWxzZQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKFNrLmltcG9ydE1vZHVsZSgic3lzIiwgITEsICEwKSwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHkoCiAgICAgICAgICAgICAgYS4kZC5zdGRvdXQud3JpdGUsCiAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgW2EuJGQuc3Rkb3V0LCBuZXcgU2suYnVpbHRpbi5zdHIoZyldLAogICAgICAgICAgICApCiAgICAgICAgICB9KQogICAgICB9CiAgICAgIG0uY29fa3dhcmdzID0gITAKICAgICAgU2suYnVpbHRpbi5wcmludCA9IG5ldyBTay5idWlsdGluLmZ1bmMobSkKICAgICAgU2suYnVpbHRpbi5wcmludC5fX2RvY19fID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJwcmludCh2YWx1ZSwgLi4uLCBzZXA9JyAnLCBlbmQ9J1xcbicsIGZpbGU9c3lzLnN0ZG91dCwgZmx1c2g9RmFsc2UpXG5cblByaW50cyB0aGUgdmFsdWVzIHRvIGEgc3RyZWFtLCBvciB0byBzeXMuc3Rkb3V0IGJ5IGRlZmF1bHQuXG5PcHRpb25hbCBrZXl3b3JkIGFyZ3VtZW50czpcbmZpbGU6ICBhIGZpbGUtbGlrZSBvYmplY3QgKHN0cmVhbSk7IGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IHN5cy5zdGRvdXQuXG5zZXA6ICAgc3RyaW5nIGluc2VydGVkIGJldHdlZW4gdmFsdWVzLCBkZWZhdWx0IGEgc3BhY2UuXG5lbmQ6ICAgc3RyaW5nIGFwcGVuZGVkIGFmdGVyIHRoZSBsYXN0IHZhbHVlLCBkZWZhdWx0IGEgbmV3bGluZS5cbmZsdXNoOiB3aGV0aGVyIHRvIGZvcmNpYmx5IGZsdXNoIHRoZSBzdHJlYW0uIiwKICAgICAgKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5tb2R1bGUgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5tb2R1bGUiLCBTay5idWlsdGluLm1vZHVsZSkKICAgICAgU2suYnVpbHRpbi5tb2R1bGUucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKAogICAgICAgICJtb2R1bGUiLAogICAgICAgIFNrLmJ1aWx0aW4ubW9kdWxlLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubW9kdWxlLnByb3RvdHlwZS50cCRnZXRhdHRyID0KICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIKICAgICAgU2suYnVpbHRpbi5tb2R1bGUucHJvdG90eXBlLnRwJHNldGF0dHIgPQogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljU2V0QXR0cgogICAgICBTay5idWlsdGluLm1vZHVsZS5wcm90b3R5cGUudHAkbmFtZSA9ICJtb2R1bGUiCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLnN0cnVjdHNlcV90eXBlcyA9IHt9CiAgICAgIFNrLmJ1aWx0aW4ubWFrZV9zdHJ1Y3RzZXEgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgdmFyIGUgPSBhICsgIi4iICsgYiwKICAgICAgICAgIGYgPSBbXQogICAgICAgIGEgPSBbXQogICAgICAgIGZvciAodmFyIGcgaW4gYykgZi5wdXNoKGcpLCBhLnB1c2goY1tnXSkKICAgICAgICBjID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbihlLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgICAgdmFyIGIKICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cnVjdHNlcV90eXBlc1tlXSkpIHsKICAgICAgICAgICAgdmFyIGMgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uc3RydWN0c2VxX3R5cGVzW2VdLnByb3RvdHlwZSkKICAgICAgICAgICAgYy5jb25zdHJ1Y3Rvci5hcHBseShjLCBhcmd1bWVudHMpCiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhKSkgdmFyIGQgPSBhCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZCA9IFtdCiAgICAgICAgICAgIGMgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICAgIGZvciAoYiA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgICAgIGQucHVzaChiKQogICAgICAgICAgICBpZiAoZC5sZW5ndGggIT0gZi5sZW5ndGgpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgZSArCiAgICAgICAgICAgICAgICAgICIoKSB0YWtlcyBhICIgKwogICAgICAgICAgICAgICAgICBmLmxlbmd0aCArCiAgICAgICAgICAgICAgICAgICItc2VxdWVuY2UgKCIgKwogICAgICAgICAgICAgICAgICBkLmxlbmd0aCArCiAgICAgICAgICAgICAgICAgICItc2VxdWVuY2UgZ2l2ZW4pIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBTay5idWlsdGluLnR1cGxlLmNhbGwodGhpcywgZCkKICAgICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5zdHJ1Y3RzZXFfdHlwZXNbZV0KICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5zdHJ1Y3RzZXFfdHlwZXNbZV0gPSBjCiAgICAgICAgU2suYWJzdHIuaW5oZXJpdHMoYywgU2suYnVpbHRpbi50dXBsZSkKICAgICAgICBkICYmIChjLnByb3RvdHlwZS5fX2RvY19fID0gZCkKICAgICAgICBjLnByb3RvdHlwZS50cCRuYW1lID0gZQogICAgICAgIGMucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKAogICAgICAgICAgZSwKICAgICAgICAgIFNrLmJ1aWx0aW4uc3RydWN0c2VxX3R5cGVzW2VdLAogICAgICAgICkKICAgICAgICBjLnByb3RvdHlwZS5vYiR0eXBlLiRkID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbXSkKICAgICAgICBjLnByb3RvdHlwZS5vYiR0eXBlLiRkLm1wJGFzc19zdWJzY3JpcHQoCiAgICAgICAgICBTay5idWlsdGluLnR5cGUuYmFzZXNTdHJfLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4udHVwbGUoW1NrLmJ1aWx0aW4udHVwbGVdKSwKICAgICAgICApCiAgICAgICAgYy5wcm90b3R5cGUuX19nZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5tcCRzdWJzY3JpcHQuY2FsbChhLCBiKQogICAgICAgIH0pCiAgICAgICAgYy5wcm90b3R5cGUuX19yZWR1Y2VfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uRXhjZXB0aW9uKCJfX3JlZHVjZV9fIGlzIG5vdCBpbXBsZW1lbnRlZCIpCiAgICAgICAgfSkKICAgICAgICBjLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGEKICAgICAgICAgIGlmICgwID09PSB0aGlzLnYubGVuZ3RoKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGUgKyAiKCkiKQogICAgICAgICAgdmFyIGIgPSBbXQogICAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudi5sZW5ndGg7ICsrYSkKICAgICAgICAgICAgYlthXSA9IGZbYV0gKyAiPSIgKyBTay5taXNjZXZhbC5vYmplY3RSZXByKHRoaXMudlthXSkudgogICAgICAgICAgYSA9IGIuam9pbigiLCAiKQogICAgICAgICAgMSA9PT0gdGhpcy52Lmxlbmd0aCAmJiAoYSArPSAiLCIpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGUgKyAiKCIgKyBhICsgIikiKQogICAgICAgIH0KICAgICAgICBjLnByb3RvdHlwZS50cCRzZXRhdHRyID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoInJlYWRvbmx5IHByb3BlcnR5IikKICAgICAgICB9CiAgICAgICAgYy5wcm90b3R5cGUudHAkZ2V0YXR0ciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHZhciBiID0gYS4kanNzdHIoKQogICAgICAgICAgYiA9IGYuaW5kZXhPZihiKQogICAgICAgICAgcmV0dXJuIDAgPD0gYgogICAgICAgICAgICA/IHRoaXMudltiXQogICAgICAgICAgICA6IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljR2V0QXR0cihhKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5tYWtlX3N0cnVjdHNlcSIsIFNrLmJ1aWx0aW4ubWFrZV9zdHJ1Y3RzZXEpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLmdlbmVyYXRvciA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICB2YXIgZgogICAgICAgIGlmIChhKSB7CiAgICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5nZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZ2VuZXJhdG9yKGEsIGIsIGMsIGQsIGUpCiAgICAgICAgICB0aGlzLmZ1bmNfY29kZSA9IGEKICAgICAgICAgIHRoaXMuZnVuY19nbG9iYWxzID0gYiB8fCBudWxsCiAgICAgICAgICB0aGlzLmdpJHJ1bm5pbmcgPSAhMQogICAgICAgICAgdGhpcy5naSRyZXN1bWVhdCA9IDAKICAgICAgICAgIHRoaXMuZ2kkc2VudHZhbHVlID0gdm9pZCAwCiAgICAgICAgICB0aGlzLmdpJGxvY2FscyA9IHt9CiAgICAgICAgICB0aGlzLmdpJGNlbGxzID0ge30KICAgICAgICAgIGlmICgwIDwgYy5sZW5ndGgpCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhLmNvX3Zhcm5hbWVzLmxlbmd0aDsgKytiKQogICAgICAgICAgICAgIHRoaXMuZ2kkbG9jYWxzW2EuY29fdmFybmFtZXNbYl1dID0gY1tiXQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZSkgZm9yIChmIGluIGUpIGRbZl0gPSBlW2ZdCiAgICAgICAgICB0aGlzLmZ1bmNfY2xvc3VyZSA9IGQKICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5nZW5lcmF0b3IiLCBTay5idWlsdGluLmdlbmVyYXRvcikKICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiZ2VuZXJhdG9yIiwKICAgICAgICBTay5idWlsdGluLmdlbmVyYXRvciwKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLmdlbmVyYXRvci5wcm90b3R5cGUudHAkaXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5nZW5lcmF0b3IucHJvdG90eXBlLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gdGhpcwogICAgICAgIHRoaXMuZ2kkcnVubmluZyA9ICEwCiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gbnVsbCkKICAgICAgICB0aGlzLmdpJHNlbnR2YWx1ZSA9IGIKICAgICAgICBiID0gW3RoaXNdCiAgICAgICAgdGhpcy5mdW5jX2Nsb3N1cmUgJiYgYi5wdXNoKHRoaXMuZnVuY19jbG9zdXJlKQogICAgICAgIHJldHVybiAoZnVuY3Rpb24gZihiKSB7CiAgICAgICAgICBpZiAoYiBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pIHsKICAgICAgICAgICAgaWYgKGEpIHJldHVybiBuZXcgU2subWlzY2V2YWwuU3VzcGVuc2lvbihmLCBiKQogICAgICAgICAgICBiID0gU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGIpCiAgICAgICAgICB9CiAgICAgICAgICBjLmdpJHJ1bm5pbmcgPSAhMQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBiKQogICAgICAgICAgaWYgKGIgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgICAgcmV0dXJuIChjLmdpJHJlc3VtZWF0ID0gYlswXSksIChiID0gYlsxXSkKICAgICAgICB9KSh0aGlzLmZ1bmNfY29kZS5hcHBseSh0aGlzLmZ1bmNfZ2xvYmFscywgYikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5nZW5lcmF0b3IucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXJuZXh0KCEwKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZ2VuZXJhdG9yLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAiPGdlbmVyYXRvciBvYmplY3QgIiArIHRoaXMuZnVuY19jb2RlLmNvX25hbWUudiArICI+IiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5nZW5lcmF0b3IucHJvdG90eXBlLnNlbmQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS50cCRpdGVybmV4dCghMCwgYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5tYWtlR2VuZXJhdG9yID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLAogICAgICAgICAgZCA9IG5ldyBTay5idWlsdGluLmdlbmVyYXRvcihudWxsLCBudWxsLCBudWxsKQogICAgICAgIGQudHAkaXRlcm5leHQgPSBhCiAgICAgICAgZm9yIChjIGluIGIpIGIuaGFzT3duUHJvcGVydHkoYykgJiYgKGRbY10gPSBiW2NdKQogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLm1ha2VHZW5lcmF0b3IiLCBTay5idWlsdGluLm1ha2VHZW5lcmF0b3IpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLmZpbGUgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5maWxlKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5maWxlKGEsIGIsIGMpCiAgICAgICAgdGhpcy5tb2RlID0gYgogICAgICAgIHRoaXMubmFtZSA9IFNrLmZmaS5yZW1hcFRvSnMoYSkKICAgICAgICB0aGlzLmNsb3NlZCA9ICExCiAgICAgICAgaWYgKCIvZGV2L3N0ZG91dCIgPT09IHRoaXMubmFtZSkKICAgICAgICAgICh0aGlzLmRhdGEkID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKSwgKHRoaXMuZmlsZW5vID0gMSkKICAgICAgICBlbHNlIGlmICgiL2Rldi9zdGRpbiIgPT09IHRoaXMubmFtZSkgdGhpcy5maWxlbm8gPSAwCiAgICAgICAgZWxzZSBpZiAoIi9kZXYvc3RkZXJyIiA9PT0gdGhpcy5uYW1lKSB0aGlzLmZpbGVubyA9IDIKICAgICAgICBlbHNlIHsKICAgICAgICAgIGlmIChTay5pbkJyb3dzZXIpCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAoKHRoaXMuZmlsZW5vID0gMTApLAogICAgICAgICAgICAgIChjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYS52KSksCiAgICAgICAgICAgICAgbnVsbCA9PSBjKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgaWYgKCJ3IiA9PSBiLnYgfHwgImEiID09IGIudikgdGhpcy5kYXRhJCA9ICIiCiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSU9FcnJvcigKICAgICAgICAgICAgICAgICAgIltFcnJubyAyXSBObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5OiAnIiArIGEudiArICInIiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICJ0ZXh0YXJlYSIgPT0gYy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgICA/ICh0aGlzLmRhdGEkID0gYy52YWx1ZSkKICAgICAgICAgICAgICAgIDogKHRoaXMuZGF0YSQgPSBjLnRleHRDb250ZW50KQogICAgICAgICAgZWxzZSAodGhpcy5maWxlbm8gPSAxMSksICh0aGlzLmRhdGEkID0gU2sucmVhZChhLnYpKQogICAgICAgICAgdGhpcy5saW5lTGlzdCA9IHRoaXMuZGF0YSQuc3BsaXQoIlxuIikKICAgICAgICAgIHRoaXMubGluZUxpc3QgPSB0aGlzLmxpbmVMaXN0LnNsaWNlKDAsIC0xKQogICAgICAgICAgZm9yIChkIGluIHRoaXMubGluZUxpc3QpIHRoaXMubGluZUxpc3RbZF0gKz0gIlxuIgogICAgICAgICAgdGhpcy5jdXJyZW50TGluZSA9IDAKICAgICAgICB9CiAgICAgICAgdGhpcy5wb3MkID0gMAogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5maWxlCiAgICAgICAgU2suZmlsZW9wZW4gJiYgMTAgPD0gdGhpcy5maWxlbm8gJiYgU2suZmlsZW9wZW4odGhpcykKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoImZpbGUiLCBTay5idWlsdGluLmZpbGUsIFNrLmJ1aWx0aW4ub2JqZWN0KQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAgICI8IiArCiAgICAgICAgICAgICh0aGlzLmNsb3NlZCA/ICJjbG9zZWQiIDogIm9wZW4iKSArCiAgICAgICAgICAgICJmaWxlICciICsKICAgICAgICAgICAgdGhpcy5uYW1lICsKICAgICAgICAgICAgIicsIG1vZGUgJyIgKwogICAgICAgICAgICBTay5mZmkucmVtYXBUb0pzKHRoaXMubW9kZSkgKwogICAgICAgICAgICAiJz4iLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLl9fZW50ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuX19leGl0X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuY2xvc2UsIFthXSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSB7CiAgICAgICAgICB0cCRpdGVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgIH0sCiAgICAgICAgICAkb2JqOiB0aGlzLAogICAgICAgICAgJGluZGV4OiB0aGlzLmN1cnJlbnRMaW5lLAogICAgICAgICAgJGxpbmVzOiB0aGlzLmxpbmVMaXN0LAogICAgICAgICAgdHAkaXRlcm5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIShhLiRpbmRleCA+PSBhLiRsaW5lcy5sZW5ndGgpKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYS4kbGluZXNbYS4kaW5kZXgrK10pCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuY2xvc2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICBhLmNsb3NlZCA9ICEwCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLmZsdXNoID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7fSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5maWxlbm8gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5maWxlbm8KICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5pc2F0dHkgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gITEKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5yZWFkID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBhLmRhdGEkLmxlbmd0aAogICAgICAgIGlmIChhLmNsb3NlZCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoIkkvTyBvcGVyYXRpb24gb24gY2xvc2VkIGZpbGUiKQogICAgICAgIHZhciBkID0gdm9pZCAwID09PSBiID8gYyA6IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICBkID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGEuZGF0YSQuc3Vic3RyKGEucG9zJCwgZCkpCiAgICAgICAgYS5wb3MkID0gdm9pZCAwID09PSBiID8gYyA6IGEucG9zJCArIFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICBhLnBvcyQgPj0gYyAmJiAoYS5wb3MkID0gYykKICAgICAgICByZXR1cm4gZAogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUuJHJlYWRsaW5lID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGlmICgwID09PSBhLmZpbGVubykgewogICAgICAgICAgYSA9IFNrLmZmaS5yZW1hcFRvSnMoYykKICAgICAgICAgIGEgPSBTay5pbnB1dGZ1bihhID8gYSA6ICIiKQogICAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBQcm9taXNlKSB7CiAgICAgICAgICAgIHZhciBkID0gbmV3IFNrLm1pc2NldmFsLlN1c3BlbnNpb24oKQogICAgICAgICAgICBkLnJlc3VtZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmIChkLmRhdGEuZXJyb3IpIHRocm93IGQuZGF0YS5lcnJvcgogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoZC5kYXRhLnJlc3VsdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBkLmRhdGEgPSB7IHR5cGU6ICJTay5wcm9taXNlIiwgcHJvbWlzZTogYSB9CiAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgICAgfQogICAgICAgIGIgPSAiIgogICAgICAgIGEuY3VycmVudExpbmUgPCBhLmxpbmVMaXN0Lmxlbmd0aCAmJgogICAgICAgICAgKChiID0gYS5saW5lTGlzdFthLmN1cnJlbnRMaW5lXSksIGEuY3VycmVudExpbmUrKykKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5yZWFkbGluZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmZpbGUuJHJlYWRsaW5lKGEsIGIsIHZvaWQgMCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5yZWFkbGluZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoMCA9PT0gYS5maWxlbm8pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgInJlYWRsaW5lcyBpbnMndCBpbXBsZW1lbnRlZCBiZWNhdXNlIHRoZSB3ZWIgZG9lc24ndCBzdXBwb3J0IEN0cmwrRCIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBbXQogICAgICAgIGZvciAoYiA9IGEuY3VycmVudExpbmU7IGIgPCBhLmxpbmVMaXN0Lmxlbmd0aDsgYisrKQogICAgICAgICAgYy5wdXNoKG5ldyBTay5idWlsdGluLnN0cihhLmxpbmVMaXN0W2JdKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjKQogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLnNlZWsgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBiID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IDApCiAgICAgICAgMCA9PT0gYwogICAgICAgICAgPyAoYS5wb3MkID0gYikKICAgICAgICAgIDogMSA9PSBjCiAgICAgICAgICA/IChhLnBvcyQgPSBhLmRhdGEkLmxlbmd0aCArIGIpCiAgICAgICAgICA6IDIgPT0gYyAmJiAoYS5wb3MkID0gYS5kYXRhJC5sZW5ndGggKyBiKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS50ZWxsID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIFNrLmZmaS5yZW1hcFRvUHkoYS5wb3MkKQogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLnRydW5jYXRlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS53cml0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhhLm1vZGUpCiAgICAgICAgaWYgKCJ3IiA9PT0gYyB8fCAid2IiID09PSBjIHx8ICJhIiA9PT0gYyB8fCAiYWIiID09PSBjKQogICAgICAgICAgaWYgKFNrLmZpbGV3cml0ZSkgewogICAgICAgICAgICBpZiAoYS5jbG9zZWQpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigiSS9PIG9wZXJhdGlvbiBvbiBjbG9zZWQgZmlsZSIpCiAgICAgICAgICAgIDEgPT09IGEuZmlsZW5vID8gU2sub3V0cHV0KFNrLmZmaS5yZW1hcFRvSnMoYikpIDogU2suZmlsZXdyaXRlKGEsIGIpCiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgMSA9PT0gYS5maWxlbm8gPyBTay5vdXRwdXQoU2suZmZpLnJlbWFwVG9KcyhiKSkgOiBTay5hc3NlcnRzLmZhaWwoKQogICAgICAgIGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSU9FcnJvcigiRmlsZSBub3Qgb3BlbiBmb3Igd3JpdGluZyIpCiAgICAgIH0pCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5maWxlIiwgU2suYnVpbHRpbi5maWxlKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suZmZpID0gU2suZmZpIHx8IHt9CiAgICAgIFNrLmZmaS5yZW1hcFRvUHkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAobnVsbCA9PT0gYSB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEpIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICBpZiAoYS5vYiR0eXBlKSByZXR1cm4gYQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2subWlzY2V2YWwuU3VzcGVuc2lvbikgcmV0dXJuIGEKICAgICAgICBpZiAoIltvYmplY3QgQXJyYXldIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpKSB7CiAgICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7ICsrYikgYy5wdXNoKFNrLmZmaS5yZW1hcFRvUHkoYVtiXSkpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjKQogICAgICAgIH0KICAgICAgICBpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhKSB7CiAgICAgICAgICBjID0gW10KICAgICAgICAgIGZvciAoYiBpbiBhKQogICAgICAgICAgICBjLnB1c2goU2suZmZpLnJlbWFwVG9QeShiKSksIGMucHVzaChTay5mZmkucmVtYXBUb1B5KGFbYl0pKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmRpY3QoYykKICAgICAgICB9CiAgICAgICAgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEpIHJldHVybiBTay5idWlsdGluLmFzc2skKGEpCiAgICAgICAgaWYgKCJib29sZWFuIiA9PT0gdHlwZW9mIGEpIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKGEpCiAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgcmV0dXJuIG5ldyBTay5idWlsdGluLmZ1bmMoYSkKICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCByZW1hcCB0eXBlICIgKyB0eXBlb2YgYSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS5yZW1hcFRvUHkiLCBTay5mZmkucmVtYXBUb1B5KQogICAgICBTay5mZmkucmVtYXBUb0pzID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QpIHsKICAgICAgICAgIHZhciBjID0ge30KICAgICAgICAgIHZhciBkID0gYS50cCRpdGVyKCkKICAgICAgICAgIGZvciAoYiA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZC50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICAgIHZhciBlID0gYS5tcCRzdWJzY3JpcHQoYikKICAgICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gbnVsbCkKICAgICAgICAgICAgYiA9IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICAgICAgY1tiXSA9IFNrLmZmaS5yZW1hcFRvSnMoZSkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5saXN0IHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSB7CiAgICAgICAgICBjID0gW10KICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBhLnYubGVuZ3RoOyArK2UpIGMucHVzaChTay5mZmkucmVtYXBUb0pzKGEudltlXSkpCiAgICAgICAgICByZXR1cm4gYwogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkgcmV0dXJuIGEudiA/ICEwIDogITEKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKAogICAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhIHx8CiAgICAgICAgICAiYm9vbGVhbiIgPT09IHR5cGVvZiBhIHx8CiAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGEKICAgICAgICApCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIGlmICh2b2lkIDAgIT09IGEpIHJldHVybiBhLnYKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS5yZW1hcFRvSnMiLCBTay5mZmkucmVtYXBUb0pzKQogICAgICBTay5mZmkuY2FsbGJhY2sgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYQogICAgICAgICAgPyBhCiAgICAgICAgICA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseSgKICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZmZpLmNhbGxiYWNrIiwgU2suZmZpLmNhbGxiYWNrKQogICAgICBTay5mZmkuc3Rkd3JhcCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBhID0gbmV3IGEoKQogICAgICAgIGEudiA9IGIKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZmZpLnN0ZHdyYXAiLCBTay5mZmkuc3Rkd3JhcCkKICAgICAgU2suZmZpLmJhc2ljd3JhcCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSB8fCAiYm9vbGVhbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gYQogICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuZXhwZWN0ZWQgdHlwZSBmb3IgYmFzaWN3cmFwIikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS5iYXNpY3dyYXAiLCBTay5mZmkuYmFzaWN3cmFwKQogICAgICBTay5mZmkudW53cmFwbyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAodm9pZCAwICE9PSBhKSByZXR1cm4gYS52CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5mZmkudW53cmFwbyIsIFNrLmZmaS51bndyYXBvKQogICAgICBTay5mZmkudW53cmFwbiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PT0gYSA/IG51bGwgOiBhLnYKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS51bndyYXBuIiwgU2suZmZpLnVud3JhcG4pCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLml0ZXJhdG9yID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmdlbmVyYXRvcikgcmV0dXJuIGEKICAgICAgICBpZiAoKGMgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRpdGVyKSkpCiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIFthXSkKICAgICAgICB0aGlzLnNlbnRpbmVsID0gYgogICAgICAgIHRoaXMuZmxhZyA9ICExCiAgICAgICAgdGhpcy5pZHggPSAwCiAgICAgICAgdGhpcy5vYmogPSBhCiAgICAgICAgdm9pZCAwID09PSBiCiAgICAgICAgICA/ICgodGhpcy5nZXRpdGVtID0gU2suYWJzdHIubG9va3VwU3BlY2lhbCgKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtLAogICAgICAgICAgICApKSwKICAgICAgICAgICAgKHRoaXMuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8aXRlcmF0b3Igb2JqZWN0PiIpCiAgICAgICAgICAgIH0pKQogICAgICAgICAgOiAoKHRoaXMuY2FsbCA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGNhbGwpKSwKICAgICAgICAgICAgKHRoaXMuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8Y2FsbGFibGUtaXRlcmF0b3Igb2JqZWN0PiIpCiAgICAgICAgICAgIH0pKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiaXRlcmF0b3IiLAogICAgICAgIFNrLmJ1aWx0aW4uaXRlcmF0b3IsCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5pdGVyYXRvci5wcm90b3R5cGUuX19jbGFzc19fID0gU2suYnVpbHRpbi5pdGVyYXRvcgogICAgICBTay5idWlsdGluLml0ZXJhdG9yLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXIoKQogICAgICB9KQogICAgICBTay5idWlsdGluLml0ZXJhdG9yLnByb3RvdHlwZS50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLml0ZXJhdG9yLnByb3RvdHlwZS50cCRpdGVybmV4dCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMKICAgICAgICBpZiAoITAgIT09IHRoaXMuZmxhZykgewogICAgICAgICAgaWYgKHRoaXMuZ2V0aXRlbSkgewogICAgICAgICAgICB2YXIgYyA9IFNrLm1pc2NldmFsLnRyeUNhdGNoKAogICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheShiLmdldGl0ZW0sIFsKICAgICAgICAgICAgICAgICAgYi5vYmosCiAgICAgICAgICAgICAgICAgIFNrLmZmaS5yZW1hcFRvUHkoYi5pZHgrKyksCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAhKAogICAgICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLlN0b3BJdGVyYXRpb24gfHwKICAgICAgICAgICAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5JbmRleEVycm9yCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgdGhyb3cgYQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGEgPyBjIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGMpCiAgICAgICAgICB9CiAgICAgICAgICBjID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICBpZiAoU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGEsIGIuc2VudGluZWwsICJFcSIpKSBiLmZsYWcgPSAhMAogICAgICAgICAgICBlbHNlIHJldHVybiBhCiAgICAgICAgICB9CiAgICAgICAgICBjID0gdGhpcy5jYWxsCiAgICAgICAgICAgID8gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkodGhpcy5jYWxsLCBbdGhpcy5vYmpdKSwKICAgICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICA6IFNrLm1pc2NldmFsLmNoYWluKFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSh0aGlzLm9iaiksIGMpCiAgICAgICAgICByZXR1cm4gYSA/IGMgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYykKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pdGVyYXRvci5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IGEudHAkaXRlcm5leHQoKQogICAgICAgIGlmICghYSkgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbigpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uaXRlcmF0b3IiLCBTay5idWlsdGluLml0ZXJhdG9yKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5lbnVtZXJhdGUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZW51bWVyYXRlKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5lbnVtZXJhdGUoYSwgYikKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJlbnVtZXJhdGUiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChiKSkgYiA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYikKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSArCiAgICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICAgKQogICAgICAgIGVsc2UgYiA9IDAKICAgICAgICB2YXIgYyA9IGEudHAkaXRlcigpCiAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICB0aGlzLiRpbmRleCA9IGIKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgYSA9IGMudHAkaXRlcm5leHQoKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYSkgewogICAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmludF8odGhpcy4kaW5kZXgrKykKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFtiLCBhXSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5fX2NsYXNzX18gPSBTay5idWlsdGluLmVudW1lcmF0ZQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiZW51bWVyYXRlIiwKICAgICAgICBTay5idWlsdGluLmVudW1lcmF0ZSwKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uKAogICAgICAgIGEsCiAgICAgICkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXIoKQogICAgICB9KQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcm5leHQoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLmNvX3Zhcm5hbWVzID0gWyJpdGVyYWJsZSIsICJzdGFydCJdCiAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLmNvX2FyZ2NvdW50ID0gMgogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS4kZGVmYXVsdHMgPSBbU2suYnVpbHRpbi5ub25lLm5vbmUkLCAwXQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5jb19uYW1lID0gU2suYnVpbHRpbi5zdHIoImVudW1lcmF0ZSIpCiAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIjxlbnVtZXJhdGUgb2JqZWN0PiIpCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYywgZAogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImZpbHRlcl8iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLmZpbHRlcl8pKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZpbHRlcl8oYSwgYikKICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYikKICAgICAgICB2YXIgZiA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgIGMgPSBhID09PSBTay5idWlsdGluLm5vbmUubm9uZSQgPyBiIDogU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEsIFtiXSkKICAgICAgICAgIGlmIChTay5taXNjZXZhbC5pc1RydWUoYykpIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIHRoaXMudHAkaXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZCA9IGUudHAkaXRlcm5leHQoKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCkgewogICAgICAgICAgICBmb3IgKGMgPSBmKGQpOyB2b2lkIDAgPT09IGM7ICkgewogICAgICAgICAgICAgIGQgPSBlLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBkKSByZXR1cm4KICAgICAgICAgICAgICBjID0gZihkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5maWx0ZXJfCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJmaWx0ZXIiLCBTay5idWlsdGluLmZpbHRlcl8sIFNrLmJ1aWx0aW4ub2JqZWN0KQogICAgICBTay5idWlsdGluLmZpbHRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcigpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXy5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcm5leHQoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXy5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8ZmlsdGVyIG9iamVjdD4iKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5maWx0ZXJfIiwgU2suYnVpbHRpbi5maWx0ZXJfKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi56aXBfID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEsIGIKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi56aXBfKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi56aXBfKC4uLmFyZ3VtZW50cykKICAgICAgICBpZiAoMCA9PT0gYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi56aXBfKG5ldyBTay5idWlsdGluLmxpc3QoW10pKQogICAgICAgIHZhciBjID0gW10KICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYXJndW1lbnRzLmxlbmd0aDsgYSsrKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYy5wdXNoKFNrLmFic3RyLml0ZXIoYXJndW1lbnRzW2FdKSkKICAgICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgaWYgKGQgaW5zdGFuY2VvZiBTay5idWlsdGluLlR5cGVFcnJvcikKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiemlwIGFyZ3VtZW50ICMiICsgKGEgKyAxKSArICIgbXVzdCBzdXBwb3J0IGl0ZXJhdGlvbiIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB0aHJvdyBkCiAgICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYy5sZW5ndGg7IGErKykgewogICAgICAgICAgICBiID0gY1thXS50cCRpdGVybmV4dCgpCiAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIpIHJldHVybgogICAgICAgICAgICBkLnB1c2goYikKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShkKQogICAgICAgIH0KICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uemlwXwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgiemlwIiwgU2suYnVpbHRpbi56aXBfLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi56aXBfLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXIoKQogICAgICB9KQogICAgICBTay5idWlsdGluLnppcF8ucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXJuZXh0KCkKICAgICAgfQogICAgICBTay5idWlsdGluLnppcF8ucHJvdG90eXBlLiRyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPHppcCBvYmplY3Q+IikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uemlwXyIsIFNrLmJ1aWx0aW4uemlwXykKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ubWFwXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYywgZCwgZSwgZgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm1hcF8iLCBhcmd1bWVudHMubGVuZ3RoLCAyKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLm1hcF8pKSB7CiAgICAgICAgICB2YXIgZyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpLnNsaWNlKDEpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubWFwXyhhLCAuLi5nKQogICAgICAgIH0KICAgICAgICBpZiAoMiA8IGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICAgIHZhciBoID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGFyZ3VtZW50cykuc2xpY2UoMSkKICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBoLmxlbmd0aDsgZCsrKSBoW2RdID0gU2suYWJzdHIuaXRlcihoW2RdKQogICAgICAgICAgdmFyIGsgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZiA9IFtdCiAgICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBoLmxlbmd0aDsgZCsrKSB7CiAgICAgICAgICAgICAgYyA9IGhbZF0udHAkaXRlcm5leHQoKQogICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGMpIHJldHVybgogICAgICAgICAgICAgIGYucHVzaChjKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAoYiA9IFNrLmFic3RyLml0ZXIoYikpLAogICAgICAgICAgICAoayA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBiLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICAgfSkKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBlID0gaygpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBlKSB7CiAgICAgICAgICAgIGlmIChhID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBBcnJheSAmJiAoZSA9IG5ldyBTay5idWlsdGluLnR1cGxlKGUpKSwgZQogICAgICAgICAgICBlIGluc3RhbmNlb2YgQXJyYXkgfHwgKGUgPSBbZV0pCiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBlKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnRwJGl0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgfQogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5tYXBfCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJtYXAiLCBTay5idWlsdGluLm1hcF8sIFNrLmJ1aWx0aW4ub2JqZWN0KQogICAgICBTay5idWlsdGluLm1hcF8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcigpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubWFwXy5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcm5leHQoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWFwXy5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8bWFwIG9iamVjdD4iKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5tYXBfIiwgU2suYnVpbHRpbi5tYXBfKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgdmFyIGEgPSB7CiAgICAgICAgVF9FTkRNQVJLRVI6IDAsCiAgICAgICAgVF9OQU1FOiAxLAogICAgICAgIFRfTlVNQkVSOiAyLAogICAgICAgIFRfU1RSSU5HOiAzLAogICAgICAgIFRfTkVXTElORTogNCwKICAgICAgICBUX0lOREVOVDogNSwKICAgICAgICBUX0RFREVOVDogNiwKICAgICAgICBUX0xQQVI6IDcsCiAgICAgICAgVF9SUEFSOiA4LAogICAgICAgIFRfTFNRQjogOSwKICAgICAgICBUX1JTUUI6IDEwLAogICAgICAgIFRfQ09MT046IDExLAogICAgICAgIFRfQ09NTUE6IDEyLAogICAgICAgIFRfU0VNSTogMTMsCiAgICAgICAgVF9QTFVTOiAxNCwKICAgICAgICBUX01JTlVTOiAxNSwKICAgICAgICBUX1NUQVI6IDE2LAogICAgICAgIFRfU0xBU0g6IDE3LAogICAgICAgIFRfVkJBUjogMTgsCiAgICAgICAgVF9BTVBFUjogMTksCiAgICAgICAgVF9MRVNTOiAyMCwKICAgICAgICBUX0dSRUFURVI6IDIxLAogICAgICAgIFRfRVFVQUw6IDIyLAogICAgICAgIFRfRE9UOiAyMywKICAgICAgICBUX1BFUkNFTlQ6IDI0LAogICAgICAgIFRfTEJSQUNFOiAyNSwKICAgICAgICBUX1JCUkFDRTogMjYsCiAgICAgICAgVF9FUUVRVUFMOiAyNywKICAgICAgICBUX05PVEVRVUFMOiAyOCwKICAgICAgICBUX0xFU1NFUVVBTDogMjksCiAgICAgICAgVF9HUkVBVEVSRVFVQUw6IDMwLAogICAgICAgIFRfVElMREU6IDMxLAogICAgICAgIFRfQ0lSQ1VNRkxFWDogMzIsCiAgICAgICAgVF9MRUZUU0hJRlQ6IDMzLAogICAgICAgIFRfUklHSFRTSElGVDogMzQsCiAgICAgICAgVF9ET1VCTEVTVEFSOiAzNSwKICAgICAgICBUX1BMVVNFUVVBTDogMzYsCiAgICAgICAgVF9NSU5FUVVBTDogMzcsCiAgICAgICAgVF9TVEFSRVFVQUw6IDM4LAogICAgICAgIFRfU0xBU0hFUVVBTDogMzksCiAgICAgICAgVF9QRVJDRU5URVFVQUw6IDQwLAogICAgICAgIFRfQU1QRVJFUVVBTDogNDEsCiAgICAgICAgVF9WQkFSRVFVQUw6IDQyLAogICAgICAgIFRfQ0lSQ1VNRkxFWEVRVUFMOiA0MywKICAgICAgICBUX0xFRlRTSElGVEVRVUFMOiA0NCwKICAgICAgICBUX1JJR0hUU0hJRlRFUVVBTDogNDUsCiAgICAgICAgVF9ET1VCTEVTVEFSRVFVQUw6IDQ2LAogICAgICAgIFRfRE9VQkxFU0xBU0g6IDQ3LAogICAgICAgIFRfRE9VQkxFU0xBU0hFUVVBTDogNDgsCiAgICAgICAgVF9BVDogNDksCiAgICAgICAgVF9BVEVRVUFMOiA1MCwKICAgICAgICBUX1JBUlJPVzogNTEsCiAgICAgICAgVF9FTExJUFNJUzogNTIsCiAgICAgICAgVF9PUDogNTMsCiAgICAgICAgVF9BV0FJVDogNTQsCiAgICAgICAgVF9BU1lOQzogNTUsCiAgICAgICAgVF9FUlJPUlRPS0VOOiA1NiwKICAgICAgICBUX05UX09GRlNFVDogMjU2LAogICAgICAgIFRfTl9UT0tFTlM6IDYwLAogICAgICAgIFRfQ09NTUVOVDogNTcsCiAgICAgICAgVF9OTDogNTgsCiAgICAgICAgVF9FTkNPRElORzogNTksCiAgICAgIH0KICAgICAgbSA9IHsKICAgICAgICAiIT0iOiBhLk5PVEVRVUFMLAogICAgICAgICIlIjogYS5QRVJDRU5ULAogICAgICAgICIlPSI6IGEuUEVSQ0VOVEVRVUFMLAogICAgICAgICImIjogYS5BTVBFUiwKICAgICAgICAiJj0iOiBhLkFNUEVSRVFVQUwsCiAgICAgICAgIigiOiBhLkxQQVIsCiAgICAgICAgIikiOiBhLlJQQVIsCiAgICAgICAgIioiOiBhLlNUQVIsCiAgICAgICAgIioqIjogYS5ET1VCTEVTVEFSLAogICAgICAgICIqKj0iOiBhLkRPVUJMRVNUQVJFUVVBTCwKICAgICAgICAiKj0iOiBhLlNUQVJFUVVBTCwKICAgICAgICAiKyI6IGEuUExVUywKICAgICAgICAiKz0iOiBhLlBMVVNFUVVBTCwKICAgICAgICAiLCI6IGEuQ09NTUEsCiAgICAgICAgIi0iOiBhLk1JTlVTLAogICAgICAgICItPSI6IGEuTUlORVFVQUwsCiAgICAgICAgIi0+IjogYS5SQVJST1csCiAgICAgICAgIi4iOiBhLkRPVCwKICAgICAgICAiLi4uIjogYS5FTExJUFNJUywKICAgICAgICAiLyI6IGEuU0xBU0gsCiAgICAgICAgIi8vIjogYS5ET1VCTEVTTEFTSCwKICAgICAgICAiLy89IjogYS5ET1VCTEVTTEFTSEVRVUFMLAogICAgICAgICIvPSI6IGEuU0xBU0hFUVVBTCwKICAgICAgICAiOiI6IGEuQ09MT04sCiAgICAgICAgIjo9IjogYS5DT0xPTkVRVUFMLAogICAgICAgICI7IjogYS5TRU1JLAogICAgICAgICI8IjogYS5MRVNTLAogICAgICAgICI8PCI6IGEuTEVGVFNISUZULAogICAgICAgICI8PD0iOiBhLkxFRlRTSElGVEVRVUFMLAogICAgICAgICI8PSI6IGEuTEVTU0VRVUFMLAogICAgICAgICI9IjogYS5FUVVBTCwKICAgICAgICAiPT0iOiBhLkVRRVFVQUwsCiAgICAgICAgIj4iOiBhLkdSRUFURVIsCiAgICAgICAgIj49IjogYS5HUkVBVEVSRVFVQUwsCiAgICAgICAgIj4+IjogYS5SSUdIVFNISUZULAogICAgICAgICI+Pj0iOiBhLlJJR0hUU0hJRlRFUVVBTCwKICAgICAgICAiQCI6IGEuQVQsCiAgICAgICAgIkA9IjogYS5BVEVRVUFMLAogICAgICAgICJbIjogYS5MU1FCLAogICAgICAgICJdIjogYS5SU1FCLAogICAgICAgICJeIjogYS5DSVJDVU1GTEVYLAogICAgICAgICJePSI6IGEuQ0lSQ1VNRkxFWEVRVUFMLAogICAgICAgICJ7IjogYS5MQlJBQ0UsCiAgICAgICAgInwiOiBhLlZCQVIsCiAgICAgICAgInw9IjogYS5WQkFSRVFVQUwsCiAgICAgICAgIn0iOiBhLlJCUkFDRSwKICAgICAgICAifiI6IGEuVElMREUsCiAgICAgIH0KICAgICAgdmFyIGIgPSB7fQogICAgICA7KGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIGMgaW4gYSkgYlthW2NdXSA9IGMKICAgICAgfSkoKQogICAgICA7WyJ0b2tfbmFtZSIsICJJU1RFUk1JTkFMIiwgIklTTk9OVEVSTUlOQUwiLCAiSVNFT0YiXS5jb25jYXQoCiAgICAgICAgT2JqZWN0LmtleXMoYikubWFwKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBiW2FdCiAgICAgICAgfSksCiAgICAgICkKICAgICAgU2sudG9rZW4gPSB7fQogICAgICBTay50b2tlbi50b2tlbnMgPSBhCiAgICAgIFNrLnRva2VuLnRva19uYW1lID0gYgogICAgICBTay50b2tlbi5FWEFDVF9UT0tFTl9UWVBFUyA9IG0KICAgICAgU2sudG9rZW4uSVNURVJNSU5BTCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICByZXR1cm4gYiA8IGEuVF9OVF9PRkZTRVQKICAgICAgfQogICAgICBTay50b2tlbi5JU05PTlRFUk1JTkFMID0gZnVuY3Rpb24oYikgewogICAgICAgIHJldHVybiBiID49IGEuVF9OVF9PRkZTRVQKICAgICAgfQogICAgICBTay50b2tlbi5JU0VPRiA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICByZXR1cm4gYiA9PSBhLlRfRU5ETUFSS0VSCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay50b2tlbiIsIFNrLnRva2VuKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuLnRva2VucyIsIFNrLnRva2VuLnRva2VucykKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay50b2tlbi50b2tfbmFtZSIsIFNrLnRva2VuLnRva19uYW1lKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuLkVYQUNUX1RPS0VOX1RZUEVTIikKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay50b2tlbi5JU1RFUk1JTkFMIiwgU2sudG9rZW4uSVNURVJNSU5BTCkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay50b2tlbi5JU05PTlRFUk1JTkFMIiwgU2sudG9rZW4uSVNOT05URVJNSU5BTCkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay50b2tlbi5JU0VPRiIsIFNrLnRva2VuLklTRU9GKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgZnVuY3Rpb24gYShhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdGhpcy50eXBlID0gYQogICAgICAgIHRoaXMuc3RyaW5nID0gYgogICAgICAgIHRoaXMuc3RhcnQgPSBjCiAgICAgICAgdGhpcy5lbmQgPSBkCiAgICAgICAgdGhpcy5saW5lID0gZQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGIoYSkgewogICAgICAgIHJldHVybiAiKCIgKyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLmpvaW4oInwiKSArICIpIgogICAgICB9CiAgICAgIGZ1bmN0aW9uIGMoYSkgewogICAgICAgIHJldHVybiBiLmFwcGx5KG51bGwsIGFyZ3VtZW50cykgKyAiPyIKICAgICAgfQogICAgICBmdW5jdGlvbiBkKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBjID0gYS5sZW5ndGg7IGMtLTsgKSBpZiAoYVtjXSA9PT0gYikgcmV0dXJuICEwCiAgICAgICAgcmV0dXJuICExCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICByZXR1cm4gIiBGUiBSRiBCciBCUiBGciByIEIgUiBiIGJSIGYgcmIgckIgRiBSZiBVIHJGIHUgUkIgYnIgZlIgZnIgcmYgUmIiLnNwbGl0KAogICAgICAgICAgIiAiLAogICAgICAgICkKICAgICAgfQogICAgICB2YXIgZiA9IFNrLnRva2VuLnRva2VucwogICAgICBjb25zdCBnID0gU2suYnVpbHRpbi5TeW50YXhFcnJvciwKICAgICAgICBoID0gU2suYnVpbHRpbi5TeW50YXhFcnJvcgogICAgICBhLnByb3RvdHlwZS5leGFjdF90eXBlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PSBmLlRfT1AgJiYgdGhpcy5zdHJpbmcgaW4gU2sudG9rZW4uRVhBQ1RfVE9LRU5fVFlQRVMKICAgICAgICAgID8gU2sudG9rZW4uRVhBQ1RfVE9LRU5fVFlQRVNbdGhpcy5zdHJpbmddCiAgICAgICAgICA6IHRoaXMudHlwZQogICAgICB9CiAgICAgIHZhciBrID0gL1tcXF4kLiorPygpW1xde318XS9nLAogICAgICAgIGwgPSBSZWdFeHAoay5zb3VyY2UpCiAgICAgIGNvbnN0IHIgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSBiKAogICAgICAgICAgICAiW0EtWl0iLAogICAgICAgICAgICAiW2Etel0iLAogICAgICAgICAgICAiW1xcdXsxMEI5OX0tXFx1ezEwQjlDfVxcdXsxMTJBOX1cXHV7MTE1REN9LVxcdXsxMTVERH1cXHUwMzRGXFx1MTE1Ri1cXHUxMTYwXFx1MTdCNC1cXHUxN0I1XFx1MjA2NVxcdTMxNjRcXHVGRkEwXFx1RkZGMC1cXHVGRkY4XFx1e0UwMDAwfVxcdXtFMDAwMn0tXFx1e0UwMDFGfVxcdXtFMDA4MH0tXFx1e0UwMEZGfVxcdXtFMDFGMH0tXFx1e0UwRkZGfVxcdXsxMTJBOX1cXHUwMEQ3XSIsCiAgICAgICAgICAgICJbXFx1MDJCMC1cXHUwMkMxXFx1MDJDNi1cXHUwMkQxXFx1MDJFMC1cXHUwMkU0XFx1MDJFQ1xcdTAyRUVcXHUwMzc0XFx1MDM3QVxcdTA1NTlcXHUwNkU1LVxcdTA2RTZcXHUwN0Y0LVxcdTA3RjVcXHUwOTcxXFx1MUM3OC1cXHUxQzdEXFx1MUQyQy1cXHUxRDZBXFx1MURGRC1cXHUxREZGXFx1MkUyRlxcdTMwRkNcXHVBNjdGXFx1QTY5Qy1cXHVBNjlEXFx1QTcxNy1cXHVBNzFGXFx1QTc4OFxcdUE3RjgtXFx1QTdGOVxcdUFCNUMtXFx1QUI1RlxcdUZGNzBcXHVGRjlFLVxcdUZGOUZcXHV7MTZGOTN9LVxcdXsxNkY5Rn1cXHUwMkQwLVxcdTAyRDFcXHUwNjQwXFx1MDdGQVxcdTBFNDZcXHUwRUM2XFx1MTg0M1xcdTFBQTdcXHUxQzdCXFx1MzAwNVxcdTMwMzEtXFx1MzAzNVxcdTMwOUQtXFx1MzA5RVxcdTMwRkMtXFx1MzBGRVxcdUEwMTVcXHVBNjBDXFx1QTlDRlxcdUE5RTZcXHVBQTcwXFx1QUFERFxcdUFBRjMtXFx1QUFGNFxcdUZGNzBcXHV7MTZCNDJ9LVxcdXsxNkI0M31cXHV7MTZGRTB9LVxcdXsxNkZFMX1cXHUwMkIwLVxcdTAyQjhcXHUwMkMwLVxcdTAyQzFcXHUwMkUwLVxcdTAyRTRcXHUwMzdBXFx1MUQyQy1cXHUxRDZBXFx1MUQ3OFxcdTFEOUItXFx1MURCRlxcdTIwNzFcXHUyMDdGXFx1MjA5MC1cXHUyMDlDXFx1MkM3Qy1cXHUyQzdEXFx1QTY5Qy1cXHVBNjlEXFx1QTc3MFxcdUE3RjgtXFx1QTdGOVxcdUFCNUMtXFx1QUI1RlxcdUZGOUUtXFx1RkY5RlxcdTAyQjJcXHUxRDYyXFx1MURBNFxcdTFEQThcXHUyMDcxXFx1MkM3Q1xcdTJFMTgtXFx1MkUxOVxcdTJFMkZdIiwKICAgICAgICAgICAgIltcXHUyMTM1LVxcdTIxMzhcXHV7MUVFMDB9LVxcdXsxRUUwM31cXHV7MUVFMDV9LVxcdXsxRUUxRn1cXHV7MUVFMjF9LVxcdXsxRUUyMn1cXHV7MUVFMjR9XFx1ezFFRTI3fVxcdXsxRUUyOX0tXFx1ezFFRTMyfVxcdXsxRUUzNH0tXFx1ezFFRTM3fVxcdXsxRUUzOX1cXHV7MUVFM0J9XFx1ezFFRTQyfVxcdXsxRUU0N31cXHV7MUVFNDl9XFx1ezFFRTRCfVxcdXsxRUU0RH0tXFx1ezFFRTRGfVxcdXsxRUU1MX0tXFx1ezFFRTUyfVxcdXsxRUU1NH1cXHV7MUVFNTd9XFx1ezFFRTU5fVxcdXsxRUU1Qn1cXHV7MUVFNUR9XFx1ezFFRTVGfVxcdXsxRUU2MX0tXFx1ezFFRTYyfVxcdXsxRUU2NH1cXHV7MUVFNjd9LVxcdXsxRUU2QX1cXHV7MUVFNkN9LVxcdXsxRUU3Mn1cXHV7MUVFNzR9LVxcdXsxRUU3N31cXHV7MUVFNzl9LVxcdXsxRUU3Q31cXHV7MUVFN0V9XFx1ezFFRTgwfS1cXHV7MUVFODl9XFx1ezFFRThCfS1cXHV7MUVFOUJ9XFx1ezFFRUExfS1cXHV7MUVFQTN9XFx1ezFFRUE1fS1cXHV7MUVFQTl9XFx1ezFFRUFCfS1cXHV7MUVFQkJ9XFx1MzAwNlxcdTM0MDAtXFx1NERCNVxcdTRFMDAtXFx1OUZFRlxcdUY5MDAtXFx1RkE2RFxcdUZBNzAtXFx1RkFEOVxcdXsxNzAwMH0tXFx1ezE4N0YxfVxcdXsxODgwMH0tXFx1ezE4QUYyfVxcdXsxQjE3MH0tXFx1ezFCMkZCfVxcdXsyMDAwMH0tXFx1ezJBNkQ2fVxcdXsyQTcwMH0tXFx1ezJCNzM0fVxcdXsyQjc0MH0tXFx1ezJCODFEfVxcdXsyQjgyMH0tXFx1ezJDRUExfVxcdXsyQ0VCMH0tXFx1ezJFQkUwfVxcdXsyRjgwMH0tXFx1ezJGQTFEfVxcdUFBQzBcXHVBQUMyXFx1RkUyMC1cXHVGRTJGXFx1ezEwRDIyfS1cXHV7MTBEMjN9XFx1ezExMzVEfVxcdTAwQUFcXHUwMEJBXFx1MzQwMC1cXHU0REI1XFx1NEUwMC1cXHU5RkVGXFx1RkEwRS1cXHVGQTBGXFx1RkExMVxcdUZBMTMtXFx1RkExNFxcdUZBMUZcXHVGQTIxXFx1RkEyMy1cXHVGQTI0XFx1RkEyNy1cXHVGQTI5XFx1ezIwMDAwfS1cXHV7MkE2RDZ9XFx1ezJBNzAwfS1cXHV7MkI3MzR9XFx1ezJCNzQwfS1cXHV7MkI4MUR9XFx1ezJCODIwfS1cXHV7MkNFQTF9XFx1ezJDRUIwfS1cXHV7MkVCRTB9XFx1MTE1Ri1cXHUxMTYwXFx1MzE2NFxcdUZGQTBcXHUwNjczXFx1MTdBMy1cXHUxN0E0XFx1MEU0MC1cXHUwRTQ0XFx1MEVDMC1cXHUwRUM0XFx1MTlCNS1cXHUxOUI3XFx1MTlCQVxcdUFBQjUtXFx1QUFCNlxcdUFBQjlcXHVBQUJCLVxcdUFBQkNdIiwKICAgICAgICAgICAgIltcXHUzMDA3XFx1MzAyMS1cXHUzMDI5XFx1MzAzOC1cXHUzMDNBXFx1MjE3MC1cXHUyMTdGXFx1MjE2MC1cXHUyMTZGXSIsCiAgICAgICAgICAgICJfIiwKICAgICAgICAgICAgIltcXHUxODg1LVxcdTE4ODZcXHUyMTE4XFx1MjEyRVxcdTMwOUItXFx1MzA5Q10iLAogICAgICAgICAgKSwKICAgICAgICAgIGMgPSBiKAogICAgICAgICAgICBhLAogICAgICAgICAgICAiW1xcdTEwNEEtXFx1MTA0QlxcdTEwMkItXFx1MTAyQ1xcdTEwMkQtXFx1MTAzMFxcdTEwMzFcXHUxMDMyLVxcdTEwMzZcXHUxMDM4XFx1MTAzQi1cXHUxMDNDXFx1MTAzRC1cXHUxMDNFXFx1MTA1Ni1cXHUxMDU3XFx1MTA1OC1cXHUxMDU5XFx1MTA1RS1cXHUxMDYwXFx1MTA2MlxcdTEwNjctXFx1MTA2OFxcdTEwNzEtXFx1MTA3NFxcdTEwODJcXHUxMDgzLVxcdTEwODRcXHUxMDg1LVxcdTEwODZcXHUxMDlDXFx1MTA5RFxcdTEwMzdcXHUxMDM5LVxcdTEwM0FcXHUxMDg3LVxcdTEwOENcXHUxMDhEXFx1MTA4RlxcdTEwOUEtXFx1MTA5QlxcdUE5RTVcXHVBQTdCXFx1QUE3Q1xcdUFBN0RcXHVBOUU2XFx1QUE3MFxcdTEwNEEtXFx1MTA0Ql0iLAogICAgICAgICAgICAiW1xcdTA5MDNcXHUwOTNCXFx1MDkzRS1cXHUwOTQwXFx1MDk0OS1cXHUwOTRDXFx1MDk0RS1cXHUwOTRGXFx1MDk4Mi1cXHUwOTgzXFx1MDlCRS1cXHUwOUMwXFx1MDlDNy1cXHUwOUM4XFx1MDlDQi1cXHUwOUNDXFx1MDlEN1xcdTBBMDNcXHUwQTNFLVxcdTBBNDBcXHUwQTgzXFx1MEFCRS1cXHUwQUMwXFx1MEFDOVxcdTBBQ0ItXFx1MEFDQ1xcdTBCMDItXFx1MEIwM1xcdTBCM0VcXHUwQjQwXFx1MEI0Ny1cXHUwQjQ4XFx1MEI0Qi1cXHUwQjRDXFx1MEI1N1xcdTBCQkUtXFx1MEJCRlxcdTBCQzEtXFx1MEJDMlxcdTBCQzYtXFx1MEJDOFxcdTBCQ0EtXFx1MEJDQ1xcdTBCRDdcXHUwQzAxLVxcdTBDMDNcXHUwQzQxLVxcdTBDNDRcXHUwQzgyLVxcdTBDODNcXHUwQ0JFXFx1MENDMC1cXHUwQ0M0XFx1MENDNy1cXHUwQ0M4XFx1MENDQS1cXHUwQ0NCXFx1MENENS1cXHUwQ0Q2XFx1MEQwMi1cXHUwRDAzXFx1MEQzRS1cXHUwRDQwXFx1MEQ0Ni1cXHUwRDQ4XFx1MEQ0QS1cXHUwRDRDXFx1MEQ1N1xcdTBEODItXFx1MEQ4M1xcdTBEQ0YtXFx1MEREMVxcdTBERDgtXFx1MERERlxcdTBERjItXFx1MERGM1xcdTBGN0ZcXHUxMDJCLVxcdTEwMkNcXHUxMDMxXFx1MTAzOFxcdTEwM0ItXFx1MTAzQ1xcdTEwNTYtXFx1MTA1N1xcdTEwNjJcXHUxMDY3LVxcdTEwNjhcXHUxMDgzLVxcdTEwODRcXHUxMDlDXFx1MTdCNlxcdTE3QkUtXFx1MTdDNVxcdTE3QzctXFx1MTdDOFxcdTE5MjMtXFx1MTkyNlxcdTE5MjktXFx1MTkyQlxcdTE5MzAtXFx1MTkzMVxcdTE5MzMtXFx1MTkzOFxcdTFBMTktXFx1MUExQVxcdTFBNTVcXHUxQTU3XFx1MUE2MVxcdTFBNjMtXFx1MUE2NFxcdTFBNkQtXFx1MUE3MlxcdTFCMDRcXHUxQjM1XFx1MUIzQlxcdTFCM0QtXFx1MUI0MVxcdTFCNDNcXHUxQjgyXFx1MUJBMVxcdTFCQTYtXFx1MUJBN1xcdTFCRTdcXHUxQkVBLVxcdTFCRUNcXHUxQkVFXFx1MUMyNC1cXHUxQzJCXFx1MUMzNC1cXHUxQzM1XFx1MUNGMi1cXHUxQ0YzXFx1QTgyMy1cXHVBODI0XFx1QTgyN1xcdUE4ODAtXFx1QTg4MVxcdUE4QjQtXFx1QThDM1xcdUE5NTJcXHVBOTgzXFx1QTlCNC1cXHVBOUI1XFx1QTlCQS1cXHVBOUJCXFx1QTlCRC1cXHVBOUJGXFx1QUEyRi1cXHVBQTMwXFx1QUEzMy1cXHVBQTM0XFx1QUE0RFxcdUFBRUJcXHVBQUVFLVxcdUFBRUZcXHVBQUY1XFx1QUJFMy1cXHVBQkU0XFx1QUJFNi1cXHVBQkU3XFx1QUJFOS1cXHVBQkVBXFx1ezExMDAwfVxcdXsxMTAwMn1cXHV7MTEwODJ9XFx1ezExMEIwfS1cXHV7MTEwQjJ9XFx1ezExMEI3fS1cXHV7MTEwQjh9XFx1ezExMTJDfVxcdXsxMTE0NX0tXFx1ezExMTQ2fVxcdXsxMTE4Mn1cXHV7MTExQjN9LVxcdXsxMTFCNX1cXHV7MTExQkZ9XFx1ezExMjJDfS1cXHV7MTEyMkV9XFx1ezExMjMyfS1cXHV7MTEyMzN9XFx1ezExMkUwfS1cXHV7MTEyRTJ9XFx1ezExMzAyfS1cXHV7MTEzMDN9XFx1ezExMzNFfS1cXHV7MTEzM0Z9XFx1ezExMzQxfS1cXHV7MTEzNDR9XFx1ezExMzQ3fS1cXHV7MTEzNDh9XFx1ezExMzRCfS1cXHV7MTEzNEN9XFx1ezExMzU3fVxcdXsxMTM2Mn0tXFx1ezExMzYzfVxcdXsxMTQzNX0tXFx1ezExNDM3fVxcdXsxMTQ0MH0tXFx1ezExNDQxfVxcdXsxMTQ0NX1cXHV7MTE0QjB9LVxcdXsxMTRCMn1cXHV7MTE0Qjl9XFx1ezExNEJCfS1cXHV7MTE0QkV9XFx1ezExNEMxfVxcdXsxMTVBRn0tXFx1ezExNUIxfVxcdXsxMTVCOH0tXFx1ezExNUJCfVxcdXsxMTVCRX1cXHV7MTE2MzB9LVxcdXsxMTYzMn1cXHV7MTE2M0J9LVxcdXsxMTYzQ31cXHV7MTE2M0V9XFx1ezExNkFDfVxcdXsxMTZBRX0tXFx1ezExNkFGfVxcdXsxMTcyMH0tXFx1ezExNzIxfVxcdXsxMTcyNn1cXHV7MTE4MkN9LVxcdXsxMTgyRX1cXHV7MTE4Mzh9XFx1ezExQTM5fVxcdXsxMUE1N30tXFx1ezExQTU4fVxcdXsxMUE5N31cXHV7MTFDMkZ9XFx1ezExQzNFfVxcdXsxMUNBOX1cXHV7MTFDQjF9XFx1ezExQ0I0fVxcdXsxMUQ4QX0tXFx1ezExRDhFfVxcdXsxMUQ5M30tXFx1ezExRDk0fVxcdXsxMUQ5Nn1cXHV7MTFFRjV9LVxcdXsxMUVGNn1cXHV7MTZGNTF9LVxcdXsxNkY3RX1cXHUwRjNFLVxcdTBGM0ZcXHUxMDg3LVxcdTEwOENcXHUxMDhGXFx1MTA5QS1cXHUxMDlCXFx1MUI0NFxcdTFCQUFcXHUxQ0UxXFx1MUNGN1xcdTMwMkUtXFx1MzAyRlxcdUE5NTNcXHVBOUMwXFx1QUE3QlxcdUFBN0RcXHVBQkVDXFx1ezExMUMwfVxcdXsxMTIzNX1cXHV7MTEzNER9XFx1ezExNkI2fVxcdXsxRDE2RH0tXFx1ezFEMTcyfVxcdTA5QkVcXHUwOUQ3XFx1MEIzRVxcdTBCNTdcXHUwQkJFXFx1MEJEN1xcdTBDQzJcXHUwQ0Q1LVxcdTBDRDZcXHUwRDNFXFx1MEQ1N1xcdTBEQ0ZcXHUwRERGXFx1MzAyRS1cXHUzMDJGXFx1ezExMzNFfVxcdXsxMTM1N31cXHV7MTE0QjB9XFx1ezExNEJEfVxcdXsxMTVBRn1cXHV7MUQxNjV9XFx1ezFEMTZFfS1cXHV7MUQxNzJ9XSIsCiAgICAgICAgICAgICJbXFx1ezFEN0NFfS1cXHV7MUQ3RkZ9XFx1RkYxMC1cXHVGRjE5XSIsCiAgICAgICAgICAgICJcXHUyMDQwIiwKICAgICAgICAgICAgIltcXHUwMEI3XFx1MDM4N1xcdTEzNjktXFx1MTM3MVxcdTE5REFdIiwKICAgICAgICAgICkKICAgICAgICBpZiAoITEgPT09IFJlZ0V4cCgpLnVuaWNvZGUpCiAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cCgiXiIgKyBhICsgIisiICsgYyArICIqJCIsICJ1IikKICAgICAgICBhID0gYigiW0EtWl0iLCAiW2Etel0iLCAiXyIpCiAgICAgICAgYyA9IGIoYSwgIlswLTldIikKICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cCgiXiIgKyBhICsgIisiICsgYyArICIqJCIpCiAgICAgIH0pKCkKICAgICAgOyhmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIGIuYXBwbHkobnVsbCwgYXJndW1lbnRzKSArICIqIgogICAgICB9KSgiXFxcXFxccj9cXG5bIFxcZlxcdF0qIikKICAgICAgYygiI1teXFxyXFxuXSoiKQogICAgICBtID0KICAgICAgICBiKAogICAgICAgICAgIlswLTldKD86Xz9bMC05XSkqXFwuKD86WzAtOV0oPzpfP1swLTldKSopPyIsCiAgICAgICAgICAiXFwuWzAtOV0oPzpfP1swLTldKSoiLAogICAgICAgICkgKyBjKCJbZUVdWy0rXT9bMC05XSg/Ol8/WzAtOV0pKiIpCiAgICAgIHZhciBuID0gYihtLCAiWzAtOV0oPzpfP1swLTldKSpbZUVdWy0rXT9bMC05XSg/Ol8/WzAtOV0pKiIpLAogICAgICAgIHEgPSBiKCJbMC05XSg/Ol8/WzAtOV0pKltqSl0iLCBuICsgIltqSl0iKQogICAgICBtID0gYi5hcHBseShudWxsLCBlKCkpCiAgICAgIHAgPSBiKG0gKyAiJycnIiwgbSArICciIiInKQogICAgICBiKAogICAgICAgIG0gKyAiJ1teXFxuJ1xcXFxdKig/OlxcXFwuW15cXG4nXFxcXF0qKSonIiwKICAgICAgICBtICsgJyJbXlxcbiJcXFxcXSooPzpcXFxcLlteXFxuIlxcXFxdKikqIicsCiAgICAgICkKICAgICAgdmFyIEQgPSBPYmplY3Qua2V5cyhTay50b2tlbi5FWEFDVF9UT0tFTl9UWVBFUykuc29ydCgpCiAgICAgIEQgPSBiLmFwcGx5KAogICAgICAgIHRoaXMsCiAgICAgICAgRC5yZXZlcnNlKCkubWFwKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhICYmIGwudGVzdChhKSA/IGEucmVwbGFjZShrLCAiXFwkJiIpIDogYQogICAgICAgIH0pLAogICAgICApCiAgICAgIHZhciB4ID0gYigiXFxyP1xcbiIsIEQpLAogICAgICAgIEggPSBiKAogICAgICAgICAgbSArICInW15cXG4nXFxcXF0qKD86XFxcXC5bXlxcbidcXFxcXSopKiIgKyBiKCInIiwgIlxcXFxcXHI/XFxuIiksCiAgICAgICAgICBtICsgJyJbXlxcbiJcXFxcXSooPzpcXFxcLlteXFxuIlxcXFxdKikqJyArIGIoJyInLCAiXFxcXFxccj9cXG4iKSwKICAgICAgICApLAogICAgICAgIEogPSBiKCJcXFxcXFxyP1xcbnwkIiwgIiNbXlxcclxcbl0qIiwgcCksCiAgICAgICAgQSA9IHt9CiAgICAgIG0gPSBlKCkKICAgICAgZm9yIChsZXQgYSBvZiBtKQogICAgICAgIChBW2EgKyAiJyJdID0gIl5bXidcXFxcXSooPzpcXFxcLlteJ1xcXFxdKikqJyIpLAogICAgICAgICAgKEFbYSArICciJ10gPSAnXlteIlxcXFxdKig/OlxcXFwuW14iXFxcXF0qKSoiJyksCiAgICAgICAgICAoQVthICsgIicnJyJdID0gIl5bXidcXFxcXSooPzooPzpcXFxcLnwnKD8hJycpKVteJ1xcXFxdKikqJycnIiksCiAgICAgICAgICAoQVthICsgJyIiIiddID0gJ15bXiJcXFxcXSooPzooPzpcXFxcLnwiKD8hIiIpKVteIlxcXFxdKikqIiIiJykKICAgICAgbGV0IEMgPSBbXSwKICAgICAgICBLID0gW10KICAgICAgZm9yIChsZXQgYSBvZiBtKQogICAgICAgIEMucHVzaChhICsgJyInKSwgQy5wdXNoKGEgKyAiJyIpLCBLLnB1c2goYSArICciIiInKSwgSy5wdXNoKGEgKyAiJycnIikKICAgICAgU2suX3Rva2VuaXplID0gZnVuY3Rpb24oYywgZSwgaywgbCkgewogICAgICAgIHZhciBtID0gU2suX19mdXR1cmVfXy5weXRob24zID8gIiIgOiAiKD86TD8pIgogICAgICAgIG0gPSBiKAogICAgICAgICAgIjBbeFhdKD86Xz9bMC05YS1mQS1GXSkrIiArIG0sCiAgICAgICAgICAiMFtiQl0oPzpfP1swMV0pKyIgKyBtLAogICAgICAgICAgU2suX19mdXR1cmVfXy5zaWxlbnRfb2N0YWxfbGl0ZXJhbAogICAgICAgICAgICA/ICIwKFtvT10/KSg/Ol8/WzAtN10pKyIgKyBtCiAgICAgICAgICAgIDogIjAoW29PXSkoPzpfP1swLTddKSsiICsgbSwKICAgICAgICAgICIoPzowKD86Xz8wKSp8WzEtOV0oPzpfP1swLTldKSopIiArIG0sCiAgICAgICAgKQogICAgICAgIG0gPSBiKHEsIG4sIG0pCiAgICAgICAgbSA9ICJbIFxcZlxcdF0qIiArIGIoSiwgbSwgeCwgSCwgIlxcdysiKQogICAgICAgIG0gPSBuZXcgUmVnRXhwKG0pCiAgICAgICAgdmFyIHAgPSAwLAogICAgICAgICAgRCA9IDAsCiAgICAgICAgICBCID0gMCwKICAgICAgICAgIHogPSAiIiwKICAgICAgICAgIEcgPSAwLAogICAgICAgICAgUyA9IG51bGwsCiAgICAgICAgICBJID0gWzBdLAogICAgICAgICAgRSwKICAgICAgICAgIE4gPSB2b2lkIDAsCiAgICAgICAgICBVID0gdm9pZCAwLAogICAgICAgICAgRiwKICAgICAgICAgIFEKICAgICAgICB2b2lkIDAgIT09IGsgJiYKICAgICAgICAgICgidXRmLTgtc2lnIiA9PSBrICYmIChrID0gInV0Zi04IiksCiAgICAgICAgICBsKG5ldyBhKGYuVF9FTkNPRElORywgaywgWzAsIDBdLCBbMCwgMF0sICIiKSkpCiAgICAgICAgZm9yICh2YXIgeSA9IChrID0gIiIpOyA7ICkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgOyhrID0geSksICh5ID0gZSgpKQogICAgICAgICAgfSBjYXRjaCAoTSkgewogICAgICAgICAgICB5ID0gIiIKICAgICAgICAgIH0KICAgICAgICAgIHAgKz0gMQogICAgICAgICAgdmFyIHUgPSAwLAogICAgICAgICAgICBMID0geS5sZW5ndGgKICAgICAgICAgIGlmICh6KSB7CiAgICAgICAgICAgIGlmICgheSkgdGhyb3cgbmV3IGcoIkVPRiBpbiBtdWx0aS1saW5lIHN0cmluZyIsIGMsIFVbMF0sIFVbMV0pCiAgICAgICAgICAgIE4ubGFzdEluZGV4ID0gMAogICAgICAgICAgICB2YXIgdCA9IE4uZXhlYyh5KQogICAgICAgICAgICBpZiAodCkKICAgICAgICAgICAgICAodSA9IEYgPSB0WzBdLmxlbmd0aCksCiAgICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9TVFJJTkcsIHogKyB5LnN1YnN0cmluZygwLCBGKSwgVSwgW3AsIEZdLCBTICsgeSkpLAogICAgICAgICAgICAgICAgKHogPSAiIiksCiAgICAgICAgICAgICAgICAoRyA9IDApLAogICAgICAgICAgICAgICAgKFMgPSBudWxsKQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBHICYmCiAgICAgICAgICAgICAgIlxcXG4iICE9PSB5LnN1YnN0cmluZyh5Lmxlbmd0aCAtIDIpICYmCiAgICAgICAgICAgICAgIlxcXHJcbiIgIT09IHkuc3Vic3RyaW5nKHkubGVuZ3RoIC0gMykKICAgICAgICAgICAgICAgID8gKGwobmV3IGEoZi5UX0VSUk9SVE9LRU4sIHogKyB5LCBVLCBbcCwgeS5sZW5ndGhdLCBTKSksCiAgICAgICAgICAgICAgICAgICh6ID0gIiIpLAogICAgICAgICAgICAgICAgICAoUyA9IG51bGwpKQogICAgICAgICAgICAgICAgOiAoKHogKz0geSksIChTICs9IHkpKQogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoMCAhPSBEIHx8IEIpIHsKICAgICAgICAgICAgaWYgKCF5KSB0aHJvdyBuZXcgZygiRU9GIGluIG11bHRpLWxpbmUgc3RhdGVtZW50IiwgYywgcCwgMCkKICAgICAgICAgICAgQiA9IDAKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICgheSkgYnJlYWsKICAgICAgICAgICAgZm9yIChFID0gMDsgdSA8IEw7ICkgewogICAgICAgICAgICAgIGlmICgiICIgPT0geVt1XSkgRSArPSAxCiAgICAgICAgICAgICAgZWxzZSBpZiAoIlx0IiA9PSB5W3VdKSBFID0gOCAqIE1hdGguZmxvb3IoRSAvIDggKyAxKQogICAgICAgICAgICAgIGVsc2UgaWYgKCJcZiIgPT0geVt1XSkgRSA9IDAKICAgICAgICAgICAgICBlbHNlIGJyZWFrCiAgICAgICAgICAgICAgdSArPSAxCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHUgPT0gTCkgYnJlYWsKICAgICAgICAgICAgaWYgKGQoIiNcclxuIiwgeVt1XSkpIHsKICAgICAgICAgICAgICBpZiAoIiMiID09IHlbdV0pIHsKICAgICAgICAgICAgICAgIEUgPSB5LnN1YnN0cmluZyh1KQogICAgICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICAgICAgTCA9IEUubGVuZ3RoOwogICAgICAgICAgICAgICAgICAwIDwgTCAmJiAtMSAhPT0gIlxyXG4iLmluZGV4T2YoRS5jaGFyQXQoTCAtIDEpKTsKICAgICAgICAgICAgICAgICAgLS1MCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgTCA9IEUuc3Vic3RyaW5nKDAsIEwpCiAgICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9DT01NRU5ULCBMLCBbcCwgdV0sIFtwLCB1ICsgTC5sZW5ndGhdLCB5KSkKICAgICAgICAgICAgICAgIHUgKz0gTC5sZW5ndGgKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbChuZXcgYShmLlRfTkwsIHkuc3Vic3RyaW5nKHUpLCBbcCwgdV0sIFtwLCB5Lmxlbmd0aF0sIHkpKQogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRSA+IElbSS5sZW5ndGggLSAxXSAmJgogICAgICAgICAgICAgIChJLnB1c2goRSksCiAgICAgICAgICAgICAgbChuZXcgYShmLlRfSU5ERU5ULCB5LnN1YnN0cmluZyh1KSwgW3AsIDBdLCBbcCwgdV0sIHkpKSkKICAgICAgICAgICAgZm9yICg7IEUgPCBJW0kubGVuZ3RoIC0gMV07ICkgewogICAgICAgICAgICAgIGlmICghZChJLCBFKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBoKAogICAgICAgICAgICAgICAgICAidW5pbmRlbnQgZG9lcyBub3QgbWF0Y2ggYW55IG91dGVyIGluZGVudGF0aW9uIGxldmVsIiwKICAgICAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICAgICAgcCwKICAgICAgICAgICAgICAgICAgdSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBJID0gSS5zbGljZSgwLCAtMSkKICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9ERURFTlQsICIiLCBbcCwgdV0sIFtwLCB1XSwgeSkpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZvciAoOyB1IDwgTDsgKSB7CiAgICAgICAgICAgIGZvciAoRSA9IHkuY2hhckF0KHUpOyAiICIgPT09IEUgfHwgIlxmIiA9PT0gRSB8fCAiXHQiID09PSBFOyApCiAgICAgICAgICAgICAgKHUgKz0gMSksIChFID0geS5jaGFyQXQodSkpCiAgICAgICAgICAgIGlmICgoUSA9IG0uZXhlYyh5LnN1YnN0cmluZyh1KSkpKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgKChFID0gdSksCiAgICAgICAgICAgICAgICAoRiA9IEUgKyBRWzFdLmxlbmd0aCksCiAgICAgICAgICAgICAgICAoUSA9IFtwLCBFXSksCiAgICAgICAgICAgICAgICAodCA9IFtwLCBGXSksCiAgICAgICAgICAgICAgICAodSA9IEYpLAogICAgICAgICAgICAgICAgRSAhPSBGKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgRiA9IHkuc3Vic3RyaW5nKEUsIEYpCiAgICAgICAgICAgICAgICB2YXIgdiA9IHlbRV0KICAgICAgICAgICAgICAgIGlmIChkKCIwMTIzNDU2Nzg5IiwgdikgfHwgKCIuIiA9PSB2ICYmICIuIiAhPSBGICYmICIuLi4iICE9IEYpKQogICAgICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9OVU1CRVIsIEYsIFEsIHQsIHkpKQogICAgICAgICAgICAgICAgZWxzZSBpZiAoZCgiXHJcbiIsIHYpKQogICAgICAgICAgICAgICAgICAwIDwgRAogICAgICAgICAgICAgICAgICAgID8gbChuZXcgYShmLlRfTkwsIEYsIFEsIHQsIHkpKQogICAgICAgICAgICAgICAgICAgIDogbChuZXcgYShmLlRfTkVXTElORSwgRiwgUSwgdCwgeSkpCiAgICAgICAgICAgICAgICBlbHNlIGlmICgiIyIgPT0gdikgbChuZXcgYShmLlRfQ09NTUVOVCwgRiwgUSwgdCwgeSkpCiAgICAgICAgICAgICAgICBlbHNlIGlmIChkKEssIEYpKQogICAgICAgICAgICAgICAgICBpZiAoKChOID0gUmVnRXhwKEFbRl0pKSwgKHQgPSBOLmV4ZWMoeS5zdWJzdHJpbmcodSkpKSkpCiAgICAgICAgICAgICAgICAgICAgKHUgPSB0WzBdLmxlbmd0aCArIHUpLAogICAgICAgICAgICAgICAgICAgICAgKEYgPSB5LnN1YnN0cmluZyhFLCB1KSksCiAgICAgICAgICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9TVFJJTkcsIEYsIFEsIFtwLCB1XSwgeSkpCiAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFUgPSBbcCwgRV0KICAgICAgICAgICAgICAgICAgICB6ID0geS5zdWJzdHJpbmcoRSkKICAgICAgICAgICAgICAgICAgICBTID0geQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKAogICAgICAgICAgICAgICAgICBkKEMsIHYpIHx8CiAgICAgICAgICAgICAgICAgIGQoQywgRi5zdWJzdHJpbmcoMCwgMikpIHx8CiAgICAgICAgICAgICAgICAgIGQoQywgRi5zdWJzdHJpbmcoMCwgMykpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIGlmICgiXG4iID09IEZbRi5sZW5ndGggLSAxXSkgewogICAgICAgICAgICAgICAgICAgIFUgPSBbcCwgRV0KICAgICAgICAgICAgICAgICAgICBOID0gUmVnRXhwKEFbdl0gfHwgQVtGWzFdXSB8fCBBW0ZbMl1dKQogICAgICAgICAgICAgICAgICAgIHogPSB5LnN1YnN0cmluZyhFKQogICAgICAgICAgICAgICAgICAgIEcgPSAxCiAgICAgICAgICAgICAgICAgICAgUyA9IHkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICB9IGVsc2UgbChuZXcgYShmLlRfU1RSSU5HLCBGLCBRLCB0LCB5KSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgKEUgPSB2Lm5vcm1hbGl6ZSgiTkZLQyIpKSwKICAgICAgICAgICAgICAgICAgICByLnRlc3QoRSkKICAgICAgICAgICAgICAgICAgICAgID8gbChuZXcgYShmLlRfTkFNRSwgRiwgUSwgdCwgeSkpCiAgICAgICAgICAgICAgICAgICAgICA6ICJcXCIgPT0gdgogICAgICAgICAgICAgICAgICAgICAgPyAoQiA9IDEpCiAgICAgICAgICAgICAgICAgICAgICA6IChkKCIoW3siLCB2KSA/IChEICs9IDEpIDogZCgiKV19IiwgdikgJiYgLS1ELAogICAgICAgICAgICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9PUCwgRiwgUSwgdCwgeSkpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgbChuZXcgYShmLlRfRVJST1JUT0tFTiwgeVt1XSwgW3AsIHVdLCBbcCwgdSArIDFdLCB5KSksICh1ICs9IDEpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGsgJiYKICAgICAgICAgICFkKCJcclxuIiwga1trLmxlbmd0aCAtIDFdKSAmJgogICAgICAgICAgbCgKICAgICAgICAgICAgbmV3IGEoCiAgICAgICAgICAgICAgZi5UX05FV0xJTkUsCiAgICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICAgW3AgLSAxLCBrLmxlbmd0aF0sCiAgICAgICAgICAgICAgW3AgLSAxLCBrLmxlbmd0aCArIDFdLAogICAgICAgICAgICAgICIiLAogICAgICAgICAgICApLAogICAgICAgICAgKQogICAgICAgIGZvciAodmFyIFcgaW4gSS5zbGljZSgxKSkgbChuZXcgYShmLlRfREVERU5ULCAiIiwgW3AsIDBdLCBbcCwgMF0sICIiKSkKICAgICAgICBsKG5ldyBhKGYuVF9FTkRNQVJLRVIsICIiLCBbcCwgMF0sIFtwLCAwXSwgIiIpKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suX3Rva2VuaXplIiwgU2suX3Rva2VuaXplKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suT3BNYXAgPSB7CiAgICAgICAgIigiOiBTay50b2tlbi50b2tlbnMuVF9MUEFSLAogICAgICAgICIpIjogU2sudG9rZW4udG9rZW5zLlRfUlBBUiwKICAgICAgICAiWyI6IFNrLnRva2VuLnRva2Vucy5UX0xTUUIsCiAgICAgICAgIl0iOiBTay50b2tlbi50b2tlbnMuVF9SU1FCLAogICAgICAgICI6IjogU2sudG9rZW4udG9rZW5zLlRfQ09MT04sCiAgICAgICAgIiwiOiBTay50b2tlbi50b2tlbnMuVF9DT01NQSwKICAgICAgICAiOyI6IFNrLnRva2VuLnRva2Vucy5UX1NFTUksCiAgICAgICAgIisiOiBTay50b2tlbi50b2tlbnMuVF9QTFVTLAogICAgICAgICItIjogU2sudG9rZW4udG9rZW5zLlRfTUlOVVMsCiAgICAgICAgIioiOiBTay50b2tlbi50b2tlbnMuVF9TVEFSLAogICAgICAgICIvIjogU2sudG9rZW4udG9rZW5zLlRfU0xBU0gsCiAgICAgICAgInwiOiBTay50b2tlbi50b2tlbnMuVF9WQkFSLAogICAgICAgICImIjogU2sudG9rZW4udG9rZW5zLlRfQU1QRVIsCiAgICAgICAgIjwiOiBTay50b2tlbi50b2tlbnMuVF9MRVNTLAogICAgICAgICI+IjogU2sudG9rZW4udG9rZW5zLlRfR1JFQVRFUiwKICAgICAgICAiPSI6IFNrLnRva2VuLnRva2Vucy5UX0VRVUFMLAogICAgICAgICIuIjogU2sudG9rZW4udG9rZW5zLlRfRE9ULAogICAgICAgICIlIjogU2sudG9rZW4udG9rZW5zLlRfUEVSQ0VOVCwKICAgICAgICAiYCI6IFNrLnRva2VuLnRva2Vucy5UX0JBQ0tRVU9URSwKICAgICAgICAieyI6IFNrLnRva2VuLnRva2Vucy5UX0xCUkFDRSwKICAgICAgICAifSI6IFNrLnRva2VuLnRva2Vucy5UX1JCUkFDRSwKICAgICAgICAiQCI6IFNrLnRva2VuLnRva2Vucy5UX0FULAogICAgICAgICJAPSI6IFNrLnRva2VuLnRva2Vucy5UX0FURVFVQUwsCiAgICAgICAgIj09IjogU2sudG9rZW4udG9rZW5zLlRfRVFFUVVBTCwKICAgICAgICAiIT0iOiBTay50b2tlbi50b2tlbnMuVF9OT1RFUVVBTCwKICAgICAgICAiPD4iOiBTay50b2tlbi50b2tlbnMuVF9OT1RFUVVBTCwKICAgICAgICAiPD0iOiBTay50b2tlbi50b2tlbnMuVF9MRVNTRVFVQUwsCiAgICAgICAgIj49IjogU2sudG9rZW4udG9rZW5zLlRfR1JFQVRFUkVRVUFMLAogICAgICAgICJ+IjogU2sudG9rZW4udG9rZW5zLlRfVElMREUsCiAgICAgICAgIl4iOiBTay50b2tlbi50b2tlbnMuVF9DSVJDVU1GTEVYLAogICAgICAgICI8PCI6IFNrLnRva2VuLnRva2Vucy5UX0xFRlRTSElGVCwKICAgICAgICAiPj4iOiBTay50b2tlbi50b2tlbnMuVF9SSUdIVFNISUZULAogICAgICAgICIqKiI6IFNrLnRva2VuLnRva2Vucy5UX0RPVUJMRVNUQVIsCiAgICAgICAgIis9IjogU2sudG9rZW4udG9rZW5zLlRfUExVU0VRVUFMLAogICAgICAgICItPSI6IFNrLnRva2VuLnRva2Vucy5UX01JTkVRVUFMLAogICAgICAgICIqPSI6IFNrLnRva2VuLnRva2Vucy5UX1NUQVJFUVVBTCwKICAgICAgICAiLz0iOiBTay50b2tlbi50b2tlbnMuVF9TTEFTSEVRVUFMLAogICAgICAgICIlPSI6IFNrLnRva2VuLnRva2Vucy5UX1BFUkNFTlRFUVVBTCwKICAgICAgICAiJj0iOiBTay50b2tlbi50b2tlbnMuVF9BTVBFUkVRVUFMLAogICAgICAgICJ8PSI6IFNrLnRva2VuLnRva2Vucy5UX1ZCQVJFUVVBTCwKICAgICAgICAiXj0iOiBTay50b2tlbi50b2tlbnMuVF9DSVJDVU1GTEVYRVFVQUwsCiAgICAgICAgIjw8PSI6IFNrLnRva2VuLnRva2Vucy5UX0xFRlRTSElGVEVRVUFMLAogICAgICAgICI+Pj0iOiBTay50b2tlbi50b2tlbnMuVF9SSUdIVFNISUZURVFVQUwsCiAgICAgICAgIioqPSI6IFNrLnRva2VuLnRva2Vucy5UX0RPVUJMRVNUQVJFUVVBTCwKICAgICAgICAiLy8iOiBTay50b2tlbi50b2tlbnMuVF9ET1VCTEVTTEFTSCwKICAgICAgICAiLy89IjogU2sudG9rZW4udG9rZW5zLlRfRE9VQkxFU0xBU0hFUVVBTCwKICAgICAgICAiLT4iOiBTay50b2tlbi50b2tlbnMuVF9SQVJST1csCiAgICAgICAgIi4uLiI6IFNrLnRva2VuLnRva2Vucy5UX0VMTElQU0lTLAogICAgICB9CiAgICAgIFNrLlBhcnNlVGFibGVzID0gewogICAgICAgIHN5bTogewogICAgICAgICAgYW5kX2V4cHI6IDI1NywKICAgICAgICAgIGFuZF90ZXN0OiAyNTgsCiAgICAgICAgICBhbm5hc3NpZ246IDI1OSwKICAgICAgICAgIGFyZ2xpc3Q6IDI2MCwKICAgICAgICAgIGFyZ3VtZW50OiAyNjEsCiAgICAgICAgICBhcml0aF9leHByOiAyNjIsCiAgICAgICAgICBhc3NlcnRfc3RtdDogMjYzLAogICAgICAgICAgYXN5bmNfZnVuY2RlZjogMjY0LAogICAgICAgICAgYXN5bmNfc3RtdDogMjY1LAogICAgICAgICAgYXRvbTogMjY2LAogICAgICAgICAgYXRvbV9leHByOiAyNjcsCiAgICAgICAgICBhdWdhc3NpZ246IDI2OCwKICAgICAgICAgIGJyZWFrX3N0bXQ6IDI2OSwKICAgICAgICAgIGNsYXNzZGVmOiAyNzAsCiAgICAgICAgICBjb21wX2ZvcjogMjcxLAogICAgICAgICAgY29tcF9pZjogMjcyLAogICAgICAgICAgY29tcF9pdGVyOiAyNzMsCiAgICAgICAgICBjb21wX29wOiAyNzQsCiAgICAgICAgICBjb21wYXJpc29uOiAyNzUsCiAgICAgICAgICBjb21wb3VuZF9zdG10OiAyNzYsCiAgICAgICAgICBjb250aW51ZV9zdG10OiAyNzcsCiAgICAgICAgICBkZWJ1Z2dlcl9zdG10OiAyNzgsCiAgICAgICAgICBkZWNvcmF0ZWQ6IDI3OSwKICAgICAgICAgIGRlY29yYXRvcjogMjgwLAogICAgICAgICAgZGVjb3JhdG9yczogMjgxLAogICAgICAgICAgZGVsX3N0bXQ6IDI4MiwKICAgICAgICAgIGRpY3RvcnNldG1ha2VyOiAyODMsCiAgICAgICAgICBkb3R0ZWRfYXNfbmFtZTogMjg0LAogICAgICAgICAgZG90dGVkX2FzX25hbWVzOiAyODUsCiAgICAgICAgICBkb3R0ZWRfbmFtZTogMjg2LAogICAgICAgICAgZW5jb2RpbmdfZGVjbDogMjg3LAogICAgICAgICAgZXZhbF9pbnB1dDogMjg4LAogICAgICAgICAgZXhjZXB0X2NsYXVzZTogMjg5LAogICAgICAgICAgZXhwcjogMjkwLAogICAgICAgICAgZXhwcl9zdG10OiAyOTEsCiAgICAgICAgICBleHBybGlzdDogMjkyLAogICAgICAgICAgZmFjdG9yOiAyOTMsCiAgICAgICAgICBmaWxlX2lucHV0OiAyOTQsCiAgICAgICAgICBmbG93X3N0bXQ6IDI5NSwKICAgICAgICAgIGZvcl9zdG10OiAyOTYsCiAgICAgICAgICBmdW5jZGVmOiAyOTcsCiAgICAgICAgICBnbG9iYWxfc3RtdDogMjk4LAogICAgICAgICAgaWZfc3RtdDogMjk5LAogICAgICAgICAgaW1wb3J0X2FzX25hbWU6IDMwMCwKICAgICAgICAgIGltcG9ydF9hc19uYW1lczogMzAxLAogICAgICAgICAgaW1wb3J0X2Zyb206IDMwMiwKICAgICAgICAgIGltcG9ydF9uYW1lOiAzMDMsCiAgICAgICAgICBpbXBvcnRfc3RtdDogMzA0LAogICAgICAgICAgbGFtYmRlZjogMzA1LAogICAgICAgICAgbGFtYmRlZl9ub2NvbmQ6IDMwNiwKICAgICAgICAgIG5vbmxvY2FsX3N0bXQ6IDMwNywKICAgICAgICAgIG5vdF90ZXN0OiAzMDgsCiAgICAgICAgICBvcl90ZXN0OiAzMDksCiAgICAgICAgICBwYXJhbWV0ZXJzOiAzMTAsCiAgICAgICAgICBwYXNzX3N0bXQ6IDMxMSwKICAgICAgICAgIHBvd2VyOiAzMTIsCiAgICAgICAgICBwcmludF9zdG10OiAzMTMsCiAgICAgICAgICByYWlzZV9zdG10OiAzMTQsCiAgICAgICAgICByZXR1cm5fc3RtdDogMzE1LAogICAgICAgICAgc2hpZnRfZXhwcjogMzE2LAogICAgICAgICAgc2ltcGxlX3N0bXQ6IDMxNywKICAgICAgICAgIHNpbmdsZV9pbnB1dDogMjU2LAogICAgICAgICAgc2xpY2VvcDogMzE4LAogICAgICAgICAgc21hbGxfc3RtdDogMzE5LAogICAgICAgICAgc3Rhcl9leHByOiAzMjAsCiAgICAgICAgICBzdG10OiAzMjEsCiAgICAgICAgICBzdWJzY3JpcHQ6IDMyMiwKICAgICAgICAgIHN1YnNjcmlwdGxpc3Q6IDMyMywKICAgICAgICAgIHN1aXRlOiAzMjQsCiAgICAgICAgICB0ZXJtOiAzMjUsCiAgICAgICAgICB0ZXN0OiAzMjYsCiAgICAgICAgICB0ZXN0X25vY29uZDogMzI3LAogICAgICAgICAgdGVzdGxpc3Q6IDMyOCwKICAgICAgICAgIHRlc3RsaXN0X2NvbXA6IDMyOSwKICAgICAgICAgIHRlc3RsaXN0X3N0YXJfZXhwcjogMzMwLAogICAgICAgICAgdGZwZGVmOiAzMzEsCiAgICAgICAgICB0cmFpbGVyOiAzMzIsCiAgICAgICAgICB0cnlfc3RtdDogMzMzLAogICAgICAgICAgdHlwZWRhcmdzbGlzdDogMzM0LAogICAgICAgICAgdmFyYXJnc2xpc3Q6IDMzNSwKICAgICAgICAgIHZmcGRlZjogMzM2LAogICAgICAgICAgd2hpbGVfc3RtdDogMzM3LAogICAgICAgICAgd2l0aF9pdGVtOiAzMzgsCiAgICAgICAgICB3aXRoX3N0bXQ6IDMzOSwKICAgICAgICAgIHhvcl9leHByOiAzNDAsCiAgICAgICAgICB5aWVsZF9hcmc6IDM0MSwKICAgICAgICAgIHlpZWxkX2V4cHI6IDM0MiwKICAgICAgICAgIHlpZWxkX3N0bXQ6IDM0MywKICAgICAgICB9LAogICAgICAgIG51bWJlcjJzeW1ib2w6IHsKICAgICAgICAgIDI1NjogInNpbmdsZV9pbnB1dCIsCiAgICAgICAgICAyNTc6ICJhbmRfZXhwciIsCiAgICAgICAgICAyNTg6ICJhbmRfdGVzdCIsCiAgICAgICAgICAyNTk6ICJhbm5hc3NpZ24iLAogICAgICAgICAgMjYwOiAiYXJnbGlzdCIsCiAgICAgICAgICAyNjE6ICJhcmd1bWVudCIsCiAgICAgICAgICAyNjI6ICJhcml0aF9leHByIiwKICAgICAgICAgIDI2MzogImFzc2VydF9zdG10IiwKICAgICAgICAgIDI2NDogImFzeW5jX2Z1bmNkZWYiLAogICAgICAgICAgMjY1OiAiYXN5bmNfc3RtdCIsCiAgICAgICAgICAyNjY6ICJhdG9tIiwKICAgICAgICAgIDI2NzogImF0b21fZXhwciIsCiAgICAgICAgICAyNjg6ICJhdWdhc3NpZ24iLAogICAgICAgICAgMjY5OiAiYnJlYWtfc3RtdCIsCiAgICAgICAgICAyNzA6ICJjbGFzc2RlZiIsCiAgICAgICAgICAyNzE6ICJjb21wX2ZvciIsCiAgICAgICAgICAyNzI6ICJjb21wX2lmIiwKICAgICAgICAgIDI3MzogImNvbXBfaXRlciIsCiAgICAgICAgICAyNzQ6ICJjb21wX29wIiwKICAgICAgICAgIDI3NTogImNvbXBhcmlzb24iLAogICAgICAgICAgMjc2OiAiY29tcG91bmRfc3RtdCIsCiAgICAgICAgICAyNzc6ICJjb250aW51ZV9zdG10IiwKICAgICAgICAgIDI3ODogImRlYnVnZ2VyX3N0bXQiLAogICAgICAgICAgMjc5OiAiZGVjb3JhdGVkIiwKICAgICAgICAgIDI4MDogImRlY29yYXRvciIsCiAgICAgICAgICAyODE6ICJkZWNvcmF0b3JzIiwKICAgICAgICAgIDI4MjogImRlbF9zdG10IiwKICAgICAgICAgIDI4MzogImRpY3RvcnNldG1ha2VyIiwKICAgICAgICAgIDI4NDogImRvdHRlZF9hc19uYW1lIiwKICAgICAgICAgIDI4NTogImRvdHRlZF9hc19uYW1lcyIsCiAgICAgICAgICAyODY6ICJkb3R0ZWRfbmFtZSIsCiAgICAgICAgICAyODc6ICJlbmNvZGluZ19kZWNsIiwKICAgICAgICAgIDI4ODogImV2YWxfaW5wdXQiLAogICAgICAgICAgMjg5OiAiZXhjZXB0X2NsYXVzZSIsCiAgICAgICAgICAyOTA6ICJleHByIiwKICAgICAgICAgIDI5MTogImV4cHJfc3RtdCIsCiAgICAgICAgICAyOTI6ICJleHBybGlzdCIsCiAgICAgICAgICAyOTM6ICJmYWN0b3IiLAogICAgICAgICAgMjk0OiAiZmlsZV9pbnB1dCIsCiAgICAgICAgICAyOTU6ICJmbG93X3N0bXQiLAogICAgICAgICAgMjk2OiAiZm9yX3N0bXQiLAogICAgICAgICAgMjk3OiAiZnVuY2RlZiIsCiAgICAgICAgICAyOTg6ICJnbG9iYWxfc3RtdCIsCiAgICAgICAgICAyOTk6ICJpZl9zdG10IiwKICAgICAgICAgIDMwMDogImltcG9ydF9hc19uYW1lIiwKICAgICAgICAgIDMwMTogImltcG9ydF9hc19uYW1lcyIsCiAgICAgICAgICAzMDI6ICJpbXBvcnRfZnJvbSIsCiAgICAgICAgICAzMDM6ICJpbXBvcnRfbmFtZSIsCiAgICAgICAgICAzMDQ6ICJpbXBvcnRfc3RtdCIsCiAgICAgICAgICAzMDU6ICJsYW1iZGVmIiwKICAgICAgICAgIDMwNjogImxhbWJkZWZfbm9jb25kIiwKICAgICAgICAgIDMwNzogIm5vbmxvY2FsX3N0bXQiLAogICAgICAgICAgMzA4OiAibm90X3Rlc3QiLAogICAgICAgICAgMzA5OiAib3JfdGVzdCIsCiAgICAgICAgICAzMTA6ICJwYXJhbWV0ZXJzIiwKICAgICAgICAgIDMxMTogInBhc3Nfc3RtdCIsCiAgICAgICAgICAzMTI6ICJwb3dlciIsCiAgICAgICAgICAzMTM6ICJwcmludF9zdG10IiwKICAgICAgICAgIDMxNDogInJhaXNlX3N0bXQiLAogICAgICAgICAgMzE1OiAicmV0dXJuX3N0bXQiLAogICAgICAgICAgMzE2OiAic2hpZnRfZXhwciIsCiAgICAgICAgICAzMTc6ICJzaW1wbGVfc3RtdCIsCiAgICAgICAgICAzMTg6ICJzbGljZW9wIiwKICAgICAgICAgIDMxOTogInNtYWxsX3N0bXQiLAogICAgICAgICAgMzIwOiAic3Rhcl9leHByIiwKICAgICAgICAgIDMyMTogInN0bXQiLAogICAgICAgICAgMzIyOiAic3Vic2NyaXB0IiwKICAgICAgICAgIDMyMzogInN1YnNjcmlwdGxpc3QiLAogICAgICAgICAgMzI0OiAic3VpdGUiLAogICAgICAgICAgMzI1OiAidGVybSIsCiAgICAgICAgICAzMjY6ICJ0ZXN0IiwKICAgICAgICAgIDMyNzogInRlc3Rfbm9jb25kIiwKICAgICAgICAgIDMyODogInRlc3RsaXN0IiwKICAgICAgICAgIDMyOTogInRlc3RsaXN0X2NvbXAiLAogICAgICAgICAgMzMwOiAidGVzdGxpc3Rfc3Rhcl9leHByIiwKICAgICAgICAgIDMzMTogInRmcGRlZiIsCiAgICAgICAgICAzMzI6ICJ0cmFpbGVyIiwKICAgICAgICAgIDMzMzogInRyeV9zdG10IiwKICAgICAgICAgIDMzNDogInR5cGVkYXJnc2xpc3QiLAogICAgICAgICAgMzM1OiAidmFyYXJnc2xpc3QiLAogICAgICAgICAgMzM2OiAidmZwZGVmIiwKICAgICAgICAgIDMzNzogIndoaWxlX3N0bXQiLAogICAgICAgICAgMzM4OiAid2l0aF9pdGVtIiwKICAgICAgICAgIDMzOTogIndpdGhfc3RtdCIsCiAgICAgICAgICAzNDA6ICJ4b3JfZXhwciIsCiAgICAgICAgICAzNDE6ICJ5aWVsZF9hcmciLAogICAgICAgICAgMzQyOiAieWllbGRfZXhwciIsCiAgICAgICAgICAzNDM6ICJ5aWVsZF9zdG10IiwKICAgICAgICB9LAogICAgICAgIGRmYXM6IHsKICAgICAgICAgIDI1NjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgICAgWzIsIDFdLAogICAgICAgICAgICAgICAgWzMsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgICAgW1syLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAyOiAxLAogICAgICAgICAgICAgIDQ6IDEsCiAgICAgICAgICAgICAgNTogMSwKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDEwOiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDEzOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE2OiAxLAogICAgICAgICAgICAgIDE3OiAxLAogICAgICAgICAgICAgIDE4OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIwOiAxLAogICAgICAgICAgICAgIDIxOiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDIzOiAxLAogICAgICAgICAgICAgIDI0OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI2OiAxLAogICAgICAgICAgICAgIDI3OiAxLAogICAgICAgICAgICAgIDI4OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMxOiAxLAogICAgICAgICAgICAgIDMyOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM0OiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM3OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDM5OiAxLAogICAgICAgICAgICAgIDQwOiAxLAogICAgICAgICAgICAgIDQxOiAxLAogICAgICAgICAgICAgIDQyOiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI1NzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s0NCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0NSwgMF0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI1ODogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s0NiwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0NywgMF0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjU5OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzQ4LCAxXV0sCiAgICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MCwgM10sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDg6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjA6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNTEsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUxLCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgICA1MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjE6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTUsIDJdLAogICAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MCwgMl0sCiAgICAgICAgICAgICAgICBbNTQsIDNdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgM11dLAogICAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgICA1MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjI6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNTUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMzAsIDBdLAogICAgICAgICAgICAgICAgWzQzLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjYzOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzI0LCAxXV0sCiAgICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgM10sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjQ6IFtbW1sxMCwgMV1dLCBbWzU2LCAyXV0sIFtbMCwgMl1dXSwgeyAxMDogMSB9XSwKICAgICAgICAgIDI2NTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1NywgMl0sCiAgICAgICAgICAgICAgICBbNTYsIDJdLAogICAgICAgICAgICAgICAgWzU4LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDEwOiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjY2OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNiwgMV0sCiAgICAgICAgICAgICAgICBbMjUsIDFdLAogICAgICAgICAgICAgICAgWzMzLCAxXSwKICAgICAgICAgICAgICAgIFs5LCAxXSwKICAgICAgICAgICAgICAgIFsxMSwgMV0sCiAgICAgICAgICAgICAgICBbMTIsIDJdLAogICAgICAgICAgICAgICAgWzM1LCAzXSwKICAgICAgICAgICAgICAgIFszOCwgNF0sCiAgICAgICAgICAgICAgICBbMTksIDFdLAogICAgICAgICAgICAgICAgWzcsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzU5LCAxXSwKICAgICAgICAgICAgICAgIFs2MCwgNl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjEsIDFdLAogICAgICAgICAgICAgICAgWzYyLCA3XSwKICAgICAgICAgICAgICAgIFs2MywgN10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjQsIDFdLAogICAgICAgICAgICAgICAgWzYzLCA4XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs3LCA1XSwKICAgICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNTksIDFdXSwKICAgICAgICAgICAgICBbWzYxLCAxXV0sCiAgICAgICAgICAgICAgW1s2NCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjY3OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMjksIDFdLAogICAgICAgICAgICAgICAgWzY1LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNjUsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjYsIDJdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs2NywgMV0sCiAgICAgICAgICAgICAgICBbNjgsIDFdLAogICAgICAgICAgICAgICAgWzY5LCAxXSwKICAgICAgICAgICAgICAgIFs3MCwgMV0sCiAgICAgICAgICAgICAgICBbNzEsIDFdLAogICAgICAgICAgICAgICAgWzcyLCAxXSwKICAgICAgICAgICAgICAgIFs3MywgMV0sCiAgICAgICAgICAgICAgICBbNzQsIDFdLAogICAgICAgICAgICAgICAgWzc1LCAxXSwKICAgICAgICAgICAgICAgIFs3NiwgMV0sCiAgICAgICAgICAgICAgICBbNzcsIDFdLAogICAgICAgICAgICAgICAgWzc4LCAxXSwKICAgICAgICAgICAgICAgIFs3OSwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY3OiAxLAogICAgICAgICAgICAgIDY4OiAxLAogICAgICAgICAgICAgIDY5OiAxLAogICAgICAgICAgICAgIDcwOiAxLAogICAgICAgICAgICAgIDcxOiAxLAogICAgICAgICAgICAgIDcyOiAxLAogICAgICAgICAgICAgIDczOiAxLAogICAgICAgICAgICAgIDc0OiAxLAogICAgICAgICAgICAgIDc1OiAxLAogICAgICAgICAgICAgIDc2OiAxLAogICAgICAgICAgICAgIDc3OiAxLAogICAgICAgICAgICAgIDc4OiAxLAogICAgICAgICAgICAgIDc5OiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI2OTogW1tbWzM5LCAxXV0sIFtbMCwgMV1dXSwgeyAzOTogMSB9XSwKICAgICAgICAgIDI3MDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMywgMV1dLAogICAgICAgICAgICAgIFtbMjUsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgICAgWzM1LCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbODAsIDVdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjEsIDZdLAogICAgICAgICAgICAgICAgWzgxLCA3XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNV1dLAogICAgICAgICAgICAgIFtbNDgsIDNdXSwKICAgICAgICAgICAgICBbWzYxLCA2XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMTM6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzE6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMCwgMV0sCiAgICAgICAgICAgICAgICBbMzQsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1szNCwgMl1dLAogICAgICAgICAgICAgIFtbODIsIDNdXSwKICAgICAgICAgICAgICBbWzgzLCA0XV0sCiAgICAgICAgICAgICAgW1s4NCwgNV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs4NSwgNl0sCiAgICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAxMDogMSwgMzQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzI6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMzcsIDFdXSwKICAgICAgICAgICAgICBbWzg2LCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzg1LCAzXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDM3OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjczOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbODcsIDFdLAogICAgICAgICAgICAgICAgWzU0LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDEwOiAxLCAzNDogMSwgMzc6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzQ6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs4OCwgMV0sCiAgICAgICAgICAgICAgICBbODksIDFdLAogICAgICAgICAgICAgICAgWzgsIDJdLAogICAgICAgICAgICAgICAgWzkwLCAxXSwKICAgICAgICAgICAgICAgIFs4OCwgMV0sCiAgICAgICAgICAgICAgICBbODMsIDFdLAogICAgICAgICAgICAgICAgWzkxLCAxXSwKICAgICAgICAgICAgICAgIFs5MiwgM10sCiAgICAgICAgICAgICAgICBbOTMsIDFdLAogICAgICAgICAgICAgICAgWzk0LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICAgIFtbODMsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOCwgMV0sCiAgICAgICAgICAgICAgICBbMCwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA4OiAxLCA4MzogMSwgODg6IDEsIDg5OiAxLCA5MDogMSwgOTE6IDEsIDkyOiAxLCA5MzogMSwgOTQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzU6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbOTUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOTYsIDBdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzY6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs5NywgMV0sCiAgICAgICAgICAgICAgICBbOTgsIDFdLAogICAgICAgICAgICAgICAgWzU4LCAxXSwKICAgICAgICAgICAgICAgIFs5OSwgMV0sCiAgICAgICAgICAgICAgICBbNTcsIDFdLAogICAgICAgICAgICAgICAgWzEwMCwgMV0sCiAgICAgICAgICAgICAgICBbNTYsIDFdLAogICAgICAgICAgICAgICAgWzEwMSwgMV0sCiAgICAgICAgICAgICAgICBbMTAyLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDQ6IDEsIDEwOiAxLCAxMzogMSwgMjA6IDEsIDIxOiAxLCAzNDogMSwgMzc6IDEsIDQxOiAxLCA0MjogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI3NzogW1tbWzQwLCAxXV0sIFtbMCwgMV1dXSwgeyA0MDogMSB9XSwKICAgICAgICAgIDI3ODogW1tbWzE3LCAxXV0sIFtbMCwgMV1dXSwgeyAxNzogMSB9XSwKICAgICAgICAgIDI3OTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDMsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTYsIDJdLAogICAgICAgICAgICAgICAgWzEwNCwgMl0sCiAgICAgICAgICAgICAgICBbOTksIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDE6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyODA6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDEsIDFdXSwKICAgICAgICAgICAgICBbWzEwNSwgMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsyLCA0XSwKICAgICAgICAgICAgICAgIFszNSwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjEsIDVdLAogICAgICAgICAgICAgICAgWzgxLCA2XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICAgIFtbMiwgNF1dLAogICAgICAgICAgICAgIFtbNjEsIDVdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA0MTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4MTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDYsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTA2LCAxXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDQxOiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjgyOiBbW1tbMjcsIDFdXSwgW1s4MiwgMl1dLCBbWzAsIDJdXV0sIHsgMjc6IDEgfV0sCiAgICAgICAgICAyODM6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAyXSwKICAgICAgICAgICAgICAgIFs1MywgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDgsIDRdLAogICAgICAgICAgICAgICAgWzU0LCA1XSwKICAgICAgICAgICAgICAgIFs1MiwgNl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTQsIDVdLAogICAgICAgICAgICAgICAgWzUyLCA2XSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbOTUsIDddXSwKICAgICAgICAgICAgICBbWzQ5LCA3XV0sCiAgICAgICAgICAgICAgW1swLCA1XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCA4XSwKICAgICAgICAgICAgICAgIFsxMDcsIDhdLAogICAgICAgICAgICAgICAgWzAsIDZdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzU0LCA1XSwKICAgICAgICAgICAgICAgIFs1MiwgOV0sCiAgICAgICAgICAgICAgICBbMCwgN10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDZdLAogICAgICAgICAgICAgICAgWzAsIDhdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAxMF0sCiAgICAgICAgICAgICAgICBbNTMsIDExXSwKICAgICAgICAgICAgICAgIFswLCA5XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDgsIDEyXV0sCiAgICAgICAgICAgICAgW1s5NSwgMTNdXSwKICAgICAgICAgICAgICBbWzQ5LCAxM11dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgOV0sCiAgICAgICAgICAgICAgICBbMCwgMTNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICAgIDUzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4NDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTA4LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMjUsIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAyNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4NTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDksIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDBdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjU6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyODY6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMjUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTEwLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDI1OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjg3OiBbW1tbMjUsIDFdXSwgW1swLCAxXV1dLCB7IDI1OiAxIH1dLAogICAgICAgICAgMjg4OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzExMSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsyLCAxXSwKICAgICAgICAgICAgICAgIFsxMTIsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4OTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMTMsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEwOCwgM10sCiAgICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDExMzogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5MDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMTQsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTE1LCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjkxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzExNiwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMTcsIDJdLAogICAgICAgICAgICAgICAgWzUwLCAzXSwKICAgICAgICAgICAgICAgIFsxMTgsIDRdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzExMSwgNF0sCiAgICAgICAgICAgICAgICBbNjIsIDRdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzExNiwgNV0sCiAgICAgICAgICAgICAgICBbNjIsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCAzXSwKICAgICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyOTI6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs5NSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOTUsIDFdLAogICAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5MzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzExOSwgMl0sCiAgICAgICAgICAgICAgICBbMzAsIDFdLAogICAgICAgICAgICAgICAgWzIyLCAxXSwKICAgICAgICAgICAgICAgIFs0MywgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzEyMCwgMl1dLAogICAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjk0OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMiwgMF0sCiAgICAgICAgICAgICAgICBbMTEyLCAxXSwKICAgICAgICAgICAgICAgIFsxMjEsIDBdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAyOiAxLAogICAgICAgICAgICAgIDQ6IDEsCiAgICAgICAgICAgICAgNTogMSwKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDEwOiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDEzOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE2OiAxLAogICAgICAgICAgICAgIDE3OiAxLAogICAgICAgICAgICAgIDE4OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIwOiAxLAogICAgICAgICAgICAgIDIxOiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDIzOiAxLAogICAgICAgICAgICAgIDI0OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI2OiAxLAogICAgICAgICAgICAgIDI3OiAxLAogICAgICAgICAgICAgIDI4OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMxOiAxLAogICAgICAgICAgICAgIDMyOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM0OiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM3OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDM5OiAxLAogICAgICAgICAgICAgIDQwOiAxLAogICAgICAgICAgICAgIDQxOiAxLAogICAgICAgICAgICAgIDQyOiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICAgIDExMjogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyOTU6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMjIsIDFdLAogICAgICAgICAgICAgICAgWzEyMywgMV0sCiAgICAgICAgICAgICAgICBbMTI0LCAxXSwKICAgICAgICAgICAgICAgIFsxMjUsIDFdLAogICAgICAgICAgICAgICAgWzEyNiwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA1OiAxLCAyMzogMSwgMzE6IDEsIDM5OiAxLCA0MDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5NjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1szNCwgMV1dLAogICAgICAgICAgICAgIFtbODIsIDJdXSwKICAgICAgICAgICAgICBbWzgzLCAzXV0sCiAgICAgICAgICAgICAgW1sxMTEsIDRdXSwKICAgICAgICAgICAgICBbWzQ4LCA1XV0sCiAgICAgICAgICAgICAgW1s4MCwgNl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMjcsIDddLAogICAgICAgICAgICAgICAgWzAsIDZdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OCwgOF1dLAogICAgICAgICAgICAgIFtbODAsIDldXSwKICAgICAgICAgICAgICBbWzAsIDldXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5NzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s0LCAxXV0sCiAgICAgICAgICAgICAgW1syNSwgMl1dLAogICAgICAgICAgICAgIFtbMTI4LCAzXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ4LCA0XSwKICAgICAgICAgICAgICAgIFsxMjksIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s4MCwgNl1dLAogICAgICAgICAgICAgIFtbNDksIDddXSwKICAgICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgICAgICBbWzQ4LCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5ODogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syNiwgMV1dLAogICAgICAgICAgICAgIFtbMjUsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDFdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjY6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyOTk6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMzcsIDFdXSwKICAgICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgICAgW1s0OCwgM11dLAogICAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTI3LCA1XSwKICAgICAgICAgICAgICAgIFsxMzAsIDFdLAogICAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OCwgNl1dLAogICAgICAgICAgICAgIFtbODAsIDddXSwKICAgICAgICAgICAgICBbWzAsIDddXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNzogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMwMDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMDgsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1syNSwgM11dLAogICAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDI1OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzAxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzEzMSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTMxLCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDI1OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzAyOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzM2LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgICBbMTksIDNdLAogICAgICAgICAgICAgICAgWzExMCwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzMyLCA0XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgICBbMTksIDNdLAogICAgICAgICAgICAgICAgWzMyLCA0XSwKICAgICAgICAgICAgICAgIFsxMTAsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEzMiwgNV0sCiAgICAgICAgICAgICAgICBbMTUsIDVdLAogICAgICAgICAgICAgICAgWzM1LCA2XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNV1dLAogICAgICAgICAgICAgIFtbMTMyLCA3XV0sCiAgICAgICAgICAgICAgW1s2MSwgNV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDM2OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzAzOiBbW1tbMzIsIDFdXSwgW1sxMzMsIDJdXSwgW1swLCAyXV1dLCB7IDMyOiAxIH1dLAogICAgICAgICAgMzA0OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTM0LCAxXSwKICAgICAgICAgICAgICAgIFsxMzUsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMzI6IDEsIDM2OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzA1OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzE0LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICAgIFsxMzYsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICAgIFtbNDgsIDJdXSwKICAgICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAxNDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMwNjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgICBbMTM2LCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbODYsIDRdXSwKICAgICAgICAgICAgICBbWzQ4LCAyXV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMTQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMDc6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMTgsIDFdXSwKICAgICAgICAgICAgICBbWzI1LCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDE4OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzA4OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOCwgMV0sCiAgICAgICAgICAgICAgICBbMTM3LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDYsIDJdXSwKICAgICAgICAgICAgICBbWzAsIDJdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzA5OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzEzOCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMzksIDBdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxMDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1szNSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs2MSwgMl0sCiAgICAgICAgICAgICAgICBbMTQwLCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICAgIFtbNjEsIDJdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxMTogW1tbWzI4LCAxXV0sIFtbMCwgMV1dXSwgeyAyODogMSB9XSwKICAgICAgICAgIDMxMjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNDEsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTMsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1sxMjAsIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxMzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNiwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMl0sCiAgICAgICAgICAgICAgICBbMTQyLCAzXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNF0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA1XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNl0sCiAgICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA3XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCA4XSwKICAgICAgICAgICAgICAgIFswLCA3XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgN10sCiAgICAgICAgICAgICAgICBbMCwgOF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAxNjogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxNDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s1LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFszNiwgM10sCiAgICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA2XV0sCiAgICAgICAgICAgICAgW1swLCA2XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxNTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syMywgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMTEsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjM6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMTY6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMTQzLCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE0NCwgMF0sCiAgICAgICAgICAgICAgICBbMTQyLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzE3OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzE0NSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsyLCAyXSwKICAgICAgICAgICAgICAgIFsxNDYsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE0NSwgMV0sCiAgICAgICAgICAgICAgICBbMiwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDU6IDEsCiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxNjogMSwKICAgICAgICAgICAgICAxNzogMSwKICAgICAgICAgICAgICAxODogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyMzogMSwKICAgICAgICAgICAgICAyNDogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyNjogMSwKICAgICAgICAgICAgICAyNzogMSwKICAgICAgICAgICAgICAyODogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMTogMSwKICAgICAgICAgICAgICAzMjogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzNjogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICAzOTogMSwKICAgICAgICAgICAgICA0MDogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMTg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDgsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDg6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMTk6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNDcsIDFdLAogICAgICAgICAgICAgICAgWzE0OCwgMV0sCiAgICAgICAgICAgICAgICBbMTQ5LCAxXSwKICAgICAgICAgICAgICAgIFsxNTAsIDFdLAogICAgICAgICAgICAgICAgWzE1MSwgMV0sCiAgICAgICAgICAgICAgICBbMTUyLCAxXSwKICAgICAgICAgICAgICAgIFsxNTMsIDFdLAogICAgICAgICAgICAgICAgWzE1NCwgMV0sCiAgICAgICAgICAgICAgICBbMTU1LCAxXSwKICAgICAgICAgICAgICAgIFsxNTYsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA1OiAxLAogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTU6IDEsCiAgICAgICAgICAgICAgMTY6IDEsCiAgICAgICAgICAgICAgMTc6IDEsCiAgICAgICAgICAgICAgMTg6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjM6IDEsCiAgICAgICAgICAgICAgMjQ6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjY6IDEsCiAgICAgICAgICAgICAgMjc6IDEsCiAgICAgICAgICAgICAgMjg6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzE6IDEsCiAgICAgICAgICAgICAgMzI6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzY6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgMzk6IDEsCiAgICAgICAgICAgICAgNDA6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzIwOiBbW1tbMTUsIDFdXSwgW1s5NSwgMl1dLCBbWzAsIDJdXV0sIHsgMTU6IDEgfV0sCiAgICAgICAgICAzMjE6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxLCAxXSwKICAgICAgICAgICAgICAgIFszLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNDogMSwKICAgICAgICAgICAgICA1OiAxLAogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTA6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTM6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTU6IDEsCiAgICAgICAgICAgICAgMTY6IDEsCiAgICAgICAgICAgICAgMTc6IDEsCiAgICAgICAgICAgICAgMTg6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjA6IDEsCiAgICAgICAgICAgICAgMjE6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjM6IDEsCiAgICAgICAgICAgICAgMjQ6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjY6IDEsCiAgICAgICAgICAgICAgMjc6IDEsCiAgICAgICAgICAgICAgMjg6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzE6IDEsCiAgICAgICAgICAgICAgMzI6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzQ6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzY6IDEsCiAgICAgICAgICAgICAgMzc6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgMzk6IDEsCiAgICAgICAgICAgICAgNDA6IDEsCiAgICAgICAgICAgICAgNDE6IDEsCiAgICAgICAgICAgICAgNDI6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzIyOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDNdLAogICAgICAgICAgICAgICAgWzE1NywgNF0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTU3LCA0XSwKICAgICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgICA0ODogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjM6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMTU4LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNTgsIDFdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICAgIDQ4OiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMyNDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgICAgWzIsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgICAgW1sxNTksIDNdXSwKICAgICAgICAgICAgICBbWzEyMSwgNF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjAsIDFdLAogICAgICAgICAgICAgICAgWzEyMSwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDI6IDEsCiAgICAgICAgICAgICAgNTogMSwKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE2OiAxLAogICAgICAgICAgICAgIDE3OiAxLAogICAgICAgICAgICAgIDE4OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDIzOiAxLAogICAgICAgICAgICAgIDI0OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI2OiAxLAogICAgICAgICAgICAgIDI3OiAxLAogICAgICAgICAgICAgIDI4OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMxOiAxLAogICAgICAgICAgICAgIDMyOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDM5OiAxLAogICAgICAgICAgICAgIDQwOiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMyNTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMjAsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTYxLCAwXSwKICAgICAgICAgICAgICAgIFsxNSwgMF0sCiAgICAgICAgICAgICAgICBbMTYyLCAwXSwKICAgICAgICAgICAgICAgIFs0MSwgMF0sCiAgICAgICAgICAgICAgICBbMTYzLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzI2OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbODQsIDFdLAogICAgICAgICAgICAgICAgWzE2NCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMzcsIDNdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgICAgW1s4NCwgNF1dLAogICAgICAgICAgICAgIFtbMTI3LCA1XV0sCiAgICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjc6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjUsIDFdLAogICAgICAgICAgICAgICAgWzg0LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDksIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjk6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1NCwgMl0sCiAgICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCA0XSwKICAgICAgICAgICAgICAgIFsxMDcsIDRdLAogICAgICAgICAgICAgICAgWzAsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAzXSwKICAgICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMzA6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTU6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzMxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzI1LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDksIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAyNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMzMjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzM1LCAxXSwKICAgICAgICAgICAgICAgIFsxMTAsIDJdLAogICAgICAgICAgICAgICAgWzM4LCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs2MSwgNF0sCiAgICAgICAgICAgICAgICBbODEsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1syNSwgNF1dLAogICAgICAgICAgICAgIFtbMTY2LCA2XV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgICAgW1s2MSwgNF1dLAogICAgICAgICAgICAgIFtbNjQsIDRdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNTogMSwgMzg6IDEsIDExMDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMzMzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syMCwgMV1dLAogICAgICAgICAgICAgIFtbNDgsIDJdXSwKICAgICAgICAgICAgICBbWzgwLCAzXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE2NywgNF0sCiAgICAgICAgICAgICAgICBbMTY4LCA1XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDgsIDZdXSwKICAgICAgICAgICAgICBbWzQ4LCA3XV0sCiAgICAgICAgICAgICAgW1s4MCwgOF1dLAogICAgICAgICAgICAgIFtbODAsIDldXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTY3LCA0XSwKICAgICAgICAgICAgICAgIFsxMjcsIDEwXSwKICAgICAgICAgICAgICAgIFsxNjgsIDVdLAogICAgICAgICAgICAgICAgWzAsIDhdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCA5XV0sCiAgICAgICAgICAgICAgW1s0OCwgMTFdXSwKICAgICAgICAgICAgICBbWzgwLCAxMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjgsIDVdLAogICAgICAgICAgICAgICAgWzAsIDEyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDIwOiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzM0OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTUsIDFdLAogICAgICAgICAgICAgICAgWzE2OSwgMl0sCiAgICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE2OSwgNF0sCiAgICAgICAgICAgICAgICBbNTIsIDVdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCA2XSwKICAgICAgICAgICAgICAgIFs1MiwgN10sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzE2OSwgOF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTY5LCA5XSwKICAgICAgICAgICAgICAgIFs1MywgM10sCiAgICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAxMF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNSwgMTFdLAogICAgICAgICAgICAgICAgWzE2OSwgMl0sCiAgICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgICAgWzAsIDddLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxMl0sCiAgICAgICAgICAgICAgICBbMCwgOF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTAsIDEzXSwKICAgICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgICBbMCwgOV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDddLAogICAgICAgICAgICAgICAgWzAsIDEwXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjksIDE0XSwKICAgICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgICAgWzAsIDExXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMTJdXSwKICAgICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgICBbMCwgMTRdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE2OSwgMTZdLAogICAgICAgICAgICAgICAgWzUzLCAzXSwKICAgICAgICAgICAgICAgIFswLCAxNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTAsIDE3XSwKICAgICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgICAgWzAsIDE2XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDksIDE0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMTU6IDEsIDI1OiAxLCA1MzogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMzNTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE1LCAxXSwKICAgICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgICBbMTcwLCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNzAsIDVdLAogICAgICAgICAgICAgICAgWzUyLCA0XSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMTcwLCA2XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCA3XSwKICAgICAgICAgICAgICAgIFs1MiwgOF0sCiAgICAgICAgICAgICAgICBbMCwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTMsIDJdLAogICAgICAgICAgICAgICAgWzE3MCwgOV0sCiAgICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDRdLAogICAgICAgICAgICAgICAgWzAsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxMF0sCiAgICAgICAgICAgICAgICBbMCwgNl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAxMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNSwgMTJdLAogICAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICAgIFsxNzAsIDNdLAogICAgICAgICAgICAgICAgWzAsIDhdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCAxM10sCiAgICAgICAgICAgICAgICBbNTIsIDRdLAogICAgICAgICAgICAgICAgWzAsIDldLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxMF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgOF0sCiAgICAgICAgICAgICAgICBbMCwgMTFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgICBbMTcwLCAxNF0sCiAgICAgICAgICAgICAgICBbMCwgMTJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgICAgWzAsIDE0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgICBbMTcwLCAxNl0sCiAgICAgICAgICAgICAgICBbMCwgMTVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCAxN10sCiAgICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICAgIFswLCAxNl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAxNF1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDE1OiAxLCAyNTogMSwgNTM6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMzY6IFtbW1syNSwgMV1dLCBbWzAsIDFdXV0sIHsgMjU6IDEgfV0sCiAgICAgICAgICAzMzc6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMjEsIDFdXSwKICAgICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgICAgW1s0OCwgM11dLAogICAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTI3LCA1XSwKICAgICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDgsIDZdXSwKICAgICAgICAgICAgICBbWzgwLCA3XV0sCiAgICAgICAgICAgICAgW1swLCA3XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjE6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMzg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDksIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTA4LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbOTUsIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzM5OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzQyLCAxXV0sCiAgICAgICAgICAgICAgW1sxNzEsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgICAgWzUyLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA0MjogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDM0MDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNzIsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTczLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzQxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTExLCAyXSwKICAgICAgICAgICAgICAgIFszNiwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDM0MjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1szMSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNzQsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMzE6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzNDM6IFtbW1s2MiwgMV1dLCBbWzAsIDFdXV0sIHsgMzE6IDEgfV0sCiAgICAgICAgfSwKICAgICAgICBzdGF0ZXM6IFsKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxLCAxXSwKICAgICAgICAgICAgICBbMiwgMV0sCiAgICAgICAgICAgICAgWzMsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgW1syLCAxXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQ0LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDUsIDBdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbNDYsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0NywgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s0OCwgMV1dLAogICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDNdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbNTEsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUxLCAxXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICBbMTUsIDJdLAogICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDJdLAogICAgICAgICAgICAgIFs1NCwgM10sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s1NSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzMwLCAwXSwKICAgICAgICAgICAgICBbNDMsIDBdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMjQsIDFdXSwKICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAzXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDRdXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICBdLAogICAgICAgICAgW1tbMTAsIDFdXSwgW1s1NiwgMl1dLCBbWzAsIDJdXV0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTAsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1NywgMl0sCiAgICAgICAgICAgICAgWzU2LCAyXSwKICAgICAgICAgICAgICBbNTgsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDJdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNiwgMV0sCiAgICAgICAgICAgICAgWzI1LCAxXSwKICAgICAgICAgICAgICBbMzMsIDFdLAogICAgICAgICAgICAgIFs5LCAxXSwKICAgICAgICAgICAgICBbMTEsIDFdLAogICAgICAgICAgICAgIFsxMiwgMl0sCiAgICAgICAgICAgICAgWzM1LCAzXSwKICAgICAgICAgICAgICBbMzgsIDRdLAogICAgICAgICAgICAgIFsxOSwgMV0sCiAgICAgICAgICAgICAgWzcsIDVdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1OSwgMV0sCiAgICAgICAgICAgICAgWzYwLCA2XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgMV0sCiAgICAgICAgICAgICAgWzYyLCA3XSwKICAgICAgICAgICAgICBbNjMsIDddLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzY0LCAxXSwKICAgICAgICAgICAgICBbNjMsIDhdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzcsIDVdLAogICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s1OSwgMV1dLAogICAgICAgICAgICBbWzYxLCAxXV0sCiAgICAgICAgICAgIFtbNjQsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMjksIDFdLAogICAgICAgICAgICAgIFs2NSwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNjUsIDJdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2NiwgMl0sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2NywgMV0sCiAgICAgICAgICAgICAgWzY4LCAxXSwKICAgICAgICAgICAgICBbNjksIDFdLAogICAgICAgICAgICAgIFs3MCwgMV0sCiAgICAgICAgICAgICAgWzcxLCAxXSwKICAgICAgICAgICAgICBbNzIsIDFdLAogICAgICAgICAgICAgIFs3MywgMV0sCiAgICAgICAgICAgICAgWzc0LCAxXSwKICAgICAgICAgICAgICBbNzUsIDFdLAogICAgICAgICAgICAgIFs3NiwgMV0sCiAgICAgICAgICAgICAgWzc3LCAxXSwKICAgICAgICAgICAgICBbNzgsIDFdLAogICAgICAgICAgICAgIFs3OSwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzM5LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMywgMV1dLAogICAgICAgICAgICBbWzI1LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgIFszNSwgNF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODAsIDVdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgNl0sCiAgICAgICAgICAgICAgWzgxLCA3XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA1XV0sCiAgICAgICAgICAgIFtbNDgsIDNdXSwKICAgICAgICAgICAgW1s2MSwgNl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMCwgMV0sCiAgICAgICAgICAgICAgWzM0LCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1szNCwgMl1dLAogICAgICAgICAgICBbWzgyLCAzXV0sCiAgICAgICAgICAgIFtbODMsIDRdXSwKICAgICAgICAgICAgW1s4NCwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzg1LCA2XSwKICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgNl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1szNywgMV1dLAogICAgICAgICAgICBbWzg2LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbODUsIDNdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAzXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzg3LCAxXSwKICAgICAgICAgICAgICBbNTQsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbODgsIDFdLAogICAgICAgICAgICAgIFs4OSwgMV0sCiAgICAgICAgICAgICAgWzgsIDJdLAogICAgICAgICAgICAgIFs5MCwgMV0sCiAgICAgICAgICAgICAgWzg4LCAxXSwKICAgICAgICAgICAgICBbODMsIDFdLAogICAgICAgICAgICAgIFs5MSwgMV0sCiAgICAgICAgICAgICAgWzkyLCAzXSwKICAgICAgICAgICAgICBbOTMsIDFdLAogICAgICAgICAgICAgIFs5NCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBbWzgzLCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbOCwgMV0sCiAgICAgICAgICAgICAgWzAsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s5NSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzk2LCAwXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzk3LCAxXSwKICAgICAgICAgICAgICBbOTgsIDFdLAogICAgICAgICAgICAgIFs1OCwgMV0sCiAgICAgICAgICAgICAgWzk5LCAxXSwKICAgICAgICAgICAgICBbNTcsIDFdLAogICAgICAgICAgICAgIFsxMDAsIDFdLAogICAgICAgICAgICAgIFs1NiwgMV0sCiAgICAgICAgICAgICAgWzEwMSwgMV0sCiAgICAgICAgICAgICAgWzEwMiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzQwLCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFtbWzE3LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMDMsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1NiwgMl0sCiAgICAgICAgICAgICAgWzEwNCwgMl0sCiAgICAgICAgICAgICAgWzk5LCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQxLCAxXV0sCiAgICAgICAgICAgIFtbMTA1LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMiwgNF0sCiAgICAgICAgICAgICAgWzM1LCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgNV0sCiAgICAgICAgICAgICAgWzgxLCA2XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIFtbMiwgNF1dLAogICAgICAgICAgICBbWzYxLCA1XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzEwNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwNiwgMV0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzI3LCAxXV0sIFtbODIsIDJdXSwgW1swLCAyXV1dLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICBbMTA3LCAyXSwKICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ4LCA0XSwKICAgICAgICAgICAgICBbNTQsIDVdLAogICAgICAgICAgICAgIFs1MiwgNl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzU0LCA1XSwKICAgICAgICAgICAgICBbNTIsIDZdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s5NSwgN11dLAogICAgICAgICAgICBbWzQ5LCA3XV0sCiAgICAgICAgICAgIFtbMCwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCA4XSwKICAgICAgICAgICAgICBbMTA3LCA4XSwKICAgICAgICAgICAgICBbMCwgNl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTQsIDVdLAogICAgICAgICAgICAgIFs1MiwgOV0sCiAgICAgICAgICAgICAgWzAsIDddLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA2XSwKICAgICAgICAgICAgICBbMCwgOF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDEwXSwKICAgICAgICAgICAgICBbNTMsIDExXSwKICAgICAgICAgICAgICBbMCwgOV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDgsIDEyXV0sCiAgICAgICAgICAgIFtbOTUsIDEzXV0sCiAgICAgICAgICAgIFtbNDksIDEzXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDldLAogICAgICAgICAgICAgIFswLCAxM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzEwNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwOCwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzI1LCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMDksIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzExMCwgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzI1LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMTEsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsyLCAxXSwKICAgICAgICAgICAgICBbMTEyLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzExMywgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTA4LCAzXSwKICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTE0LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTE1LCAwXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzExNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzExNywgMl0sCiAgICAgICAgICAgICAgWzUwLCAzXSwKICAgICAgICAgICAgICBbMTE4LCA0XSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTExLCA0XSwKICAgICAgICAgICAgICBbNjIsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzExNiwgNV0sCiAgICAgICAgICAgICAgWzYyLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDNdLAogICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbOTUsIDFdLAogICAgICAgICAgICAgIFsxMDcsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbOTUsIDFdLAogICAgICAgICAgICAgIFsxMDcsIDFdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTE5LCAyXSwKICAgICAgICAgICAgICBbMzAsIDFdLAogICAgICAgICAgICAgIFsyMiwgMV0sCiAgICAgICAgICAgICAgWzQzLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1sxMjAsIDJdXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzIsIDBdLAogICAgICAgICAgICAgIFsxMTIsIDFdLAogICAgICAgICAgICAgIFsxMjEsIDBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTIyLCAxXSwKICAgICAgICAgICAgICBbMTIzLCAxXSwKICAgICAgICAgICAgICBbMTI0LCAxXSwKICAgICAgICAgICAgICBbMTI1LCAxXSwKICAgICAgICAgICAgICBbMTI2LCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzM0LCAxXV0sCiAgICAgICAgICAgIFtbODIsIDJdXSwKICAgICAgICAgICAgW1s4MywgM11dLAogICAgICAgICAgICBbWzExMSwgNF1dLAogICAgICAgICAgICBbWzQ4LCA1XV0sCiAgICAgICAgICAgIFtbODAsIDZdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMjcsIDddLAogICAgICAgICAgICAgIFswLCA2XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OCwgOF1dLAogICAgICAgICAgICBbWzgwLCA5XV0sCiAgICAgICAgICAgIFtbMCwgOV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s0LCAxXV0sCiAgICAgICAgICAgIFtbMjUsIDJdXSwKICAgICAgICAgICAgW1sxMjgsIDNdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OCwgNF0sCiAgICAgICAgICAgICAgWzEyOSwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODAsIDZdXSwKICAgICAgICAgICAgW1s0OSwgN11dLAogICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgICAgW1s0OCwgNF1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNiwgMV1dLAogICAgICAgICAgICBbWzI1LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDFdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMzcsIDFdXSwKICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICBbWzQ4LCAzXV0sCiAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMjcsIDVdLAogICAgICAgICAgICAgIFsxMzAsIDFdLAogICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OCwgNl1dLAogICAgICAgICAgICBbWzgwLCA3XV0sCiAgICAgICAgICAgIFtbMCwgN11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwOCwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzI1LCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMzEsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEzMSwgMV0sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1szNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgWzE5LCAzXSwKICAgICAgICAgICAgICBbMTEwLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1szMiwgNF1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgWzE5LCAzXSwKICAgICAgICAgICAgICBbMzIsIDRdLAogICAgICAgICAgICAgIFsxMTAsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEzMiwgNV0sCiAgICAgICAgICAgICAgWzE1LCA1XSwKICAgICAgICAgICAgICBbMzUsIDZdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDVdXSwKICAgICAgICAgICAgW1sxMzIsIDddXSwKICAgICAgICAgICAgW1s2MSwgNV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzMyLCAxXV0sIFtbMTMzLCAyXV0sIFtbMCwgMl1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMzQsIDFdLAogICAgICAgICAgICAgIFsxMzUsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTQsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgWzEzNiwgM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDRdXSwKICAgICAgICAgICAgW1s0OCwgMl1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTQsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgWzEzNiwgM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODYsIDRdXSwKICAgICAgICAgICAgW1s0OCwgMl1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTgsIDFdXSwKICAgICAgICAgICAgW1syNSwgMl1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAxXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzgsIDFdLAogICAgICAgICAgICAgIFsxMzcsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ2LCAyXV0sCiAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMzgsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMzksIDBdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMzUsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgMl0sCiAgICAgICAgICAgICAgWzE0MCwgM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICBbWzYxLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgW1tbMjgsIDFdXSwgW1swLCAxXV1dLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE0MSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMTIwLCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMTQyLCAzXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDRdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDZdLAogICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgN11dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA4XSwKICAgICAgICAgICAgICBbMCwgN10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDddLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMzYsIDNdLAogICAgICAgICAgICAgIFs1MiwgM10sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDVdLAogICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNl1dLAogICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMjMsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMTEsIDJdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE0MywgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE0NCwgMF0sCiAgICAgICAgICAgICAgWzE0MiwgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxNDUsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsyLCAyXSwKICAgICAgICAgICAgICBbMTQ2LCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTQ1LCAxXSwKICAgICAgICAgICAgICBbMiwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQ4LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDJdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE0NywgMV0sCiAgICAgICAgICAgICAgWzE0OCwgMV0sCiAgICAgICAgICAgICAgWzE0OSwgMV0sCiAgICAgICAgICAgICAgWzE1MCwgMV0sCiAgICAgICAgICAgICAgWzE1MSwgMV0sCiAgICAgICAgICAgICAgWzE1MiwgMV0sCiAgICAgICAgICAgICAgWzE1MywgMV0sCiAgICAgICAgICAgICAgWzE1NCwgMV0sCiAgICAgICAgICAgICAgWzE1NSwgMV0sCiAgICAgICAgICAgICAgWzE1NiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzE1LCAxXV0sIFtbOTUsIDJdXSwgW1swLCAyXV1dLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgIFszLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICBbNDgsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDNdLAogICAgICAgICAgICAgIFsxNTcsIDRdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNTcsIDRdLAogICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE1OCwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTU4LCAxXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgIFsyLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIFtbMTU5LCAzXV0sCiAgICAgICAgICAgIFtbMTIxLCA0XV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTYwLCAxXSwKICAgICAgICAgICAgICBbMTIxLCA0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTIwLCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTYxLCAwXSwKICAgICAgICAgICAgICBbMTUsIDBdLAogICAgICAgICAgICAgIFsxNjIsIDBdLAogICAgICAgICAgICAgIFs0MSwgMF0sCiAgICAgICAgICAgICAgWzE2MywgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs4NCwgMV0sCiAgICAgICAgICAgICAgWzE2NCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMzcsIDNdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIFtbODQsIDRdXSwKICAgICAgICAgICAgW1sxMjcsIDVdXSwKICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNjUsIDFdLAogICAgICAgICAgICAgIFs4NCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s0OSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgIFsxMDcsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzU0LCAyXSwKICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDRdLAogICAgICAgICAgICAgIFsxMDcsIDRdLAogICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgM10sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDJdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDNdXSwKICAgICAgICAgICAgW1swLCAzXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzM1LCAxXSwKICAgICAgICAgICAgICBbMTEwLCAyXSwKICAgICAgICAgICAgICBbMzgsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzYxLCA0XSwKICAgICAgICAgICAgICBbODEsIDVdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzI1LCA0XV0sCiAgICAgICAgICAgIFtbMTY2LCA2XV0sCiAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICBbWzYxLCA0XV0sCiAgICAgICAgICAgIFtbNjQsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMjAsIDFdXSwKICAgICAgICAgICAgW1s0OCwgMl1dLAogICAgICAgICAgICBbWzgwLCAzXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTY3LCA0XSwKICAgICAgICAgICAgICBbMTY4LCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OCwgNl1dLAogICAgICAgICAgICBbWzQ4LCA3XV0sCiAgICAgICAgICAgIFtbODAsIDhdXSwKICAgICAgICAgICAgW1s4MCwgOV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE2NywgNF0sCiAgICAgICAgICAgICAgWzEyNywgMTBdLAogICAgICAgICAgICAgIFsxNjgsIDVdLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA5XV0sCiAgICAgICAgICAgIFtbNDgsIDExXV0sCiAgICAgICAgICAgIFtbODAsIDEyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTY4LCA1XSwKICAgICAgICAgICAgICBbMCwgMTJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNSwgMV0sCiAgICAgICAgICAgICAgWzE2OSwgMl0sCiAgICAgICAgICAgICAgWzUzLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNjksIDRdLAogICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUwLCA2XSwKICAgICAgICAgICAgICBbNTIsIDddLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1sxNjksIDhdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE2OSwgOV0sCiAgICAgICAgICAgICAgWzUzLCAzXSwKICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDEwXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTUsIDExXSwKICAgICAgICAgICAgICBbMTY5LCAyXSwKICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgIFswLCA3XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMTJdLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MCwgMTNdLAogICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgWzAsIDldLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA3XSwKICAgICAgICAgICAgICBbMCwgMTBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE2OSwgMTRdLAogICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgIFswLCAxMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMTJdXSwKICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgWzAsIDE0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNjksIDE2XSwKICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgIFswLCAxNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDE3XSwKICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICBbMCwgMTZdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCAxNF1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNSwgMV0sCiAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICBbMTcwLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNzAsIDVdLAogICAgICAgICAgICAgIFs1MiwgNF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzE3MCwgNl1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUwLCA3XSwKICAgICAgICAgICAgICBbNTIsIDhdLAogICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgWzE3MCwgOV0sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA0XSwKICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDEwXSwKICAgICAgICAgICAgICBbMCwgNl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDExXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTUsIDEyXSwKICAgICAgICAgICAgICBbNTMsIDJdLAogICAgICAgICAgICAgIFsxNzAsIDNdLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MCwgMTNdLAogICAgICAgICAgICAgIFs1MiwgNF0sCiAgICAgICAgICAgICAgWzAsIDldLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDEwXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDhdLAogICAgICAgICAgICAgIFswLCAxMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICBbMTcwLCAxNF0sCiAgICAgICAgICAgICAgWzAsIDEyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgWzAsIDE0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgWzE3MCwgMTZdLAogICAgICAgICAgICAgIFswLCAxNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDE3XSwKICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICBbMCwgMTZdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCAxNF1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzI1LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syMSwgMV1dLAogICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgIFtbNDgsIDNdXSwKICAgICAgICAgICAgW1s4MCwgNF1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEyNywgNV0sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ4LCA2XV0sCiAgICAgICAgICAgIFtbODAsIDddXSwKICAgICAgICAgICAgW1swLCA3XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQ5LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTA4LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbOTUsIDNdXSwKICAgICAgICAgICAgW1swLCAzXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQyLCAxXV0sCiAgICAgICAgICAgIFtbMTcxLCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgIFs1MiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE3MiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE3MywgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMTEsIDJdLAogICAgICAgICAgICAgIFszNiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDJdXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzMxLCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTc0LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzYyLCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICBdLAogICAgICAgIGxhYmVsczogWwogICAgICAgICAgWzAsICJFTVBUWSJdLAogICAgICAgICAgWzMxNywgbnVsbF0sCiAgICAgICAgICBbNCwgbnVsbF0sCiAgICAgICAgICBbMjc2LCBudWxsXSwKICAgICAgICAgIFsxLCAiZGVmIl0sCiAgICAgICAgICBbMSwgInJhaXNlIl0sCiAgICAgICAgICBbMSwgIlRydWUiXSwKICAgICAgICAgIFszLCBudWxsXSwKICAgICAgICAgIFsxLCAibm90Il0sCiAgICAgICAgICBbMSwgIm51bGwiXSwKICAgICAgICAgIFs1NSwgbnVsbF0sCiAgICAgICAgICBbMiwgbnVsbF0sCiAgICAgICAgICBbMjUsIG51bGxdLAogICAgICAgICAgWzEsICJjbGFzcyJdLAogICAgICAgICAgWzEsICJsYW1iZGEiXSwKICAgICAgICAgIFsxNiwgbnVsbF0sCiAgICAgICAgICBbMSwgInByaW50Il0sCiAgICAgICAgICBbMSwgImRlYnVnZ2VyIl0sCiAgICAgICAgICBbMSwgIm5vbmxvY2FsIl0sCiAgICAgICAgICBbNTIsIG51bGxdLAogICAgICAgICAgWzEsICJ0cnkiXSwKICAgICAgICAgIFsxLCAid2hpbGUiXSwKICAgICAgICAgIFszMSwgbnVsbF0sCiAgICAgICAgICBbMSwgInJldHVybiJdLAogICAgICAgICAgWzEsICJhc3NlcnQiXSwKICAgICAgICAgIFsxLCBudWxsXSwKICAgICAgICAgIFsxLCAiZ2xvYmFsIl0sCiAgICAgICAgICBbMSwgImRlbCJdLAogICAgICAgICAgWzEsICJwYXNzIl0sCiAgICAgICAgICBbNTQsIG51bGxdLAogICAgICAgICAgWzE1LCBudWxsXSwKICAgICAgICAgIFsxLCAieWllbGQiXSwKICAgICAgICAgIFsxLCAiaW1wb3J0Il0sCiAgICAgICAgICBbMSwgIkZhbHNlIl0sCiAgICAgICAgICBbMSwgImZvciJdLAogICAgICAgICAgWzcsIG51bGxdLAogICAgICAgICAgWzEsICJmcm9tIl0sCiAgICAgICAgICBbMSwgImlmIl0sCiAgICAgICAgICBbOSwgbnVsbF0sCiAgICAgICAgICBbMSwgImJyZWFrIl0sCiAgICAgICAgICBbMSwgImNvbnRpbnVlIl0sCiAgICAgICAgICBbNDksIG51bGxdLAogICAgICAgICAgWzEsICJ3aXRoIl0sCiAgICAgICAgICBbMTQsIG51bGxdLAogICAgICAgICAgWzMxNiwgbnVsbF0sCiAgICAgICAgICBbMTksIG51bGxdLAogICAgICAgICAgWzMwOCwgbnVsbF0sCiAgICAgICAgICBbMSwgImFuZCJdLAogICAgICAgICAgWzExLCBudWxsXSwKICAgICAgICAgIFszMjYsIG51bGxdLAogICAgICAgICAgWzIyLCBudWxsXSwKICAgICAgICAgIFsyNjEsIG51bGxdLAogICAgICAgICAgWzEyLCBudWxsXSwKICAgICAgICAgIFszNSwgbnVsbF0sCiAgICAgICAgICBbMjcxLCBudWxsXSwKICAgICAgICAgIFszMjUsIG51bGxdLAogICAgICAgICAgWzI5NywgbnVsbF0sCiAgICAgICAgICBbMzM5LCBudWxsXSwKICAgICAgICAgIFsyOTYsIG51bGxdLAogICAgICAgICAgWzI2LCBudWxsXSwKICAgICAgICAgIFsyODMsIG51bGxdLAogICAgICAgICAgWzgsIG51bGxdLAogICAgICAgICAgWzM0MiwgbnVsbF0sCiAgICAgICAgICBbMzI5LCBudWxsXSwKICAgICAgICAgIFsxMCwgbnVsbF0sCiAgICAgICAgICBbMjY2LCBudWxsXSwKICAgICAgICAgIFszMzIsIG51bGxdLAogICAgICAgICAgWzQ1LCBudWxsXSwKICAgICAgICAgIFszOCwgbnVsbF0sCiAgICAgICAgICBbNDAsIG51bGxdLAogICAgICAgICAgWzUwLCBudWxsXSwKICAgICAgICAgIFs0NiwgbnVsbF0sCiAgICAgICAgICBbNDEsIG51bGxdLAogICAgICAgICAgWzQyLCBudWxsXSwKICAgICAgICAgIFszNiwgbnVsbF0sCiAgICAgICAgICBbNDMsIG51bGxdLAogICAgICAgICAgWzQ4LCBudWxsXSwKICAgICAgICAgIFs0NCwgbnVsbF0sCiAgICAgICAgICBbMzcsIG51bGxdLAogICAgICAgICAgWzM5LCBudWxsXSwKICAgICAgICAgIFszMjQsIG51bGxdLAogICAgICAgICAgWzI2MCwgbnVsbF0sCiAgICAgICAgICBbMjkyLCBudWxsXSwKICAgICAgICAgIFsxLCAiaW4iXSwKICAgICAgICAgIFszMDksIG51bGxdLAogICAgICAgICAgWzI3MywgbnVsbF0sCiAgICAgICAgICBbMzI3LCBudWxsXSwKICAgICAgICAgIFsyNzIsIG51bGxdLAogICAgICAgICAgWzI4LCBudWxsXSwKICAgICAgICAgIFsyMSwgbnVsbF0sCiAgICAgICAgICBbMjcsIG51bGxdLAogICAgICAgICAgWzI5LCBudWxsXSwKICAgICAgICAgIFsxLCAiaXMiXSwKICAgICAgICAgIFszMCwgbnVsbF0sCiAgICAgICAgICBbMjAsIG51bGxdLAogICAgICAgICAgWzI5MCwgbnVsbF0sCiAgICAgICAgICBbMjc0LCBudWxsXSwKICAgICAgICAgIFszMzMsIG51bGxdLAogICAgICAgICAgWzI5OSwgbnVsbF0sCiAgICAgICAgICBbMjcwLCBudWxsXSwKICAgICAgICAgIFszMzcsIG51bGxdLAogICAgICAgICAgWzI3OSwgbnVsbF0sCiAgICAgICAgICBbMjY1LCBudWxsXSwKICAgICAgICAgIFsyODEsIG51bGxdLAogICAgICAgICAgWzI2NCwgbnVsbF0sCiAgICAgICAgICBbMjg2LCBudWxsXSwKICAgICAgICAgIFsyODAsIG51bGxdLAogICAgICAgICAgWzMyMCwgbnVsbF0sCiAgICAgICAgICBbMSwgImFzIl0sCiAgICAgICAgICBbMjg0LCBudWxsXSwKICAgICAgICAgIFsyMywgbnVsbF0sCiAgICAgICAgICBbMzI4LCBudWxsXSwKICAgICAgICAgIFswLCBudWxsXSwKICAgICAgICAgIFsxLCAiZXhjZXB0Il0sCiAgICAgICAgICBbMzQwLCBudWxsXSwKICAgICAgICAgIFsxOCwgbnVsbF0sCiAgICAgICAgICBbMzMwLCBudWxsXSwKICAgICAgICAgIFsyNjgsIG51bGxdLAogICAgICAgICAgWzI1OSwgbnVsbF0sCiAgICAgICAgICBbMzEyLCBudWxsXSwKICAgICAgICAgIFsyOTMsIG51bGxdLAogICAgICAgICAgWzMyMSwgbnVsbF0sCiAgICAgICAgICBbMjY5LCBudWxsXSwKICAgICAgICAgIFsyNzcsIG51bGxdLAogICAgICAgICAgWzMxNCwgbnVsbF0sCiAgICAgICAgICBbMzE1LCBudWxsXSwKICAgICAgICAgIFszNDMsIG51bGxdLAogICAgICAgICAgWzEsICJlbHNlIl0sCiAgICAgICAgICBbMzEwLCBudWxsXSwKICAgICAgICAgIFs1MSwgbnVsbF0sCiAgICAgICAgICBbMSwgImVsaWYiXSwKICAgICAgICAgIFszMDAsIG51bGxdLAogICAgICAgICAgWzMwMSwgbnVsbF0sCiAgICAgICAgICBbMjg1LCBudWxsXSwKICAgICAgICAgIFszMDMsIG51bGxdLAogICAgICAgICAgWzMwMiwgbnVsbF0sCiAgICAgICAgICBbMzM1LCBudWxsXSwKICAgICAgICAgIFsyNzUsIG51bGxdLAogICAgICAgICAgWzI1OCwgbnVsbF0sCiAgICAgICAgICBbMSwgIm9yIl0sCiAgICAgICAgICBbMzM0LCBudWxsXSwKICAgICAgICAgIFsyNjcsIG51bGxdLAogICAgICAgICAgWzM0LCBudWxsXSwKICAgICAgICAgIFsyNjIsIG51bGxdLAogICAgICAgICAgWzMzLCBudWxsXSwKICAgICAgICAgIFszMTksIG51bGxdLAogICAgICAgICAgWzEzLCBudWxsXSwKICAgICAgICAgIFsyOTUsIG51bGxdLAogICAgICAgICAgWzI2MywgbnVsbF0sCiAgICAgICAgICBbMjkxLCBudWxsXSwKICAgICAgICAgIFszMTEsIG51bGxdLAogICAgICAgICAgWzMwNywgbnVsbF0sCiAgICAgICAgICBbMzEzLCBudWxsXSwKICAgICAgICAgIFsyODIsIG51bGxdLAogICAgICAgICAgWzI5OCwgbnVsbF0sCiAgICAgICAgICBbMzA0LCBudWxsXSwKICAgICAgICAgIFsyNzgsIG51bGxdLAogICAgICAgICAgWzMxOCwgbnVsbF0sCiAgICAgICAgICBbMzIyLCBudWxsXSwKICAgICAgICAgIFs1LCBudWxsXSwKICAgICAgICAgIFs2LCBudWxsXSwKICAgICAgICAgIFs0NywgbnVsbF0sCiAgICAgICAgICBbMTcsIG51bGxdLAogICAgICAgICAgWzI0LCBudWxsXSwKICAgICAgICAgIFszMDUsIG51bGxdLAogICAgICAgICAgWzMwNiwgbnVsbF0sCiAgICAgICAgICBbMzIzLCBudWxsXSwKICAgICAgICAgIFsyODksIG51bGxdLAogICAgICAgICAgWzEsICJmaW5hbGx5Il0sCiAgICAgICAgICBbMzMxLCBudWxsXSwKICAgICAgICAgIFszMzYsIG51bGxdLAogICAgICAgICAgWzMzOCwgbnVsbF0sCiAgICAgICAgICBbMjU3LCBudWxsXSwKICAgICAgICAgIFszMiwgbnVsbF0sCiAgICAgICAgICBbMzQxLCBudWxsXSwKICAgICAgICBdLAogICAgICAgIGtleXdvcmRzOiB7CiAgICAgICAgICBGYWxzZTogMzMsCiAgICAgICAgICBudWxsOiA5LAogICAgICAgICAgVHJ1ZTogNiwKICAgICAgICAgIGFuZDogNDcsCiAgICAgICAgICBhczogMTA4LAogICAgICAgICAgYXNzZXJ0OiAyNCwKICAgICAgICAgIGJyZWFrOiAzOSwKICAgICAgICAgIGNsYXNzOiAxMywKICAgICAgICAgIGNvbnRpbnVlOiA0MCwKICAgICAgICAgIGRlYnVnZ2VyOiAxNywKICAgICAgICAgIGRlZjogNCwKICAgICAgICAgIGRlbDogMjcsCiAgICAgICAgICBlbGlmOiAxMzAsCiAgICAgICAgICBlbHNlOiAxMjcsCiAgICAgICAgICBleGNlcHQ6IDExMywKICAgICAgICAgIGZpbmFsbHk6IDE2OCwKICAgICAgICAgIGZvcjogMzQsCiAgICAgICAgICBmcm9tOiAzNiwKICAgICAgICAgIGdsb2JhbDogMjYsCiAgICAgICAgICBpZjogMzcsCiAgICAgICAgICBpbXBvcnQ6IDMyLAogICAgICAgICAgaW46IDgzLAogICAgICAgICAgaXM6IDkyLAogICAgICAgICAgbGFtYmRhOiAxNCwKICAgICAgICAgIG5vbmxvY2FsOiAxOCwKICAgICAgICAgIG5vdDogOCwKICAgICAgICAgIG9yOiAxMzksCiAgICAgICAgICBwYXNzOiAyOCwKICAgICAgICAgIHByaW50OiAxNiwKICAgICAgICAgIHJhaXNlOiA1LAogICAgICAgICAgcmV0dXJuOiAyMywKICAgICAgICAgIHRyeTogMjAsCiAgICAgICAgICB3aGlsZTogMjEsCiAgICAgICAgICB3aXRoOiA0MiwKICAgICAgICAgIHlpZWxkOiAzMSwKICAgICAgICB9LAogICAgICAgIHRva2VuczogewogICAgICAgICAgMDogMTEyLAogICAgICAgICAgMTogMjUsCiAgICAgICAgICAyOiAxMSwKICAgICAgICAgIDM6IDcsCiAgICAgICAgICA0OiAyLAogICAgICAgICAgNTogMTU5LAogICAgICAgICAgNjogMTYwLAogICAgICAgICAgNzogMzUsCiAgICAgICAgICA4OiA2MSwKICAgICAgICAgIDk6IDM4LAogICAgICAgICAgMTA6IDY0LAogICAgICAgICAgMTE6IDQ4LAogICAgICAgICAgMTI6IDUyLAogICAgICAgICAgMTM6IDE0NiwKICAgICAgICAgIDE0OiA0MywKICAgICAgICAgIDE1OiAzMCwKICAgICAgICAgIDE2OiAxNSwKICAgICAgICAgIDE3OiAxNjIsCiAgICAgICAgICAxODogMTE1LAogICAgICAgICAgMTk6IDQ1LAogICAgICAgICAgMjA6IDk0LAogICAgICAgICAgMjE6IDg5LAogICAgICAgICAgMjI6IDUwLAogICAgICAgICAgMjM6IDExMCwKICAgICAgICAgIDI0OiAxNjMsCiAgICAgICAgICAyNTogMTIsCiAgICAgICAgICAyNjogNTksCiAgICAgICAgICAyNzogOTAsCiAgICAgICAgICAyODogODgsCiAgICAgICAgICAyOTogOTEsCiAgICAgICAgICAzMDogOTMsCiAgICAgICAgICAzMTogMjIsCiAgICAgICAgICAzMjogMTczLAogICAgICAgICAgMzM6IDE0NCwKICAgICAgICAgIDM0OiAxNDIsCiAgICAgICAgICAzNTogNTMsCiAgICAgICAgICAzNjogNzQsCiAgICAgICAgICAzNzogNzgsCiAgICAgICAgICAzODogNjgsCiAgICAgICAgICAzOTogNzksCiAgICAgICAgICA0MDogNjksCiAgICAgICAgICA0MTogNzIsCiAgICAgICAgICA0MjogNzMsCiAgICAgICAgICA0MzogNzUsCiAgICAgICAgICA0NDogNzcsCiAgICAgICAgICA0NTogNjcsCiAgICAgICAgICA0NjogNzEsCiAgICAgICAgICA0NzogMTYxLAogICAgICAgICAgNDg6IDc2LAogICAgICAgICAgNDk6IDQxLAogICAgICAgICAgNTA6IDcwLAogICAgICAgICAgNTE6IDEyOSwKICAgICAgICAgIDUyOiAxOSwKICAgICAgICAgIDU0OiAyOSwKICAgICAgICAgIDU1OiAxMCwKICAgICAgICB9LAogICAgICAgIHN0YXJ0OiAyNTYsCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIGZ1bmN0aW9uIGEoYSwgYikgewogICAgICAgIHRoaXMuZmlsZW5hbWUgPSBhCiAgICAgICAgdGhpcy5ncmFtbWFyID0gYgogICAgICAgIHRoaXMucF9mbGFncyA9IDAKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGIoYiwgZCkgewogICAgICAgIHZvaWQgMCA9PT0gZCAmJiAoZCA9ICJmaWxlX2lucHV0IikKICAgICAgICBiID0gbmV3IGEoYiwgU2suUGFyc2VUYWJsZXMpCiAgICAgICAgImZpbGVfaW5wdXQiID09PSBkCiAgICAgICAgICA/IGIuc2V0dXAoU2suUGFyc2VUYWJsZXMuc3ltLmZpbGVfaW5wdXQpCiAgICAgICAgICA6IFNrLmFzc2VydHMuZmFpbCgidG9kbzsiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgYS5GVVRVUkVfUFJJTlRfRlVOQ1RJT04gPSAicHJpbnRfZnVuY3Rpb24iCiAgICAgIGEuRlVUVVJFX1VOSUNPREVfTElURVJBTFMgPSAidW5pY29kZV9saXRlcmFscyIKICAgICAgYS5GVVRVUkVfRElWSVNJT04gPSAiZGl2aXNpb24iCiAgICAgIGEuRlVUVVJFX0FCU09MVVRFX0lNUE9SVCA9ICJhYnNvbHV0ZV9pbXBvcnQiCiAgICAgIGEuRlVUVVJFX1dJVEhfU1RBVEVNRU5UID0gIndpdGhfc3RhdGVtZW50IgogICAgICBhLkZVVFVSRV9ORVNURURfU0NPUEVTID0gIm5lc3RlZF9zY29wZXMiCiAgICAgIGEuRlVUVVJFX0dFTkVSQVRPUlMgPSAiZ2VuZXJhdG9ycyIKICAgICAgYS5DT19GVVRVUkVfUFJJTlRfRlVOQ1RJT04gPSA2NTUzNgogICAgICBhLkNPX0ZVVFVSRV9VTklDT0RFX0xJVEVSQUxTID0gMTMxMDcyCiAgICAgIGEuQ09fRlVUVVJFX0RJVklTT04gPSA4MTkyCiAgICAgIGEuQ09fRlVUVVJFX0FCU09MVVRFX0lNUE9SVCA9IDE2Mzg0CiAgICAgIGEuQ09fRlVUVVJFX1dJVEhfU1RBVEVNRU5UID0gMzI3NjgKICAgICAgYS5wcm90b3R5cGUuc2V0dXAgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IGEgfHwgdGhpcy5ncmFtbWFyLnN0YXJ0CiAgICAgICAgdGhpcy5zdGFjayA9IFsKICAgICAgICAgIHsKICAgICAgICAgICAgZGZhOiB0aGlzLmdyYW1tYXIuZGZhc1thXSwKICAgICAgICAgICAgc3RhdGU6IDAsCiAgICAgICAgICAgIG5vZGU6IHsgdHlwZTogYSwgdmFsdWU6IG51bGwsIGNvbnRleHQ6IG51bGwsIGNoaWxkcmVuOiBbXSB9LAogICAgICAgICAgfSwKICAgICAgICBdCiAgICAgICAgdGhpcy51c2VkX25hbWVzID0ge30KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5hZGR0b2tlbiA9IGZ1bmN0aW9uKGEsIGIsIGUpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQgPSB0aGlzLmNsYXNzaWZ5KGEsIGIsIGUpCiAgICAgICAgYTogZm9yICg7OykgewogICAgICAgICAgdmFyIGggPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0KICAgICAgICAgIHZhciBrID0gaC5kZmFbMF0KICAgICAgICAgIHZhciBsID0ga1toLnN0YXRlXQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGwubGVuZ3RoOyArK2MpIHsKICAgICAgICAgICAgdmFyIHIgPSBsW2NdWzBdCiAgICAgICAgICAgIHZhciBuID0gbFtjXVsxXQogICAgICAgICAgICB2YXIgcSA9IHRoaXMuZ3JhbW1hci5sYWJlbHNbcl1bMF0KICAgICAgICAgICAgaWYgKGQgPT09IHIpIHsKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgyNTYgPiBxKQogICAgICAgICAgICAgIHRoaXMuc2hpZnQoYSwgYiwgbiwgZSkKICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgZSA9IG47CiAgICAgICAgICAgICAgICAxID09PSBrW2VdLmxlbmd0aCAmJiAwID09PSBrW2VdWzBdWzBdICYmIGtbZV1bMF1bMV0gPT09IGU7CgogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5wb3AoKQogICAgICAgICAgICAgICAgaWYgKDAgPT09IHRoaXMuc3RhY2subGVuZ3RoKSByZXR1cm4gITAKICAgICAgICAgICAgICAgIGggPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0KICAgICAgICAgICAgICAgIGUgPSBoLnN0YXRlCiAgICAgICAgICAgICAgICBrID0gaC5kZmFbMF0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIDI1NiA8PSBxICYmCiAgICAgICAgICAgICAgKChyID0gdGhpcy5ncmFtbWFyLmRmYXNbcV0pLCAociA9IHJbMV0pLCByLmhhc093blByb3BlcnR5KGQpKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLnB1c2gocSwgdGhpcy5ncmFtbWFyLmRmYXNbcV0sIG4sIGUpCiAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBiOiB7CiAgICAgICAgICAgIGsgPSBbMCwgaC5zdGF0ZV0KICAgICAgICAgICAgZm9yIChoID0gbC5sZW5ndGg7IGgtLTsgKQogICAgICAgICAgICAgIGlmIChsW2hdWzBdID09PSBrWzBdICYmIGxbaF1bMV0gPT09IGtbMV0pIHsKICAgICAgICAgICAgICAgIGwgPSAhMAogICAgICAgICAgICAgICAgYnJlYWsgYgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgbCA9ICExCiAgICAgICAgICB9CiAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICBpZiAoKHRoaXMucG9wKCksIDAgPT09IHRoaXMuc3RhY2subGVuZ3RoKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigidG9vIG11Y2ggaW5wdXQiLCB0aGlzLmZpbGVuYW1lKQogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRocm93ICgoYSA9IGVbMF1bMF0pLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigiYmFkIGlucHV0IiwgdGhpcy5maWxlbmFtZSwgYSwgZSkpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNsYXNzaWZ5ID0gZnVuY3Rpb24oYiwgZCwgZSkgewogICAgICAgIGlmIChiID09PSBTay50b2tlbi50b2tlbnMuVF9OQU1FKSB7CiAgICAgICAgICB0aGlzLnVzZWRfbmFtZXNbZF0gPSAhMAogICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICB0aGlzLmdyYW1tYXIua2V5d29yZHMuaGFzT3duUHJvcGVydHkoZCkgJiYgdGhpcy5ncmFtbWFyLmtleXdvcmRzW2RdCiAgICAgICAgICAicHJpbnQiID09PSBkICYmCiAgICAgICAgICAgICh0aGlzLnBfZmxhZ3MgJiBhLkNPX0ZVVFVSRV9QUklOVF9GVU5DVElPTiB8fAogICAgICAgICAgICAgICEwID09PSBTay5fX2Z1dHVyZV9fLnByaW50X2Z1bmN0aW9uKSAmJgogICAgICAgICAgICAoYyA9ICExKQogICAgICAgICAgaWYgKGMpIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGMgPSB0aGlzLmdyYW1tYXIudG9rZW5zLmhhc093blByb3BlcnR5KGIpICYmIHRoaXMuZ3JhbW1hci50b2tlbnNbYl0KICAgICAgICBpZiAoIWMpIHsKICAgICAgICAgIGQgPSAiIyIgKyBiCiAgICAgICAgICBmb3IgKGxldCBhIGluIFNrLnRva2VuLnRva2VucykKICAgICAgICAgICAgaWYgKFNrLnRva2VuLnRva2Vuc1thXSA9PSBiKSB7CiAgICAgICAgICAgICAgZCA9IGEKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgImJhZCB0b2tlbiAiICsgZCwKICAgICAgICAgICAgdGhpcy5maWxlbmFtZSwKICAgICAgICAgICAgZVswXVswXSwKICAgICAgICAgICAgZSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uKGEsIGIsIGUsIGYpIHsKICAgICAgICB2YXIgYyA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5kZmEsCiAgICAgICAgICBkID0gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdLm5vZGUKICAgICAgICBkLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgdHlwZTogYSwKICAgICAgICAgIHZhbHVlOiBiLAogICAgICAgICAgbGluZW5vOiBmWzBdWzBdLAogICAgICAgICAgY29sX29mZnNldDogZlswXVsxXSwKICAgICAgICAgIGNoaWxkcmVuOiBudWxsLAogICAgICAgIH0pCiAgICAgICAgdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdID0geyBkZmE6IGMsIHN0YXRlOiBlLCBub2RlOiBkIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oYSwgYiwgZSwgZikgewogICAgICAgIGEgPSB7CiAgICAgICAgICB0eXBlOiBhLAogICAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgICBsaW5lbm86IGZbMF1bMF0sCiAgICAgICAgICBjb2xfb2Zmc2V0OiBmWzBdWzFdLAogICAgICAgICAgY2hpbGRyZW46IFtdLAogICAgICAgIH0KICAgICAgICB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0gPSB7CiAgICAgICAgICBkZmE6IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5kZmEsCiAgICAgICAgICBzdGF0ZTogZSwKICAgICAgICAgIG5vZGU6IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5ub2RlLAogICAgICAgIH0KICAgICAgICB0aGlzLnN0YWNrLnB1c2goeyBkZmE6IGIsIHN0YXRlOiAwLCBub2RlOiBhIH0pCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLnN0YWNrLnBvcCgpLm5vZGUKICAgICAgICBpZiAoYSkKICAgICAgICAgIGlmICgwICE9PSB0aGlzLnN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgYiA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5ub2RlCiAgICAgICAgICAgIGIuY2hpbGRyZW4ucHVzaChhKQogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICh0aGlzLnJvb3Rub2RlID0gYSksICh0aGlzLnJvb3Rub2RlLnVzZWRfbmFtZXMgPSB0aGlzLnVzZWRfbmFtZXMpCiAgICAgIH0KICAgICAgU2sucGFyc2UgPSBmdW5jdGlvbihhLCBkKSB7CiAgICAgICAgdmFyIGMgPSBTay50b2tlbi50b2tlbnMuVF9DT01NRU5ULAogICAgICAgICAgZiA9IFNrLnRva2VuLnRva2Vucy5UX05MLAogICAgICAgICAgZyA9IFNrLnRva2VuLnRva2Vucy5UX09QLAogICAgICAgICAgaCA9IFNrLnRva2VuLnRva2Vucy5UX0VORE1BUktFUiwKICAgICAgICAgIGsgPSBTay50b2tlbi50b2tlbnMuVF9FTkNPRElORywKICAgICAgICAgIGwgPSAhMSwKICAgICAgICAgIHIgPSBiKGEpCiAgICAgICAgU2suX3Rva2VuaXplKAogICAgICAgICAgYSwKICAgICAgICAgIChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHZhciBiID0gYQogICAgICAgICAgICAgIC5zcGxpdCgiXG4iKQogICAgICAgICAgICAgIC5yZXZlcnNlKCkKICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhICsgIlxuIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBpZiAoMCA9PT0gYi5sZW5ndGgpIHRocm93IG5ldyBTay5idWlsdGluLkV4Y2VwdGlvbigiRU9GIikKICAgICAgICAgICAgICByZXR1cm4gYi5wb3AoKQogICAgICAgICAgICB9CiAgICAgICAgICB9KShkKSwKICAgICAgICAgICJ1dGYtOCIsCiAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHZhciBiID0gbnVsbAogICAgICAgICAgICBhLnR5cGUgIT09IGMgJiYKICAgICAgICAgICAgICBhLnR5cGUgIT09IGYgJiYKICAgICAgICAgICAgICBhLnR5cGUgIT09IGsgJiYKICAgICAgICAgICAgICAoYS50eXBlID09PSBnICYmIChiID0gU2suT3BNYXBbYS5zdHJpbmddKSwKICAgICAgICAgICAgICByLmFkZHRva2VuKGIgfHwgYS50eXBlLCBhLnN0cmluZywgW2Euc3RhcnQsIGEuZW5kLCBhLmxpbmVdKSwKICAgICAgICAgICAgICBhLnR5cGUgPT09IGggJiYgKGwgPSAhMCkpCiAgICAgICAgICB9LAogICAgICAgICkKICAgICAgICBpZiAoIWwpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigiaW5jb21wbGV0ZSBpbnB1dCIsIHRoaXMuZmlsZW5hbWUpCiAgICAgICAgcmV0dXJuIHsgY3N0OiByLnJvb3Rub2RlLCBmbGFnczogci5wX2ZsYWdzIH0KICAgICAgfQogICAgICBTay5wYXJzZVRyZWVEdW1wID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgYiA9IGIgfHwgIiIKICAgICAgICB2YXIgZCA9ICIiICsgYgogICAgICAgIGlmICgyNTYgPD0gYS50eXBlKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZCArPSBTay5QYXJzZVRhYmxlcy5udW1iZXIyc3ltYm9sW2EudHlwZV0gKyAiXG4iLCBjID0gMDsKICAgICAgICAgICAgYyA8IGEuY2hpbGRyZW4ubGVuZ3RoOwogICAgICAgICAgICArK2MKICAgICAgICAgICkKICAgICAgICAgICAgZCArPSBTay5wYXJzZVRyZWVEdW1wKGEuY2hpbGRyZW5bY10sIGIgKyAiICAiKQogICAgICAgIGVsc2UKICAgICAgICAgIGQgKz0KICAgICAgICAgICAgU2sudG9rZW4udG9rX25hbWVbYS50eXBlXSArCiAgICAgICAgICAgICI6ICIgKwogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoYS52YWx1ZSkuJHIoKS52ICsKICAgICAgICAgICAgIlxuIgogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5QYXJzZXIiLCBhKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnBhcnNlIiwgU2sucGFyc2UpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sucGFyc2VUcmVlRHVtcCIsIFNrLnBhcnNlVHJlZUR1bXApCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5hc3Rub2RlcyA9IHt9CiAgICAgIFNrLmFzdG5vZGVzLkxvYWQgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLlN0b3JlID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5EZWwgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkF1Z0xvYWQgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkF1Z1N0b3JlID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5QYXJhbSA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuQW5kID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5PciA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuQWRkID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5TdWIgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk11bHQgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk1hdE11bHQgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkRpdiA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuTW9kID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5Qb3cgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkxTaGlmdCA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuUlNoaWZ0ID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5CaXRPciA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuQml0WG9yID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5CaXRBbmQgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkZsb29yRGl2ID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5JbnZlcnQgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk5vdCA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuVUFkZCA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuVVN1YiA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuRXEgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk5vdEVxID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5MdCA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuTHRFID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5HdCA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuR3RFID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5JcyA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuSXNOb3QgPSBmdW5jdGlvbigpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkluID0gZnVuY3Rpb24oKSB7fQogICAgICBTay5hc3Rub2Rlcy5Ob3RJbiA9IGZ1bmN0aW9uKCkge30KICAgICAgU2suYXN0bm9kZXMuTW9kdWxlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHRoaXMuYm9keSA9IGEKICAgICAgICB0aGlzLmRvY3N0cmluZyA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkludGVyYWN0aXZlID0gZnVuY3Rpb24oYSkgewogICAgICAgIHRoaXMuYm9keSA9IGEKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkV4cHJlc3Npb24gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy5ib2R5ID0gYQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU3VpdGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy5ib2R5ID0gYQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWYgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZyAmJiB2b2lkIDAgIT09IGcpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gaCAmJiB2b2lkIDAgIT09IGgpCiAgICAgICAgdGhpcy5uYW1lID0gYQogICAgICAgIHRoaXMuYXJncyA9IGIKICAgICAgICB0aGlzLmJvZHkgPSBjCiAgICAgICAgdGhpcy5kZWNvcmF0b3JfbGlzdCA9IGQKICAgICAgICB0aGlzLnJldHVybnMgPSBlCiAgICAgICAgdGhpcy5kb2NzdHJpbmcgPSBmCiAgICAgICAgdGhpcy5saW5lbm8gPSBnCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gaAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQXN5bmNGdW5jdGlvbkRlZiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBnICYmIHZvaWQgMCAhPT0gZykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBoICYmIHZvaWQgMCAhPT0gaCkKICAgICAgICB0aGlzLm5hbWUgPSBhCiAgICAgICAgdGhpcy5hcmdzID0gYgogICAgICAgIHRoaXMuYm9keSA9IGMKICAgICAgICB0aGlzLmRlY29yYXRvcl9saXN0ID0gZAogICAgICAgIHRoaXMucmV0dXJucyA9IGUKICAgICAgICB0aGlzLmRvY3N0cmluZyA9IGYKICAgICAgICB0aGlzLmxpbmVubyA9IGcKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBoCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5DbGFzc0RlZiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBnICYmIHZvaWQgMCAhPT0gZykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBoICYmIHZvaWQgMCAhPT0gaCkKICAgICAgICB0aGlzLm5hbWUgPSBhCiAgICAgICAgdGhpcy5iYXNlcyA9IGIKICAgICAgICB0aGlzLmtleXdvcmRzID0gYwogICAgICAgIHRoaXMuYm9keSA9IGQKICAgICAgICB0aGlzLmRlY29yYXRvcl9saXN0ID0gZQogICAgICAgIHRoaXMuZG9jc3RyaW5nID0gZgogICAgICAgIHRoaXMubGluZW5vID0gZwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGgKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlJldHVybiA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnZhbHVlID0gYQogICAgICAgIHRoaXMubGluZW5vID0gYgogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkRlbGV0ZSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnRhcmdldHMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQXNzaWduID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMudGFyZ2V0cyA9IGEKICAgICAgICB0aGlzLnZhbHVlID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkF1Z0Fzc2lnbiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLnRhcmdldCA9IGEKICAgICAgICB0aGlzLm9wID0gYgogICAgICAgIHRoaXMudmFsdWUgPSBjCiAgICAgICAgdGhpcy5saW5lbm8gPSBkCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQW5uQXNzaWduID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGYgJiYgdm9pZCAwICE9PSBmKQogICAgICAgIHRoaXMudGFyZ2V0ID0gYQogICAgICAgIHRoaXMuYW5ub3RhdGlvbiA9IGIKICAgICAgICB0aGlzLnZhbHVlID0gYwogICAgICAgIHRoaXMuc2ltcGxlID0gZAogICAgICAgIHRoaXMubGluZW5vID0gZQogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkZvciA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBmICYmIHZvaWQgMCAhPT0gZikKICAgICAgICB0aGlzLnRhcmdldCA9IGEKICAgICAgICB0aGlzLml0ZXIgPSBiCiAgICAgICAgdGhpcy5ib2R5ID0gYwogICAgICAgIHRoaXMub3JlbHNlID0gZAogICAgICAgIHRoaXMubGluZW5vID0gZQogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkFzeW5jRm9yID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGYgJiYgdm9pZCAwICE9PSBmKQogICAgICAgIHRoaXMudGFyZ2V0ID0gYQogICAgICAgIHRoaXMuaXRlciA9IGIKICAgICAgICB0aGlzLmJvZHkgPSBjCiAgICAgICAgdGhpcy5vcmVsc2UgPSBkCiAgICAgICAgdGhpcy5saW5lbm8gPSBlCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuV2hpbGUgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy50ZXN0ID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLm9yZWxzZSA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5JZiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLnRlc3QgPSBhCiAgICAgICAgdGhpcy5ib2R5ID0gYgogICAgICAgIHRoaXMub3JlbHNlID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLldpdGggPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5pdGVtcyA9IGEKICAgICAgICB0aGlzLmJvZHkgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQXN5bmNXaXRoID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuaXRlbXMgPSBhCiAgICAgICAgdGhpcy5ib2R5ID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlJhaXNlID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGYgJiYgdm9pZCAwICE9PSBmKQogICAgICAgIHRoaXMuZXhjID0gYQogICAgICAgIHRoaXMuY2F1c2UgPSBiCiAgICAgICAgdGhpcy5pbnN0ID0gYwogICAgICAgIHRoaXMudGJhY2sgPSBkCiAgICAgICAgdGhpcy5saW5lbm8gPSBlCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuVHJ5ID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGYgJiYgdm9pZCAwICE9PSBmKQogICAgICAgIHRoaXMuYm9keSA9IGEKICAgICAgICB0aGlzLmhhbmRsZXJzID0gYgogICAgICAgIHRoaXMub3JlbHNlID0gYwogICAgICAgIHRoaXMuZmluYWxib2R5ID0gZAogICAgICAgIHRoaXMubGluZW5vID0gZQogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkFzc2VydCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLnRlc3QgPSBhCiAgICAgICAgdGhpcy5tc2cgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSW1wb3J0ID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMubmFtZXMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSW1wb3J0RnJvbSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLm1vZHVsZSA9IGEKICAgICAgICB0aGlzLm5hbWVzID0gYgogICAgICAgIHRoaXMubGV2ZWwgPSBjCiAgICAgICAgdGhpcy5saW5lbm8gPSBkCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuR2xvYmFsID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMubmFtZXMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTm9ubG9jYWwgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy5uYW1lcyA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5FeHByID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuUGFzcyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICB0aGlzLmxpbmVubyA9IGEKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5CcmVhayA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICB0aGlzLmxpbmVubyA9IGEKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Db250aW51ZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICB0aGlzLmxpbmVubyA9IGEKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5QcmludCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmRlc3QgPSBhCiAgICAgICAgdGhpcy52YWx1ZXMgPSBiCiAgICAgICAgdGhpcy5ubCA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5EZWJ1Z2dlciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICB0aGlzLmxpbmVubyA9IGEKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Cb29sT3AgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5vcCA9IGEKICAgICAgICB0aGlzLnZhbHVlcyA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5CaW5PcCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmxlZnQgPSBhCiAgICAgICAgdGhpcy5vcCA9IGIKICAgICAgICB0aGlzLnJpZ2h0ID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlVuYXJ5T3AgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5vcCA9IGEKICAgICAgICB0aGlzLm9wZXJhbmQgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTGFtYmRhID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuYXJncyA9IGEKICAgICAgICB0aGlzLmJvZHkgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSWZFeHAgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy50ZXN0ID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLm9yZWxzZSA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5EaWN0ID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMua2V5cyA9IGEKICAgICAgICB0aGlzLnZhbHVlcyA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TZXQgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy5lbHRzID0gYQogICAgICAgIHRoaXMubGluZW5vID0gYgogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkxpc3RDb21wID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuZWx0ID0gYQogICAgICAgIHRoaXMuZ2VuZXJhdG9ycyA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TZXRDb21wID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuZWx0ID0gYQogICAgICAgIHRoaXMuZ2VuZXJhdG9ycyA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5EaWN0Q29tcCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmtleSA9IGEKICAgICAgICB0aGlzLnZhbHVlID0gYgogICAgICAgIHRoaXMuZ2VuZXJhdG9ycyA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5HZW5lcmF0b3JFeHAgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5lbHQgPSBhCiAgICAgICAgdGhpcy5nZW5lcmF0b3JzID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkF3YWl0ID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuWWllbGQgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5ZaWVsZEZyb20gPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Db21wYXJlID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMubGVmdCA9IGEKICAgICAgICB0aGlzLm9wcyA9IGIKICAgICAgICB0aGlzLmNvbXBhcmF0b3JzID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkNhbGwgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy5mdW5jID0gYQogICAgICAgIHRoaXMuYXJncyA9IGIKICAgICAgICB0aGlzLmtleXdvcmRzID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLk51bSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLm4gPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU3RyID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMucyA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Gb3JtYXR0ZWRWYWx1ZSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLnZhbHVlID0gYQogICAgICAgIHRoaXMuY29udmVyc2lvbiA9IGIKICAgICAgICB0aGlzLmZvcm1hdF9zcGVjID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkpvaW5lZFN0ciA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnZhbHVlcyA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5CeXRlcyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50ID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRWxsaXBzaXMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgdGhpcy5saW5lbm8gPSBhCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQ29uc3RhbnQgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5BdHRyaWJ1dGUgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmF0dHIgPSBiCiAgICAgICAgdGhpcy5jdHggPSBjCiAgICAgICAgdGhpcy5saW5lbm8gPSBkCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU3Vic2NyaXB0ID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5zbGljZSA9IGIKICAgICAgICB0aGlzLmN0eCA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TdGFycmVkID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5jdHggPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTmFtZSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLmlkID0gYQogICAgICAgIHRoaXMuY3R4ID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkxpc3QgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5lbHRzID0gYQogICAgICAgIHRoaXMuY3R4ID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlR1cGxlID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuZWx0cyA9IGEKICAgICAgICB0aGlzLmN0eCA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TbGljZSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB0aGlzLmxvd2VyID0gYQogICAgICAgIHRoaXMudXBwZXIgPSBiCiAgICAgICAgdGhpcy5zdGVwID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRXh0U2xpY2UgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy5kaW1zID0gYQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSW5kZXggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLmNvbXByZWhlbnNpb24gPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgdGhpcy50YXJnZXQgPSBhCiAgICAgICAgdGhpcy5pdGVyID0gYgogICAgICAgIHRoaXMuaWZzID0gYwogICAgICAgIHRoaXMuaXNfYXN5bmMgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5FeGNlcHRIYW5kbGVyID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMudHlwZSA9IGEKICAgICAgICB0aGlzLm5hbWUgPSBiCiAgICAgICAgdGhpcy5ib2R5ID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLmFyZ3VtZW50c18gPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgdGhpcy5hcmdzID0gYQogICAgICAgIHRoaXMudmFyYXJnID0gYgogICAgICAgIHRoaXMua3dvbmx5YXJncyA9IGMKICAgICAgICB0aGlzLmt3X2RlZmF1bHRzID0gZAogICAgICAgIHRoaXMua3dhcmcgPSBlCiAgICAgICAgdGhpcy5kZWZhdWx0cyA9IGYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLmFyZyA9IGZ1bmN0aW9uIGEoYSwgYikgewogICAgICAgIHRoaXMuYXJnID0gYQogICAgICAgIHRoaXMuYW5ub3RhdGlvbiA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLmtleXdvcmQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdGhpcy5hcmcgPSBhCiAgICAgICAgdGhpcy52YWx1ZSA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLmFsaWFzID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHRoaXMubmFtZSA9IGEKICAgICAgICB0aGlzLmFzbmFtZSA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLndpdGhpdGVtID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHRoaXMuY29udGV4dF9leHByID0gYQogICAgICAgIHRoaXMub3B0aW9uYWxfdmFycyA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLk1vZHVsZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTW9kdWxlIgogICAgICBTay5hc3Rub2Rlcy5Nb2R1bGUucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJkb2NzdHJpbmciLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRvY3N0cmluZwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuSW50ZXJhY3RpdmUucHJvdG90eXBlLl9hc3RuYW1lID0gIkludGVyYWN0aXZlIgogICAgICBTay5hc3Rub2Rlcy5JbnRlcmFjdGl2ZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRXhwcmVzc2lvbi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRXhwcmVzc2lvbiIKICAgICAgU2suYXN0bm9kZXMuRXhwcmVzc2lvbi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuU3VpdGUucHJvdG90eXBlLl9hc3RuYW1lID0gIlN1aXRlIgogICAgICBTay5hc3Rub2Rlcy5TdWl0ZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWYucHJvdG90eXBlLl9hc3RuYW1lID0gIkZ1bmN0aW9uRGVmIgogICAgICBTay5hc3Rub2Rlcy5GdW5jdGlvbkRlZi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubmFtZQogICAgICAgIH0sCiAgICAgICAgImFyZ3MiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmFyZ3MKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAiZGVjb3JhdG9yX2xpc3QiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRlY29yYXRvcl9saXN0CiAgICAgICAgfSwKICAgICAgICAicmV0dXJucyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEucmV0dXJucwogICAgICAgIH0sCiAgICAgICAgImRvY3N0cmluZyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuZG9jc3RyaW5nCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Bc3luY0Z1bmN0aW9uRGVmLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3luY0Z1bmN0aW9uRGVmIgogICAgICBTay5hc3Rub2Rlcy5Bc3luY0Z1bmN0aW9uRGVmLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lCiAgICAgICAgfSwKICAgICAgICAiYXJncyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJncwogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJkZWNvcmF0b3JfbGlzdCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuZGVjb3JhdG9yX2xpc3QKICAgICAgICB9LAogICAgICAgICJyZXR1cm5zIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5yZXR1cm5zCiAgICAgICAgfSwKICAgICAgICAiZG9jc3RyaW5nIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5kb2NzdHJpbmcKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkNsYXNzRGVmLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJDbGFzc0RlZiIKICAgICAgU2suYXN0bm9kZXMuQ2xhc3NEZWYucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgIm5hbWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWUKICAgICAgICB9LAogICAgICAgICJiYXNlcyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYmFzZXMKICAgICAgICB9LAogICAgICAgICJrZXl3b3JkcyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEua2V5d29yZHMKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAiZGVjb3JhdG9yX2xpc3QiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRlY29yYXRvcl9saXN0CiAgICAgICAgfSwKICAgICAgICAiZG9jc3RyaW5nIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5kb2NzdHJpbmcKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLlJldHVybi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiUmV0dXJuIgogICAgICBTay5hc3Rub2Rlcy5SZXR1cm4ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRGVsZXRlLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJEZWxldGUiCiAgICAgIFNrLmFzdG5vZGVzLkRlbGV0ZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGFyZ2V0cyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGFyZ2V0cwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXNzaWduLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3NpZ24iCiAgICAgIFNrLmFzdG5vZGVzLkFzc2lnbi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGFyZ2V0cyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGFyZ2V0cwogICAgICAgIH0sCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXVnQXNzaWduLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBdWdBc3NpZ24iCiAgICAgIFNrLmFzdG5vZGVzLkF1Z0Fzc2lnbi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGFyZ2V0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS50YXJnZXQKICAgICAgICB9LAogICAgICAgICJvcCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEub3AKICAgICAgICB9LAogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkFubkFzc2lnbi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQW5uQXNzaWduIgogICAgICBTay5hc3Rub2Rlcy5Bbm5Bc3NpZ24ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRhcmdldCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGFyZ2V0CiAgICAgICAgfSwKICAgICAgICAiYW5ub3RhdGlvbiIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYW5ub3RhdGlvbgogICAgICAgIH0sCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgICAgInNpbXBsZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuc2ltcGxlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Gb3IucHJvdG90eXBlLl9hc3RuYW1lID0gIkZvciIKICAgICAgU2suYXN0bm9kZXMuRm9yLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ0YXJnZXQiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRhcmdldAogICAgICAgIH0sCiAgICAgICAgIml0ZXIiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLml0ZXIKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAib3JlbHNlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkFzeW5jRm9yLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3luY0ZvciIKICAgICAgU2suYXN0bm9kZXMuQXN5bmNGb3IucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRhcmdldCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGFyZ2V0CiAgICAgICAgfSwKICAgICAgICAiaXRlciIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuaXRlcgogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLm9yZWxzZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuV2hpbGUucHJvdG90eXBlLl9hc3RuYW1lID0gIldoaWxlIgogICAgICBTay5hc3Rub2Rlcy5XaGlsZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGVzdCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGVzdAogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLm9yZWxzZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuSWYucHJvdG90eXBlLl9hc3RuYW1lID0gIklmIgogICAgICBTay5hc3Rub2Rlcy5JZi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGVzdCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGVzdAogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLm9yZWxzZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuV2l0aC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiV2l0aCIKICAgICAgU2suYXN0bm9kZXMuV2l0aC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiaXRlbXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLml0ZW1zCiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXN5bmNXaXRoLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3luY1dpdGgiCiAgICAgIFNrLmFzdG5vZGVzLkFzeW5jV2l0aC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiaXRlbXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLml0ZW1zCiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuUmFpc2UucHJvdG90eXBlLl9hc3RuYW1lID0gIlJhaXNlIgogICAgICBTay5hc3Rub2Rlcy5SYWlzZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZXhjIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5leGMKICAgICAgICB9LAogICAgICAgICJjYXVzZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuY2F1c2UKICAgICAgICB9LAogICAgICAgICJpbnN0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5pbnN0CiAgICAgICAgfSwKICAgICAgICAidGJhY2siLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRiYWNrCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5UcnkucHJvdG90eXBlLl9hc3RuYW1lID0gIlRyeSIKICAgICAgU2suYXN0bm9kZXMuVHJ5LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAiaGFuZGxlcnMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmhhbmRsZXJzCiAgICAgICAgfSwKICAgICAgICAib3JlbHNlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICAgICJmaW5hbGJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmZpbmFsYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXNzZXJ0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3NlcnQiCiAgICAgIFNrLmFzdG5vZGVzLkFzc2VydC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGVzdCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudGVzdAogICAgICAgIH0sCiAgICAgICAgIm1zZyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubXNnCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5JbXBvcnQucHJvdG90eXBlLl9hc3RuYW1lID0gIkltcG9ydCIKICAgICAgU2suYXN0bm9kZXMuSW1wb3J0LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuYW1lcyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubmFtZXMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkltcG9ydEZyb20ucHJvdG90eXBlLl9hc3RuYW1lID0gIkltcG9ydEZyb20iCiAgICAgIFNrLmFzdG5vZGVzLkltcG9ydEZyb20ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgIm1vZHVsZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubW9kdWxlCiAgICAgICAgfSwKICAgICAgICAibmFtZXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWVzCiAgICAgICAgfSwKICAgICAgICAibGV2ZWwiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmxldmVsCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5HbG9iYWwucHJvdG90eXBlLl9hc3RuYW1lID0gIkdsb2JhbCIKICAgICAgU2suYXN0bm9kZXMuR2xvYmFsLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuYW1lcyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubmFtZXMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLk5vbmxvY2FsLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJOb25sb2NhbCIKICAgICAgU2suYXN0bm9kZXMuTm9ubG9jYWwucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgIm5hbWVzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRXhwci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRXhwciIKICAgICAgU2suYXN0bm9kZXMuRXhwci5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5QYXNzLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJQYXNzIgogICAgICBTay5hc3Rub2Rlcy5QYXNzLnByb3RvdHlwZS5fZmllbGRzID0gW10KICAgICAgU2suYXN0bm9kZXMuQnJlYWsucHJvdG90eXBlLl9hc3RuYW1lID0gIkJyZWFrIgogICAgICBTay5hc3Rub2Rlcy5CcmVhay5wcm90b3R5cGUuX2ZpZWxkcyA9IFtdCiAgICAgIFNrLmFzdG5vZGVzLkNvbnRpbnVlLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJDb250aW51ZSIKICAgICAgU2suYXN0bm9kZXMuQ29udGludWUucHJvdG90eXBlLl9maWVsZHMgPSBbXQogICAgICBTay5hc3Rub2Rlcy5QcmludC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiUHJpbnQiCiAgICAgIFNrLmFzdG5vZGVzLlByaW50LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJkZXN0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5kZXN0CiAgICAgICAgfSwKICAgICAgICAidmFsdWVzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZXMKICAgICAgICB9LAogICAgICAgICJubCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubmwKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkRlYnVnZ2VyLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJEZWJ1Z2dlciIKICAgICAgU2suYXN0bm9kZXMuRGVidWdnZXIucHJvdG90eXBlLl9maWVsZHMgPSBbXQogICAgICBTay5hc3Rub2Rlcy5Cb29sT3AucHJvdG90eXBlLl9hc3RuYW1lID0gIkJvb2xPcCIKICAgICAgU2suYXN0bm9kZXMuQm9vbE9wLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJvcCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEub3AKICAgICAgICB9LAogICAgICAgICJ2YWx1ZXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQmluT3AucHJvdG90eXBlLl9hc3RuYW1lID0gIkJpbk9wIgogICAgICBTay5hc3Rub2Rlcy5CaW5PcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibGVmdCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubGVmdAogICAgICAgIH0sCiAgICAgICAgIm9wIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcAogICAgICAgIH0sCiAgICAgICAgInJpZ2h0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5yaWdodAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuVW5hcnlPcC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiVW5hcnlPcCIKICAgICAgU2suYXN0bm9kZXMuVW5hcnlPcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAib3AiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLm9wCiAgICAgICAgfSwKICAgICAgICAib3BlcmFuZCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEub3BlcmFuZAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTGFtYmRhLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJMYW1iZGEiCiAgICAgIFNrLmFzdG5vZGVzLkxhbWJkYS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiYXJncyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJncwogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLklmRXhwLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJJZkV4cCIKICAgICAgU2suYXN0bm9kZXMuSWZFeHAucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRlc3QiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRlc3QKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAib3JlbHNlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkRpY3QucHJvdG90eXBlLl9hc3RuYW1lID0gIkRpY3QiCiAgICAgIFNrLmFzdG5vZGVzLkRpY3QucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImtleXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmtleXMKICAgICAgICB9LAogICAgICAgICJ2YWx1ZXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuU2V0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJTZXQiCiAgICAgIFNrLmFzdG5vZGVzLlNldC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZWx0cyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuZWx0cwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTGlzdENvbXAucHJvdG90eXBlLl9hc3RuYW1lID0gIkxpc3RDb21wIgogICAgICBTay5hc3Rub2Rlcy5MaXN0Q29tcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZWx0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5lbHQKICAgICAgICB9LAogICAgICAgICJnZW5lcmF0b3JzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5nZW5lcmF0b3JzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5TZXRDb21wLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJTZXRDb21wIgogICAgICBTay5hc3Rub2Rlcy5TZXRDb21wLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJlbHQiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmVsdAogICAgICAgIH0sCiAgICAgICAgImdlbmVyYXRvcnMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmdlbmVyYXRvcnMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkRpY3RDb21wLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJEaWN0Q29tcCIKICAgICAgU2suYXN0bm9kZXMuRGljdENvbXAucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImtleSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEua2V5CiAgICAgICAgfSwKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgICAiZ2VuZXJhdG9ycyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuZ2VuZXJhdG9ycwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuR2VuZXJhdG9yRXhwLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJHZW5lcmF0b3JFeHAiCiAgICAgIFNrLmFzdG5vZGVzLkdlbmVyYXRvckV4cC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZWx0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5lbHQKICAgICAgICB9LAogICAgICAgICJnZW5lcmF0b3JzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5nZW5lcmF0b3JzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Bd2FpdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQXdhaXQiCiAgICAgIFNrLmFzdG5vZGVzLkF3YWl0LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLllpZWxkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJZaWVsZCIKICAgICAgU2suYXN0bm9kZXMuWWllbGQucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuWWllbGRGcm9tLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJZaWVsZEZyb20iCiAgICAgIFNrLmFzdG5vZGVzLllpZWxkRnJvbS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Db21wYXJlLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJDb21wYXJlIgogICAgICBTay5hc3Rub2Rlcy5Db21wYXJlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJsZWZ0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5sZWZ0CiAgICAgICAgfSwKICAgICAgICAib3BzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcHMKICAgICAgICB9LAogICAgICAgICJjb21wYXJhdG9ycyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuY29tcGFyYXRvcnMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkNhbGwucHJvdG90eXBlLl9hc3RuYW1lID0gIkNhbGwiCiAgICAgIFNrLmFzdG5vZGVzLkNhbGwucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImZ1bmMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmZ1bmMKICAgICAgICB9LAogICAgICAgICJhcmdzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5hcmdzCiAgICAgICAgfSwKICAgICAgICAia2V5d29yZHMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmtleXdvcmRzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5OdW0ucHJvdG90eXBlLl9hc3RuYW1lID0gIk51bSIKICAgICAgU2suYXN0bm9kZXMuTnVtLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5uCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5TdHIucHJvdG90eXBlLl9hc3RuYW1lID0gIlN0ciIKICAgICAgU2suYXN0bm9kZXMuU3RyLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5zCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Gb3JtYXR0ZWRWYWx1ZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRm9ybWF0dGVkVmFsdWUiCiAgICAgIFNrLmFzdG5vZGVzLkZvcm1hdHRlZFZhbHVlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICAgICJjb252ZXJzaW9uIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5jb252ZXJzaW9uCiAgICAgICAgfSwKICAgICAgICAiZm9ybWF0X3NwZWMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmZvcm1hdF9zcGVjCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Kb2luZWRTdHIucHJvdG90eXBlLl9hc3RuYW1lID0gIkpvaW5lZFN0ciIKICAgICAgU2suYXN0bm9kZXMuSm9pbmVkU3RyLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZXMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQnl0ZXMucHJvdG90eXBlLl9hc3RuYW1lID0gIkJ5dGVzIgogICAgICBTay5hc3Rub2Rlcy5CeXRlcy5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAicyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEucwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJOYW1lQ29uc3RhbnQiCiAgICAgIFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5FbGxpcHNpcy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRWxsaXBzaXMiCiAgICAgIFNrLmFzdG5vZGVzLkVsbGlwc2lzLnByb3RvdHlwZS5fZmllbGRzID0gW10KICAgICAgU2suYXN0bm9kZXMuQ29uc3RhbnQucHJvdG90eXBlLl9hc3RuYW1lID0gIkNvbnN0YW50IgogICAgICBTay5hc3Rub2Rlcy5Db25zdGFudC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5BdHRyaWJ1dGUucHJvdG90eXBlLl9hc3RuYW1lID0gIkF0dHJpYnV0ZSIKICAgICAgU2suYXN0bm9kZXMuQXR0cmlidXRlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICAgICJhdHRyIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5hdHRyCiAgICAgICAgfSwKICAgICAgICAiY3R4IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5jdHgKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLlN1YnNjcmlwdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU3Vic2NyaXB0IgogICAgICBTay5hc3Rub2Rlcy5TdWJzY3JpcHQucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgICAgInNsaWNlIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5zbGljZQogICAgICAgIH0sCiAgICAgICAgImN0eCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuY3R4CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5TdGFycmVkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJTdGFycmVkIgogICAgICBTay5hc3Rub2Rlcy5TdGFycmVkLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICAgICJjdHgiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmN0eAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTmFtZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTmFtZSIKICAgICAgU2suYXN0bm9kZXMuTmFtZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiaWQiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmlkCiAgICAgICAgfSwKICAgICAgICAiY3R4IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5jdHgKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkxpc3QucHJvdG90eXBlLl9hc3RuYW1lID0gIkxpc3QiCiAgICAgIFNrLmFzdG5vZGVzLkxpc3QucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImVsdHMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmVsdHMKICAgICAgICB9LAogICAgICAgICJjdHgiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmN0eAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuVHVwbGUucHJvdG90eXBlLl9hc3RuYW1lID0gIlR1cGxlIgogICAgICBTay5hc3Rub2Rlcy5UdXBsZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZWx0cyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuZWx0cwogICAgICAgIH0sCiAgICAgICAgImN0eCIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuY3R4CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Mb2FkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJMb2FkIgogICAgICBTay5hc3Rub2Rlcy5Mb2FkLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuU3RvcmUucHJvdG90eXBlLl9hc3RuYW1lID0gIlN0b3JlIgogICAgICBTay5hc3Rub2Rlcy5TdG9yZS5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkRlbC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRGVsIgogICAgICBTay5hc3Rub2Rlcy5EZWwucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5BdWdMb2FkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBdWdMb2FkIgogICAgICBTay5hc3Rub2Rlcy5BdWdMb2FkLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuQXVnU3RvcmUucHJvdG90eXBlLl9hc3RuYW1lID0gIkF1Z1N0b3JlIgogICAgICBTay5hc3Rub2Rlcy5BdWdTdG9yZS5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLlBhcmFtLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJQYXJhbSIKICAgICAgU2suYXN0bm9kZXMuUGFyYW0ucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5TbGljZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU2xpY2UiCiAgICAgIFNrLmFzdG5vZGVzLlNsaWNlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJsb3dlciIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEubG93ZXIKICAgICAgICB9LAogICAgICAgICJ1cHBlciIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudXBwZXIKICAgICAgICB9LAogICAgICAgICJzdGVwIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5zdGVwCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5FeHRTbGljZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRXh0U2xpY2UiCiAgICAgIFNrLmFzdG5vZGVzLkV4dFNsaWNlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJkaW1zIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5kaW1zCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5JbmRleC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiSW5kZXgiCiAgICAgIFNrLmFzdG5vZGVzLkluZGV4LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkFuZC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQW5kIgogICAgICBTay5hc3Rub2Rlcy5BbmQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Pci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiT3IiCiAgICAgIFNrLmFzdG5vZGVzLk9yLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuQWRkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBZGQiCiAgICAgIFNrLmFzdG5vZGVzLkFkZC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLlN1Yi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU3ViIgogICAgICBTay5hc3Rub2Rlcy5TdWIucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5NdWx0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJNdWx0IgogICAgICBTay5hc3Rub2Rlcy5NdWx0LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuTWF0TXVsdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTWF0TXVsdCIKICAgICAgU2suYXN0bm9kZXMuTWF0TXVsdC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkRpdi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRGl2IgogICAgICBTay5hc3Rub2Rlcy5EaXYucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Nb2QucHJvdG90eXBlLl9hc3RuYW1lID0gIk1vZCIKICAgICAgU2suYXN0bm9kZXMuTW9kLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuUG93LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJQb3ciCiAgICAgIFNrLmFzdG5vZGVzLlBvdy5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkxTaGlmdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTFNoaWZ0IgogICAgICBTay5hc3Rub2Rlcy5MU2hpZnQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5SU2hpZnQucHJvdG90eXBlLl9hc3RuYW1lID0gIlJTaGlmdCIKICAgICAgU2suYXN0bm9kZXMuUlNoaWZ0LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuQml0T3IucHJvdG90eXBlLl9hc3RuYW1lID0gIkJpdE9yIgogICAgICBTay5hc3Rub2Rlcy5CaXRPci5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkJpdFhvci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQml0WG9yIgogICAgICBTay5hc3Rub2Rlcy5CaXRYb3IucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5CaXRBbmQucHJvdG90eXBlLl9hc3RuYW1lID0gIkJpdEFuZCIKICAgICAgU2suYXN0bm9kZXMuQml0QW5kLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuRmxvb3JEaXYucHJvdG90eXBlLl9hc3RuYW1lID0gIkZsb29yRGl2IgogICAgICBTay5hc3Rub2Rlcy5GbG9vckRpdi5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkludmVydC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiSW52ZXJ0IgogICAgICBTay5hc3Rub2Rlcy5JbnZlcnQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Ob3QucHJvdG90eXBlLl9hc3RuYW1lID0gIk5vdCIKICAgICAgU2suYXN0bm9kZXMuTm90LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuVUFkZC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiVUFkZCIKICAgICAgU2suYXN0bm9kZXMuVUFkZC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLlVTdWIucHJvdG90eXBlLl9hc3RuYW1lID0gIlVTdWIiCiAgICAgIFNrLmFzdG5vZGVzLlVTdWIucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5FcS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRXEiCiAgICAgIFNrLmFzdG5vZGVzLkVxLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuTm90RXEucHJvdG90eXBlLl9hc3RuYW1lID0gIk5vdEVxIgogICAgICBTay5hc3Rub2Rlcy5Ob3RFcS5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkx0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJMdCIKICAgICAgU2suYXN0bm9kZXMuTHQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5MdEUucHJvdG90eXBlLl9hc3RuYW1lID0gIkx0RSIKICAgICAgU2suYXN0bm9kZXMuTHRFLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuR3QucHJvdG90eXBlLl9hc3RuYW1lID0gIkd0IgogICAgICBTay5hc3Rub2Rlcy5HdC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkd0RS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiR3RFIgogICAgICBTay5hc3Rub2Rlcy5HdEUucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Jcy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiSXMiCiAgICAgIFNrLmFzdG5vZGVzLklzLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuSXNOb3QucHJvdG90eXBlLl9hc3RuYW1lID0gIklzTm90IgogICAgICBTay5hc3Rub2Rlcy5Jc05vdC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkluLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJJbiIKICAgICAgU2suYXN0bm9kZXMuSW4ucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Ob3RJbi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTm90SW4iCiAgICAgIFNrLmFzdG5vZGVzLk5vdEluLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuY29tcHJlaGVuc2lvbi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiY29tcHJlaGVuc2lvbiIKICAgICAgU2suYXN0bm9kZXMuY29tcHJlaGVuc2lvbi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidGFyZ2V0IiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS50YXJnZXQKICAgICAgICB9LAogICAgICAgICJpdGVyIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5pdGVyCiAgICAgICAgfSwKICAgICAgICAiaWZzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5pZnMKICAgICAgICB9LAogICAgICAgICJpc19hc3luYyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuaXNfYXN5bmMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIucHJvdG90eXBlLl9hc3RuYW1lID0gIkV4Y2VwdEhhbmRsZXIiCiAgICAgIFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInR5cGUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnR5cGUKICAgICAgICB9LAogICAgICAgICJuYW1lIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lCiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuYXJndW1lbnRzXy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiYXJndW1lbnRzIgogICAgICBTay5hc3Rub2Rlcy5hcmd1bWVudHNfLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJhcmdzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5hcmdzCiAgICAgICAgfSwKICAgICAgICAidmFyYXJnIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS52YXJhcmcKICAgICAgICB9LAogICAgICAgICJrd29ubHlhcmdzIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5rd29ubHlhcmdzCiAgICAgICAgfSwKICAgICAgICAia3dfZGVmYXVsdHMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmt3X2RlZmF1bHRzCiAgICAgICAgfSwKICAgICAgICAia3dhcmciLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmt3YXJnCiAgICAgICAgfSwKICAgICAgICAiZGVmYXVsdHMiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRlZmF1bHRzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5hcmcucHJvdG90eXBlLl9hc3RuYW1lID0gImFyZyIKICAgICAgU2suYXN0bm9kZXMuYXJnLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJhcmciLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmFyZwogICAgICAgIH0sCiAgICAgICAgImFubm90YXRpb24iLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLmFubm90YXRpb24KICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLmtleXdvcmQucHJvdG90eXBlLl9hc3RuYW1lID0gImtleXdvcmQiCiAgICAgIFNrLmFzdG5vZGVzLmtleXdvcmQucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImFyZyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJnCiAgICAgICAgfSwKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5hbGlhcy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiYWxpYXMiCiAgICAgIFNrLmFzdG5vZGVzLmFsaWFzLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lCiAgICAgICAgfSwKICAgICAgICAiYXNuYW1lIiwKICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gYS5hc25hbWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLndpdGhpdGVtLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJ3aXRoaXRlbSIKICAgICAgU2suYXN0bm9kZXMud2l0aGl0ZW0ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImNvbnRleHRfZXhwciIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEuY29udGV4dF9leHByCiAgICAgICAgfSwKICAgICAgICAib3B0aW9uYWxfdmFycyIsCiAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgcmV0dXJuIGEub3B0aW9uYWxfdmFycwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hc3Rub2RlcyIsIFNrLmFzdG5vZGVzKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgZnVuY3Rpb24gYShhLCBiLCBjKSB7CiAgICAgICAgdGhpcy5jX2VuY29kaW5nID0gYQogICAgICAgIHRoaXMuY19maWxlbmFtZSA9IGIKICAgICAgICB0aGlzLmNfZmxhZ3MgPSBjIHx8IDAKICAgICAgfQogICAgICBmdW5jdGlvbiBiKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJub2RlIG11c3QgYmUgZGVmaW5lZCIpCiAgICAgICAgcmV0dXJuIG51bGwgPT09IGEuY2hpbGRyZW4gPyAwIDogYS5jaGlsZHJlbi5sZW5ndGgKICAgICAgfQogICAgICBmdW5jdGlvbiBjKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJub2RlIG11c3QgYmUgZGVmaW5lZCIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBiLCAiaW5kZXggb2YgY2hpbGQgbXVzdCBiZSBzcGVjaWZpZWQiKQogICAgICAgIHJldHVybiBhLmNoaWxkcmVuW2JdCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYS50eXBlID09PSBiLCAibm9kZSB3YXNuJ3QgZXhwZWN0ZWQgdHlwZSIpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZShhLCBiLCBjKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoYywgYS5jX2ZpbGVuYW1lLCBiLmxpbmVubykKICAgICAgfQogICAgICBmdW5jdGlvbiBmKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSwKICAgICAgICAgICJleHBlY3Rpbmcgc3RyaW5nLCBnb3QgIiArIHR5cGVvZiBhLAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZyhhKSB7CiAgICAgICAgdmFyIGQsIGUKICAgICAgICBzd2l0Y2ggKGEudHlwZSkgewogICAgICAgICAgY2FzZSB0LnNpbmdsZV9pbnB1dDoKICAgICAgICAgICAgaWYgKGMoYSwgMCkudHlwZSA9PT0gdi5UX05FV0xJTkUpIGJyZWFrCiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGcoYyhhLCAwKSkKICAgICAgICAgIGNhc2UgdC5maWxlX2lucHV0OgogICAgICAgICAgICBmb3IgKGQgPSBlID0gMDsgZCA8IGIoYSk7ICsrZCkgewogICAgICAgICAgICAgIHZhciBrID0gYyhhLCBkKQogICAgICAgICAgICAgIGsudHlwZSA9PT0gdC5zdG10ICYmIChlICs9IGcoaykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgIGNhc2UgdC5zdG10OgogICAgICAgICAgICByZXR1cm4gZyhjKGEsIDApKQogICAgICAgICAgY2FzZSB0LmNvbXBvdW5kX3N0bXQ6CiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBjYXNlIHQuc2ltcGxlX3N0bXQ6CiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGIoYSkgLyAyKQogICAgICAgICAgY2FzZSB0LnN1aXRlOgogICAgICAgICAgICBpZiAoMSA9PT0gYihhKSkgcmV0dXJuIGcoYyhhLCAwKSkKICAgICAgICAgICAgZSA9IDAKICAgICAgICAgICAgZm9yIChkID0gMjsgZCA8IGIoYSkgLSAxOyArK2QpIGUgKz0gZyhjKGEsIGQpKQogICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJOb24tc3RhdGVtZW50IGZvdW5kIikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDAKICAgICAgfQogICAgICBmdW5jdGlvbiBoKGEsIGIsIGMsIGQpIHsKICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIgJiYgKGMgPSBjLnYpCiAgICAgICAgaWYgKCJOb25lIiA9PT0gYykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAiYXNzaWdubWVudCB0byBOb25lIiwKICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICBkLAogICAgICAgICAgKQogICAgICAgIGlmICgiVHJ1ZSIgPT09IGMgfHwgIkZhbHNlIiA9PT0gYykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAiYXNzaWdubWVudCB0byBUcnVlIG9yIEZhbHNlIGlzIGZvcmJpZGRlbiIsCiAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgZCwKICAgICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBrKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgYyAhPT0gU2suYXN0bm9kZXMuQXVnU3RvcmUgJiYgYyAhPT0gU2suYXN0bm9kZXMuQXVnTG9hZCwKICAgICAgICAgICJjb250ZXh0IG5vdCBBdWdTdG9yZSBvciBBdWdMb2FkIiwKICAgICAgICApCiAgICAgICAgdmFyIGcgPSAoZSA9IG51bGwpCiAgICAgICAgc3dpdGNoIChiLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZToKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZToKICAgICAgICAgICAgYyA9PT0gU2suYXN0bm9kZXMuU3RvcmUgJiYgaChhLCBkLCBiLmF0dHIsIGQubGluZW5vKQogICAgICAgICAgICBiLmN0eCA9IGMKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3Vic2NyaXB0OgogICAgICAgICAgICBiLmN0eCA9IGMKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGlzdDoKICAgICAgICAgICAgYi5jdHggPSBjCiAgICAgICAgICAgIGUgPSBiLmVsdHMKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVHVwbGU6CiAgICAgICAgICAgIGlmICgwID09PSBiLmVsdHMubGVuZ3RoKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgImNhbid0IGFzc2lnbiB0byAoKSIsCiAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGIuY3R4ID0gYwogICAgICAgICAgICBlID0gYi5lbHRzCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxhbWJkYToKICAgICAgICAgICAgZyA9ICJsYW1iZGEiCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNhbGw6CiAgICAgICAgICAgIGcgPSAiZnVuY3Rpb24gY2FsbCIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQm9vbE9wOgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5CaW5PcDoKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVW5hcnlPcDoKICAgICAgICAgICAgZyA9ICJvcGVyYXRvciIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuR2VuZXJhdG9yRXhwOgogICAgICAgICAgICBnID0gImdlbmVyYXRvciBleHByZXNzaW9uIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5ZaWVsZDoKICAgICAgICAgICAgZyA9ICJ5aWVsZCBleHByZXNzaW9uIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5MaXN0Q29tcDoKICAgICAgICAgICAgZyA9ICJsaXN0IGNvbXByZWhlbnNpb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlNldENvbXA6CiAgICAgICAgICAgIGcgPSAic2V0IGNvbXByZWhlbnNpb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRpY3RDb21wOgogICAgICAgICAgICBnID0gImRpY3QgY29tcHJlaGVuc2lvbiIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGljdDoKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2V0OgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OdW06CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0cjoKICAgICAgICAgICAgZyA9ICJsaXRlcmFsIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lQ29uc3RhbnQ6CiAgICAgICAgICAgIGcgPSAiVHJ1ZSwgRmFsc2Ugb3IgTm9uZSIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQ29tcGFyZToKICAgICAgICAgICAgZyA9ICJjb21wYXJpc29uIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5SZXByOgogICAgICAgICAgICBnID0gInJlcHIiCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmRXhwOgogICAgICAgICAgICBnID0gImNvbmRpdGlvbmFsIGV4cHJlc3Npb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBleHByZXNzaW9uIGluIGFzc2lnbm1lbnQiKQogICAgICAgIH0KICAgICAgICBpZiAoZykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAiY2FuJ3QgIiArCiAgICAgICAgICAgICAgKGMgPT09IFNrLmFzdG5vZGVzLlN0b3JlID8gImFzc2lnbiB0byIgOiAiZGVsZXRlIikgKwogICAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgICAgZywKICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICkKICAgICAgICBpZiAoZSkgZm9yIChiID0gMDsgYiA8IGUubGVuZ3RoOyArK2IpIGsoYSwgZVtiXSwgYywgZCkKICAgICAgfQogICAgICBmdW5jdGlvbiBsKGEpIHsKICAgICAgICBpZiAodm9pZCAwID09PSBNW2EudHlwZV0pCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigiaW52YWxpZCBzeW50YXgiLCBhLnR5cGUsIGEubGluZW5vKQogICAgICAgIHJldHVybiBNW2EudHlwZV0KICAgICAgfQogICAgICBmdW5jdGlvbiByKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS52YWx1ZSA/IFNrLmJ1aWx0aW4uc3RyKGEudmFsdWUpIDogU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBmdW5jdGlvbiBuKGEsIGUpIHsKICAgICAgICBkKGUsIHQuY29tcF9vcCkKICAgICAgICBpZiAoMSA9PT0gYihlKSkKICAgICAgICAgIHN3aXRjaCAoKChlID0gYyhlLCAwKSksIGUudHlwZSkpIHsKICAgICAgICAgICAgY2FzZSB2LlRfTEVTUzoKICAgICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuTHQKICAgICAgICAgICAgY2FzZSB2LlRfR1JFQVRFUjoKICAgICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuR3QKICAgICAgICAgICAgY2FzZSB2LlRfRVFFUVVBTDoKICAgICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuRXEKICAgICAgICAgICAgY2FzZSB2LlRfTEVTU0VRVUFMOgogICAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5MdEUKICAgICAgICAgICAgY2FzZSB2LlRfR1JFQVRFUkVRVUFMOgogICAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5HdEUKICAgICAgICAgICAgY2FzZSB2LlRfTk9URVFVQUw6CiAgICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLk5vdEVxCiAgICAgICAgICAgIGNhc2Ugdi5UX05BTUU6CiAgICAgICAgICAgICAgaWYgKCJpbiIgPT09IGUudmFsdWUpIHJldHVybiBTay5hc3Rub2Rlcy5JbgogICAgICAgICAgICAgIGlmICgiaXMiID09PSBlLnZhbHVlKSByZXR1cm4gU2suYXN0bm9kZXMuSXMKICAgICAgICAgIH0KICAgICAgICBlbHNlIGlmICgyID09PSBiKGUpICYmIGMoZSwgMCkudHlwZSA9PT0gdi5UX05BTUUpIHsKICAgICAgICAgIGlmICgiaW4iID09PSBjKGUsIDEpLnZhbHVlKSByZXR1cm4gU2suYXN0bm9kZXMuTm90SW4KICAgICAgICAgIGlmICgiaXMiID09PSBjKGUsIDApLnZhbHVlKSByZXR1cm4gU2suYXN0bm9kZXMuSXNOb3QKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJpbnZhbGlkIGNvbXBfb3AiKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHEoYSwgYikgewogICAgICAgIGEgJiYKICAgICAgICAgICgoYS5saW5lbm8gPSBiLmxpbmVubyksCiAgICAgICAgICAoYS5jb2xfb2Zmc2V0ID0gYi5jb2xfb2Zmc2V0KSwKICAgICAgICAgIChhLmVuZF9saW5lbm8gPSBiLmVuZF9saW5lbm8pLAogICAgICAgICAgKGEuZW5kX2NvbF9vZmZzZXQgPSBiLmVuZF9jb2xfb2Zmc2V0KSkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEQoYSwgZCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgayA9IFtdCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICBkLnR5cGUgPT09IHQudGVzdGxpc3QgfHwKICAgICAgICAgICAgZC50eXBlID09PSB0LnRlc3RsaXN0X3N0YXJfZXhwciB8fAogICAgICAgICAgICBkLnR5cGUgPT09IHQubGlzdG1ha2VyIHx8CiAgICAgICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdF9jb21wIHx8CiAgICAgICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdF9zYWZlIHx8CiAgICAgICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdDEsCiAgICAgICAgICAibm9kZSB0eXBlIG11c3QgYmUgbGlzdGxpa2UiLAogICAgICAgICkKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYihkKTsgZSArPSAyKQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAgIGMoZCwgZSkudHlwZSA9PT0gdC50ZXN0IHx8CiAgICAgICAgICAgICAgYyhkLCBlKS50eXBlID09PSB0Lm9sZF90ZXN0IHx8CiAgICAgICAgICAgICAgYyhkLCBlKS50eXBlID09PSB0LnN0YXJfZXhwciwKICAgICAgICAgICksCiAgICAgICAgICAgIChrW2UgLyAyXSA9IHUoYSwgYyhkLCBlKSkpCiAgICAgICAgcmV0dXJuIGsKICAgICAgfQogICAgICBmdW5jdGlvbiB4KGEsIGUpIHsKICAgICAgICB2YXIgawogICAgICAgIGQoZSwgdC5zdWl0ZSkKICAgICAgICB2YXIgZiA9IFtdCiAgICAgICAgdmFyIGwgPSAwCiAgICAgICAgaWYgKGMoZSwgMCkudHlwZSA9PT0gdC5zaW1wbGVfc3RtdCkgewogICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgIHZhciB3ID0gYihlKSAtIDEKICAgICAgICAgIGMoZSwgdyAtIDEpLnR5cGUgPT09IHYuVF9TRU1JICYmIC0tdwogICAgICAgICAgZm9yIChrID0gMDsgayA8IHc7IGsgKz0gMikgZltsKytdID0gTChhLCBjKGUsIGspKQogICAgICAgIH0gZWxzZQogICAgICAgICAgZm9yIChrID0gMjsgayA8IGIoZSkgLSAxOyArK2spIHsKICAgICAgICAgICAgdyA9IGMoZSwgaykKICAgICAgICAgICAgZCh3LCB0LnN0bXQpCiAgICAgICAgICAgIHZhciBoID0gZyh3KQogICAgICAgICAgICBpZiAoMSA9PT0gaCkgZltsKytdID0gTChhLCB3KQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgZm9yICh3ID0gYyh3LCAwKSwgZCh3LCB0LnNpbXBsZV9zdG10KSwgaCA9IDA7IGggPCBiKHcpOyBoICs9IDIpIHsKICAgICAgICAgICAgICAgIGlmICgwID09PSBiKGModywgaCkpKSB7CiAgICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGggKyAxID09PSBiKHcpKQogICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZltsKytdID0gTChhLCBjKHcsIGgpKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICBTay5hc3NlcnRzLmFzc2VydChsID09PSBnKGUpKQogICAgICAgIHJldHVybiBmCiAgICAgIH0KICAgICAgZnVuY3Rpb24gSChhLCBlLCBnKSB7CiAgICAgICAgdmFyIGYKICAgICAgICBkKGUsIHQuZXhwcmxpc3QpCiAgICAgICAgdmFyIGwgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCBiKGUpOyBmICs9IDIpIHsKICAgICAgICAgIHZhciB3ID0gdShhLCBjKGUsIGYpKQogICAgICAgICAgbFtmIC8gMl0gPSB3CiAgICAgICAgICBnICYmIGsoYSwgdywgZywgYyhlLCBmKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGwKICAgICAgfQogICAgICBmdW5jdGlvbiBKKGEsIGQpIHsKICAgICAgICBhOiBmb3IgKDs7KQogICAgICAgICAgc3dpdGNoIChkLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSB0LmltcG9ydF9hc19uYW1lOgogICAgICAgICAgICAgIGEgPSBudWxsCiAgICAgICAgICAgICAgdmFyIGUgPSBmKGMoZCwgMCkudmFsdWUpCiAgICAgICAgICAgICAgMyA9PT0gYihkKSAmJiAoYSA9IGMoZCwgMikudmFsdWUpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hbGlhcyhlLCBudWxsID09IGEgPyBudWxsIDogZihhKSkKICAgICAgICAgICAgY2FzZSB0LmRvdHRlZF9hc19uYW1lOgogICAgICAgICAgICAgIGlmICgxID09PSBiKGQpKSB7CiAgICAgICAgICAgICAgICBkID0gYyhkLCAwKQogICAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgKGEgPSBKKGEsIGMoZCwgMCkpKSwKICAgICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoIWEuYXNuYW1lKSwKICAgICAgICAgICAgICAgICAgKGEuYXNuYW1lID0gZihjKGQsIDIpLnZhbHVlKSksCiAgICAgICAgICAgICAgICAgIGEKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LmRvdHRlZF9uYW1lOgogICAgICAgICAgICAgIGlmICgxID09PSBiKGQpKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hbGlhcyhmKGMoZCwgMCkudmFsdWUpLCBudWxsKQogICAgICAgICAgICAgIGEgPSAiIgogICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBiKGQpOyBlICs9IDIpIGEgKz0gYyhkLCBlKS52YWx1ZSArICIuIgogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuYWxpYXMoZihhLnN1YnN0cigwLCBhLmxlbmd0aCAtIDEpKSwgbnVsbCkKICAgICAgICAgICAgY2FzZSB2LlRfU1RBUjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLmFsaWFzKGYoIioiKSwgbnVsbCkKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJ1bmV4cGVjdGVkIGltcG9ydCBuYW1lIiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBBKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChiLnR5cGUgPT0gdC50ZXN0bGlzdF9jb21wIHx8IGIudHlwZSA9PSB0LmFyZ3VtZW50KQogICAgICAgIHJldHVybiBaKGEsIGIsIDApCiAgICAgIH0KICAgICAgZnVuY3Rpb24gQyhhLCBkKSB7CiAgICAgICAgaWYgKGMoZCwgMCkudHlwZSA9PT0gdi5UX01JTlVTICYmIDIgPT09IGIoZCkpIHsKICAgICAgICAgIHZhciBlID0gYyhkLCAxKQogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnR5cGUgPT09IHQuZmFjdG9yICYmCiAgICAgICAgICAgIDEgPT09IGIoZSkgJiYKICAgICAgICAgICAgKChlID0gYyhlLCAwKSksIGUudHlwZSA9PT0gdC5wb3dlciAmJiAxID09PSBiKGUpKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHZhciBrID0gYyhlLCAwKQogICAgICAgICAgICBpZiAoay50eXBlID09PSB0LmF0b20gJiYgKChlID0gYyhrLCAwKSksIGUudHlwZSA9PT0gdi5UX05VTUJFUikpCiAgICAgICAgICAgICAgcmV0dXJuIChlLnZhbHVlID0gIi0iICsgZS52YWx1ZSksIFEoYSwgaykKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYSA9IHUoYSwgYyhkLCAxKSkKICAgICAgICBzd2l0Y2ggKGMoZCwgMCkudHlwZSkgewogICAgICAgICAgY2FzZSB2LlRfUExVUzoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5VbmFyeU9wKAogICAgICAgICAgICAgIFNrLmFzdG5vZGVzLlVBZGQsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2Ugdi5UX01JTlVTOgogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlVuYXJ5T3AoCiAgICAgICAgICAgICAgU2suYXN0bm9kZXMuVVN1YiwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgIGQuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB2LlRfVElMREU6CiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuVW5hcnlPcCgKICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5JbnZlcnQsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgZmFjdG9yIikKICAgICAgfQogICAgICBmdW5jdGlvbiBLKGEsIGssIGcsIGYpIHsKICAgICAgICB2YXIgbCwgdywgcgogICAgICAgIGQoaywgdC5hcmdsaXN0KQogICAgICAgIGZvciAobCA9IHIgPSB3ID0gMDsgbCA8IGIoayk7IGwrKykgewogICAgICAgICAgdmFyIG4gPSBjKGssIGwpCiAgICAgICAgICBuLnR5cGUgPT0gdC5hcmd1bWVudCAmJgogICAgICAgICAgICAoMSA9PSBiKG4pCiAgICAgICAgICAgICAgPyB3KysKICAgICAgICAgICAgICA6IGMobiwgMSkudHlwZSA9PSB0LmNvbXBfZm9yCiAgICAgICAgICAgICAgPyAodysrLAogICAgICAgICAgICAgICAgZiB8fCBlKGEsIG4sICJpbnZhbGlkIHN5bnRheCIpLAogICAgICAgICAgICAgICAgMSA8IGIoaykgJiYKICAgICAgICAgICAgICAgICAgZShhLCBuLCAiR2VuZXJhdG9yIGV4cHJlc3Npb24gbXVzdCBiZSBwYXJlbnRoZXNpemVkIikpCiAgICAgICAgICAgICAgOiBjKG4sIDApLnR5cGUgPT0gdi5UX1NUQVIKICAgICAgICAgICAgICA/IHcrKwogICAgICAgICAgICAgIDogcisrKQogICAgICAgIH0KICAgICAgICB2YXIgUiA9IFtdCiAgICAgICAgdmFyIFQgPSBbXQogICAgICAgIGZvciAobCA9IGYgPSByID0gdyA9IDA7IGwgPCBiKGspOyBsKyspCiAgICAgICAgICBpZiAoKChuID0gYyhrLCBsKSksIG4udHlwZSA9PSB0LmFyZ3VtZW50KSkgewogICAgICAgICAgICB2YXIgTyA9IGMobiwgMCkKICAgICAgICAgICAgaWYgKDEgPT0gYihuKSkgewogICAgICAgICAgICAgIHIgJiYKICAgICAgICAgICAgICAgIChmCiAgICAgICAgICAgICAgICAgID8gZSgKICAgICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgICBPLAogICAgICAgICAgICAgICAgICAgICAgInBvc2l0aW9uYWwgYXJndW1lbnQgZm9sbG93cyBrZXl3b3JkIGFyZ3VtZW50IHVucGFja2luZyIsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICA6IGUoYSwgTywgInBvc2l0aW9uYWwgYXJndW1lbnQgZm9sbG93cyBrZXl3b3JkIGFyZ3VtZW50IikpCiAgICAgICAgICAgICAgdmFyIHEgPSB1KGEsIE8pCiAgICAgICAgICAgICAgaWYgKCFxKSByZXR1cm4gbnVsbAogICAgICAgICAgICAgIFJbdysrXSA9IHEKICAgICAgICAgICAgfSBlbHNlIGlmIChPLnR5cGUgPT0gdi5UX1NUQVIpIHsKICAgICAgICAgICAgICBpZiAoZikKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIGUoCiAgICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgICBPLAogICAgICAgICAgICAgICAgICAgICJpdGVyYWJsZSBhcmd1bWVudCB1bnBhY2tpbmcgZm9sbG93cyBrZXl3b3JkIGFyZ3VtZW50IHVucGFja2luZyIsCiAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBxID0gdShhLCBjKG4sIDEpKQogICAgICAgICAgICAgIGlmICghcSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICBuID0gbmV3IFNrLmFzdG5vZGVzLlN0YXJyZWQoCiAgICAgICAgICAgICAgICBxLAogICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICAgIE8ubGluZW5vLAogICAgICAgICAgICAgICAgTy5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICBSW3crK10gPSBuCiAgICAgICAgICAgIH0gZWxzZSBpZiAoTy50eXBlID09IHYuVF9ET1VCTEVTVEFSKSB7CiAgICAgICAgICAgICAgbCsrCiAgICAgICAgICAgICAgcSA9IHUoYSwgYyhuLCAxKSkKICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgbiA9IG5ldyBTay5hc3Rub2Rlcy5rZXl3b3JkKG51bGwsIHEpCiAgICAgICAgICAgICAgVFtyKytdID0gbgogICAgICAgICAgICAgIGYrKwogICAgICAgICAgICB9IGVsc2UgaWYgKGMobiwgMSkudHlwZSA9PSB0LmNvbXBfZm9yKSB7CiAgICAgICAgICAgICAgcSA9IEEoYSwgbikKICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgUlt3KytdID0gcQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBtCiAgICAgICAgICAgICAgcSA9IHUoYSwgTykKICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgaWYgKHEuY29uc3RydWN0b3IgPT09IFNrLmFzdG5vZGVzLkxhbWJkYSkKICAgICAgICAgICAgICAgIHJldHVybiBlKGEsIE8sICJsYW1iZGEgY2Fubm90IGNvbnRhaW4gYXNzaWdubWVudCIpLCBudWxsCiAgICAgICAgICAgICAgaWYgKHEuY29uc3RydWN0b3IgIT09IFNrLmFzdG5vZGVzLk5hbWUpCiAgICAgICAgICAgICAgICByZXR1cm4gZShhLCBPLCAia2V5d29yZCBjYW4ndCBiZSBhbiBleHByZXNzaW9uIiksIG51bGwKICAgICAgICAgICAgICBpZiAoaChhLCBxLmlkLCBuLCAxKSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICB2YXIgcCA9IHEuaWQKICAgICAgICAgICAgICBmb3IgKG0gPSAwOyBtIDwgcjsgbSsrKQogICAgICAgICAgICAgICAgaWYgKChxID0gVFttXS5hcmcpICYmIHEgPT09IHApCiAgICAgICAgICAgICAgICAgIHJldHVybiBlKGEsIE8sICJrZXl3b3JkIGFyZ3VtZW50IHJlcGVhdGVkIiksIG51bGwKICAgICAgICAgICAgICBxID0gdShhLCBjKG4sIDIpKQogICAgICAgICAgICAgIGlmICghcSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICBuID0gbmV3IFNrLmFzdG5vZGVzLmtleXdvcmQocCwgcSkKICAgICAgICAgICAgICBUW3IrK10gPSBuCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNhbGwoZywgUiwgVCwgZy5saW5lbm8sIGcuY29sX29mZnNldCkKICAgICAgfQogICAgICBmdW5jdGlvbiBCKGEsIGUsIGspIHsKICAgICAgICBkKGUsIHQudHJhaWxlcikKICAgICAgICBpZiAoYyhlLCAwKS50eXBlID09IHYuVF9MUEFSKQogICAgICAgICAgcmV0dXJuIDIgPT0gYihlKQogICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5DYWxsKGssIG51bGwsIG51bGwsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgICAgIDogSyhhLCBjKGUsIDEpLCBrLCAhMCkKICAgICAgICBpZiAoYyhlLCAwKS50eXBlID09IHYuVF9ET1QpIHsKICAgICAgICAgIHZhciBnID0gcihjKGUsIDEpKQogICAgICAgICAgcmV0dXJuIGcKICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuQXR0cmlidXRlKAogICAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICA6IG51bGwKICAgICAgICB9CiAgICAgICAgZChjKGUsIDApLCB2LlRfTFNRQikKICAgICAgICBkKGMoZSwgMiksIHYuVF9SU1FCKQogICAgICAgIGUgPSBjKGUsIDEpCiAgICAgICAgaWYgKDEgPT0gYihlKSkKICAgICAgICAgIHJldHVybiAoZyA9IEYoYSwgYyhlLCAwKSkpCiAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLlN1YnNjcmlwdCgKICAgICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgOiBudWxsCiAgICAgICAgdmFyIGYsCiAgICAgICAgICBsID0gMSwKICAgICAgICAgIHcgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCBiKGUpOyBmICs9IDIpIHsKICAgICAgICAgIGcgPSBGKGEsIGMoZSwgZikpCiAgICAgICAgICBpZiAoIWcpIHJldHVybiBudWxsCiAgICAgICAgICBnLmtpbmQgIT0gVy5JbmRleF9raW5kICYmIChsID0gMCkKICAgICAgICAgIHdbZiAvIDJdID0gZwogICAgICAgIH0KICAgICAgICBpZiAoIWwpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlN1YnNjcmlwdCgKICAgICAgICAgICAgaywKICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLkV4dFNsaWNlKHcpLAogICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgKQogICAgICAgIGEgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCB3Lmxlbmd0aDsgKytmKQogICAgICAgICAgKGcgPSB3W2ZdKSwKICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoZy5raW5kID09IFcuSW5kZXhfa2luZCAmJiBnLnYuSW5kZXgudmFsdWUpLAogICAgICAgICAgICAoYVtmXSA9IGcudi5JbmRleC52YWx1ZSkKICAgICAgICBnID0gbmV3IFNrLmFzdG5vZGVzLlR1cGxlKGEsIFNrLmFzdG5vZGVzLkxvYWQsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5TdWJzY3JpcHQoCiAgICAgICAgICBrLAogICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLkluZGV4KGcpLAogICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBTKGEsIGspIHsKICAgICAgICBkKGssIHQuZmxvd19zdG10KQogICAgICAgIHZhciBnID0gYyhrLCAwKQogICAgICAgIHN3aXRjaCAoZy50eXBlKSB7CiAgICAgICAgICBjYXNlIHQuYnJlYWtfc3RtdDoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5CcmVhaygKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2UgdC5jb250aW51ZV9zdG10OgogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNvbnRpbnVlKAogICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICBrLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB0LnlpZWxkX3N0bXQ6CiAgICAgICAgICAgIHJldHVybiAoYSA9IHUoYSwgYyhnLCAwKSkpCiAgICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuRXhwcigKICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIDogbnVsbAogICAgICAgICAgY2FzZSB0LnJldHVybl9zdG10OgogICAgICAgICAgICBpZiAoMSA9PSBiKGcpKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuUmV0dXJuKAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHZhciBmID0gSShhLCBjKGcsIDEpKQogICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLlJldHVybigKICAgICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIDogbnVsbAogICAgICAgICAgY2FzZSB0LnJhaXNlX3N0bXQ6CiAgICAgICAgICAgIGlmICgxID09IGIoZykpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5SYWlzZSgKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAoMiA8PSBiKGcpKSB7CiAgICAgICAgICAgICAgdmFyIGwgPSBudWxsCiAgICAgICAgICAgICAgZiA9IHUoYSwgYyhnLCAxKSkKICAgICAgICAgICAgICB2YXIgdyA9IG51bGwsCiAgICAgICAgICAgICAgICBoID0gbnVsbAogICAgICAgICAgICAgIDQgPT0gYihnKSAmJiAiZnJvbSIgPT0gYyhnLCAyKS52YWx1ZQogICAgICAgICAgICAgICAgPyAoU2suX19mdXR1cmVfXy5weXRob24zIHx8CiAgICAgICAgICAgICAgICAgICAgZSgKICAgICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgICBjKGcsIDIpLAogICAgICAgICAgICAgICAgICAgICAgInJhaXNlIC4uLiBmcm9tIC4uLiBpcyBub3QgYXZhaWxhYmxlIGluIFB5dGhvbiAyIiwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAobCA9IHUoYSwgYyhnLCAzKSkpKQogICAgICAgICAgICAgICAgOiA0IDw9IGIoZykgJiYKICAgICAgICAgICAgICAgICAgIiwiID09IGMoZywgMikudmFsdWUgJiYKICAgICAgICAgICAgICAgICAgKFNrLl9fZnV0dXJlX18ucHl0aG9uMyAmJgogICAgICAgICAgICAgICAgICAgIGUoYSwgaywgIk9sZCByYWlzZSBzeW50YXggaXMgbm90IGF2YWlsYWJsZSBpbiBQeXRob24gMyIpLAogICAgICAgICAgICAgICAgICAodyA9IHUoYSwgYyhnLCAzKSkpLAogICAgICAgICAgICAgICAgICA2ID09IGIoZykgJiYgKGggPSB1KGEsIGMoZywgNSkpKSkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlJhaXNlKAogICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICB3LAogICAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0KICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBTay5hc3NlcnRzLmZhaWwoInVuZXhwZWN0ZWQgZmxvd19zdG10OiAiLCBnLnR5cGUpLCBudWxsCiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEcoYSwgZCkgewogICAgICAgIHZhciBlID0gbnVsbAogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGQudHlwZSA9PT0gdC50ZnBkZWYgfHwgZC50eXBlID09PSB0LnZmcGRlZikKICAgICAgICB2YXIgayA9IGMoZCwgMCkKICAgICAgICBoKGEsIGssIGsudmFsdWUsIGsubGluZW5vKQogICAgICAgIGsgPSBmKGsudmFsdWUpCiAgICAgICAgMyA9PSBiKGQpICYmIGMoZCwgMSkudHlwZSA9PT0gdi5UX0NPTE9OICYmIChlID0gdShhLCBjKGQsIDIpKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLmFyZyhrLCBlLCBkLmxpbmVubywgZC5jb2xfb2Zmc2V0KQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHooYSwgZCwgaywgZywgbCkgewogICAgICAgIHZhciB3ID0gaywKICAgICAgICAgIHIgPSAwCiAgICAgICAgZyB8fCBlKGEsIGMoZCwgayksICJuYW1lZCBhcmd1bWVudHMgbXVzdCBmb2xsb3cgYmFyZSAqIikKICAgICAgICBmb3IgKFNrLmFzc2VydHMuYXNzZXJ0KGwpOyB3IDwgYihkKTsgKSB7CiAgICAgICAgICB2YXIgbiA9IGMoZCwgdykKICAgICAgICAgIHN3aXRjaCAobi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgdC52ZnBkZWY6CiAgICAgICAgICAgIGNhc2UgdC50ZnBkZWY6CiAgICAgICAgICAgICAgdyArIDEgPCBiKGQpICYmIGMoZCwgdyArIDEpLnR5cGUgPT0gdi5UX0VRVUFMCiAgICAgICAgICAgICAgICA/ICgobFtyXSA9IHUoYSwgYyhkLCB3ICsgMikpKSwgKHcgKz0gMikpCiAgICAgICAgICAgICAgICA6IChsW3JdID0gbnVsbCkKICAgICAgICAgICAgICB2YXIgUiA9IDMgPT0gYihuKSA/IHUoYSwgYyhuLCAyKSkgOiBudWxsCiAgICAgICAgICAgICAgbiA9IGMobiwgMCkKICAgICAgICAgICAgICBoKGEsIG4sIG4udmFsdWUsIG4ubGluZW5vKQogICAgICAgICAgICAgIGsgPSBmKG4udmFsdWUpCiAgICAgICAgICAgICAgZ1tyKytdID0gbmV3IFNrLmFzdG5vZGVzLmFyZyhrLCBSLCBuLmxpbmVubywgbi5jb2xfb2Zmc2V0KQogICAgICAgICAgICAgIHcgKz0gMgogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGNhc2Ugdi5UX0RPVUJMRVNUQVI6CiAgICAgICAgICAgICAgcmV0dXJuIHcKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBlKGEsIG4sICJ1bmV4cGVjdGVkIG5vZGUiKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFAoYSwgZCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgaywKICAgICAgICAgIGcsCiAgICAgICAgICBmID0gW10sCiAgICAgICAgICBsID0gW10sCiAgICAgICAgICBoID0gW10sCiAgICAgICAgICB3ID0gW10sCiAgICAgICAgICByID0gbnVsbCwKICAgICAgICAgIG4gPSBudWxsCiAgICAgICAgaWYgKGQudHlwZSA9PT0gdC5wYXJhbWV0ZXJzKSB7CiAgICAgICAgICBpZiAoMiA9PT0gYihkKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hcmd1bWVudHNfKFtdLCBudWxsLCBbXSwgW10sIG51bGwsIFtdKQogICAgICAgICAgZCA9IGMoZCwgMSkKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICBkLnR5cGUgPT09IHQudmFyYXJnc2xpc3QgfHwgZC50eXBlID09PSB0LnR5cGVkYXJnc2xpc3QsCiAgICAgICAgKQogICAgICAgIGZvciAoZSA9IGsgPSBnID0gMDsgZyA8IGIoZCk7ICkgewogICAgICAgICAgdmFyIHEgPSBjKGQsIGcpCiAgICAgICAgICBzd2l0Y2ggKHEudHlwZSkgewogICAgICAgICAgICBjYXNlIHQudGZwZGVmOgogICAgICAgICAgICBjYXNlIHQudmZwZGVmOgogICAgICAgICAgICAgIGlmIChnICsgMSA8IGIoZCkgJiYgYyhkLCBnICsgMSkudHlwZSA9PSB2LlRfRVFVQUwpIHsKICAgICAgICAgICAgICAgIGxbaysrXSA9IHUoYSwgYyhkLCBnICsgMikpCiAgICAgICAgICAgICAgICBnICs9IDIKICAgICAgICAgICAgICAgIHZhciBUID0gMQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoVCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAibm9uLWRlZmF1bHQgYXJndW1lbnQgZm9sbG93cyBkZWZhdWx0IGFyZ3VtZW50IiwKICAgICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBmW2UrK10gPSBHKGEsIHEpCiAgICAgICAgICAgICAgZyArPSAyCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgY2FzZSB2LlRfU1RBUjoKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBnICsgMSA+PSBiKGQpIHx8CiAgICAgICAgICAgICAgICAoZyArIDIgPT0gYihkKSAmJiBjKGQsIGcgKyAxKS50eXBlID09IHYuVF9DT01NQSkKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICAgIm5hbWVkIGFyZ3VtZW50cyBtdXN0IGZvbGxvdyBiYXJlICoiLAogICAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIHEgPSBjKGQsIGcgKyAxKQogICAgICAgICAgICAgIHEudHlwZSA9PSB2LlRfQ09NTUEKICAgICAgICAgICAgICAgID8gKChnICs9IDIpLCAoZyA9IHooYSwgZCwgZywgaCwgdykpKQogICAgICAgICAgICAgICAgOiAoKHIgPSBHKGEsIHEpKSwKICAgICAgICAgICAgICAgICAgKGcgKz0gMyksCiAgICAgICAgICAgICAgICAgIGcgPCBiKGQpICYmCiAgICAgICAgICAgICAgICAgICAgKGMoZCwgZykudHlwZSA9PSB0LnRmcGRlZiB8fCBjKGQsIGcpLnR5cGUgPT0gdC52ZnBkZWYpICYmCiAgICAgICAgICAgICAgICAgICAgKGcgPSB6KGEsIGQsIGcsIGgsIHcpKSkKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIHYuVF9ET1VCTEVTVEFSOgogICAgICAgICAgICAgIHEgPSBjKGQsIGcgKyAxKQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHEudHlwZSA9PSB0LnRmcGRlZiB8fCBxLnR5cGUgPT0gdC52ZnBkZWYpCiAgICAgICAgICAgICAgbiA9IEcoYSwgcSkKICAgICAgICAgICAgICBnICs9IDMKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5leHBlY3RlZCBub2RlIGluIHZhcmFyZ3NsaXN0IikKICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hcmd1bWVudHNfKGYsIHIsIGgsIHcsIG4sIGwpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gVihhLCBrLCBnLCBmKSB7CiAgICAgICAgdmFyIGwgPSBmID8gYyhrLCAxKSA6IGssCiAgICAgICAgICB3ID0gbnVsbCwKICAgICAgICAgIG4gPSAxLAogICAgICAgICAgUiA9IG51bGwKICAgICAgICBpZiAoZiAmJiA1ID4gYS5jX2ZlYXR1cmVfdmVyc2lvbikKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGUoCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBsLAogICAgICAgICAgICAgICJBc3luYyBmdW5jdGlvbnMgYXJlIG9ubHkgc3VwcG9ydGVkIGluIFB5dGhvbiAzLjUgYW5kIGdyZWF0ZXIiLAogICAgICAgICAgICApLAogICAgICAgICAgICBudWxsCiAgICAgICAgICApCiAgICAgICAgZChsLCB0LmZ1bmNkZWYpCiAgICAgICAgdmFyIHEgPSByKGMobCwgbikpCiAgICAgICAgaWYgKGgoYSwgcSwgYyhsLCBuKSwgMCkpIHJldHVybiBudWxsCiAgICAgICAgdmFyIFQgPSBQKGEsIGMobCwgbiArIDEpKQogICAgICAgIGlmICghVCkgcmV0dXJuIG51bGwKICAgICAgICBpZiAoYyhsLCBuICsgMikudHlwZSA9PSB2LlRfUkFSUk9XKSB7CiAgICAgICAgICB3ID0gdShhLCBjKGwsIG4gKyAzKSkKICAgICAgICAgIGlmICghdykgcmV0dXJuIG51bGwKICAgICAgICAgIG4gKz0gMgogICAgICAgIH0KICAgICAgICBpZiAoYyhsLCBuICsgMykudHlwZSA9PSB2LlRfVFlQRV9DT01NRU5UKSB7CiAgICAgICAgICBSID0gdi5UX05FV19UWVBFX0NPTU1FTlQoYyhsLCBuICsgMykpCiAgICAgICAgICBpZiAoIVIpIHJldHVybiBudWxsCiAgICAgICAgICBuICs9IDEKICAgICAgICB9CiAgICAgICAgdmFyIE8gPSB4KGEsIGMobCwgbiArIDMpKQogICAgICAgIGlmICghTykgcmV0dXJuIG51bGwKICAgICAgICBpZiAoCiAgICAgICAgICAxIDwgYihjKGwsIG4gKyAzKSkgJiYKICAgICAgICAgICgobiA9IGMoYyhsLCBuICsgMyksIDEpKSwgbi50eXBlID09IHYuVF9UWVBFX0NPTU1FTlQpCiAgICAgICAgKSB7CiAgICAgICAgICBpZiAobnVsbCAhPSBSKQogICAgICAgICAgICByZXR1cm4gZShhLCBsLCAiQ2Fubm90IGhhdmUgdHdvIHR5cGUgY29tbWVudHMgb24gZGVmIiksIG51bGwKICAgICAgICAgIFIgPSB2LlRfTkVXX1RZUEVfQ09NTUVOVChuKQogICAgICAgICAgaWYgKCFSKSByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICByZXR1cm4gZgogICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuQXN5bmNGdW5jdGlvbkRlZigKICAgICAgICAgICAgICBxLAogICAgICAgICAgICAgIFQsCiAgICAgICAgICAgICAgTywKICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgIHcsCiAgICAgICAgICAgICAgUiwKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgKQogICAgICAgICAgOiBuZXcgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWYoCiAgICAgICAgICAgICAgcSwKICAgICAgICAgICAgICBULAogICAgICAgICAgICAgIE8sCiAgICAgICAgICAgICAgZywKICAgICAgICAgICAgICB3LAogICAgICAgICAgICAgIFIsCiAgICAgICAgICAgICAgbC5saW5lbm8sCiAgICAgICAgICAgICAgbC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBYKGEsIGUsIGspIHsKICAgICAgICBkKGUsIHQuY2xhc3NkZWYpCiAgICAgICAgaWYgKDQgPT0gYihlKSkgewogICAgICAgICAgdmFyIGcgPSB4KGEsIGMoZSwgMykpCiAgICAgICAgICB2YXIgZiA9IHIoYyhlLCAxKS52YWx1ZSkKICAgICAgICAgIGgoYSwgYyhlLCAzKSwgZiwgZS5saW5lbm8pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNsYXNzRGVmKAogICAgICAgICAgICBmLAogICAgICAgICAgICBbXSwKICAgICAgICAgICAgW10sCiAgICAgICAgICAgIGcsCiAgICAgICAgICAgIGssCiAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmIChjKGUsIDMpLnR5cGUgPT09IHYuVF9SUEFSKQogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgKGcgPSB4KGEsIGMoZSwgNSkpKSwKICAgICAgICAgICAgKGYgPSByKGMoZSwgMSkudmFsdWUpKSwKICAgICAgICAgICAgaChhLCBjKGUsIDMpLCBmLCBjKGUsIDMpLmxpbmVubyksCiAgICAgICAgICAgIG5ldyBTay5hc3Rub2Rlcy5DbGFzc0RlZigKICAgICAgICAgICAgICBmLAogICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgKQogICAgICAgIGYgPSByKGMoZSwgMSkpCiAgICAgICAgZiA9IG5ldyBTay5hc3Rub2Rlcy5OYW1lKGYsIFNrLmFzdG5vZGVzLkxvYWQsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgdmFyIGwgPSBLKGEsIGMoZSwgMyksIGYsICExKQogICAgICAgIGcgPSB4KGEsIGMoZSwgNikpCiAgICAgICAgZiA9IHIoYyhlLCAxKS52YWx1ZSkKICAgICAgICBoKGEsIGMoZSwgMSksIGYsIGMoZSwgMSkubGluZW5vKQogICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQ2xhc3NEZWYoCiAgICAgICAgICBmLAogICAgICAgICAgbC5hcmdzLAogICAgICAgICAgbC5rZXl3b3JkcywKICAgICAgICAgIGcsCiAgICAgICAgICBrLAogICAgICAgICAgbnVsbCwKICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBZKGEsIGUpIHsKICAgICAgICBmdW5jdGlvbiBrKGEsIGUpIHsKICAgICAgICAgIGZvciAoYSA9IDA7IDsgKSB7CiAgICAgICAgICAgIGQoZSwgdC5jb21wX2l0ZXIpCiAgICAgICAgICAgIGlmIChjKGUsIDApLnR5cGUgPT09IHQuY29tcF9mb3IpIHJldHVybiBhCiAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgIGQoZSwgdC5jb21wX2lmKQogICAgICAgICAgICBhKysKICAgICAgICAgICAgaWYgKDIgPT09IGIoZSkpIHJldHVybiBhCiAgICAgICAgICAgIGUgPSBjKGUsIDIpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBnCiAgICAgICAgdmFyIGYgPSAoZnVuY3Rpb24oYSwgZSkgewogICAgICAgICAgYSA9IDAKICAgICAgICAgIGE6IGZvciAoOzspIHsKICAgICAgICAgICAgYSsrCiAgICAgICAgICAgIGQoZSwgdC5jb21wX2ZvcikKICAgICAgICAgICAgaWYgKDUgPT09IGIoZSkpIGUgPSBjKGUsIDQpCiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGEKICAgICAgICAgICAgYjogZm9yICg7OykgewogICAgICAgICAgICAgIGQoZSwgdC5jb21wX2l0ZXIpCiAgICAgICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgICAgICBpZiAoZS50eXBlID09PSB0LmNvbXBfZm9yKSBjb250aW51ZSBhCiAgICAgICAgICAgICAgZWxzZSBpZiAoZS50eXBlID09PSB0LmNvbXBfaWYpCiAgICAgICAgICAgICAgICBpZiAoMyA9PT0gYihlKSkgewogICAgICAgICAgICAgICAgICBlID0gYyhlLCAyKQogICAgICAgICAgICAgICAgICBjb250aW51ZSBiCiAgICAgICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGEKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoImxvZ2ljIGVycm9yIGluIGNvdW50Q29tcEZvcnMiKQogICAgICAgIH0pKGEsIGUpCiAgICAgICAgdmFyIGwgPSBbXQogICAgICAgIGZvciAoZyA9IDA7IGcgPCBmOyArK2cpIHsKICAgICAgICAgIGQoZSwgdC5jb21wX2ZvcikKICAgICAgICAgIHZhciBoID0gYyhlLCAxKQogICAgICAgICAgdmFyIG4gPSBIKGEsIGgsIFNrLmFzdG5vZGVzLlN0b3JlKQogICAgICAgICAgdmFyIHIgPSB1KGEsIGMoZSwgMykpCiAgICAgICAgICB2YXIgdyA9CiAgICAgICAgICAgIDEgPT09IGIoaCkKICAgICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5jb21wcmVoZW5zaW9uKG5bMF0sIHIsIFtdKQogICAgICAgICAgICAgIDogbmV3IFNrLmFzdG5vZGVzLmNvbXByZWhlbnNpb24oCiAgICAgICAgICAgICAgICAgIG5ldyBTay5hc3Rub2Rlcy5UdXBsZSgKICAgICAgICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLlN0b3JlLAogICAgICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICBpZiAoNSA9PT0gYihlKSkgewogICAgICAgICAgICBlID0gYyhlLCA0KQogICAgICAgICAgICB2YXIgcSA9IGsoYSwgZSkKICAgICAgICAgICAgaCA9IFtdCiAgICAgICAgICAgIGZvciAobiA9IDA7IG4gPCBxOyArK24pCiAgICAgICAgICAgICAgZChlLCB0LmNvbXBfaXRlciksCiAgICAgICAgICAgICAgICAoZSA9IGMoZSwgMCkpLAogICAgICAgICAgICAgICAgZChlLCB0LmNvbXBfaWYpLAogICAgICAgICAgICAgICAgKHIgPSB1KGEsIGMoZSwgMSkpKSwKICAgICAgICAgICAgICAgIChoW25dID0gciksCiAgICAgICAgICAgICAgICAzID09PSBiKGUpICYmIChlID0gYyhlLCAyKSkKICAgICAgICAgICAgZS50eXBlID09PSB0LmNvbXBfaXRlciAmJiAoZSA9IGMoZSwgMCkpCiAgICAgICAgICAgIHcuaWZzID0gaAogICAgICAgICAgfQogICAgICAgICAgbFtnXSA9IHcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGwKICAgICAgfQogICAgICBmdW5jdGlvbiBhYShhLCBlKSB7CiAgICAgICAgdmFyIGsgPSBbXQogICAgICAgIGE6IHsKICAgICAgICAgIHZhciBnID0gZQogICAgICAgICAgdmFyIGYgPSAwCiAgICAgICAgICBiOiBmb3IgKDs7KSB7CiAgICAgICAgICAgIHZhciBsID0gMAogICAgICAgICAgICBmKysKICAgICAgICAgICAgZChnLCB0LmNvbXBfZm9yKQogICAgICAgICAgICBjKGcsIDApLnR5cGUgPT0gdi5UX0FTWU5DICYmIChsID0gMSkKICAgICAgICAgICAgaWYgKGIoZykgPT0gNSArIGwpIGcgPSBjKGcsIDQgKyBsKQogICAgICAgICAgICBlbHNlIGJyZWFrIGEKICAgICAgICAgICAgYzogZm9yICg7OykgewogICAgICAgICAgICAgIGQoZywgdC5jb21wX2l0ZXIpCiAgICAgICAgICAgICAgZyA9IGMoZywgMCkKICAgICAgICAgICAgICBpZiAoZy50eXBlID09PSB0LmNvbXBfZm9yKSBjb250aW51ZSBiCiAgICAgICAgICAgICAgZWxzZSBpZiAoZy50eXBlID09PSB0LmNvbXBfaWYpCiAgICAgICAgICAgICAgICBpZiAoMyA9PT0gYihnKSkgewogICAgICAgICAgICAgICAgICBnID0gYyhnLCAyKQogICAgICAgICAgICAgICAgICBjb250aW51ZSBjCiAgICAgICAgICAgICAgICB9IGVsc2UgYnJlYWsgYQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICAgIGYgPSB2b2lkIDAKICAgICAgICB9CiAgICAgICAgZm9yIChnID0gMDsgZyA8IGY7IGcrKykgewogICAgICAgICAgdmFyIGggPSAwCiAgICAgICAgICBjKGUsIDApLnR5cGUgPT0gdi5UX0FTWU5DICYmIChoID0gMSkKICAgICAgICAgIHZhciBuID0gYyhlLCAxICsgaCkKICAgICAgICAgIHZhciByID0gSChhLCBuLCBTay5hc3Rub2Rlcy5TdG9yZSkKICAgICAgICAgIGlmICghcikgcmV0dXJuIG51bGwKICAgICAgICAgIGwgPSB1KGEsIGMoZSwgMyArIGgpKQogICAgICAgICAgaWYgKCFsKSByZXR1cm4gbnVsbAogICAgICAgICAgdmFyIHcgPSByWzBdCiAgICAgICAgICByID0KICAgICAgICAgICAgMSA9PSBiKG4pCiAgICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuY29tcHJlaGVuc2lvbih3LCBsLCBudWxsLCBoKQogICAgICAgICAgICAgIDogbmV3IFNrLmFzdG5vZGVzLmNvbXByZWhlbnNpb24oCiAgICAgICAgICAgICAgICAgIG5ldyBTay5hc3Rub2Rlcy5UdXBsZSgKICAgICAgICAgICAgICAgICAgICByLAogICAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLlN0b3JlLAogICAgICAgICAgICAgICAgICAgIHcubGluZW5vLAogICAgICAgICAgICAgICAgICAgIHcuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICBuLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgbi5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgIGlmIChiKGUpID09IDUgKyBoKSB7CiAgICAgICAgICAgIHcgPSBbXQogICAgICAgICAgICBlID0gYyhlLCA0ICsgaCkKICAgICAgICAgICAgYTogZm9yIChsID0gZSwgaCA9IDA7IDsgKSB7CiAgICAgICAgICAgICAgZChsLCB0LmNvbXBfaXRlcikKICAgICAgICAgICAgICBpZiAoYyhsLCAwKS50eXBlID09IHQuY29tcF9mb3IpIHsKICAgICAgICAgICAgICAgIG4gPSBoCiAgICAgICAgICAgICAgICBicmVhayBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGwgPSBjKGwsIDApCiAgICAgICAgICAgICAgZChsLCB0LmNvbXBfaWYpCiAgICAgICAgICAgICAgaCsrCiAgICAgICAgICAgICAgaWYgKDIgPT0gYihsKSkgewogICAgICAgICAgICAgICAgbiA9IGgKICAgICAgICAgICAgICAgIGJyZWFrIGEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbCA9IGMobCwgMikKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoLTEgPT0gbikgcmV0dXJuIG51bGwKICAgICAgICAgICAgZm9yIChoID0gMDsgaCA8IG47IGgrKykgewogICAgICAgICAgICAgIGQoZSwgdC5jb21wX2l0ZXIpCiAgICAgICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgICAgICBkKGUsIHQuY29tcF9pZikKICAgICAgICAgICAgICBsID0gdShhLCBjKGUsIDEpKQogICAgICAgICAgICAgIGlmICghbCkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICB3W2hdID0gbAogICAgICAgICAgICAgIDMgPT0gYihlKSAmJiAoZSA9IGMoZSwgMikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZS50eXBlID09IHQuY29tcF9pdGVyICYmIChlID0gYyhlLCAwKSkKICAgICAgICAgICAgci5pZnMgPSB3CiAgICAgICAgICB9CiAgICAgICAgICBrW2ddID0gcgogICAgICAgIH0KICAgICAgICByZXR1cm4gawogICAgICB9CiAgICAgIGZ1bmN0aW9uIFooYSwgZCwgaykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDEgPCBiKGQpKQogICAgICAgIHZhciBnID0gYyhkLCAwKQogICAgICAgIHZhciBmID0gdShhLCBnKQogICAgICAgIGlmIChmLmNvbnN0cnVjdG9yID09PSBTay5hc3Rub2Rlcy5TdGFycmVkKQogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgZShhLCBnLCAiaXRlcmFibGUgdW5wYWNraW5nIGNhbm5vdCBiZSB1c2VkIGluIGNvbXByZWhlbnNpb24iKSwgbnVsbAogICAgICAgICAgKQogICAgICAgIGEgPSBhYShhLCBjKGQsIDEpKQogICAgICAgIHJldHVybiAwID09IGsKICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLkdlbmVyYXRvckV4cCgKICAgICAgICAgICAgICBmLAogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgZC5saW5lbm8sCiAgICAgICAgICAgICAgZC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgIGQuZW5kX2xpbmVubywKICAgICAgICAgICAgICBkLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgICAgICA6IDEgPT0gawogICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuTGlzdENvbXAoCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgIGQuY29sX29mZnNldCwKICAgICAgICAgICAgICBkLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgZC5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgOiAyID09IGsKICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLlNldENvbXAoCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgIGQuY29sX29mZnNldCwKICAgICAgICAgICAgICBkLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgZC5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgOiBudWxsCiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmEoYSwgYikgewogICAgICAgIGQoYiwgdC5hdWdhc3NpZ24pCiAgICAgICAgYiA9IGMoYiwgMCkKICAgICAgICBzd2l0Y2ggKGIudmFsdWUuY2hhckF0KDApKSB7CiAgICAgICAgICBjYXNlICIrIjoKICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLkFkZAogICAgICAgICAgY2FzZSAiLSI6CiAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5TdWIKICAgICAgICAgIGNhc2UgIi8iOgogICAgICAgICAgICByZXR1cm4gIi8iID09PSBiLnZhbHVlLmNoYXJBdCgxKQogICAgICAgICAgICAgID8gU2suYXN0bm9kZXMuRmxvb3JEaXYKICAgICAgICAgICAgICA6IFNrLmFzdG5vZGVzLkRpdgogICAgICAgICAgY2FzZSAiJSI6CiAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5Nb2QKICAgICAgICAgIGNhc2UgIjwiOgogICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuTFNoaWZ0CiAgICAgICAgICBjYXNlICI+IjoKICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLlJTaGlmdAogICAgICAgICAgY2FzZSAiJiI6CiAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5CaXRBbmQKICAgICAgICAgIGNhc2UgIl4iOgogICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuQml0WG9yCiAgICAgICAgICBjYXNlICJ8IjoKICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLkJpdE9yCiAgICAgICAgICBjYXNlICIqIjoKICAgICAgICAgICAgcmV0dXJuICIqIiA9PT0gYi52YWx1ZS5jaGFyQXQoMSkKICAgICAgICAgICAgICA/IFNrLmFzdG5vZGVzLlBvdwogICAgICAgICAgICAgIDogU2suYXN0bm9kZXMuTXVsdAogICAgICAgICAgY2FzZSAiQCI6CiAgICAgICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLnB5dGhvbjMpIHJldHVybiBTay5hc3Rub2Rlcy5NYXRNdWx0CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoImludmFsaWQgYXVnYXNzaWduIikKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSShhLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8IGIoZCkpCiAgICAgICAgZC50eXBlID09PSB0LnRlc3RsaXN0X2NvbXAKICAgICAgICAgID8gMSA8IGIoZCkgJiYgU2suYXNzZXJ0cy5hc3NlcnQoYyhkLCAxKS50eXBlICE9PSB0LmNvbXBfZm9yKQogICAgICAgICAgOiBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICAgICBkLnR5cGUgPT09IHQudGVzdGxpc3QgfHwgZC50eXBlID09PSB0LnRlc3RsaXN0X3N0YXJfZXhwciwKICAgICAgICAgICAgKQogICAgICAgIHJldHVybiAxID09PSBiKGQpCiAgICAgICAgICA/IHUoYSwgYyhkLCAwKSkKICAgICAgICAgIDogbmV3IFNrLmFzdG5vZGVzLlR1cGxlKAogICAgICAgICAgICAgIEQoYSwgZCksCiAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBFKGEsIGUpIHsKICAgICAgICBkKGUsIHQuZXhwcl9zdG10KQogICAgICAgIGlmICgxID09PSBiKGUpKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5FeHByKEkoYSwgYyhlLCAwKSksIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgaWYgKGMoZSwgMSkudHlwZSA9PT0gdC5hdWdhc3NpZ24pIHsKICAgICAgICAgIHZhciBnID0gYyhlLCAwKQogICAgICAgICAgdmFyIGYgPSBJKGEsIGcpCiAgICAgICAgICBrKGEsIGYsIFNrLmFzdG5vZGVzLlN0b3JlLCBnKQogICAgICAgICAgc3dpdGNoIChmLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZToKICAgICAgICAgICAgICB2YXIgbCA9IGYuaWQKICAgICAgICAgICAgICBoKGEsIGcsIGwsIGUubGluZW5vKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXR0cmlidXRlOgogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN1YnNjcmlwdDoKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkdlbmVyYXRvckV4cDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJhdWdtZW50ZWQgYXNzaWdubWVudCB0byBnZW5lcmF0b3IgZXhwcmVzc2lvbiBub3QgcG9zc2libGUiLAogICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLllpZWxkOgogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgImF1Z21lbnRlZCBhc3NpZ25tZW50IHRvIHlpZWxkIGV4cHJlc3Npb24gbm90IHBvc3NpYmxlIiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJpbGxlZ2FsIGV4cHJlc3Npb24gZm9yIGF1Z21lbnRlZCBhc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICAgIGcgPSBjKGUsIDIpCiAgICAgICAgICBsID0gZy50eXBlID09PSB0LnRlc3RsaXN0ID8gSShhLCBnKSA6IHUoYSwgZykKICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQXVnQXNzaWduKAogICAgICAgICAgICBmLAogICAgICAgICAgICBiYShhLCBjKGUsIDEpKSwKICAgICAgICAgICAgbCwKICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgaWYgKGMoZSwgMSkudHlwZSA9PT0gdC5hbm5hc3NpZ24pIHsKICAgICAgICAgIGlmICghU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAiQW5ub3RhdGVkIGFzc2lnbm1lbnQgaXMgbm90IHN1cHBvcnRlZCBpbiBQeXRob24gMiIsCiAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICApCiAgICAgICAgICBnID0gYyhlLCAwKQogICAgICAgICAgdmFyIG4gPSBjKGUsIDEpCiAgICAgICAgICB2YXIgciA9IDEKICAgICAgICAgIGZvciAoZiA9IGc7IDEgPT0gYihmKTsgKSBmID0gYyhmLCAwKQogICAgICAgICAgMCA8IGIoZikgJiYgYyhmLCAwKS50eXBlID09IHYuVF9MUEFSICYmIChyID0gMCkKICAgICAgICAgIGYgPSBJKGEsIGcpCiAgICAgICAgICBzd2l0Y2ggKGYuY29uc3RydWN0b3IpIHsKICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lOgogICAgICAgICAgICAgIGwgPSBmLmlkCiAgICAgICAgICAgICAgaChhLCBnLCBsLCBlLmxpbmVubykKICAgICAgICAgICAgICBrKGEsIGYsIFNrLmFzdG5vZGVzLlN0b3JlLCBnKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXR0cmlidXRlOgogICAgICAgICAgICAgIGwgPSBmLmF0dHIKICAgICAgICAgICAgICBoKGEsIGcsIGwsIGUubGluZW5vKQogICAgICAgICAgICAgIGsoYSwgZiwgU2suYXN0bm9kZXMuU3RvcmUsIGcpCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdWJzY3JpcHQ6CiAgICAgICAgICAgICAgayhhLCBmLCBTay5hc3Rub2Rlcy5TdG9yZSwgZykKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxpc3Q6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAib25seSBzaW5nbGUgdGFyZ2V0IChub3QgbGlzdCkgY2FuIGJlIGFubm90YXRlZCIsCiAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVHVwbGU6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAib25seSBzaW5nbGUgdGFyZ2V0IChub3QgdHVwbGUpIGNhbiBiZSBhbm5vdGF0ZWQiLAogICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgImlsbGVnYWwgdGFyZ2V0IGZvciBhbm5vdGF0aW9uIiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICAgIGYuY29uc3RydWN0b3IgIT0gU2suYXN0bm9kZXMuTmFtZSAmJiAociA9IDApCiAgICAgICAgICBnID0gYyhuLCAxKQogICAgICAgICAgbCA9IHUoYSwgZykKICAgICAgICAgIGlmICgyID09IGIobikpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQW5uQXNzaWduKAogICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgICAgICBnID0gYyhuLCAzKQogICAgICAgICAgYSA9IHUoYSwgZykKICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQW5uQXNzaWduKGYsIGwsIGEsIHIsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgfQogICAgICAgIGQoYyhlLCAxKSwgdi5UX0VRVUFMKQogICAgICAgIHIgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCBiKGUpIC0gMjsgZiArPSAyKSB7CiAgICAgICAgICBnID0gYyhlLCBmKQogICAgICAgICAgaWYgKGcudHlwZSA9PT0gdC55aWVsZF9leHByKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAiYXNzaWdubWVudCB0byB5aWVsZCBleHByZXNzaW9uIG5vdCBwb3NzaWJsZSIsCiAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICApCiAgICAgICAgICBnID0gSShhLCBnKQogICAgICAgICAgayhhLCBnLCBTay5hc3Rub2Rlcy5TdG9yZSwgYyhlLCBmKSkKICAgICAgICAgIHJbZiAvIDJdID0gZwogICAgICAgIH0KICAgICAgICBnID0gYyhlLCBiKGUpIC0gMSkKICAgICAgICBhID0gZy50eXBlID09PSB0LnRlc3RsaXN0X3N0YXJfZXhwciA/IEkoYSwgZykgOiB1KGEsIGcpCiAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5Bc3NpZ24ociwgYSwgZS5saW5lbm8sIGUuY29sX29mZnNldCkKICAgICAgfQogICAgICBmdW5jdGlvbiBOKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGIuY2hhckF0KDApLAogICAgICAgICAgZCA9ICExLAogICAgICAgICAgZSA9ICExCiAgICAgICAgaWYgKAogICAgICAgICAgYS5jX2ZsYWdzICYgU2suUGFyc2VyLkNPX0ZVVFVSRV9VTklDT0RFX0xJVEVSQUxTIHx8CiAgICAgICAgICAhMCA9PT0gU2suX19mdXR1cmVfXy51bmljb2RlX2xpdGVyYWxzCiAgICAgICAgKQogICAgICAgICAgZSA9ICEwCiAgICAgICAgaWYgKCJ1IiA9PT0gYyB8fCAiVSIgPT09IGMpCiAgICAgICAgICAoYiA9IGIuc3Vic3RyKDEpKSwgKGMgPSBiLmNoYXJBdCgwKSksIChlID0gITApCiAgICAgICAgZWxzZSBpZiAoInIiID09PSBjIHx8ICJSIiA9PT0gYykKICAgICAgICAgIChiID0gYi5zdWJzdHIoMSkpLCAoYyA9IGIuY2hhckF0KDApKSwgKGQgPSAhMCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJiIiAhPT0gYyAmJiAiQiIgIT09IGMsCiAgICAgICAgICAidG9kbzsgaGF2ZW4ndCBkb25lIGInJyBzdHJpbmdzIHlldCIsCiAgICAgICAgKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgIiciID09PSBjIHx8ICgnIicgPT09IGMgJiYgYi5jaGFyQXQoYi5sZW5ndGggLSAxKSA9PT0gYyksCiAgICAgICAgKQogICAgICAgIGIgPSBiLnN1YnN0cigxLCBiLmxlbmd0aCAtIDIpCiAgICAgICAgZSAmJiAoYiA9IHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChiKSkpCiAgICAgICAgNCA8PSBiLmxlbmd0aCAmJgogICAgICAgICAgYi5jaGFyQXQoMCkgPT09IGMgJiYKICAgICAgICAgIGIuY2hhckF0KDEpID09PSBjICYmCiAgICAgICAgICAoU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAgIGIuY2hhckF0KGIubGVuZ3RoIC0gMSkgPT09IGMgJiYgYi5jaGFyQXQoYi5sZW5ndGggLSAyKSA9PT0gYywKICAgICAgICAgICksCiAgICAgICAgICAoYiA9IGIuc3Vic3RyKDIsIGIubGVuZ3RoIC0gNCkpKQogICAgICAgIGlmIChkIHx8IC0xID09PSBiLmluZGV4T2YoIlxcIikpIGEgPSBmKGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoYikpKQogICAgICAgIGVsc2UgewogICAgICAgICAgYSA9IGIKICAgICAgICAgIGMgPSBhLmxlbmd0aAogICAgICAgICAgZCA9ICIiCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYzsgKytiKQogICAgICAgICAgICBpZiAoKChlID0gYS5jaGFyQXQoYikpLCAiXFwiID09PSBlKSkKICAgICAgICAgICAgICBpZiAoKCsrYiwgKGUgPSBhLmNoYXJBdChiKSksICJuIiA9PT0gZSkpIGQgKz0gIlxuIgogICAgICAgICAgICAgIGVsc2UgaWYgKCJcXCIgPT09IGUpIGQgKz0gIlxcIgogICAgICAgICAgICAgIGVsc2UgaWYgKCJ0IiA9PT0gZSkgZCArPSAiXHQiCiAgICAgICAgICAgICAgZWxzZSBpZiAoInIiID09PSBlKSBkICs9ICJcciIKICAgICAgICAgICAgICBlbHNlIGlmICgiYiIgPT09IGUpIGQgKz0gIlxiIgogICAgICAgICAgICAgIGVsc2UgaWYgKCJmIiA9PT0gZSkgZCArPSAiXGYiCiAgICAgICAgICAgICAgZWxzZSBpZiAoInYiID09PSBlKSBkICs9ICJcdiIKICAgICAgICAgICAgICBlbHNlIGlmICgiMCIgPT09IGUpIGQgKz0gIlx4MDAiCiAgICAgICAgICAgICAgZWxzZSBpZiAoJyInID09PSBlKSBkICs9ICciJwogICAgICAgICAgICAgIGVsc2UgaWYgKCInIiA9PT0gZSkgZCArPSAiJyIKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgiXG4iICE9PSBlKQogICAgICAgICAgICAgICAgICBpZiAoIngiID09PSBlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBhLmNoYXJBdCgrK2IpCiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBhLmNoYXJBdCgrK2IpCiAgICAgICAgICAgICAgICAgICAgZCArPSB1bmVzY2FwZSgKICAgICAgICAgICAgICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudCgKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChrICsgZywgMTYpKSwKICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCJ1IiA9PT0gZSB8fCAiVSIgPT09IGUpIHsKICAgICAgICAgICAgICAgICAgICBrID0gYS5jaGFyQXQoKytiKQogICAgICAgICAgICAgICAgICAgIGcgPSBhLmNoYXJBdCgrK2IpCiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBhLmNoYXJBdCgrK2IpCiAgICAgICAgICAgICAgICAgICAgZSA9IGEuY2hhckF0KCsrYikKICAgICAgICAgICAgICAgICAgICBkICs9IHVuZXNjYXBlKAogICAgICAgICAgICAgICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlKAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KGsgKyBnLCAxNiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQobCArIGUsIDE2KSwKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICB9IGVsc2UgZCArPSAiXFwiICsgZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBkICs9IGUKICAgICAgICAgIGEgPSBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGQpKQogICAgICAgICAgYSA9IGYoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBmdW5jdGlvbiBVKGEsIGIsIGMpIHsKICAgICAgICBhID0gYi5jaGFyQXQoYi5sZW5ndGggLSAxKQogICAgICAgIGlmICgiaiIgPT09IGEgfHwgIkoiID09PSBhKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5jb21wbGV4X3N1YnR5cGVfZnJvbV9zdHJpbmcoYikKICAgICAgICBpZiAoImwiID09PSBhIHx8ICJMIiA9PT0gYSkKICAgICAgICAgIHJldHVybiBTay5sb25nRnJvbVN0cihiLnN1YnN0cigwLCBiLmxlbmd0aCAtIDEpLCAwKQogICAgICAgIGlmICgtMSAhPT0gYi5pbmRleE9mKCIuIikpIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8ocGFyc2VGbG9hdChiKSkKICAgICAgICBjID0gYgogICAgICAgIGEgPSAhMQogICAgICAgICItIiA9PT0gYi5jaGFyQXQoMCkgJiYgKChjID0gYi5zdWJzdHIoMSkpLCAoYSA9ICEwKSkKICAgICAgICBpZiAoCiAgICAgICAgICAiMCIgIT09IGMuY2hhckF0KDApIHx8CiAgICAgICAgICAoIngiICE9PSBjLmNoYXJBdCgxKSAmJiAiWCIgIT09IGMuY2hhckF0KDEpKQogICAgICAgICkgewogICAgICAgICAgaWYgKC0xICE9PSBiLmluZGV4T2YoImUiKSB8fCAtMSAhPT0gYi5pbmRleE9mKCJFIikpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8ocGFyc2VGbG9hdChiKSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgIjAiICE9PSBjLmNoYXJBdCgwKSB8fAogICAgICAgICAgICAoImIiICE9PSBjLmNoYXJBdCgxKSAmJiAiQiIgIT09IGMuY2hhckF0KDEpKQogICAgICAgICAgKQogICAgICAgICAgICBpZiAoIjAiID09PSBjLmNoYXJBdCgwKSkKICAgICAgICAgICAgICBpZiAoIjAiID09PSBjKSBjID0gMAogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYyA9IGMuc3Vic3RyaW5nKDEpCiAgICAgICAgICAgICAgICBpZiAoIm8iID09PSBjLmNoYXJBdCgwKSB8fCAiTyIgPT09IGMuY2hhckF0KDApKQogICAgICAgICAgICAgICAgICBjID0gYy5zdWJzdHJpbmcoMSkKICAgICAgICAgICAgICAgIGMgPSBwYXJzZUludChjLCA4KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBjID0gcGFyc2VJbnQoYywgMTApCiAgICAgICAgICBlbHNlIChjID0gYy5zdWJzdHJpbmcoMikpLCAoYyA9IHBhcnNlSW50KGMsIDIpKQogICAgICAgIH0gZWxzZSAoYyA9IGMuc3Vic3RyaW5nKDIpKSwgKGMgPSBwYXJzZUludChjLCAxNikpCiAgICAgICAgcmV0dXJuIGMgPiBTay5idWlsdGluLmludF8udGhyZXNob2xkJCAmJgogICAgICAgICAgTWF0aC5mbG9vcihjKSA9PT0gYyAmJgogICAgICAgICAgLTEgPT09IGIuaW5kZXhPZigiZSIpICYmCiAgICAgICAgICAtMSA9PT0gYi5pbmRleE9mKCJFIikKICAgICAgICAgID8gU2subG9uZ0Zyb21TdHIoYiwgMCkKICAgICAgICAgIDogYQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5pbnRfKC1jKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gRihhLCBlKSB7CiAgICAgICAgdmFyIGssIGcKICAgICAgICBkKGUsIHQuc3Vic2NyaXB0KQogICAgICAgIHZhciBmID0gYyhlLCAwKQogICAgICAgIHZhciBsID0gKGsgPSBnID0gbnVsbCkKICAgICAgICBpZiAoZi50eXBlID09PSB2LlRfRE9UKSByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkVsbGlwc2lzKCkKICAgICAgICBpZiAoMSA9PT0gYihlKSAmJiBmLnR5cGUgPT09IHQudGVzdCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuSW5kZXgodShhLCBmKSkKICAgICAgICBmLnR5cGUgPT09IHQudGVzdCAmJiAoZyA9IHUoYSwgZikpCiAgICAgICAgZi50eXBlID09PSB2LlRfQ09MT04KICAgICAgICAgID8gMSA8IGIoZSkgJiYgKChmID0gYyhlLCAxKSksIGYudHlwZSA9PT0gdC50ZXN0ICYmIChrID0gdShhLCBmKSkpCiAgICAgICAgICA6IDIgPCBiKGUpICYmICgoZiA9IGMoZSwgMikpLCBmLnR5cGUgPT09IHQudGVzdCAmJiAoayA9IHUoYSwgZikpKQogICAgICAgIGYgPSBjKGUsIGIoZSkgLSAxKQogICAgICAgIGYudHlwZSA9PT0gdC5zbGljZW9wICYmCiAgICAgICAgICAoMSA9PT0gYihmKQogICAgICAgICAgICA/ICgoZiA9IGMoZiwgMCkpLAogICAgICAgICAgICAgIChsID0gbmV3IFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudCgKICAgICAgICAgICAgICAgIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkxvYWQsCiAgICAgICAgICAgICAgICBmLmxpbmVubywKICAgICAgICAgICAgICAgIGYuY29sX29mZnNldCwKICAgICAgICAgICAgICApKSkKICAgICAgICAgICAgOiAoKGYgPSBjKGYsIDEpKSwgZi50eXBlID09PSB0LnRlc3QgJiYgKGwgPSB1KGEsIGYpKSkpCiAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5TbGljZShnLCBrLCBsKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFEoYSwgaykgewogICAgICAgIHZhciBnID0gYyhrLCAwKQogICAgICAgIHN3aXRjaCAoZy50eXBlKSB7CiAgICAgICAgICBjYXNlIHYuVF9OQU1FOgogICAgICAgICAgICBnID0gZy52YWx1ZQogICAgICAgICAgICBpZiAoNCA8PSBnLmxlbmd0aCAmJiA1ID49IGcubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKCJOb25lIiA9PT0gZykKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50KAogICAgICAgICAgICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgaWYgKCJUcnVlIiA9PT0gZykKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50KAogICAgICAgICAgICAgICAgICBTay5idWlsdGluLmJvb2wudHJ1ZSQsCiAgICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgaWYgKCJGYWxzZSIgPT09IGcpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudCgKICAgICAgICAgICAgICAgICAgU2suYnVpbHRpbi5ib29sLmZhbHNlJCwKICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgfQogICAgICAgICAgICBhID0gcihnLCBhKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLk5hbWUoCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICBrLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB2LlRfU1RSSU5HOgogICAgICAgICAgICBkKGMoaywgMCksIHYuVF9TVFJJTkcpCiAgICAgICAgICAgIHZhciBmID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCIiKQogICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgYihrKTsgKytnKQogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmID0gZi5zcSRjb25jYXQoTihhLCBjKGssIGcpLnZhbHVlKSkKICAgICAgICAgICAgICB9IGNhdGNoIChjYSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICJpbnZhbGlkIHN0cmluZyAocG9zc2libHkgY29udGFpbnMgYSB1bmljb2RlIGNoYXJhY3RlcikiLAogICAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgIGMoaywgZykubGluZW5vLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5TdHIoCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgYS5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2Ugdi5UX05VTUJFUjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5OdW0oCiAgICAgICAgICAgICAgVShhLCBnLnZhbHVlLCBrLmxpbmVubyksCiAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgICAgICBjYXNlIHYuVF9FTExJUFNJUzoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5FbGxpcHNpcygKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2Ugdi5UX0xQQVI6CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgKGcgPSBjKGssIDEpKSwKICAgICAgICAgICAgICBnLnR5cGUgPT0gdi5UX1JQQVIKICAgICAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLlR1cGxlKAogICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkxvYWQsCiAgICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICA6IGcudHlwZSA9PSB0LnlpZWxkX2V4cHIKICAgICAgICAgICAgICAgID8gdShhLCBnKQogICAgICAgICAgICAgICAgOiAxID09IGIoZykKICAgICAgICAgICAgICAgID8gSShhLCBnKQogICAgICAgICAgICAgICAgOiBjKGcsIDEpLnR5cGUgPT0gdC5jb21wX2ZvcgogICAgICAgICAgICAgICAgPyBxKEEoYSwgZyksIGspCiAgICAgICAgICAgICAgICA6IHEoSShhLCBnKSwgaykKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB2LlRfTFNRQjoKICAgICAgICAgICAgZyA9IGMoaywgMSkKICAgICAgICAgICAgaWYgKGcudHlwZSA9PSB2LlRfUlNRQikKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkxpc3QoCiAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkxvYWQsCiAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBkKGcsIHQudGVzdGxpc3RfY29tcCkKICAgICAgICAgICAgaWYgKDEgPT0gYihnKSB8fCBjKGcsIDEpLnR5cGUgPT0gdi5UX0NPTU1BKQogICAgICAgICAgICAgIHJldHVybiAoYSA9IEQoYSwgZykpCiAgICAgICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5MaXN0KAogICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIDogbnVsbAogICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChnLnR5cGUgPT0gdC50ZXN0bGlzdF9jb21wKQogICAgICAgICAgICBhID0gWihhLCBnLCAxKQogICAgICAgICAgICByZXR1cm4gcShhLCBrKQogICAgICAgICAgY2FzZSB2LlRfTEJSQUNFOgogICAgICAgICAgICBnID0gYyhrLCAxKQogICAgICAgICAgICBpZiAoZy50eXBlID09IHYuVF9SQlJBQ0UpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5EaWN0KAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBmID0gYyhnLCAwKS50eXBlID09IHYuVF9ET1VCTEVTVEFSCiAgICAgICAgICAgIGlmICgxID09IGIoZykgfHwgKDEgPCBiKGcpICYmIGMoZywgMSkudHlwZSA9PSB2LlRfQ09NTUEpKSB7CiAgICAgICAgICAgICAgdmFyIGwgPSBbXQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGcudHlwZSA9PT0gdC5kaWN0b3JzZXRtYWtlcikKICAgICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgYihnKTsgZiArPSAyKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9IHUoYSwgYyhnLCBmKSkKICAgICAgICAgICAgICAgIGxbZiAvIDJdID0gaAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhID0gbmV3IFNrLmFzdG5vZGVzLlNldChsLCBnLmxpbmVubywgZy5jb2xfb2Zmc2V0KQogICAgICAgICAgICB9IGVsc2UgaWYgKDEgPCBiKGcpICYmIGMoZywgMSkudHlwZSA9PSB0LmNvbXBfZm9yKQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGcudHlwZSA9PT0gdC5kaWN0b3JzZXRtYWtlciksCiAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgxIDwgYihnKSksCiAgICAgICAgICAgICAgICAoZiA9IHUoYSwgYyhnLCAwKSkpLAogICAgICAgICAgICAgICAgKGEgPSBZKGEsIGMoZywgMSkpKSwKICAgICAgICAgICAgICAgIChhID0gbmV3IFNrLmFzdG5vZGVzLlNldENvbXAoZiwgYSwgZy5saW5lbm8sIGcuY29sX29mZnNldCkpCiAgICAgICAgICAgIGVsc2UgaWYgKGIoZykgPiAzIC0gZiAmJiBjKGcsIDMgLSBmKS50eXBlID09IHQuY29tcF9mb3IpIHsKICAgICAgICAgICAgICBpZiAoZikKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIGUoCiAgICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgICBrLAogICAgICAgICAgICAgICAgICAgICJkaWN0IHVucGFja2luZyBjYW5ub3QgYmUgdXNlZCBpbiBkaWN0IGNvbXByZWhlbnNpb24iLAogICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMyA8IGIoZykpCiAgICAgICAgICAgICAgZChjKGcsIDEpLCB2LlRfQ09MT04pCiAgICAgICAgICAgICAgZiA9IHUoYSwgYyhnLCAwKSkKICAgICAgICAgICAgICBsID0gdShhLCBjKGcsIDIpKQogICAgICAgICAgICAgIGEgPSBZKGEsIGMoZywgMykpCiAgICAgICAgICAgICAgYSA9IG5ldyBTay5hc3Rub2Rlcy5EaWN0Q29tcChmLCBsLCBhLCBnLmxpbmVubywgZy5jb2xfb2Zmc2V0KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBuCiAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgaCA9IFtdCiAgICAgICAgICAgICAgZm9yIChuID0gZiA9IDA7IG4gPCBiKGcpOyBuKyspIHsKICAgICAgICAgICAgICAgIHZhciBtID0gYQogICAgICAgICAgICAgICAgdmFyIHcgPSBnLAogICAgICAgICAgICAgICAgICBwID0gbgogICAgICAgICAgICAgICAgaWYgKGModywgcCkudHlwZSA9PSB2LlRfRE9VQkxFU1RBUikKICAgICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMiA8PSBiKHcpIC0gcCksCiAgICAgICAgICAgICAgICAgICAgKG4gPSB1KG0sIGModywgcCArIDEpKSksCiAgICAgICAgICAgICAgICAgICAgKG0gPSB7IGtleTogbnVsbCwgdmFsdWU6IG4sIGk6IHAgKyAyIH0pCiAgICAgICAgICAgICAgICBlbHNlIGlmICgKICAgICAgICAgICAgICAgICAgKFNrLmFzc2VydHMuYXNzZXJ0KDMgPD0gYih3KSAtIHApLCAobiA9IHUobSwgYyh3LCBwKSkpKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHZhciB4ID0gbgogICAgICAgICAgICAgICAgICBkKGModywgcCArIDEpLCB2LlRfQ09MT04pCiAgICAgICAgICAgICAgICAgIG0gPSAobiA9IHUobSwgYyh3LCBwICsgMikpKQogICAgICAgICAgICAgICAgICAgID8geyBrZXk6IHgsIHZhbHVlOiBuLCBpOiBwICsgMyB9CiAgICAgICAgICAgICAgICAgICAgOiAhMQogICAgICAgICAgICAgICAgfSBlbHNlIG0gPSAwCiAgICAgICAgICAgICAgICBuID0gbS5pCiAgICAgICAgICAgICAgICBsW2ZdID0gbS5rZXkKICAgICAgICAgICAgICAgIGhbZl0gPSBtLnZhbHVlCiAgICAgICAgICAgICAgICBmKysKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYSA9IG5ldyBTay5hc3Rub2Rlcy5EaWN0KAogICAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICBnLmxpbmVubywKICAgICAgICAgICAgICAgIGcuY29sX29mZnNldCwKICAgICAgICAgICAgICAgIGcuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgIGcuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBxKGEsIGspCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gU2suYXNzZXJ0LmZhaWwoInVuaGFuZGxlZCBhdG9tICIgKyBnLnR5cGUpLCBudWxsCiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHkoYSwgZSkgewogICAgICAgIHZhciBrLAogICAgICAgICAgZyA9IDAKICAgICAgICBkKGUsIHQuYXRvbV9leHByKQogICAgICAgIHZhciBmID0gYihlKQogICAgICAgIGMoZSwgMCkudHlwZSA9PT0gdi5UX0FXQUlUICYmICgoZyA9IDEpLCBTay5hc3NlcnRzLmFzc2VydCgxIDwgZikpCiAgICAgICAgdmFyIGwgPSBRKGEsIGMoZSwgZykpCiAgICAgICAgaWYgKCFsKSByZXR1cm4gbnVsbAogICAgICAgIGlmICgxID09PSBmKSByZXR1cm4gbAogICAgICAgIGlmIChnICYmIDIgPT09IGYpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkF3YWl0KGwsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgZm9yIChrID0gZyArIDE7IGsgPCBmOyBrKyspIHsKICAgICAgICAgIHZhciBoID0gYyhlLCBrKQogICAgICAgICAgaWYgKGgudHlwZSAhPT0gdC50cmFpbGVyKSBicmVhawogICAgICAgICAgaCA9IEIoYSwgaCwgbCkKICAgICAgICAgIGlmICghaCkgcmV0dXJuIG51bGwKICAgICAgICAgIGgubGluZW5vID0gbC5saW5lbm8KICAgICAgICAgIGguY29sX29mZnNldCA9IGwuY29sX29mZnNldAogICAgICAgICAgbCA9IGgKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGcgPyBuZXcgU2suYXN0bm9kZXMuQXdhaXQobCwgZS5saW5lLCBlLmNvbF9vZmZzZXQpIDogbAogICAgICB9CiAgICAgIGZ1bmN0aW9uIHUoYSwgZSkgewogICAgICAgIGE6IGZvciAoOzspIHsKICAgICAgICAgIHN3aXRjaCAoZS50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgdC50ZXN0OgogICAgICAgICAgICBjYXNlIHQudGVzdF9ub2NvbmQ6CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgYyhlLCAwKS50eXBlID09PSB0LmxhbWJkZWYgfHwKICAgICAgICAgICAgICAgIGMoZSwgMCkudHlwZSA9PT0gdC5sYW1iZGVmX25vY29uZAogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdmFyIGsgPSBjKGUsIDApCiAgICAgICAgICAgICAgICAzID09PSBiKGspCiAgICAgICAgICAgICAgICAgID8gKChlID0gbmV3IFNrLmFzdG5vZGVzLmFyZ3VtZW50c18oW10sIG51bGwsIG51bGwsIFtdKSksCiAgICAgICAgICAgICAgICAgICAgKGEgPSB1KGEsIGMoaywgMikpKSkKICAgICAgICAgICAgICAgICAgOiAoKGUgPSBQKGEsIGMoaywgMSkpKSwgKGEgPSB1KGEsIGMoaywgMykpKSkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuTGFtYmRhKGUsIGEsIGsubGluZW5vLCBrLmNvbF9vZmZzZXQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICgxIDwgYihlKSkKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDUgPT09IGIoZSkpLAogICAgICAgICAgICAgICAgICBuZXcgU2suYXN0bm9kZXMuSWZFeHAoCiAgICAgICAgICAgICAgICAgICAgdShhLCBjKGUsIDIpKSwKICAgICAgICAgICAgICAgICAgICB1KGEsIGMoZSwgMCkpLAogICAgICAgICAgICAgICAgICAgIHUoYSwgYyhlLCA0KSksCiAgICAgICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgdC5vcl90ZXN0OgogICAgICAgICAgICBjYXNlIHQuYW5kX3Rlc3Q6CiAgICAgICAgICAgICAgaWYgKDEgPT09IGIoZSkpIHsKICAgICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgICBjb250aW51ZSBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBnID0gW10KICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgYihlKTsgayArPSAyKSBnW2sgLyAyXSA9IHUoYSwgYyhlLCBrKSkKICAgICAgICAgICAgICBpZiAoImFuZCIgPT09IGMoZSwgMSkudmFsdWUpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkJvb2xPcCgKICAgICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuQW5kLAogICAgICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJvciIgPT09IGMoZSwgMSkudmFsdWUpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5Cb29sT3AoCiAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5PciwKICAgICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgdC5ub3RfdGVzdDoKICAgICAgICAgICAgICBpZiAoMSA9PT0gYihlKSkgewogICAgICAgICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlIGEKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuVW5hcnlPcCgKICAgICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTm90LAogICAgICAgICAgICAgICAgICB1KGEsIGMoZSwgMSkpLAogICAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQuY29tcGFyaXNvbjoKICAgICAgICAgICAgICBpZiAoMSA9PT0gYihlKSkgewogICAgICAgICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlIGEKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGYgPSBbXQogICAgICAgICAgICAgICAgZyA9IFtdCiAgICAgICAgICAgICAgICBmb3IgKGsgPSAxOyBrIDwgYihlKTsgayArPSAyKQogICAgICAgICAgICAgICAgICAoZlsoayAtIDEpIC8gMl0gPSBuKGEsIGMoZSwgaykpKSwKICAgICAgICAgICAgICAgICAgICAoZ1soayAtIDEpIC8gMl0gPSB1KGEsIGMoZSwgayArIDEpKSkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQ29tcGFyZSgKICAgICAgICAgICAgICAgICAgdShhLCBjKGUsIDApKSwKICAgICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgICAgZywKICAgICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgdC5zdGFyX2V4cHI6CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGQoZSwgdC5zdGFyX2V4cHIpLAogICAgICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLlN0YXJyZWQoCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhlLCAxKSksCiAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkxvYWQsCiAgICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQuZXhwcjoKICAgICAgICAgICAgY2FzZSB0Lnhvcl9leHByOgogICAgICAgICAgICBjYXNlIHQuYW5kX2V4cHI6CiAgICAgICAgICAgIGNhc2UgdC5zaGlmdF9leHByOgogICAgICAgICAgICBjYXNlIHQuYXJpdGhfZXhwcjoKICAgICAgICAgICAgY2FzZSB0LnRlcm06CiAgICAgICAgICAgICAgaWYgKDEgPT09IGIoZSkpIHsKICAgICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgICBjb250aW51ZSBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBoID0gZSwKICAgICAgICAgICAgICAgIHIgPSBuZXcgU2suYXN0bm9kZXMuQmluT3AoCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAwKSksCiAgICAgICAgICAgICAgICAgIGwoYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAyKSksCiAgICAgICAgICAgICAgICAgIGgubGluZW5vLAogICAgICAgICAgICAgICAgICBoLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgcSA9IChiKGgpIC0gMSkgLyAyCiAgICAgICAgICAgICAgZm9yIChlID0gMTsgZSA8IHE7ICsrZSkKICAgICAgICAgICAgICAgIChrID0gYyhoLCAyICogZSArIDEpKSwKICAgICAgICAgICAgICAgICAgKGcgPSBsKGspKSwKICAgICAgICAgICAgICAgICAgKGYgPSB1KGEsIGMoaCwgMiAqIGUgKyAyKSkpLAogICAgICAgICAgICAgICAgICAociA9IG5ldyBTay5hc3Rub2Rlcy5CaW5PcChyLCBnLCBmLCBrLmxpbmVubywgay5jb2xfb2Zmc2V0KSkKICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgICAgICBjYXNlIHQueWllbGRfZXhwcjoKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKGcgPSAhMSksCiAgICAgICAgICAgICAgICAoZiA9IG51bGwpLAogICAgICAgICAgICAgICAgMSA8IGIoZSkgJiYgKGsgPSBjKGUsIDEpKSwKICAgICAgICAgICAgICAgIGsgJiYKICAgICAgICAgICAgICAgICAgKChmID0gYyhrLCBiKGspIC0gMSkpLAogICAgICAgICAgICAgICAgICAyID09IGIoaykgPyAoKGcgPSAhMCksIChmID0gdShhLCBmKSkpIDogKGYgPSBJKGEsIGYpKSksCiAgICAgICAgICAgICAgICBnCiAgICAgICAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLllpZWxkRnJvbShmLCBlLmxpbmVubywgZS5jb2xfb2Zmc2V0KQogICAgICAgICAgICAgICAgICA6IG5ldyBTay5hc3Rub2Rlcy5ZaWVsZChmLCBlLmxpbmVubywgZS5jb2xfb2Zmc2V0KQogICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LmZhY3RvcjoKICAgICAgICAgICAgICBpZiAoMSA9PT0gYihlKSkgewogICAgICAgICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlIGEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIEMoYSwgZSkKICAgICAgICAgICAgY2FzZSB0LnBvd2VyOgogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAoayA9IGUpLAogICAgICAgICAgICAgICAgZChrLCB0LnBvd2VyKSwKICAgICAgICAgICAgICAgIChlID0geShhLCBjKGssIDApKSksCiAgICAgICAgICAgICAgICAxICE9PSBiKGspICYmCiAgICAgICAgICAgICAgICAgIGMoaywgYihrKSAtIDEpLnR5cGUgPT09IHQuZmFjdG9yICYmCiAgICAgICAgICAgICAgICAgICgoYSA9IHUoYSwgYyhrLCBiKGspIC0gMSkpKSwKICAgICAgICAgICAgICAgICAgKGUgPSBuZXcgU2suYXN0bm9kZXMuQmluT3AoCiAgICAgICAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Qb3csCiAgICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICkpKSwKICAgICAgICAgICAgICAgIGUKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgZXhwciIsICJuLnR5cGU6ICVkIiwgZS50eXBlKQogICAgICAgICAgfQogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTChhLCBsKSB7CiAgICAgICAgbC50eXBlID09PSB0LnN0bXQgJiYgKFNrLmFzc2VydHMuYXNzZXJ0KDEgPT09IGIobCkpLCAobCA9IGMobCwgMCkpKQogICAgICAgIGwudHlwZSA9PT0gdC5zaW1wbGVfc3RtdCAmJgogICAgICAgICAgKFNrLmFzc2VydHMuYXNzZXJ0KDEgPT09IGcobCkpLCAobCA9IGMobCwgMCkpKQogICAgICAgIGlmIChsLnR5cGUgPT09IHQuc21hbGxfc3RtdCkKICAgICAgICAgIHN3aXRjaCAoKChsID0gYyhsLCAwKSksIGwudHlwZSkpIHsKICAgICAgICAgICAgY2FzZSB0LmV4cHJfc3RtdDoKICAgICAgICAgICAgICByZXR1cm4gRShhLCBsKQogICAgICAgICAgICBjYXNlIHQuZGVsX3N0bXQ6CiAgICAgICAgICAgICAgdmFyIGggPSBsCiAgICAgICAgICAgICAgZChoLCB0LmRlbF9zdG10KQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuRGVsZXRlKAogICAgICAgICAgICAgICAgSChhLCBjKGgsIDEpLCBTay5hc3Rub2Rlcy5EZWwpLAogICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICBoLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQucGFzc19zdG10OgogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuUGFzcyhsLmxpbmVubywgbC5jb2xfb2Zmc2V0KQogICAgICAgICAgICBjYXNlIHQuZmxvd19zdG10OgogICAgICAgICAgICAgIHJldHVybiBTKGEsIGwpCiAgICAgICAgICAgIGNhc2UgdC5pbXBvcnRfc3RtdDoKICAgICAgICAgICAgICB2YXIgbiA9IGwsCiAgICAgICAgICAgICAgICByCiAgICAgICAgICAgICAgZChuLCB0LmltcG9ydF9zdG10KQogICAgICAgICAgICAgIHZhciBxID0gbi5saW5lbm8KICAgICAgICAgICAgICBsID0gbi5jb2xfb2Zmc2V0CiAgICAgICAgICAgICAgbiA9IGMobiwgMCkKICAgICAgICAgICAgICBpZiAobi50eXBlID09PSB0LmltcG9ydF9uYW1lKSB7CiAgICAgICAgICAgICAgICBuID0gYyhuLCAxKQogICAgICAgICAgICAgICAgZChuLCB0LmRvdHRlZF9hc19uYW1lcykKICAgICAgICAgICAgICAgIHZhciBtID0gW10KICAgICAgICAgICAgICAgIGZvciAociA9IDA7IHIgPCBiKG4pOyByICs9IDIpIG1bciAvIDJdID0gSihhLCBjKG4sIHIpKQogICAgICAgICAgICAgICAgYSA9IG5ldyBTay5hc3Rub2Rlcy5JbXBvcnQobSwgcSwgbCkKICAgICAgICAgICAgICB9IGVsc2UgaWYgKG4udHlwZSA9PT0gdC5pbXBvcnRfZnJvbSkgewogICAgICAgICAgICAgICAgdmFyIHAgPSBudWxsCiAgICAgICAgICAgICAgICBoID0gMAogICAgICAgICAgICAgICAgZm9yIChtID0gMTsgbSA8IGIobik7ICsrbSkKICAgICAgICAgICAgICAgICAgaWYgKGMobiwgbSkudHlwZSA9PT0gdC5kb3R0ZWRfbmFtZSkgewogICAgICAgICAgICAgICAgICAgIHAgPSBKKGEsIGMobiwgbSkpCiAgICAgICAgICAgICAgICAgICAgbSsrCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjKG4sIG0pLnR5cGUgPT09IHYuVF9ET1QpIGgrKwogICAgICAgICAgICAgICAgICBlbHNlIGlmIChjKG4sIG0pLnR5cGUgPT09IHYuVF9FTExJUFNJUykgaCArPSAzCiAgICAgICAgICAgICAgICAgIGVsc2UgYnJlYWsKICAgICAgICAgICAgICAgICsrbQogICAgICAgICAgICAgICAgc3dpdGNoIChjKG4sIG0pLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgY2FzZSB2LlRfU1RBUjoKICAgICAgICAgICAgICAgICAgICBuID0gYyhuLCBtKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIGNhc2Ugdi5UX0xQQVI6CiAgICAgICAgICAgICAgICAgICAgbiA9IGMobiwgbSArIDEpCiAgICAgICAgICAgICAgICAgICAgYihuKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIGNhc2UgdC5pbXBvcnRfYXNfbmFtZXM6CiAgICAgICAgICAgICAgICAgICAgbiA9IGMobiwgbSkKICAgICAgICAgICAgICAgICAgICBtID0gYihuKQogICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBtICUgMikKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICAidHJhaWxpbmcgY29tbWEgbm90IGFsbG93ZWQgd2l0aG91dCBzdXJyb3VuZGluZyBwYXJlbnRoZXNlcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgbi5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICJVbmV4cGVjdGVkIG5vZGUtdHlwZSBpbiBmcm9tLWltcG9ydCIsCiAgICAgICAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICBuLmxpbmVubywKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtID0gW10KICAgICAgICAgICAgICAgIGlmIChuLnR5cGUgPT09IHYuVF9TVEFSKSBtWzBdID0gSihhLCBuKQogICAgICAgICAgICAgICAgZWxzZSBmb3IgKHIgPSAwOyByIDwgYihuKTsgciArPSAyKSBtW3IgLyAyXSA9IEooYSwgYyhuLCByKSkKICAgICAgICAgICAgICAgIGEgPSBwID8gcC5uYW1lLnYgOiAiIgogICAgICAgICAgICAgICAgYSA9IG5ldyBTay5hc3Rub2Rlcy5JbXBvcnRGcm9tKGYoYSksIG0sIGgsIHEsIGwpCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICAgInVua25vd24gaW1wb3J0IHN0YXRlbWVudCIsCiAgICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgbi5saW5lbm8sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgY2FzZSB0Lmdsb2JhbF9zdG10OgogICAgICAgICAgICAgIGEgPSBsCiAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgZChhLCB0Lmdsb2JhbF9zdG10KQogICAgICAgICAgICAgIGZvciAoaCA9IDE7IGggPCBiKGEpOyBoICs9IDIpIGxbKGggLSAxKSAvIDJdID0gZihjKGEsIGgpLnZhbHVlKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuR2xvYmFsKGwsIGEubGluZW5vLCBhLmNvbF9vZmZzZXQpCiAgICAgICAgICAgIGNhc2UgdC5ub25sb2NhbF9zdG10OgogICAgICAgICAgICAgIGUoYSwgbCwgIk5vdCBpbXBsZW1lbnRlZDogbm9ubG9jYWwiKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGNhc2UgdC5hc3NlcnRfc3RtdDoKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKGggPSBsKSwKICAgICAgICAgICAgICAgIGQoaCwgdC5hc3NlcnRfc3RtdCksCiAgICAgICAgICAgICAgICAyID09PSBiKGgpCiAgICAgICAgICAgICAgICAgID8gKGEgPSBuZXcgU2suYXN0bm9kZXMuQXNzZXJ0KAogICAgICAgICAgICAgICAgICAgICAgdShhLCBjKGgsIDEpKSwKICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICA6IDQgPT09IGIoaCkKICAgICAgICAgICAgICAgICAgPyAoYSA9IG5ldyBTay5hc3Rub2Rlcy5Bc3NlcnQoCiAgICAgICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICAgICAgdShhLCBjKGgsIDMpKSwKICAgICAgICAgICAgICAgICAgICAgIGgubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICAgIDogKFNrLmFzc2VydHMuZmFpbCgiaW1wcm9wZXIgbnVtYmVyIG9mIHBhcnRzIHRvIGFzc2VydCBzdG10IiksCiAgICAgICAgICAgICAgICAgICAgKGEgPSB2b2lkIDApKSwKICAgICAgICAgICAgICAgIGEKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgdC5wcmludF9zdG10OgogICAgICAgICAgICAgIGggPSBsCiAgICAgICAgICAgICAgU2suX19mdXR1cmVfXy5wcmludF9mdW5jdGlvbiAmJgogICAgICAgICAgICAgICAgZShhLCBoLCAiTWlzc2luZyBwYXJlbnRoZXNlcyBpbiBjYWxsIHRvICdwcmludCciKQogICAgICAgICAgICAgIG4gPSAxCiAgICAgICAgICAgICAgcSA9IG51bGwKICAgICAgICAgICAgICBkKGgsIHQucHJpbnRfc3RtdCkKICAgICAgICAgICAgICAyIDw9IGIoaCkgJiYKICAgICAgICAgICAgICAgIGMoaCwgMSkudHlwZSA9PT0gdi5UX1JJR0hUU0hJRlQgJiYKICAgICAgICAgICAgICAgICgocSA9IHUoYSwgYyhoLCAyKSkpLCAobiA9IDQpKQogICAgICAgICAgICAgIGwgPSBbXQogICAgICAgICAgICAgIGZvciAocCA9IDA7IG4gPCBiKGgpOyBuICs9IDIsICsrcCkgbFtwXSA9IHUoYSwgYyhoLCBuKSkKICAgICAgICAgICAgICBhID0gYyhoLCBiKGgpIC0gMSkudHlwZSA9PT0gdi5UX0NPTU1BID8gITEgOiAhMAogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuUHJpbnQocSwgbCwgYSwgaC5saW5lbm8sIGguY29sX29mZnNldCkKICAgICAgICAgICAgY2FzZSB0LmRlYnVnZ2VyX3N0bXQ6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5EZWJ1Z2dlcihsLmxpbmVubywgbC5jb2xfb2Zmc2V0KQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIHNtYWxsX3N0bXQiKQogICAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICAgIHN3aXRjaCAoKChoID0gYyhsLCAwKSksIGQobCwgdC5jb21wb3VuZF9zdG10KSwgaC50eXBlKSkgewogICAgICAgICAgICBjYXNlIHQuaWZfc3RtdDoKICAgICAgICAgICAgICBkKGgsIHQuaWZfc3RtdCkKICAgICAgICAgICAgICBpZiAoNCA9PT0gYihoKSkKICAgICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuSWYoCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCAzKSksCiAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGVsc2UgaWYgKCgobCA9IGMoaCwgNCkudmFsdWUuY2hhckF0KDIpKSwgInMiID09PSBsKSkKICAgICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuSWYoCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCAzKSksCiAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCA2KSksCiAgICAgICAgICAgICAgICAgIGgubGluZW5vLAogICAgICAgICAgICAgICAgICBoLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgZWxzZSBpZiAoImkiID09PSBsKSB7CiAgICAgICAgICAgICAgICBxID0gYihoKSAtIDQKICAgICAgICAgICAgICAgIG4gPSAhMQogICAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgICBjKGgsIHEgKyAxKS50eXBlID09PSB2LlRfTkFNRSAmJgogICAgICAgICAgICAgICAgICAicyIgPT09IGMoaCwgcSArIDEpLnZhbHVlLmNoYXJBdCgyKSAmJgogICAgICAgICAgICAgICAgICAoKG4gPSAhMCksIChxIC09IDMpKQogICAgICAgICAgICAgICAgcSAvPSA0CiAgICAgICAgICAgICAgICBuICYmCiAgICAgICAgICAgICAgICAgICgobCA9IFsKICAgICAgICAgICAgICAgICAgICBuZXcgU2suYXN0bm9kZXMuSWYoCiAgICAgICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgYihoKSAtIDYpKSwKICAgICAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCBiKGgpIC0gNCkpLAogICAgICAgICAgICAgICAgICAgICAgeChhLCBjKGgsIGIoaCkgLSAxKSksCiAgICAgICAgICAgICAgICAgICAgICBjKGgsIGIoaCkgLSA2KS5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICBjKGgsIGIoaCkgLSA2KS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgIF0pLAogICAgICAgICAgICAgICAgICBxLS0pCiAgICAgICAgICAgICAgICBmb3IgKHAgPSAwOyBwIDwgcTsgKytwKQogICAgICAgICAgICAgICAgICAobiA9IDUgKyA0ICogKHEgLSBwIC0gMSkpLAogICAgICAgICAgICAgICAgICAgIChsID0gWwogICAgICAgICAgICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLklmKAogICAgICAgICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgbikpLAogICAgICAgICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgbiArIDIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICAgICAgICAgICAgYyhoLCBuKS5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICAgIGMoaCwgbikuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuSWYoCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCAzKSksCiAgICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICAgIGgubGluZW5vLAogICAgICAgICAgICAgICAgICBoLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuZXhwZWN0ZWQgdG9rZW4gaW4gJ2lmJyBzdGF0ZW1lbnQiKSwKICAgICAgICAgICAgICAgICAgKGEgPSB2b2lkIDApCiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgY2FzZSB0LndoaWxlX3N0bXQ6CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGQoaCwgdC53aGlsZV9zdG10KSwKICAgICAgICAgICAgICAgIDQgPT09IGIoaCkKICAgICAgICAgICAgICAgICAgPyAoYSA9IG5ldyBTay5hc3Rub2Rlcy5XaGlsZSgKICAgICAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgMykpLAogICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICA6IDcgPT09IGIoaCkKICAgICAgICAgICAgICAgICAgPyAoYSA9IG5ldyBTay5hc3Rub2Rlcy5XaGlsZSgKICAgICAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgMykpLAogICAgICAgICAgICAgICAgICAgICAgeChhLCBjKGgsIDYpKSwKICAgICAgICAgICAgICAgICAgICAgIGgubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICAgIDogKFNrLmFzc2VydHMuZmFpbCgid3JvbmcgbnVtYmVyIG9mIHRva2VucyBmb3IgJ3doaWxlJyBzdG10IiksCiAgICAgICAgICAgICAgICAgICAgKGEgPSB2b2lkIDApKSwKICAgICAgICAgICAgICAgIGEKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgdC5mb3Jfc3RtdDoKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKGwgPSBbXSksCiAgICAgICAgICAgICAgICBkKGgsIHQuZm9yX3N0bXQpLAogICAgICAgICAgICAgICAgOSA9PT0gYihoKSAmJiAobCA9IHgoYSwgYyhoLCA4KSkpLAogICAgICAgICAgICAgICAgKG4gPSBjKGgsIDEpKSwKICAgICAgICAgICAgICAgIChxID0gSChhLCBuLCBTay5hc3Rub2Rlcy5TdG9yZSkpLAogICAgICAgICAgICAgICAgKHEgPQogICAgICAgICAgICAgICAgICAxID09PSBiKG4pCiAgICAgICAgICAgICAgICAgICAgPyBxWzBdCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgU2suYXN0bm9kZXMuVHVwbGUoCiAgICAgICAgICAgICAgICAgICAgICAgIHEsCiAgICAgICAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLlN0b3JlLAogICAgICAgICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgICBuZXcgU2suYXN0bm9kZXMuRm9yKAogICAgICAgICAgICAgICAgICBxLAogICAgICAgICAgICAgICAgICBJKGEsIGMoaCwgMykpLAogICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgNSkpLAogICAgICAgICAgICAgICAgICBsLAogICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LnRyeV9zdG10OgogICAgICAgICAgICAgIGwgPSBbXQogICAgICAgICAgICAgIHIgPSBiKGgpCiAgICAgICAgICAgICAgcSA9IChyIC0gMykgLyAzCiAgICAgICAgICAgICAgcCA9IFtdCiAgICAgICAgICAgICAgbSA9IG51bGwKICAgICAgICAgICAgICBkKGgsIHQudHJ5X3N0bXQpCiAgICAgICAgICAgICAgbiA9IHgoYSwgYyhoLCAyKSkKICAgICAgICAgICAgICBpZiAoYyhoLCByIC0gMykudHlwZSA9PT0gdi5UX05BTUUpCiAgICAgICAgICAgICAgICAiZmluYWxseSIgPT09IGMoaCwgciAtIDMpLnZhbHVlCiAgICAgICAgICAgICAgICAgID8gKDkgPD0gciAmJgogICAgICAgICAgICAgICAgICAgICAgYyhoLCByIC0gNikudHlwZSA9PT0gdi5UX05BTUUgJiYKICAgICAgICAgICAgICAgICAgICAgICgocCA9IHgoYSwgYyhoLCByIC0gNCkpKSwgcS0tKSwKICAgICAgICAgICAgICAgICAgICAobSA9IHgoYSwgYyhoLCByIC0gMSkpKSkKICAgICAgICAgICAgICAgICAgOiAocCA9IHgoYSwgYyhoLCByIC0gMSkpKSwKICAgICAgICAgICAgICAgICAgcS0tCiAgICAgICAgICAgICAgZWxzZSBpZiAoYyhoLCByIC0gMykudHlwZSAhPT0gdC5leGNlcHRfY2xhdXNlKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICJtYWxmb3JtZWQgJ3RyeScgc3RhdGVtZW50IiwKICAgICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBpZiAoMCA8IHEpCiAgICAgICAgICAgICAgICBmb3IgKHIgPSAwOyByIDwgcTsgcisrKSB7CiAgICAgICAgICAgICAgICAgIHZhciBEID0gcgogICAgICAgICAgICAgICAgICB2YXIgQSA9IGEsCiAgICAgICAgICAgICAgICAgICAgdyA9IGMoaCwgMyArIDMgKiByKSwKICAgICAgICAgICAgICAgICAgICBCID0gYyhoLCA1ICsgMyAqIHIpCiAgICAgICAgICAgICAgICAgIGQodywgdC5leGNlcHRfY2xhdXNlKQogICAgICAgICAgICAgICAgICBkKEIsIHQuc3VpdGUpCiAgICAgICAgICAgICAgICAgIGlmICgxID09PSBiKHcpKQogICAgICAgICAgICAgICAgICAgIHZhciBDID0gbmV3IFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHgoQSwgQiksCiAgICAgICAgICAgICAgICAgICAgICB3LmxpbmVubywKICAgICAgICAgICAgICAgICAgICAgIHcuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAyID09PSBiKHcpCiAgICAgICAgICAgICAgICAgICAgICA/IChDID0gbmV3IFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgdShBLCBjKHcsIDEpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIHgoQSwgQiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdy5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgdy5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICAgICAgOiA0ID09PSBiKHcpCiAgICAgICAgICAgICAgICAgICAgICA/IChTay5fX2Z1dHVyZV9fLnB5dGhvbjMgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAiLCIgPT0gYyh3LCAyKS52YWx1ZSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgIGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJPbGQtc3R5bGUgJ2V4Y2VwdCcgY2xhdXNlcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBQeXRob24gMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgdShBLCBjKHcsIDEpKSwKICAgICAgICAgICAgICAgICAgICAgICAgKEMgPSB1KEEsIGModywgMykpKSwKICAgICAgICAgICAgICAgICAgICAgICAgayhBLCBDLCBTay5hc3Rub2Rlcy5TdG9yZSwgYyh3LCAzKSksCiAgICAgICAgICAgICAgICAgICAgICAgIChDID0gbmV3IFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgdShBLCBjKHcsIDEpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBDLAogICAgICAgICAgICAgICAgICAgICAgICAgIHgoQSwgQiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdy5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgdy5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICApKSkKICAgICAgICAgICAgICAgICAgICAgIDogKFNrLmFzc2VydHMuZmFpbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAid3JvbmcgbnVtYmVyIG9mIGNoaWxkcmVuIGZvciBleGNlcHQgY2xhdXNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgKEMgPSB2b2lkIDApKQogICAgICAgICAgICAgICAgICBsW0RdID0gQwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCEhbSB8fCAwICE9IGwubGVuZ3RoKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuVHJ5KG4sIGwsIHAsIG0sIGgubGluZW5vLCBoLmNvbF9vZmZzZXQpCiAgICAgICAgICAgIGNhc2UgdC53aXRoX3N0bXQ6CiAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgZChoLCB0LndpdGhfc3RtdCkKICAgICAgICAgICAgICBmb3IgKHEgPSAxOyBxIDwgYihoKSAtIDI7IHEgKz0gMikKICAgICAgICAgICAgICAgIChuID0gdm9pZCAwKSwKICAgICAgICAgICAgICAgICAgKG0gPSBhKSwKICAgICAgICAgICAgICAgICAgKHIgPSBjKGgsIHEpKSwKICAgICAgICAgICAgICAgICAgZChyLCB0LndpdGhfaXRlbSksCiAgICAgICAgICAgICAgICAgIChwID0gdShtLCBjKHIsIDApKSksCiAgICAgICAgICAgICAgICAgIDMgPT0gYihyKSAmJgogICAgICAgICAgICAgICAgICAgICgobiA9IHUobSwgYyhyLCAyKSkpLCBrKG0sIG4sIFNrLmFzdG5vZGVzLlN0b3JlLCByKSksCiAgICAgICAgICAgICAgICAgIChuID0gbmV3IFNrLmFzdG5vZGVzLndpdGhpdGVtKHAsIG4pKSwKICAgICAgICAgICAgICAgICAgKGxbKHEgLSAxKSAvIDJdID0gbikKICAgICAgICAgICAgICBhID0geChhLCBjKGgsIGIoaCkgLSAxKSkKICAgICAgICAgICAgICBhID0gbmV3IFNrLmFzdG5vZGVzLldpdGgobCwgYSwgaC5saW5lbm8sIGguY29sX29mZnNldCkKICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICBjYXNlIHQuZnVuY2RlZjoKICAgICAgICAgICAgICByZXR1cm4gVihhLCBoLCBbXSwgITEpCiAgICAgICAgICAgIGNhc2UgdC5jbGFzc2RlZjoKICAgICAgICAgICAgICByZXR1cm4gWChhLCBoLCBbXSkKICAgICAgICAgICAgY2FzZSB0LmRlY29yYXRlZDoKICAgICAgICAgICAgICBxID0gbnVsbAogICAgICAgICAgICAgIGQoaCwgdC5kZWNvcmF0ZWQpCiAgICAgICAgICAgICAgbiA9IGMoaCwgMCkKICAgICAgICAgICAgICBkKG4sIHQuZGVjb3JhdG9ycykKICAgICAgICAgICAgICBsID0gW10KICAgICAgICAgICAgICBmb3IgKHAgPSAwOyBwIDwgYihuKTsgKytwKSB7CiAgICAgICAgICAgICAgICBtID0gbAogICAgICAgICAgICAgICAgciA9IHAKICAgICAgICAgICAgICAgIEQgPSBhCiAgICAgICAgICAgICAgICBDID0gYyhuLCBwKQogICAgICAgICAgICAgICAgZChDLCB0LmRlY29yYXRvcikKICAgICAgICAgICAgICAgIGQoYyhDLCAwKSwgdi5UX0FUKQogICAgICAgICAgICAgICAgZChjKEMsIGIoQykgLSAxKSwgdi5UX05FV0xJTkUpCiAgICAgICAgICAgICAgICB2YXIgeSwKICAgICAgICAgICAgICAgICAgeiA9IGMoQywgMSkKICAgICAgICAgICAgICAgIGQoeiwgdC5kb3R0ZWRfbmFtZSkKICAgICAgICAgICAgICAgIEEgPSB6LmxpbmVubwogICAgICAgICAgICAgICAgdyA9IHouY29sX29mZnNldAogICAgICAgICAgICAgICAgQiA9IGYoYyh6LCAwKS52YWx1ZSkKICAgICAgICAgICAgICAgIHZhciBHID0gbmV3IFNrLmFzdG5vZGVzLk5hbWUoQiwgU2suYXN0bm9kZXMuTG9hZCwgQSwgdykKICAgICAgICAgICAgICAgIGZvciAoeSA9IDI7IHkgPCBiKHopOyB5ICs9IDIpCiAgICAgICAgICAgICAgICAgIChCID0gZihjKHosIHkpLnZhbHVlKSksCiAgICAgICAgICAgICAgICAgICAgKEcgPSBuZXcgU2suYXN0bm9kZXMuQXR0cmlidXRlKAogICAgICAgICAgICAgICAgICAgICAgRywKICAgICAgICAgICAgICAgICAgICAgIEIsCiAgICAgICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgICAgICAgQSwKICAgICAgICAgICAgICAgICAgICAgIHcsCiAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgIEEgPSBHCiAgICAgICAgICAgICAgICBEID0KICAgICAgICAgICAgICAgICAgMyA9PT0gYihDKQogICAgICAgICAgICAgICAgICAgID8gQQogICAgICAgICAgICAgICAgICAgIDogNSA9PT0gYihDKQogICAgICAgICAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLkNhbGwoCiAgICAgICAgICAgICAgICAgICAgICAgIEEsCiAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgQy5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICAgIEMuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICA6IEsoRCwgYyhDLCAzKSwgQSkKICAgICAgICAgICAgICAgIG1bcl0gPSBECiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgICAgICAgYyhoLCAxKS50eXBlID09IHQuZnVuY2RlZiB8fAogICAgICAgICAgICAgICAgICBjKGgsIDEpLnR5cGUgPT0gdC5hc3luY19mdW5jZGVmIHx8CiAgICAgICAgICAgICAgICAgIGMoaCwgMSkudHlwZSA9PSB0LmNsYXNzZGVmLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjKGgsIDEpLnR5cGUgPT0gdC5mdW5jZGVmCiAgICAgICAgICAgICAgICA/ICgocSA9IGMoaCwgMSkpLCAocSA9IFYoYSwgcSwgbCwgITEpKSkKICAgICAgICAgICAgICAgIDogYyhoLCAxKS50eXBlID09IHQuY2xhc3NkZWYKICAgICAgICAgICAgICAgID8gKHEgPSBYKGEsIGMoaCwgMSksIGwpKQogICAgICAgICAgICAgICAgOiBjKGgsIDEpLnR5cGUgPT0gdC5hc3luY19mdW5jZGVmICYmCiAgICAgICAgICAgICAgICAgICgocSA9IGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICBkKHEsIHQuYXN5bmNfZnVuY2RlZiksCiAgICAgICAgICAgICAgICAgIGQoYyhxLCAwKSwgdi5UX05BTUUpLAogICAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgoImFzeW5jIiA9PT0gYyhxLCAwKSkudmFsdWUpLAogICAgICAgICAgICAgICAgICBkKGMocSwgMSksIHQuZnVuY2RlZiksCiAgICAgICAgICAgICAgICAgIChxID0gVihhLCBxLCBsLCAhMCkpKQogICAgICAgICAgICAgIHEgJiYgKChxLmxpbmVubyA9IGgubGluZW5vKSwgKHEuY29sX29mZnNldCA9IGguY29sX29mZnNldCkpCiAgICAgICAgICAgICAgcmV0dXJuIHEKICAgICAgICAgICAgY2FzZSB0LmFzeW5jX3N0bXQ6CiAgICAgICAgICAgICAgZShhLCBoLCAiTm90IGltcGxlbWVudGVkOiBhc3luYyIpCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgidW5oYW5kbGVkIGNvbXBvdW5kX3N0bXQiKQogICAgICAgICAgfQogICAgICB9CiAgICAgIHZhciB0ID0gU2suUGFyc2VUYWJsZXMuc3ltLAogICAgICAgIHYgPSBTay50b2tlbi50b2tlbnMsCiAgICAgICAgVyA9IHsgU2xpY2Vfa2luZDogMSwgRXh0U2xpY2Vfa2luZDogMiwgSW5kZXhfa2luZDogMyB9LAogICAgICAgIE0gPSB7fQogICAgICBNW3YuVF9WQkFSXSA9IFNrLmFzdG5vZGVzLkJpdE9yCiAgICAgIE1bdi5UX0NJUkNVTUZMRVhdID0gU2suYXN0bm9kZXMuQml0WG9yCiAgICAgIE1bdi5UX0FNUEVSXSA9IFNrLmFzdG5vZGVzLkJpdEFuZAogICAgICBNW3YuVF9MRUZUU0hJRlRdID0gU2suYXN0bm9kZXMuTFNoaWZ0CiAgICAgIE1bdi5UX1JJR0hUU0hJRlRdID0gU2suYXN0bm9kZXMuUlNoaWZ0CiAgICAgIE1bdi5UX1BMVVNdID0gU2suYXN0bm9kZXMuQWRkCiAgICAgIE1bdi5UX01JTlVTXSA9IFNrLmFzdG5vZGVzLlN1YgogICAgICBNW3YuVF9TVEFSXSA9IFNrLmFzdG5vZGVzLk11bHQKICAgICAgTVt2LlRfU0xBU0hdID0gU2suYXN0bm9kZXMuRGl2CiAgICAgIE1bdi5UX0RPVUJMRVNMQVNIXSA9IFNrLmFzdG5vZGVzLkZsb29yRGl2CiAgICAgIE1bdi5UX1BFUkNFTlRdID0gU2suYXN0bm9kZXMuTW9kCiAgICAgIFNrLnNldHVwT3BlcmF0b3JzID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPyAoTVt2LlRfQVRdID0gU2suYXN0bm9kZXMuTWF0TXVsdCkgOiBNW3YuVF9BVF0gJiYgZGVsZXRlIE1bdi5UX0FUXQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suc2V0dXBPcGVyYXRvcnMiLCBTay5zZXR1cE9wZXJhdG9ycykKICAgICAgU2suYXN0RnJvbVBhcnNlID0gZnVuY3Rpb24oZSwgaywgZikgewogICAgICAgIHZhciBsLAogICAgICAgICAgaCA9IG5ldyBhKCJ1dGYtOCIsIGssIGYpLAogICAgICAgICAgbiA9IFtdLAogICAgICAgICAgciA9IDAKICAgICAgICBzd2l0Y2ggKGUudHlwZSkgewogICAgICAgICAgY2FzZSB0LmZpbGVfaW5wdXQ6CiAgICAgICAgICAgIGZvciAobCA9IDA7IGwgPCBiKGUpIC0gMTsgKytsKSB7CiAgICAgICAgICAgICAgdmFyIHEgPSBjKGUsIGwpCiAgICAgICAgICAgICAgaWYgKGUudHlwZSAhPT0gdi5UX05FV0xJTkUpCiAgICAgICAgICAgICAgICBpZiAoKGQocSwgdC5zdG10KSwgKGYgPSBnKHEpKSwgMSA9PT0gZikpIG5bcisrXSA9IEwoaCwgcSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgZm9yIChxID0gYyhxLCAwKSwgZChxLCB0LnNpbXBsZV9zdG10KSwgayA9IDA7IGsgPCBmOyArK2spCiAgICAgICAgICAgICAgICAgICAgbltyKytdID0gTChoLCBjKHEsIDIgKiBrKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLk1vZHVsZShuKQogICAgICAgICAgY2FzZSB0LmV2YWxfaW5wdXQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidG9kbzsiKQogICAgICAgICAgY2FzZSB0LnNpbmdsZV9pbnB1dDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ0b2RvOyIpCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInRvZG87IikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYXN0RHVtcCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdmFyIGIsCiAgICAgICAgICAgICAgYyA9ICIiCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhOyArK2IpIGMgKz0gIiAiCiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICB9LAogICAgICAgICAgYyA9IGZ1bmN0aW9uKGEsIGQpIHsKICAgICAgICAgICAgdmFyIGUKICAgICAgICAgICAgaWYgKG51bGwgPT09IGEpIHJldHVybiBkICsgIk5vbmUiCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBhLnByb3RvdHlwZSAmJgogICAgICAgICAgICAgIHZvaWQgMCAhPT0gYS5wcm90b3R5cGUuX2FzdG5hbWUgJiYKICAgICAgICAgICAgICBhLnByb3RvdHlwZS5faXNlbnVtCiAgICAgICAgICAgICkKICAgICAgICAgICAgICByZXR1cm4gZCArIGEucHJvdG90eXBlLl9hc3RuYW1lICsgIigpIgogICAgICAgICAgICBpZiAodm9pZCAwICE9PSBhLl9hc3RuYW1lKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSBiKGEuX2FzdG5hbWUubGVuZ3RoICsgMSkKICAgICAgICAgICAgICB2YXIgZyA9IFtdCiAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGEuX2ZpZWxkcy5sZW5ndGg7IGUgKz0gMikgewogICAgICAgICAgICAgICAgdmFyIGYgPSBhLl9maWVsZHNbZV0KICAgICAgICAgICAgICAgIHZhciBsID0gYS5fZmllbGRzW2UgKyAxXShhKQogICAgICAgICAgICAgICAgdmFyIGggPSBiKGYubGVuZ3RoICsgMSkKICAgICAgICAgICAgICAgIGcucHVzaChbZiwgYyhsLCBkICsgayArIGgpXSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGcubGVuZ3RoOyArK2UpCiAgICAgICAgICAgICAgICAoaCA9IGdbZV0pLCBsLnB1c2goaFswXSArICI9IiArIGhbMV0ucmVwbGFjZSgvXlxzKy8sICIiKSkKICAgICAgICAgICAgICBlID0gbC5qb2luKCIsXG4iICsgZCArIGspCiAgICAgICAgICAgICAgcmV0dXJuIGQgKyBhLl9hc3RuYW1lICsgIigiICsgZSArICIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChTay5pc0FycmF5TGlrZShhKSkgewogICAgICAgICAgICAgIGsgPSBbXQogICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBhLmxlbmd0aDsgKytlKSAoZyA9IGFbZV0pLCBrLnB1c2goYyhnLCBkICsgIiAiKSkKICAgICAgICAgICAgICBhID0gay5qb2luKCIsXG4iKQogICAgICAgICAgICAgIHJldHVybiBkICsgIlsiICsgYS5yZXBsYWNlKC9eXHMrLywgIiIpICsgIl0iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9CiAgICAgICAgICAgICAgITAgPT09IGEKICAgICAgICAgICAgICAgID8gIlRydWUiCiAgICAgICAgICAgICAgICA6ICExID09PSBhCiAgICAgICAgICAgICAgICA/ICJGYWxzZSIKICAgICAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICAgICAgICA/IGEudHAkc3RyKCkudgogICAgICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIKICAgICAgICAgICAgICAgID8gYS4kcigpLnYKICAgICAgICAgICAgICAgIDogIiIgKyBhCiAgICAgICAgICAgIHJldHVybiBkICsgYQogICAgICAgICAgfQogICAgICAgIHJldHVybiBjKGEsICIiKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYXN0RnJvbVBhcnNlIiwgU2suYXN0RnJvbVBhcnNlKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFzdER1bXAiLCBTay5hc3REdW1wKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgZnVuY3Rpb24gYShhLCBiLCBjKSB7CiAgICAgICAgdGhpcy5fX25hbWUgPSBhCiAgICAgICAgdGhpcy5fX2ZsYWdzID0gYgogICAgICAgIHRoaXMuX19zY29wZSA9IChiID4+IDExKSAmIDcKICAgICAgICB0aGlzLl9fbmFtZXNwYWNlcyA9IGMgfHwgW10KICAgICAgfQogICAgICBmdW5jdGlvbiBiKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICB0aGlzLnN5bUZsYWdzID0ge30KICAgICAgICB0aGlzLm5hbWUgPSBiCiAgICAgICAgdGhpcy52YXJuYW1lcyA9IFtdCiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdCiAgICAgICAgdGhpcy5ibG9ja1R5cGUgPSBjCiAgICAgICAgdGhpcy5yZXR1cm5zVmFsdWUgPSB0aGlzLnZhcmtleXdvcmRzID0gdGhpcy52YXJhcmdzID0gdGhpcy5nZW5lcmF0b3IgPSB0aGlzLmNoaWxkSGFzRnJlZSA9IHRoaXMuaGFzRnJlZSA9IHRoaXMuaXNOZXN0ZWQgPSAhMQogICAgICAgIHRoaXMubGluZW5vID0gZQogICAgICAgIHRoaXMudGFibGUgPSBhCiAgICAgICAgYS5jdXIgJiYKICAgICAgICAgIChhLmN1ci5uZXN0ZWQgfHwgImZ1bmN0aW9uIiA9PT0gYS5jdXIuYmxvY2tUeXBlKSAmJgogICAgICAgICAgKHRoaXMuaXNOZXN0ZWQgPSAhMCkKICAgICAgICBkLnNjb3BlSWQgPSBmKysKICAgICAgICBhLnN0c3NbZC5zY29wZUlkXSA9IHRoaXMKICAgICAgICB0aGlzLnN5bWJvbHMgPSB7fQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGMoYSkgewogICAgICAgIHRoaXMuZmlsZW5hbWUgPSBhCiAgICAgICAgdGhpcy50b3AgPSB0aGlzLmN1ciA9IG51bGwKICAgICAgICB0aGlzLnN0YWNrID0gW10KICAgICAgICB0aGlzLmN1ckNsYXNzID0gdGhpcy5nbG9iYWwgPSBudWxsCiAgICAgICAgdGhpcy50bXBuYW1lID0gMAogICAgICAgIHRoaXMuc3RzcyA9IHt9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykgYShiW2NdKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGUoYSwgYikgewogICAgICAgIGZvciAodmFyIGMgaW4gYikgYVtjXSA9IGJbY10KICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLlNZTVRBQl9DT05TVFMiLCB7CiAgICAgICAgREVGX0dMT0JBTDogMSwKICAgICAgICBERUZfTE9DQUw6IDIsCiAgICAgICAgREVGX1BBUkFNOiA0LAogICAgICAgIFVTRTogOCwKICAgICAgICBERUZfU1RBUjogMTYsCiAgICAgICAgREVGX0RPVUJMRVNUQVI6IDMyLAogICAgICAgIERFRl9JTlRVUExFOiA2NCwKICAgICAgICBERUZfRlJFRTogMTI4LAogICAgICAgIERFRl9GUkVFX0dMT0JBTDogMjU2LAogICAgICAgIERFRl9GUkVFX0NMQVNTOiA1MTIsCiAgICAgICAgREVGX0lNUE9SVDogMTAyNCwKICAgICAgICBERUZfQk9VTkQ6IDEwMzAsCiAgICAgICAgU0NPUEVfT0ZGOiAxMSwKICAgICAgICBTQ09QRV9NQVNLOiA3LAogICAgICAgIExPQ0FMOiAxLAogICAgICAgIEdMT0JBTF9FWFBMSUNJVDogMiwKICAgICAgICBHTE9CQUxfSU1QTElDSVQ6IDMsCiAgICAgICAgRlJFRTogNCwKICAgICAgICBDRUxMOiA1LAogICAgICAgIE9QVF9JTVBPUlRfU1RBUjogMSwKICAgICAgICBPUFRfRVhFQzogMiwKICAgICAgICBPUFRfQkFSRV9FWEVDOiA0LAogICAgICAgIE9QVF9UT1BMRVZFTDogOCwKICAgICAgICBHRU5FUkFUT1I6IDIsCiAgICAgICAgR0VORVJBVE9SX0VYUFJFU1NJT046IDIsCiAgICAgICAgTW9kdWxlQmxvY2s6ICJtb2R1bGUiLAogICAgICAgIEZ1bmN0aW9uQmxvY2s6ICJmdW5jdGlvbiIsCiAgICAgICAgQ2xhc3NCbG9jazogImNsYXNzIiwKICAgICAgfSkKICAgICAgYS5wcm90b3R5cGUuZ2V0X25hbWUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fX25hbWUKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5pc19yZWZlcmVuY2VkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDgpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfcGFyYW1ldGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDQpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfZ2xvYmFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDMgPT09IHRoaXMuX19zY29wZSB8fCAyID09IHRoaXMuX19zY29wZQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX2RlY2xhcmVkX2dsb2JhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAyID09IHRoaXMuX19zY29wZQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX2xvY2FsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDEwMzApCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfZnJlZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiA0ID09IHRoaXMuX19zY29wZQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX2ltcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDEwMjQpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfYXNzaWduZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gISEodGhpcy5fX2ZsYWdzICYgMikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5pc19uYW1lc3BhY2UgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fX25hbWVzcGFjZXMgJiYgMCA8IHRoaXMuX19uYW1lc3BhY2VzLmxlbmd0aAogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmdldF9uYW1lc3BhY2VzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX19uYW1lc3BhY2VzCiAgICAgIH0KICAgICAgdmFyIGYgPSAwCiAgICAgIGIucHJvdG90eXBlLmdldF90eXBlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmxvY2tUeXBlCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuZ2V0X25hbWUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5uYW1lCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuZ2V0X2xpbmVubyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmxpbmVubwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmlzX25lc3RlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmlzTmVzdGVkCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuaGFzX2NoaWxkcmVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDAgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aAogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9pZGVudGlmaWVycyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pZGVudHNNYXRjaGluZyhmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0pCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUubG9va3VwID0gZnVuY3Rpb24oYikgewogICAgICAgIGlmICh0aGlzLnN5bWJvbHMuaGFzT3duUHJvcGVydHkoYikpIGIgPSB0aGlzLnN5bWJvbHNbYl0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBjID0gdGhpcy5zeW1GbGFnc1tiXQogICAgICAgICAgdmFyIGQgPSB0aGlzLl9fY2hlY2tfY2hpbGRyZW4oYikKICAgICAgICAgIGIgPSB0aGlzLnN5bWJvbHNbYl0gPSBuZXcgYShiLCBjLCBkKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIGIucHJvdG90eXBlLl9fY2hlY2tfY2hpbGRyZW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsrYikgewogICAgICAgICAgdmFyIGQgPSB0aGlzLmNoaWxkcmVuW2JdCiAgICAgICAgICBkLm5hbWUgPT09IGEgJiYgYy5wdXNoKGQpCiAgICAgICAgfQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuX2lkZW50c01hdGNoaW5nID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IFtdCiAgICAgICAgZm9yIChiIGluIHRoaXMuc3ltRmxhZ3MpCiAgICAgICAgICB0aGlzLnN5bUZsYWdzLmhhc093blByb3BlcnR5KGIpICYmIGEodGhpcy5zeW1GbGFnc1tiXSkgJiYgYy5wdXNoKGIpCiAgICAgICAgYy5zb3J0KCkKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9wYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAiZnVuY3Rpb24iID09IHRoaXMuZ2V0X3R5cGUoKSwKICAgICAgICAgICJnZXRfcGFyYW1ldGVycyBvbmx5IHZhbGlkIGZvciBmdW5jdGlvbiBzY29wZXMiLAogICAgICAgICkKICAgICAgICB0aGlzLl9mdW5jUGFyYW1zIHx8CiAgICAgICAgICAodGhpcy5fZnVuY1BhcmFtcyA9IHRoaXMuX2lkZW50c01hdGNoaW5nKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGEgJiA0CiAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY1BhcmFtcwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9sb2NhbHMgPSBmdW5jdGlvbigpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJmdW5jdGlvbiIgPT0gdGhpcy5nZXRfdHlwZSgpLAogICAgICAgICAgImdldF9sb2NhbHMgb25seSB2YWxpZCBmb3IgZnVuY3Rpb24gc2NvcGVzIiwKICAgICAgICApCiAgICAgICAgdGhpcy5fZnVuY0xvY2FscyB8fAogICAgICAgICAgKHRoaXMuX2Z1bmNMb2NhbHMgPSB0aGlzLl9pZGVudHNNYXRjaGluZyhmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJldHVybiBhICYgMTAzMAogICAgICAgICAgfSkpCiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmNMb2NhbHMKICAgICAgfQogICAgICBiLnByb3RvdHlwZS5nZXRfZ2xvYmFscyA9IGZ1bmN0aW9uKCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgImZ1bmN0aW9uIiA9PSB0aGlzLmdldF90eXBlKCksCiAgICAgICAgICAiZ2V0X2dsb2JhbHMgb25seSB2YWxpZCBmb3IgZnVuY3Rpb24gc2NvcGVzIiwKICAgICAgICApCiAgICAgICAgdGhpcy5fZnVuY0dsb2JhbHMgfHwKICAgICAgICAgICh0aGlzLl9mdW5jR2xvYmFscyA9IHRoaXMuX2lkZW50c01hdGNoaW5nKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgYSA9IChhID4+IDExKSAmIDcKICAgICAgICAgICAgcmV0dXJuIDMgPT0gYSB8fCAyID09IGEKICAgICAgICAgIH0pKQogICAgICAgIHJldHVybiB0aGlzLl9mdW5jR2xvYmFscwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9mcmVlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgImZ1bmN0aW9uIiA9PSB0aGlzLmdldF90eXBlKCksCiAgICAgICAgICAiZ2V0X2ZyZWVzIG9ubHkgdmFsaWQgZm9yIGZ1bmN0aW9uIHNjb3BlcyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2Z1bmNGcmVlcyB8fAogICAgICAgICAgKHRoaXMuX2Z1bmNGcmVlcyA9IHRoaXMuX2lkZW50c01hdGNoaW5nKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIDQgPT0gKChhID4+IDExKSAmIDcpCiAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY0ZyZWVzCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuZ2V0X21ldGhvZHMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgImNsYXNzIiA9PSB0aGlzLmdldF90eXBlKCksCiAgICAgICAgICAiZ2V0X21ldGhvZHMgb25seSB2YWxpZCBmb3IgY2xhc3Mgc2NvcGVzIiwKICAgICAgICApCiAgICAgICAgaWYgKCF0aGlzLl9jbGFzc01ldGhvZHMpIHsKICAgICAgICAgIHZhciBiID0gW10KICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgKythKQogICAgICAgICAgICBiLnB1c2godGhpcy5jaGlsZHJlblthXS5uYW1lKQogICAgICAgICAgYi5zb3J0KCkKICAgICAgICAgIHRoaXMuX2NsYXNzTWV0aG9kcyA9IGIKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX2NsYXNzTWV0aG9kcwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldFNjb3BlID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSB0aGlzLnN5bUZsYWdzW2FdCiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYSA/IDAgOiAoYSA+PiAxMSkgJiA3CiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUuZ2V0U3RzRm9yQXN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYS5zY29wZUlkLCAiYXN0IHdhc24ndCBhZGRlZCB0byBzdD8iKQogICAgICAgIGEgPSB0aGlzLnN0c3NbYS5zY29wZUlkXQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYSwgInVua25vd24gc3ltIHRhYiBlbnRyeSIpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5TRVFTdG10ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgaWYgKG51bGwgIT09IGEpIHsKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgICBTay5pc0FycmF5TGlrZShhKSwKICAgICAgICAgICAgIlNFUTogbm9kZXMgaXNuJ3QgYXJyYXk/IGdvdCAiICsgYS50b1N0cmluZygpLAogICAgICAgICAgKQogICAgICAgICAgdmFyIGQgPSBhLmxlbmd0aAogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQ7ICsrYykgKGIgPSBhW2NdKSAmJiB0aGlzLnZpc2l0U3RtdChiKQogICAgICAgIH0KICAgICAgfQogICAgICBjLnByb3RvdHlwZS5TRVFFeHByID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgaWYgKG51bGwgIT09IGEpIHsKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgICBTay5pc0FycmF5TGlrZShhKSwKICAgICAgICAgICAgIlNFUTogbm9kZXMgaXNuJ3QgYXJyYXk/IGdvdCAiICsgYS50b1N0cmluZygpLAogICAgICAgICAgKQogICAgICAgICAgdmFyIGQgPSBhLmxlbmd0aAogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQ7ICsrYykgKGIgPSBhW2NdKSAmJiB0aGlzLnZpc2l0RXhwcihiKQogICAgICAgIH0KICAgICAgfQogICAgICBjLnByb3RvdHlwZS5lbnRlckJsb2NrID0gZnVuY3Rpb24oYSwgYywgZCwgZSkgewogICAgICAgIGEgPSBTay5maXhSZXNlcnZlZE5hbWVzKGEpCiAgICAgICAgdmFyIGsgPSBudWxsCiAgICAgICAgdGhpcy5jdXIgJiYgKChrID0gdGhpcy5jdXIpLCB0aGlzLnN0YWNrLnB1c2godGhpcy5jdXIpKQogICAgICAgIHRoaXMuY3VyID0gbmV3IGIodGhpcywgYSwgYywgZCwgZSkKICAgICAgICAidG9wIiA9PT0gYSAmJiAodGhpcy5nbG9iYWwgPSB0aGlzLmN1ci5zeW1GbGFncykKICAgICAgICBrICYmIGsuY2hpbGRyZW4ucHVzaCh0aGlzLmN1cikKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5leGl0QmxvY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmN1ciA9IG51bGwKICAgICAgICAwIDwgdGhpcy5zdGFjay5sZW5ndGggJiYgKHRoaXMuY3VyID0gdGhpcy5zdGFjay5wb3AoKSkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS52aXNpdFBhcmFtcyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGZvciAoYyA9IDA7IGMgPCBhLmxlbmd0aDsgKytjKQogICAgICAgICAgaWYgKCgoYiA9IGFbY10pLCBiLmNvbnN0cnVjdG9yID09PSBTay5hc3Rub2Rlcy5hcmcpKQogICAgICAgICAgICB0aGlzLmFkZERlZihiLmFyZywgNCwgYi5saW5lbm8pCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICJpbnZhbGlkIGV4cHJlc3Npb24gaW4gcGFyYW1ldGVyIGxpc3QiLAogICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS52aXNpdEFyZ3VtZW50cyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBhLmFyZ3MgJiYgdGhpcy52aXNpdFBhcmFtcyhhLmFyZ3MsICEwKQogICAgICAgIGEua3dvbmx5YXJncyAmJiB0aGlzLnZpc2l0UGFyYW1zKGEua3dvbmx5YXJncywgITApCiAgICAgICAgYS52YXJhcmcgJiYgKHRoaXMuYWRkRGVmKGEudmFyYXJnLmFyZywgNCwgYiksICh0aGlzLmN1ci52YXJhcmdzID0gITApKQogICAgICAgIGEua3dhcmcgJiYgKHRoaXMuYWRkRGVmKGEua3dhcmcuYXJnLCA0LCBiKSwgKHRoaXMuY3VyLnZhcmtleXdvcmRzID0gITApKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLm5ld1RtcG5hbWUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy5hZGREZWYobmV3IFNrLmJ1aWx0aW4uc3RyKCJfWyIgKyArK3RoaXMudG1wbmFtZSArICJdIiksIDIsIGEpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUuYWRkRGVmID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHZhciBkID0gU2subWFuZ2xlTmFtZSh0aGlzLmN1ckNsYXNzLCBuZXcgU2suYnVpbHRpbi5zdHIoYSkpLnYKICAgICAgICBkID0gU2suZml4UmVzZXJ2ZWROYW1lcyhkKQogICAgICAgIHZhciBlID0gdGhpcy5jdXIuc3ltRmxhZ3NbZF0KICAgICAgICBpZiAodm9pZCAwICE9PSBlKSB7CiAgICAgICAgICBpZiAoYiAmIDQgJiYgZSAmIDQpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICJkdXBsaWNhdGUgYXJndW1lbnQgJyIgKyBhLnYgKyAiJyBpbiBmdW5jdGlvbiBkZWZpbml0aW9uIiwKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICkKICAgICAgICAgIGUgfD0gYgogICAgICAgIH0gZWxzZSBlID0gYgogICAgICAgIHRoaXMuY3VyLnN5bUZsYWdzW2RdID0gZQogICAgICAgIGIgJiA0CiAgICAgICAgICA/IHRoaXMuY3VyLnZhcm5hbWVzLnB1c2goZCkKICAgICAgICAgIDogYiAmIDEgJiYKICAgICAgICAgICAgKChlID0gYiksCiAgICAgICAgICAgIChhID0gdGhpcy5nbG9iYWxbZF0pLAogICAgICAgICAgICB2b2lkIDAgIT09IGEgJiYgKGUgfD0gYSksCiAgICAgICAgICAgICh0aGlzLmdsb2JhbFtkXSA9IGUpKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0U2xpY2UgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2xpY2U6CiAgICAgICAgICAgIGEubG93ZXIgJiYgdGhpcy52aXNpdEV4cHIoYS5sb3dlcikKICAgICAgICAgICAgYS51cHBlciAmJiB0aGlzLnZpc2l0RXhwcihhLnVwcGVyKQogICAgICAgICAgICBhLnN0ZXAgJiYgdGhpcy52aXNpdEV4cHIoYS5zdGVwKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5FeHRTbGljZToKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGEuZGltcy5sZW5ndGg7ICsrYikgdGhpcy52aXNpdFNsaWNlKGEuZGltc1tiXSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuSW5kZXg6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgfQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0U3RtdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYSwgInZpc2l0U3RtdCBjYWxsZWQgd2l0aCB1bmRlZmluZWQiKQogICAgICAgIHN3aXRjaCAoYS5jb25zdHJ1Y3RvcikgewogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5GdW5jdGlvbkRlZjoKICAgICAgICAgICAgdGhpcy5hZGREZWYoYS5uYW1lLCAyLCBhLmxpbmVubykKICAgICAgICAgICAgYS5hcmdzLmRlZmF1bHRzICYmIHRoaXMuU0VRRXhwcihhLmFyZ3MuZGVmYXVsdHMpCiAgICAgICAgICAgIGEuZGVjb3JhdG9yX2xpc3QgJiYgdGhpcy5TRVFFeHByKGEuZGVjb3JhdG9yX2xpc3QpCiAgICAgICAgICAgIHRoaXMuZW50ZXJCbG9jayhhLm5hbWUudiwgImZ1bmN0aW9uIiwgYSwgYS5saW5lbm8pCiAgICAgICAgICAgIHRoaXMudmlzaXRBcmd1bWVudHMoYS5hcmdzLCBhLmxpbmVubykKICAgICAgICAgICAgdGhpcy5TRVFTdG10KGEuYm9keSkKICAgICAgICAgICAgdGhpcy5leGl0QmxvY2soKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5DbGFzc0RlZjoKICAgICAgICAgICAgdGhpcy5hZGREZWYoYS5uYW1lLCAyLCBhLmxpbmVubykKICAgICAgICAgICAgdGhpcy5TRVFFeHByKGEuYmFzZXMpCiAgICAgICAgICAgIGEuZGVjb3JhdG9yX2xpc3QgJiYgdGhpcy5TRVFFeHByKGEuZGVjb3JhdG9yX2xpc3QpCiAgICAgICAgICAgIHRoaXMuZW50ZXJCbG9jayhhLm5hbWUudiwgImNsYXNzIiwgYSwgYS5saW5lbm8pCiAgICAgICAgICAgIHRoaXMuY3VyQ2xhc3MgPSBhLm5hbWUKICAgICAgICAgICAgdGhpcy5TRVFTdG10KGEuYm9keSkKICAgICAgICAgICAgdGhpcy5leGl0QmxvY2soKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5SZXR1cm46CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBhLnZhbHVlICYmCiAgICAgICAgICAgICAgKHRoaXMudmlzaXRFeHByKGEudmFsdWUpLAogICAgICAgICAgICAgICh0aGlzLmN1ci5yZXR1cm5zVmFsdWUgPSAhMCksCiAgICAgICAgICAgICAgdGhpcy5jdXIuZ2VuZXJhdG9yKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiJ3JldHVybicgd2l0aCBhcmd1bWVudCBpbnNpZGUgZ2VuZXJhdG9yIiwKICAgICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWxldGU6CiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLnRhcmdldHMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkFzc2lnbjoKICAgICAgICAgICAgdGhpcy5TRVFFeHByKGEudGFyZ2V0cykKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS52YWx1ZSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQW5uQXNzaWduOgogICAgICAgICAgICBpZiAoYS50YXJnZXQuY29uc3RydWN0b3IgPT0gU2suYXN0bm9kZXMuTmFtZSkgewogICAgICAgICAgICAgIHZhciBjID0gYS50YXJnZXQKICAgICAgICAgICAgICB2YXIgZSA9IFNrLm1hbmdsZU5hbWUodGhpcy5jdXJDbGFzcywgYy5pZCkudgogICAgICAgICAgICAgIGUgPSBTay5maXhSZXNlcnZlZE5hbWVzKGUpCiAgICAgICAgICAgICAgYyA9IHRoaXMuY3VyLnN5bUZsYWdzW2VdCiAgICAgICAgICAgICAgaWYgKGMgJiAyMDQ5ICYmIHRoaXMuZ2xvYmFsICE9IHRoaXMuY3VyLnN5bUZsYWdzICYmIGEuc2ltcGxlKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICJhbm5vdGF0ZWQgbmFtZSAnIiArIGUgKyAiJyBjYW4ndCBiZSBnbG9iYWwiLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBhLmxpbmVubywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBhLnNpbXBsZQogICAgICAgICAgICAgICAgPyB0aGlzLmFkZERlZihuZXcgU2suYnVpbHRpbi5zdHIoZSksIDQwOTgsIGEubGluZW5vKQogICAgICAgICAgICAgICAgOiBhLnZhbHVlICYmIHRoaXMuYWRkRGVmKG5ldyBTay5idWlsdGluLnN0cihlKSwgMiwgYS5saW5lbm8pCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLnZpc2l0RXhwcihhLnRhcmdldCkKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5hbm5vdGF0aW9uKQogICAgICAgICAgICBhLnZhbHVlICYmIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF1Z0Fzc2lnbjoKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS50YXJnZXQpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlByaW50OgogICAgICAgICAgICBhLmRlc3QgJiYgdGhpcy52aXNpdEV4cHIoYS5kZXN0KQogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYS52YWx1ZXMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkZvcjoKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS50YXJnZXQpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEuaXRlcikKICAgICAgICAgICAgdGhpcy5TRVFTdG10KGEuYm9keSkKICAgICAgICAgICAgYS5vcmVsc2UgJiYgdGhpcy5TRVFTdG10KGEub3JlbHNlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5XaGlsZToKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS50ZXN0KQogICAgICAgICAgICB0aGlzLlNFUVN0bXQoYS5ib2R5KQogICAgICAgICAgICBhLm9yZWxzZSAmJiB0aGlzLlNFUVN0bXQoYS5vcmVsc2UpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnRlc3QpCiAgICAgICAgICAgIHRoaXMuU0VRU3RtdChhLmJvZHkpCiAgICAgICAgICAgIGEub3JlbHNlICYmIHRoaXMuU0VRU3RtdChhLm9yZWxzZSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUmFpc2U6CiAgICAgICAgICAgIGEuZXhjICYmCiAgICAgICAgICAgICAgKHRoaXMudmlzaXRFeHByKGEuZXhjKSwKICAgICAgICAgICAgICBhLmluc3QgJiYKICAgICAgICAgICAgICAgICh0aGlzLnZpc2l0RXhwcihhLmluc3QpLCBhLnRiYWNrICYmIHRoaXMudmlzaXRFeHByKGEudGJhY2spKSwKICAgICAgICAgICAgICBhLmNhdXNlICYmIHRoaXMudmlzaXRFeHByKGEuY2F1c2UpKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Bc3NlcnQ6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudGVzdCkKICAgICAgICAgICAgYS5tc2cgJiYgdGhpcy52aXNpdEV4cHIoYS5tc2cpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkltcG9ydDoKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuSW1wb3J0RnJvbToKICAgICAgICAgICAgdGhpcy52aXNpdEFsaWFzKGEubmFtZXMsIGEubGluZW5vKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5HbG9iYWw6CiAgICAgICAgICAgIHZhciBmID0gYS5uYW1lcy5sZW5ndGgKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGY7ICsrYikgewogICAgICAgICAgICAgIGUgPSBTay5tYW5nbGVOYW1lKHRoaXMuY3VyQ2xhc3MsIGEubmFtZXNbYl0pLnYKICAgICAgICAgICAgICBlID0gU2suZml4UmVzZXJ2ZWROYW1lcyhlKQogICAgICAgICAgICAgIGMgPSB0aGlzLmN1ci5zeW1GbGFnc1tlXQogICAgICAgICAgICAgIGlmIChjICYgMTApIHsKICAgICAgICAgICAgICAgIGlmIChjICYgMikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgIm5hbWUgJyIgKyBlICsgIicgaXMgYXNzaWduZWQgdG8gYmVmb3JlIGdsb2JhbCBkZWNsYXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICBhLmxpbmVubywKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICJuYW1lICciICsgZSArICInIGlzIHVzZWQgcHJpb3IgdG8gZ2xvYmFsIGRlY2xhcmF0aW9uIiwKICAgICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgYS5saW5lbm8sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuYWRkRGVmKG5ldyBTay5idWlsdGluLnN0cihlKSwgMSwgYS5saW5lbm8pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRXhwcjoKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS52YWx1ZSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUGFzczoKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQnJlYWs6CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNvbnRpbnVlOgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWJ1Z2dlcjoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuV2l0aDoKICAgICAgICAgICAgZCh0aGlzLnZpc2l0X3dpdGhpdGVtLmJpbmQodGhpcyksIGEuaXRlbXMpCiAgICAgICAgICAgIGQodGhpcy52aXNpdFN0bXQuYmluZCh0aGlzKSwgYS5ib2R5KQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Ucnk6CiAgICAgICAgICAgIHRoaXMuU0VRU3RtdChhLmJvZHkpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeGNlcHRoYW5kbGVycyhhLmhhbmRsZXJzKQogICAgICAgICAgICB0aGlzLlNFUVN0bXQoYS5vcmVsc2UpCiAgICAgICAgICAgIHRoaXMuU0VRU3RtdChhLmZpbmFsYm9keSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgKICAgICAgICAgICAgICAiVW5oYW5kbGVkIHR5cGUgIiArIGEuY29uc3RydWN0b3IubmFtZSArICIgaW4gdmlzaXRTdG10IiwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgfQogICAgICBjLnByb3RvdHlwZS52aXNpdF93aXRoaXRlbSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmNvbnRleHRfZXhwcikKICAgICAgICBhLm9wdGlvbmFsX3ZhcnMgJiYgdGhpcy52aXNpdEV4cHIoYS5vcHRpb25hbF92YXJzKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0RXhwciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJ2aXNpdEV4cHIgY2FsbGVkIHdpdGggdW5kZWZpbmVkIikKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQm9vbE9wOgogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYS52YWx1ZXMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkJpbk9wOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmxlZnQpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEucmlnaHQpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlVuYXJ5T3A6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEub3BlcmFuZCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGFtYmRhOgogICAgICAgICAgICB0aGlzLmFkZERlZihuZXcgU2suYnVpbHRpbi5zdHIoImxhbWJkYSIpLCAyLCBhLmxpbmVubykKICAgICAgICAgICAgYS5hcmdzLmRlZmF1bHRzICYmIHRoaXMuU0VRRXhwcihhLmFyZ3MuZGVmYXVsdHMpCiAgICAgICAgICAgIHRoaXMuZW50ZXJCbG9jaygibGFtYmRhIiwgImZ1bmN0aW9uIiwgYSwgYS5saW5lbm8pCiAgICAgICAgICAgIHRoaXMudmlzaXRBcmd1bWVudHMoYS5hcmdzLCBhLmxpbmVubykKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5ib2R5KQogICAgICAgICAgICB0aGlzLmV4aXRCbG9jaygpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmRXhwOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnRlc3QpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEuYm9keSkKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5vcmVsc2UpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRpY3Q6CiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLmtleXMpCiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLnZhbHVlcykKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGljdENvbXA6CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlNldENvbXA6CiAgICAgICAgICAgIHRoaXMudmlzaXRDb21wcmVoZW5zaW9uKGEuZ2VuZXJhdG9ycywgMCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGlzdENvbXA6CiAgICAgICAgICAgIHRoaXMubmV3VG1wbmFtZShhLmxpbmVubykKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5lbHQpCiAgICAgICAgICAgIHRoaXMudmlzaXRDb21wcmVoZW5zaW9uKGEuZ2VuZXJhdG9ycywgMCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuR2VuZXJhdG9yRXhwOgogICAgICAgICAgICB0aGlzLnZpc2l0R2VuZXhwKGEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLllpZWxkOgogICAgICAgICAgICBhLnZhbHVlICYmIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIHRoaXMuY3VyLmdlbmVyYXRvciA9ICEwCiAgICAgICAgICAgIGlmICh0aGlzLmN1ci5yZXR1cm5zVmFsdWUpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiJ3JldHVybicgd2l0aCBhcmd1bWVudCBpbnNpZGUgZ2VuZXJhdG9yIiwKICAgICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Db21wYXJlOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmxlZnQpCiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLmNvbXBhcmF0b3JzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5DYWxsOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmZ1bmMpCiAgICAgICAgICAgIGlmIChhLmFyZ3MpCiAgICAgICAgICAgICAgZm9yIChsZXQgYiBvZiBhLmFyZ3MpCiAgICAgICAgICAgICAgICBiLmNvbnN0cnVjdG9yID09PSBTay5hc3Rub2Rlcy5TdGFycmVkCiAgICAgICAgICAgICAgICAgID8gdGhpcy52aXNpdEV4cHIoYi52YWx1ZSkKICAgICAgICAgICAgICAgICAgOiB0aGlzLnZpc2l0RXhwcihiKQogICAgICAgICAgICBpZiAoYS5rZXl3b3JkcykgZm9yIChsZXQgYiBvZiBhLmtleXdvcmRzKSB0aGlzLnZpc2l0RXhwcihiLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OdW06CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0cjoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXR0cmlidXRlOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdWJzY3JpcHQ6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIHRoaXMudmlzaXRTbGljZShhLnNsaWNlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lOgogICAgICAgICAgICB0aGlzLmFkZERlZihhLmlkLCBhLmN0eCA9PT0gU2suYXN0bm9kZXMuTG9hZCA/IDggOiAyLCBhLmxpbmVubykKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50OgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5MaXN0OgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5UdXBsZToKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2V0OgogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYS5lbHRzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdGFycmVkOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKAogICAgICAgICAgICAgICJVbmhhbmRsZWQgdHlwZSAiICsgYS5jb25zdHJ1Y3Rvci5uYW1lICsgIiBpbiB2aXNpdEV4cHIiLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0Q29tcHJlaGVuc2lvbiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQgPSBhLmxlbmd0aAogICAgICAgIGZvciAoYyA9IGI7IGMgPCBkOyArK2MpCiAgICAgICAgICAoYiA9IGFbY10pLAogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihiLnRhcmdldCksCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGIuaXRlciksCiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihiLmlmcykKICAgICAgfQogICAgICBjLnByb3RvdHlwZS52aXNpdEFsaWFzID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLCBkCiAgICAgICAgZm9yIChkID0gMDsgZCA8IGEubGVuZ3RoOyArK2QpIHsKICAgICAgICAgIHZhciBlID0gYVtkXQogICAgICAgICAgdmFyIGYgPSAoYyA9IG51bGwgPT09IGUuYXNuYW1lID8gZS5uYW1lLnYgOiBlLmFzbmFtZS52KQogICAgICAgICAgZSA9IGMuaW5kZXhPZigiLiIpCiAgICAgICAgICA7LTEgIT09IGUgJiYgKGYgPSBjLnN1YnN0cigwLCBlKSkKICAgICAgICAgIGlmICgiKiIgIT09IGMpIHRoaXMuYWRkRGVmKG5ldyBTay5idWlsdGluLnN0cihmKSwgMTAyNCwgYikKICAgICAgICAgIGVsc2UgaWYgKCJtb2R1bGUiICE9PSB0aGlzLmN1ci5ibG9ja1R5cGUpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICJpbXBvcnQgKiBvbmx5IGFsbG93ZWQgYXQgbW9kdWxlIGxldmVsIiwKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0R2VuZXhwID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gYS5nZW5lcmF0b3JzWzBdCiAgICAgICAgdGhpcy52aXNpdEV4cHIoYi5pdGVyKQogICAgICAgIHRoaXMuZW50ZXJCbG9jaygiZ2VuZXhwciIsICJmdW5jdGlvbiIsIGEsIGEubGluZW5vKQogICAgICAgIHRoaXMuY3VyLmdlbmVyYXRvciA9ICEwCiAgICAgICAgdGhpcy5hZGREZWYobmV3IFNrLmJ1aWx0aW4uc3RyKCIuMCIpLCA0LCBhLmxpbmVubykKICAgICAgICB0aGlzLnZpc2l0RXhwcihiLnRhcmdldCkKICAgICAgICB0aGlzLlNFUUV4cHIoYi5pZnMpCiAgICAgICAgdGhpcy52aXNpdENvbXByZWhlbnNpb24oYS5nZW5lcmF0b3JzLCAxKQogICAgICAgIHRoaXMudmlzaXRFeHByKGEuZWx0KQogICAgICAgIHRoaXMuZXhpdEJsb2NrKCkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS52aXNpdEV4Y2VwdGhhbmRsZXJzID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgZm9yIChiID0gMDsgKGMgPSBhW2JdKTsgKytiKQogICAgICAgICAgYy50eXBlICYmIHRoaXMudmlzaXRFeHByKGMudHlwZSksCiAgICAgICAgICAgIGMubmFtZSAmJiB0aGlzLnZpc2l0RXhwcihjLm5hbWUpLAogICAgICAgICAgICB0aGlzLlNFUVN0bXQoYy5ib2R5KQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLmFuYWx5emVCbG9jayA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgayA9IHt9CiAgICAgICAgdmFyIGYgPSB7fSwKICAgICAgICAgIGwgPSB7fSwKICAgICAgICAgIGcgPSB7fSwKICAgICAgICAgIGggPSB7fQogICAgICAgICJjbGFzcyIgPT0gYS5ibG9ja1R5cGUgJiYgKGUobCwgZCksIGIgJiYgZShnLCBiKSkKICAgICAgICBmb3IgKHAgaW4gYS5zeW1GbGFncykgewogICAgICAgICAgdmFyIG0gPSBhLnN5bUZsYWdzW3BdCiAgICAgICAgICB0aGlzLmFuYWx5emVOYW1lKGEsIGYsIHAsIG0sIGIsIGssIGMsIGQpCiAgICAgICAgfQogICAgICAgICJjbGFzcyIgIT09IGEuYmxvY2tUeXBlICYmCiAgICAgICAgICAoImZ1bmN0aW9uIiA9PT0gYS5ibG9ja1R5cGUgJiYgZShnLCBrKSwgYiAmJiBlKGcsIGIpLCBlKGwsIGQpKQogICAgICAgIGsgPSB7fQogICAgICAgIHZhciBwID0gYS5jaGlsZHJlbi5sZW5ndGgKICAgICAgICBmb3IgKG0gPSAwOyBtIDwgcDsgKyttKQogICAgICAgICAgaWYgKAogICAgICAgICAgICAoKGQgPSBhLmNoaWxkcmVuW21dKSwKICAgICAgICAgICAgdGhpcy5hbmFseXplQ2hpbGRCbG9jayhkLCBnLCBoLCBsLCBrKSwKICAgICAgICAgICAgZC5oYXNGcmVlIHx8IGQuY2hpbGRIYXNGcmVlKQogICAgICAgICAgKQogICAgICAgICAgICBhLmNoaWxkSGFzRnJlZSA9ICEwCiAgICAgICAgZShoLCBrKQogICAgICAgICJmdW5jdGlvbiIgPT09IGEuYmxvY2tUeXBlICYmIHRoaXMuYW5hbHl6ZUNlbGxzKGYsIGgpCiAgICAgICAgYiA9IHRoaXMudXBkYXRlU3ltYm9scyhhLnN5bUZsYWdzLCBmLCBiLCBoLCAiY2xhc3MiID09PSBhLmJsb2NrVHlwZSkKICAgICAgICBhLmhhc0ZyZWUgPSBhLmhhc0ZyZWUgfHwgYgogICAgICAgIGUoYywgaCkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5hbmFseXplQ2hpbGRCbG9jayA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGYpIHsKICAgICAgICB2YXIgayA9IHt9CiAgICAgICAgZShrLCBiKQogICAgICAgIGIgPSB7fQogICAgICAgIGUoYiwgYykKICAgICAgICBjID0ge30KICAgICAgICBlKGMsIGQpCiAgICAgICAgdGhpcy5hbmFseXplQmxvY2soYSwgaywgYiwgYykKICAgICAgICBlKGYsIGIpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUuYW5hbHl6ZUNlbGxzID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgZm9yIChjIGluIGEpIHsKICAgICAgICAgIHZhciBkID0gYVtjXQogICAgICAgICAgMSA9PT0gZCAmJiB2b2lkIDAgIT09IGJbY10gJiYgKChhW2NdID0gNSksIGRlbGV0ZSBiW2NdKQogICAgICAgIH0KICAgICAgfQogICAgICBjLnByb3RvdHlwZS51cGRhdGVTeW1ib2xzID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSkgewogICAgICAgIHZhciBrLAogICAgICAgICAgZiA9ICExCiAgICAgICAgZm9yIChrIGluIGEpIHsKICAgICAgICAgIHZhciBsID0gYVtrXQogICAgICAgICAgdmFyIGcgPSBiW2tdCiAgICAgICAgICBsIHw9IGcgPDwgMTEKICAgICAgICAgIGFba10gPSBsCiAgICAgICAgfQogICAgICAgIGZvciAoayBpbiBkKQogICAgICAgICAgKGIgPSBhW2tdKSwKICAgICAgICAgICAgdm9pZCAwICE9PSBiCiAgICAgICAgICAgICAgPyBlICYmIGIgJiAxMDMxICYmICgoYiB8PSA1MTIpLCAoYVtrXSA9IGIpKQogICAgICAgICAgICAgIDogdm9pZCAwICE9PSBjW2tdICYmICgoYVtrXSA9IDgxOTIpLCAoZiA9ICEwKSkKICAgICAgICByZXR1cm4gZgogICAgICB9CiAgICAgIGMucHJvdG90eXBlLmFuYWx5emVOYW1lID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZiwgcSwgbSkgewogICAgICAgIGlmIChkICYgMSkgewogICAgICAgICAgaWYgKGQgJiA0KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAibmFtZSAnIiArIGMgKyAiJyBpcyBsb2NhbCBhbmQgZ2xvYmFsIiwKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICAgIGEubGluZW5vLAogICAgICAgICAgICApCiAgICAgICAgICBiW2NdID0gMgogICAgICAgICAgbVtjXSA9IG51bGwKICAgICAgICAgIGUgJiYgdm9pZCAwICE9PSBlW2NdICYmIGRlbGV0ZSBlW2NdCiAgICAgICAgfSBlbHNlCiAgICAgICAgICBkICYgMTAzMAogICAgICAgICAgICA/ICgoYltjXSA9IDEpLCAoZltjXSA9IG51bGwpLCBkZWxldGUgbVtjXSkKICAgICAgICAgICAgOiBlICYmIHZvaWQgMCAhPT0gZVtjXQogICAgICAgICAgICA/ICgoYltjXSA9IDQpLCAoYS5oYXNGcmVlID0gITApLCAocVtjXSA9IG51bGwpKQogICAgICAgICAgICA6ICgobSAmJiB2b2lkIDAgIT09IG1bY10pIHx8ICFhLmlzTmVzdGVkIHx8IChhLmhhc0ZyZWUgPSAhMCksCiAgICAgICAgICAgICAgKGJbY10gPSAzKSkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5hbmFseXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5hbmFseXplQmxvY2sodGhpcy50b3AsIG51bGwsIHt9LCB7fSkKICAgICAgfQogICAgICBTay5zeW1ib2x0YWJsZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgZCA9IG5ldyBjKGIpCiAgICAgICAgZC5lbnRlckJsb2NrKCJ0b3AiLCAibW9kdWxlIiwgYSwgMCkKICAgICAgICBkLnRvcCA9IGQuY3VyCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEuYm9keS5sZW5ndGg7ICsrYikgZC52aXNpdFN0bXQoYS5ib2R5W2JdKQogICAgICAgIGQuZXhpdEJsb2NrKCkKICAgICAgICBkLmFuYWx5emUoKQogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgU2suZHVtcFN5bXRhYiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGEgPyAiVHJ1ZSIgOiAiRmFsc2UiCiAgICAgICAgICB9LAogICAgICAgICAgYyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdmFyIGIsCiAgICAgICAgICAgICAgYyA9IFtdCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhLmxlbmd0aDsgKytiKQogICAgICAgICAgICAgIGMucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoYVtiXSkuJHIoKS52KQogICAgICAgICAgICByZXR1cm4gIlsiICsgYy5qb2luKCIsICIpICsgIl0iCiAgICAgICAgICB9LAogICAgICAgICAgZCA9IGZ1bmN0aW9uKGEsIGUpIHsKICAgICAgICAgICAgdmFyIGssIGYKICAgICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gIiIpCiAgICAgICAgICAgIHZhciBsID0gZSArICJTeW1fdHlwZTogIiArIGEuZ2V0X3R5cGUoKSArICJcbiIKICAgICAgICAgICAgbCArPSBlICsgIlN5bV9uYW1lOiAiICsgYS5nZXRfbmFtZSgpICsgIlxuIgogICAgICAgICAgICBsICs9IGUgKyAiU3ltX2xpbmVubzogIiArIGEuZ2V0X2xpbmVubygpICsgIlxuIgogICAgICAgICAgICBsICs9IGUgKyAiU3ltX25lc3RlZDogIiArIGIoYS5pc19uZXN0ZWQoKSkgKyAiXG4iCiAgICAgICAgICAgIGwgKz0gZSArICJTeW1faGFzY2hpbGRyZW46ICIgKyBiKGEuaGFzX2NoaWxkcmVuKCkpICsgIlxuIgogICAgICAgICAgICAiY2xhc3MiID09PSBhLmdldF90eXBlKCkKICAgICAgICAgICAgICA/IChsICs9IGUgKyAiQ2xhc3NfbWV0aG9kczogIiArIGMoYS5nZXRfbWV0aG9kcygpKSArICJcbiIpCiAgICAgICAgICAgICAgOiAiZnVuY3Rpb24iID09PSBhLmdldF90eXBlKCkgJiYKICAgICAgICAgICAgICAgICgobCArPSBlICsgIkZ1bmNfcGFyYW1zOiAiICsgYyhhLmdldF9wYXJhbWV0ZXJzKCkpICsgIlxuIiksCiAgICAgICAgICAgICAgICAobCArPSBlICsgIkZ1bmNfbG9jYWxzOiAiICsgYyhhLmdldF9sb2NhbHMoKSkgKyAiXG4iKSwKICAgICAgICAgICAgICAgIChsICs9IGUgKyAiRnVuY19nbG9iYWxzOiAiICsgYyhhLmdldF9nbG9iYWxzKCkpICsgIlxuIiksCiAgICAgICAgICAgICAgICAobCArPSBlICsgIkZ1bmNfZnJlZXM6ICIgKyBjKGEuZ2V0X2ZyZWVzKCkpICsgIlxuIikpCiAgICAgICAgICAgIGwgKz0gZSArICItLSBJZGVudGlmaWVycyAtLVxuIgogICAgICAgICAgICB2YXIgZyA9IGEuZ2V0X2lkZW50aWZpZXJzKCkKICAgICAgICAgICAgdmFyIGggPSBnLmxlbmd0aAogICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgaDsgKytmKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBhLmxvb2t1cChnW2ZdKQogICAgICAgICAgICAgIGwgKz0gZSArICJuYW1lOiAiICsgbi5nZXRfbmFtZSgpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX3JlZmVyZW5jZWQ6ICIgKyBiKG4uaXNfcmVmZXJlbmNlZCgpKSArICJcbiIKICAgICAgICAgICAgICBsICs9IGUgKyAiICBpc19pbXBvcnRlZDogIiArIGIobi5pc19pbXBvcnRlZCgpKSArICJcbiIKICAgICAgICAgICAgICBsICs9IGUgKyAiICBpc19wYXJhbWV0ZXI6ICIgKyBiKG4uaXNfcGFyYW1ldGVyKCkpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX2dsb2JhbDogIiArIGIobi5pc19nbG9iYWwoKSkgKyAiXG4iCiAgICAgICAgICAgICAgbCArPQogICAgICAgICAgICAgICAgZSArICIgIGlzX2RlY2xhcmVkX2dsb2JhbDogIiArIGIobi5pc19kZWNsYXJlZF9nbG9iYWwoKSkgKyAiXG4iCiAgICAgICAgICAgICAgbCArPSBlICsgIiAgaXNfbG9jYWw6ICIgKyBiKG4uaXNfbG9jYWwoKSkgKyAiXG4iCiAgICAgICAgICAgICAgbCArPSBlICsgIiAgaXNfZnJlZTogIiArIGIobi5pc19mcmVlKCkpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX2Fzc2lnbmVkOiAiICsgYihuLmlzX2Fzc2lnbmVkKCkpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX25hbWVzcGFjZTogIiArIGIobi5pc19uYW1lc3BhY2UoKSkgKyAiXG4iCiAgICAgICAgICAgICAgdmFyIHIgPSBuLmdldF9uYW1lc3BhY2VzKCkKICAgICAgICAgICAgICB2YXIgbSA9IHIubGVuZ3RoCiAgICAgICAgICAgICAgbCArPSBlICsgIiAgbmFtZXNwYWNlczogW1xuIgogICAgICAgICAgICAgIHZhciBwID0gW10KICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbTsgKytrKSAobiA9IHJba10pLCBwLnB1c2goZChuLCBlICsgIiAgICAiKSkKICAgICAgICAgICAgICBsICs9IHAuam9pbigiXG4iKQogICAgICAgICAgICAgIGwgKz0gZSArICIgIF1cbiIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbAogICAgICAgICAgfQogICAgICAgIHJldHVybiBkKGEudG9wLCAiIikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnN5bWJvbHRhYmxlIiwgU2suc3ltYm9sdGFibGUpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZHVtcFN5bXRhYiIsIFNrLmR1bXBTeW10YWIpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBmdW5jdGlvbiBhKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICB0aGlzLmZpbGVuYW1lID0gYQogICAgICAgIHRoaXMuc3QgPSBiCiAgICAgICAgdGhpcy5mbGFncyA9IGMKICAgICAgICB0aGlzLmNhblN1c3BlbmQgPSBkCiAgICAgICAgdGhpcy5pbnRlcmFjdGl2ZSA9ICExCiAgICAgICAgdGhpcy5uZXN0bGV2ZWwgPSAwCiAgICAgICAgdGhpcy51ID0gbnVsbAogICAgICAgIHRoaXMuc3RhY2sgPSBbXQogICAgICAgIHRoaXMucmVzdWx0ID0gW10KICAgICAgICB0aGlzLmFsbFVuaXRzID0gW10KICAgICAgICB0aGlzLnNvdXJjZSA9IGUgPyBlLnNwbGl0KCJcbiIpIDogITEKICAgICAgfQogICAgICBmdW5jdGlvbiBiKCkgewogICAgICAgIHRoaXMubmFtZSA9IHRoaXMuc3RlID0gbnVsbAogICAgICAgIHRoaXMuZG9lc1N1c3BlbmQgPSB0aGlzLmNhblN1c3BlbmQgPSAhMQogICAgICAgIHRoaXMucHJpdmF0ZV8gPSBudWxsCiAgICAgICAgdGhpcy5saW5lbm8gPSB0aGlzLmZpcnN0bGluZW5vID0gMAogICAgICAgIHRoaXMubGluZW5vU2V0ID0gITEKICAgICAgICB0aGlzLmxvY2FsbmFtZXMgPSBbXQogICAgICAgIHRoaXMubG9jYWx0ZW1wcyA9IFtdCiAgICAgICAgdGhpcy50ZW1wc1RvU2F2ZSA9IFtdCiAgICAgICAgdGhpcy5ibG9ja251bSA9IDAKICAgICAgICB0aGlzLmJsb2NrcyA9IFtdCiAgICAgICAgdGhpcy5jdXJibG9jayA9IDAKICAgICAgICB0aGlzLmNvbnN0cyA9IHt9CiAgICAgICAgdGhpcy5zY29wZW5hbWUgPSBudWxsCiAgICAgICAgdGhpcy5zdWZmaXhDb2RlID0gdGhpcy5zd2l0Y2hDb2RlID0gdGhpcy52YXJEZWNsc0NvZGUgPSB0aGlzLnByZWZpeENvZGUgPQogICAgICAgICAgIiIKICAgICAgICB0aGlzLmJyZWFrQmxvY2tzID0gW10KICAgICAgICB0aGlzLmNvbnRpbnVlQmxvY2tzID0gW10KICAgICAgICB0aGlzLmV4Y2VwdEJsb2NrcyA9IFtdCiAgICAgICAgdGhpcy5maW5hbGx5QmxvY2tzID0gW10KICAgICAgfQogICAgICBmdW5jdGlvbiBjKGEpIHsKICAgICAgICByZXR1cm4gITAgIT09IGdbYV0gPyBhIDogYSArICJfJHJ3JCIKICAgICAgfQogICAgICBmdW5jdGlvbiBkKGEpIHsKICAgICAgICByZXR1cm4gaFthXSA/IGEgKyAiXyRybiQiIDogYQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGUoYSwgYikgewogICAgICAgIHZhciBjID0gYi52CiAgICAgICAgaWYgKAogICAgICAgICAgbnVsbCA9PT0gYSB8fAogICAgICAgICAgbnVsbCA9PT0gYyB8fAogICAgICAgICAgIl8iICE9PSBjLmNoYXJBdCgwKSB8fAogICAgICAgICAgIl8iICE9PSBjLmNoYXJBdCgxKSB8fAogICAgICAgICAgKCJfIiA9PT0gYy5jaGFyQXQoYy5sZW5ndGggLSAxKSAmJiAiXyIgPT09IGMuY2hhckF0KGMubGVuZ3RoIC0gMikpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB2YXIgZCA9IGEudgogICAgICAgIGQucmVwbGFjZSgvXy9nLCAiIikKICAgICAgICBpZiAoIiIgPT09IGQpIHJldHVybiBiCiAgICAgICAgZCA9IGEudgogICAgICAgIGQucmVwbGFjZSgvXl8qLywgIiIpCiAgICAgICAgcmV0dXJuIChkID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfIiArIGQgKyBjKSkKICAgICAgfQogICAgICB2YXIgZgogICAgICBTay5nZW5zeW1jb3VudCA9IDAKICAgICAgYi5wcm90b3R5cGUuYWN0aXZhdGVTY29wZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gdGhpcwogICAgICAgIGYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBiLAogICAgICAgICAgICBjID0gYS5ibG9ja3NbYS5jdXJibG9ja10KICAgICAgICAgIGlmIChudWxsID09PSBjLl9uZXh0KQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgKytiKSBjLnB1c2goYXJndW1lbnRzW2JdKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5nZXRTb3VyY2VMaW5lID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHRoaXMuc291cmNlKQogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZVthIC0gMV0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5hbm5vdGF0ZVNvdXJjZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICh0aGlzLnNvdXJjZSkgewogICAgICAgICAgdmFyIGMgPSBhLmxpbmVubwogICAgICAgICAgdmFyIGQgPSBhLmNvbF9vZmZzZXQKICAgICAgICAgIGYoIlxuLy9cbi8vIGxpbmUgIiwgYywgIjpcbi8vICIsIHRoaXMuZ2V0U291cmNlTGluZShjKSwgIlxuLy8gIikKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBkOyArK2IpIGYoIiAiKQogICAgICAgICAgZigiXlxuLy9cbiIpCiAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEubGluZW5vICYmIHZvaWQgMCAhPT0gYS5jb2xfb2Zmc2V0KQogICAgICAgICAgZigiJGN1cnJMaW5lTm8gPSAiLCBjLCAiO1xuJGN1cnJDb2xObyA9ICIsIGQsICI7XG5cbiIpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmdlbnN5bSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSAiJCIgKyAoYSB8fCAiIikgKyBTay5nZW5zeW1jb3VudCsrKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLm5pY2VOYW1lID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB0aGlzLmdlbnN5bSgKICAgICAgICAgIGEKICAgICAgICAgICAgLnJlcGxhY2UoIjwiLCAiIikKICAgICAgICAgICAgLnJlcGxhY2UoIj4iLCAiIikKICAgICAgICAgICAgLnJlcGxhY2UoIiAiLCAiXyIpLAogICAgICAgICkKICAgICAgfQogICAgICB2YXIgZyA9IHsKICAgICAgICAgIGFic3RyYWN0OiAhMCwKICAgICAgICAgIGFzOiAhMCwKICAgICAgICAgIGJvb2xlYW46ICEwLAogICAgICAgICAgYnJlYWs6ICEwLAogICAgICAgICAgYnl0ZTogITAsCiAgICAgICAgICBjYXNlOiAhMCwKICAgICAgICAgIGNhdGNoOiAhMCwKICAgICAgICAgIGNoYXI6ICEwLAogICAgICAgICAgY2xhc3M6ICEwLAogICAgICAgICAgY29udGludWU6ICEwLAogICAgICAgICAgY29uc3Q6ICEwLAogICAgICAgICAgZGVidWdnZXI6ICEwLAogICAgICAgICAgZGVmYXVsdDogITAsCiAgICAgICAgICBkZWxldGU6ICEwLAogICAgICAgICAgZG86ICEwLAogICAgICAgICAgZG91YmxlOiAhMCwKICAgICAgICAgIGVsc2U6ICEwLAogICAgICAgICAgZW51bTogITAsCiAgICAgICAgICBleHBvcnQ6ICEwLAogICAgICAgICAgZXh0ZW5kczogITAsCiAgICAgICAgICBmYWxzZTogITAsCiAgICAgICAgICBmaW5hbDogITAsCiAgICAgICAgICBmaW5hbGx5OiAhMCwKICAgICAgICAgIGZsb2F0OiAhMCwKICAgICAgICAgIGZvcjogITAsCiAgICAgICAgICBmdW5jdGlvbjogITAsCiAgICAgICAgICBnb3RvOiAhMCwKICAgICAgICAgIGlmOiAhMCwKICAgICAgICAgIGltcGxlbWVudHM6ICEwLAogICAgICAgICAgaW1wb3J0OiAhMCwKICAgICAgICAgIGluOiAhMCwKICAgICAgICAgIGluc3RhbmNlb2Y6ICEwLAogICAgICAgICAgaW50OiAhMCwKICAgICAgICAgIGludGVyZmFjZTogITAsCiAgICAgICAgICBpczogITAsCiAgICAgICAgICBsb25nOiAhMCwKICAgICAgICAgIG5hbWVzcGFjZTogITAsCiAgICAgICAgICBuYXRpdmU6ICEwLAogICAgICAgICAgbmV3OiAhMCwKICAgICAgICAgIG51bGw6ICEwLAogICAgICAgICAgcGFja2FnZTogITAsCiAgICAgICAgICBwcml2YXRlOiAhMCwKICAgICAgICAgIHByb3RlY3RlZDogITAsCiAgICAgICAgICBwdWJsaWM6ICEwLAogICAgICAgICAgcmV0dXJuOiAhMCwKICAgICAgICAgIHNob3J0OiAhMCwKICAgICAgICAgIHN0YXRpYzogITAsCiAgICAgICAgICBzdXBlcjogITEsCiAgICAgICAgICBzd2l0Y2g6ICEwLAogICAgICAgICAgc3luY2hyb25pemVkOiAhMCwKICAgICAgICAgIHRoaXM6ICEwLAogICAgICAgICAgdGhyb3c6ICEwLAogICAgICAgICAgdGhyb3dzOiAhMCwKICAgICAgICAgIHRyYW5zaWVudDogITAsCiAgICAgICAgICB0cnVlOiAhMCwKICAgICAgICAgIHRyeTogITAsCiAgICAgICAgICB0eXBlb2Y6ICEwLAogICAgICAgICAgdXNlOiAhMCwKICAgICAgICAgIHZhcjogITAsCiAgICAgICAgICB2b2lkOiAhMCwKICAgICAgICAgIHZvbGF0aWxlOiAhMCwKICAgICAgICAgIHdoaWxlOiAhMCwKICAgICAgICAgIHdpdGg6ICEwLAogICAgICAgIH0sCiAgICAgICAgaCA9IHsKICAgICAgICAgIF9fZGVmaW5lR2V0dGVyX186ICEwLAogICAgICAgICAgX19kZWZpbmVTZXR0ZXJfXzogITAsCiAgICAgICAgICBhcHBseTogITAsCiAgICAgICAgICBjYWxsOiAhMCwKICAgICAgICAgIGV2YWw6ICEwLAogICAgICAgICAgaGFzT3duUHJvcGVydHk6ICEwLAogICAgICAgICAgaXNQcm90b3R5cGVPZjogITAsCiAgICAgICAgICBfX2xvb2t1cEdldHRlcl9fOiAhMCwKICAgICAgICAgIF9fbG9va3VwU2V0dGVyX186ICEwLAogICAgICAgICAgX19ub1N1Y2hNZXRob2RfXzogITAsCiAgICAgICAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZTogITAsCiAgICAgICAgICB0b1NvdXJjZTogITAsCiAgICAgICAgICB0b0xvY2FsZVN0cmluZzogITAsCiAgICAgICAgICB0b1N0cmluZzogITAsCiAgICAgICAgICB1bndhdGNoOiAhMCwKICAgICAgICAgIHZhbHVlT2Y6ICEwLAogICAgICAgICAgd2F0Y2g6ICEwLAogICAgICAgICAgbGVuZ3RoOiAhMCwKICAgICAgICAgIG5hbWU6ICEwLAogICAgICAgIH0KICAgICAgYS5wcm90b3R5cGUubWFrZUNvbnN0YW50ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9ICIiCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7ICsrYikgYyArPSBhcmd1bWVudHNbYl0KICAgICAgICBmb3IgKGQgaW4gdGhpcy51LmNvbnN0cykKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy51LmNvbnN0cy5oYXNPd25Qcm9wZXJ0eShkKSAmJgogICAgICAgICAgICAoKGIgPSB0aGlzLnUuY29uc3RzW2RdKSwgYiA9PSBjKQogICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gZAogICAgICAgIHZhciBkID0gdGhpcy51LnNjb3BlbmFtZSArICIuIiArIHRoaXMuZ2Vuc3ltKCJjb25zdCIpCiAgICAgICAgdGhpcy51LmNvbnN0c1tkXSA9IGMKICAgICAgICByZXR1cm4gZAogICAgICB9CiAgICAgIGEucHJvdG90eXBlLl9nciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQgPSB0aGlzLmdlbnN5bShhKQogICAgICAgIHRoaXMudS5sb2NhbHRlbXBzLnB1c2goZCkKICAgICAgICBmKCJ2YXIgIiwgZCwgIj0iKQogICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyArK2MpIGYoYXJndW1lbnRzW2NdKQogICAgICAgIGYoIjsiKQogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUub3V0cHV0SW50ZXJydXB0VGVzdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gIiIKICAgICAgICBpZiAoCiAgICAgICAgICBudWxsICE9PSBTay5leGVjTGltaXQgfHwKICAgICAgICAgIChudWxsICE9PSBTay55aWVsZExpbWl0ICYmIHRoaXMudS5jYW5TdXNwZW5kKQogICAgICAgICkKICAgICAgICAgIChhICs9ICJ2YXIgJGRhdGVOb3cgPSBEYXRlLm5vdygpOyIpLAogICAgICAgICAgICBudWxsICE9PSBTay5leGVjTGltaXQgJiYKICAgICAgICAgICAgICAoYSArPQogICAgICAgICAgICAgICAgImlmICgkZGF0ZU5vdyAtIFNrLmV4ZWNTdGFydCA+IFNrLmV4ZWNMaW1pdCkge3Rocm93IG5ldyBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yKFNrLnRpbWVvdXRNc2coKSl9IiksCiAgICAgICAgICAgIG51bGwgIT09IFNrLnlpZWxkTGltaXQgJiYKICAgICAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCAmJgogICAgICAgICAgICAgICgoYSA9CiAgICAgICAgICAgICAgICBhICsKICAgICAgICAgICAgICAgICJpZiAoJGRhdGVOb3cgLSBTay5sYXN0WWllbGQgPiBTay55aWVsZExpbWl0KSB7IiArCiAgICAgICAgICAgICAgICAoInZhciAkc3VzcCA9ICRzYXZlU3VzcGVuc2lvbih7ZGF0YToge3R5cGU6ICdTay55aWVsZCd9LCByZXN1bWU6IGZ1bmN0aW9uKCkge319LCAnIiArCiAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgICAgICAgICAiJywkY3VyckxpbmVObywkY3VyckNvbE5vKTsiKSksCiAgICAgICAgICAgICAgKGEgKz0gIiRzdXNwLiRibGsgPSAkYmxrOyRzdXNwLm9wdGlvbmFsID0gdHJ1ZTtyZXR1cm4gJHN1c3A7fSIpLAogICAgICAgICAgICAgICh0aGlzLnUuZG9lc1N1c3BlbmQgPSAhMCkpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5fanVtcGZhbHNlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGEgPSB0aGlzLl9ncigKICAgICAgICAgICJqZmFsc2UiLAogICAgICAgICAgIigiLAogICAgICAgICAgYSwKICAgICAgICAgICI9PT1mYWxzZXx8IVNrLm1pc2NldmFsLmlzVHJ1ZSgiLAogICAgICAgICAgYSwKICAgICAgICAgICIpKSIsCiAgICAgICAgKQogICAgICAgIGYoImlmKCIsIGEsICIpey8qdGVzdCBmYWlsZWQgKi8kYmxrPSIsIGIsICI7Y29udGludWU7fSIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2p1bXB1bmRlZiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBmKCJpZigiLCBhLCAiPT09dW5kZWZpbmVkKXskYmxrPSIsIGIsICI7Y29udGludWU7fSIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2p1bXBub3R1bmRlZiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBmKCJpZigiLCBhLCAiIT09dW5kZWZpbmVkKXskYmxrPSIsIGIsICI7Y29udGludWU7fSIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2p1bXB0cnVlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGEgPSB0aGlzLl9ncigianRydWUiLCAiKCIsIGEsICI9PT10cnVlfHxTay5taXNjZXZhbC5pc1RydWUoIiwgYSwgIikpIikKICAgICAgICBmKCJpZigiLCBhLCAiKXsvKnRlc3QgcGFzc2VkICovJGJsaz0iLCBiLCAiO2NvbnRpbnVlO30iKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLl9qdW1wID0gZnVuY3Rpb24oYSkgewogICAgICAgIG51bGwgPT09IHRoaXMudS5ibG9ja3NbdGhpcy51LmN1cmJsb2NrXS5fbmV4dCAmJgogICAgICAgICAgKGYoIiRibGs9IiwgYSwgIjsiKSwgKHRoaXMudS5ibG9ja3NbdGhpcy51LmN1cmJsb2NrXS5fbmV4dCA9IGEpKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLl9jaGVja1N1c3BlbnNpb24gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKHRoaXMudS5jYW5TdXNwZW5kKSB7CiAgICAgICAgICB2YXIgYiA9IHRoaXMubmV3QmxvY2soImZ1bmN0aW9uIHJldHVybiBvciByZXN1bWUgc3VzcGVuc2lvbiIpCiAgICAgICAgICB0aGlzLl9qdW1wKGIpCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGIpCiAgICAgICAgICBhID0gYSB8fCB7IGxpbmVubzogIiRjdXJyTGluZU5vIiwgY29sX29mZnNldDogIiRjdXJyQ29sTm8iIH0KICAgICAgICAgIGYoCiAgICAgICAgICAgICJpZiAoJHJldCAmJiAkcmV0LiRpc1N1c3BlbnNpb24pIHsgcmV0dXJuICRzYXZlU3VzcGVuc2lvbigkcmV0LCciICsKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAiJywiICsKICAgICAgICAgICAgICBhLmxpbmVubyArCiAgICAgICAgICAgICAgIiwiICsKICAgICAgICAgICAgICBhLmNvbF9vZmZzZXQgKwogICAgICAgICAgICAgICIpOyB9IiwKICAgICAgICAgICkKICAgICAgICAgIHRoaXMudS5kb2VzU3VzcGVuZCA9ICEwCiAgICAgICAgICB0aGlzLnUudGVtcHNUb1NhdmUgPSB0aGlzLnUudGVtcHNUb1NhdmUuY29uY2F0KHRoaXMudS5sb2NhbHRlbXBzKQogICAgICAgIH0gZWxzZQogICAgICAgICAgZigKICAgICAgICAgICAgImlmICgkcmV0ICYmICRyZXQuJGlzU3VzcGVuc2lvbikgeyAkcmV0ID0gU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KCRyZXQpOyB9IiwKICAgICAgICAgICkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jdW5wYWNrc3RhcnN0b2FycmF5ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmICghYSB8fCAwID09IGEubGVuZ3RoKSByZXR1cm4gIltdIgogICAgICAgIGxldCBjID0gITEKICAgICAgICBmb3IgKGxldCBkIG9mIGEpIHsKICAgICAgICAgIGlmIChiICYmIGMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICJFeHRlbmRlZCBhcmd1bWVudCB1bnBhY2tpbmcgaXMgbm90IHBlcm1pdHRlZCBpbiBQeXRob24gMiIsCiAgICAgICAgICAgICkKICAgICAgICAgIGQuY29uc3RydWN0b3IgPT09IFNrLmFzdG5vZGVzLlN0YXJyZWQgJiYgKGMgPSAhMCkKICAgICAgICB9CiAgICAgICAgaWYgKGMpIHsKICAgICAgICAgIGIgPSB0aGlzLl9ncigidW5wYWNrIiwgIltdIikKICAgICAgICAgIGZvciAobGV0IGMgb2YgYSkKICAgICAgICAgICAgYy5jb25zdHJ1Y3RvciAhPT0gU2suYXN0bm9kZXMuU3RhcnJlZAogICAgICAgICAgICAgID8gZihiLCAiLnB1c2goIiwgdGhpcy52ZXhwcihjKSwgIik7IikKICAgICAgICAgICAgICA6IChmKAogICAgICAgICAgICAgICAgICAiJHJldCA9IFNrLm1pc2NldmFsLml0ZXJGb3IoU2suYWJzdHIuaXRlcigiLAogICAgICAgICAgICAgICAgICB0aGlzLnZleHByKGMudmFsdWUpLAogICAgICAgICAgICAgICAgICAiKSwgZnVuY3Rpb24oZSkgeyAiLAogICAgICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgICAgICAiLnB1c2goZSk7IH0pOyIsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKCkpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICByZXR1cm4gIlsiICsgYS5tYXAoYSA9PiB0aGlzLnZleHByKGEpKS5qb2luKCIsIikgKyAiXSIKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jdHVwbGVsaXN0b3JzZXQgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoInR1cGxlIiA9PT0gYyB8fCAibGlzdCIgPT09IGMgfHwgInNldCIgPT09IGMpCiAgICAgICAgdmFyIGQgPSAhMQogICAgICAgIGZvciAoayBvZiBhLmVsdHMpCiAgICAgICAgICBpZiAoay5jb25zdHJ1Y3RvciA9PT0gU2suYXN0bm9kZXMuU3RhcnJlZCkgewogICAgICAgICAgICBkID0gITAKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICBpZiAoYS5jdHggPT09IFNrLmFzdG5vZGVzLlN0b3JlKSB7CiAgICAgICAgICBpZiAoZCkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgIlR1cGxlIHVucGFja2luZyB3aXRoIHN0YXJzIGlzIG5vdCBzdXBwb3J0ZWQiLAogICAgICAgICAgICApCiAgICAgICAgICBkID0gdGhpcy5fZ3IoCiAgICAgICAgICAgICJpdGVtcyIsCiAgICAgICAgICAgICJTay5hYnN0ci5zZXF1ZW5jZVVucGFjaygiICsgYiArICIsIiArIGEuZWx0cy5sZW5ndGggKyAiKSIsCiAgICAgICAgICApCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5lbHRzLmxlbmd0aDsgKytiKQogICAgICAgICAgICB0aGlzLnZleHByKGEuZWx0c1tiXSwgZCArICJbIiArIGIgKyAiXSIpCiAgICAgICAgfSBlbHNlIGlmIChhLmN0eCA9PT0gU2suYXN0bm9kZXMuTG9hZCB8fCAic2V0IiA9PT0gYykgewogICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgaWYgKCFTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiTGlzdCBwYWNraW5nIHdpdGggc3RhcnMgaXMgbm90IHN1cHBvcnRlZCBpbiBQeXRob24gMiIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgImxvYWQiICsgYywKICAgICAgICAgICAgICAibmV3IFNrLmJ1aWx0aW5zWyciLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgIiddKCIsCiAgICAgICAgICAgICAgdGhpcy5jdW5wYWNrc3RhcnN0b2FycmF5KGEuZWx0cyksCiAgICAgICAgICAgICAgIikiLAogICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoInR1cGxlIiA9PT0gYykgewogICAgICAgICAgICB2YXIgZSA9ICEwCiAgICAgICAgICAgIGQgPSBbXQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5lbHRzLmxlbmd0aDsgKytiKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSB0aGlzLnZleHByKGEuZWx0c1tiXSkKICAgICAgICAgICAgICBlICYmIC0xID09IGsuaW5kZXhPZigiJGNvbnN0IikgJiYgKGUgPSAhMSkKICAgICAgICAgICAgICBkLnB1c2goaykKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZSkgcmV0dXJuIHRoaXMubWFrZUNvbnN0YW50KCJuZXcgU2suYnVpbHRpbi50dXBsZShbIiArIGQgKyAiXSkiKQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZC5sZW5ndGg7ICsrYikgZFtiXSA9IHRoaXMuX2dyKCJlbGVtIiwgZFtiXSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyKCJsb2FkIiArIGMsICJuZXcgU2suYnVpbHRpbnNbJyIsIGMsICInXShbIiwgZCwgIl0pIikKICAgICAgICAgIH0KICAgICAgICAgIGQgPSBbXQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IGEuZWx0cy5sZW5ndGg7ICsrYikKICAgICAgICAgICAgZC5wdXNoKHRoaXMuX2dyKCJlbGVtIiwgdGhpcy52ZXhwcihhLmVsdHNbYl0pKSkKICAgICAgICAgIHJldHVybiB0aGlzLl9ncigibG9hZCIgKyBjLCAibmV3IFNrLmJ1aWx0aW5zWyciLCBjLCAiJ10oWyIsIGQsICJdKSIpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNkaWN0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgdmFyIGMgPSBbXQogICAgICAgIGlmIChudWxsICE9PSBhLmtleXMpCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhLnZhbHVlcy5sZW5ndGggPT09IGEua2V5cy5sZW5ndGgpLCBiID0gMDsKICAgICAgICAgICAgYiA8IGEudmFsdWVzLmxlbmd0aDsKICAgICAgICAgICAgKytiCiAgICAgICAgICApIHsKICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnZleHByKGEudmFsdWVzW2JdKQogICAgICAgICAgICBjLnB1c2godGhpcy52ZXhwcihhLmtleXNbYl0pKQogICAgICAgICAgICBjLnB1c2goZCkKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fZ3IoImxvYWRkaWN0IiwgIm5ldyBTay5idWlsdGluc1snZGljdCddKFsiLCBjLCAiXSkiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNsaXN0Y29tcCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuTGlzdENvbXApCiAgICAgICAgdmFyIGIgPSB0aGlzLl9ncigiX2NvbXByIiwgIm5ldyBTay5idWlsdGluc1snbGlzdCddKFtdKSIpCiAgICAgICAgcmV0dXJuIHRoaXMuY2NvbXBnZW4oImxpc3QiLCBiLCBhLmdlbmVyYXRvcnMsIDAsIGEuZWx0LCBudWxsLCBhKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNkaWN0Y29tcCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuRGljdENvbXApCiAgICAgICAgdmFyIGIgPSB0aGlzLl9ncigiX2Rjb21wciIsICJuZXcgU2suYnVpbHRpbnMuZGljdChbXSkiKQogICAgICAgIHJldHVybiB0aGlzLmNjb21wZ2VuKCJkaWN0IiwgYiwgYS5nZW5lcmF0b3JzLCAwLCBhLnZhbHVlLCBhLmtleSwgYSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jc2V0Y29tcCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuU2V0Q29tcCkKICAgICAgICB2YXIgYiA9IHRoaXMuX2dyKCJfc2V0Y29tcHIiLCAibmV3IFNrLmJ1aWx0aW5zLnNldChbXSkiKQogICAgICAgIHJldHVybiB0aGlzLmNjb21wZ2VuKCJzZXQiLCBiLCBhLmdlbmVyYXRvcnMsIDAsIGEuZWx0LCBudWxsLCBhKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNjb21wZ2VuID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZywgaCkgewogICAgICAgIHZhciBrID0gdGhpcy5uZXdCbG9jayhhICsgIiBjb21wIHN0YXJ0IiksCiAgICAgICAgICBsID0gdGhpcy5uZXdCbG9jayhhICsgIiBjb21wIHNraXAiKSwKICAgICAgICAgIG4gPSB0aGlzLm5ld0Jsb2NrKGEgKyAiIGNvbXAgYW5jaG9yIiksCiAgICAgICAgICByID0gY1tkXSwKICAgICAgICAgIHEgPSB0aGlzLnZleHByKHIuaXRlcikKICAgICAgICBxID0gdGhpcy5fZ3IoIml0ZXIiLCAiU2suYWJzdHIuaXRlcigiLCBxLCAiKSIpCiAgICAgICAgdmFyIG0KICAgICAgICB0aGlzLl9qdW1wKGspCiAgICAgICAgdGhpcy5zZXRCbG9jayhrKQogICAgICAgIGYoIiRyZXQgPSBTay5hYnN0ci5pdGVybmV4dCgiLCBxLCAiLCB0cnVlKTsiKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihoKQogICAgICAgIHEgPSB0aGlzLl9ncigibmV4dCIsICIkcmV0IikKICAgICAgICB0aGlzLl9qdW1wdW5kZWYocSwgbikKICAgICAgICB0aGlzLnZleHByKHIudGFyZ2V0LCBxKQogICAgICAgIHZhciBwID0gci5pZnMgPyByLmlmcy5sZW5ndGggOiAwCiAgICAgICAgZm9yIChtID0gMDsgbSA8IHA7ICsrbSkKICAgICAgICAgIChxID0gdGhpcy52ZXhwcihyLmlmc1ttXSkpLCB0aGlzLl9qdW1wZmFsc2UocSwgaykKICAgICAgICArK2QgPCBjLmxlbmd0aCAmJiB0aGlzLmNjb21wZ2VuKGEsIGIsIGMsIGQsIGUsIGcsIGgpCiAgICAgICAgZCA+PSBjLmxlbmd0aCAmJgogICAgICAgICAgKChjID0gdGhpcy52ZXhwcihlKSksCiAgICAgICAgICAiZGljdCIgPT09IGEKICAgICAgICAgICAgPyAoKGEgPSB0aGlzLnZleHByKGcpKSwgZihiLCAiLm1wJGFzc19zdWJzY3JpcHQoIiwgYSwgIiwiLCBjLCAiKTsiKSkKICAgICAgICAgICAgOiAibGlzdCIgPT09IGEKICAgICAgICAgICAgPyBmKGIsICIudi5wdXNoKCIsIGMsICIpOyIpCiAgICAgICAgICAgIDogInNldCIgPT09IGEgJiYgZihiLCAiLnYubXAkYXNzX3N1YnNjcmlwdCgiLCBjLCAiLCB0cnVlKTsiKSwKICAgICAgICAgIHRoaXMuX2p1bXAobCksCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGwpKQogICAgICAgIHRoaXMuX2p1bXAoaykKICAgICAgICB0aGlzLnNldEJsb2NrKG4pCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jeWllbGQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKHRoaXMudS5zdGUuYmxvY2tUeXBlICE9PSBTay5TWU1UQUJfQ09OU1RTLkZ1bmN0aW9uQmxvY2spCiAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIid5aWVsZCcgb3V0c2lkZSBmdW5jdGlvbiIpCiAgICAgICAgdmFyIGIgPSAibnVsbCIKICAgICAgICBhLnZhbHVlICYmIChiID0gdGhpcy52ZXhwcihhLnZhbHVlKSkKICAgICAgICBhID0gdGhpcy5uZXdCbG9jaygiYWZ0ZXIgeWllbGQiKQogICAgICAgIGYoInJldHVybiBbLypyZXN1bWUqLyIsIGEsICIsLypyZXQqLyIsIGIsICJdOyIpCiAgICAgICAgdGhpcy5zZXRCbG9jayhhKQogICAgICAgIHJldHVybiAiJGdlbi5naSRzZW50dmFsdWUiCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2NvbXBhcmUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhLm9wcy5sZW5ndGggPT09IGEuY29tcGFyYXRvcnMubGVuZ3RoKQogICAgICAgIHZhciBjID0gdGhpcy52ZXhwcihhLmxlZnQpCiAgICAgICAgdmFyIGQgPSBhLm9wcy5sZW5ndGgKICAgICAgICB2YXIgZSA9IHRoaXMubmV3QmxvY2soImRvbmUiKQogICAgICAgIHZhciBrID0gdGhpcy5fZ3IoImNvbXBhcmVyZXMiLCAibnVsbCIpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgewogICAgICAgICAgdmFyIGcgPSB0aGlzLnZleHByKGEuY29tcGFyYXRvcnNbYl0pCiAgICAgICAgICBmKAogICAgICAgICAgICAiJHJldCA9IFNrLmJ1aWx0aW4uYm9vbChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woIiwKICAgICAgICAgICAgYywKICAgICAgICAgICAgIiwiLAogICAgICAgICAgICBnLAogICAgICAgICAgICAiLCciLAogICAgICAgICAgICBhLm9wc1tiXS5wcm90b3R5cGUuX2FzdG5hbWUsCiAgICAgICAgICAgICInLCB0cnVlKSk7IiwKICAgICAgICAgICkKICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgICAgZihrLCAiPSRyZXQ7IikKICAgICAgICAgIHRoaXMuX2p1bXBmYWxzZSgiJHJldCIsIGUpCiAgICAgICAgICBjID0gZwogICAgICAgIH0KICAgICAgICB0aGlzLl9qdW1wKGUpCiAgICAgICAgdGhpcy5zZXRCbG9jayhlKQogICAgICAgIHJldHVybiBrCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2NhbGwgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLnZleHByKGEuZnVuYykKICAgICAgICBsZXQgYyA9IHRoaXMuY3VucGFja3N0YXJzdG9hcnJheShhLmFyZ3MsICFTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgdmFyIGQgPSAidW5kZWZpbmVkIgogICAgICAgIGlmIChhLmtleXdvcmRzICYmIDAgPCBhLmtleXdvcmRzLmxlbmd0aCkgewogICAgICAgICAgbGV0IGMgPSAhMQogICAgICAgICAgZCA9IFtdCiAgICAgICAgICBmb3IgKGxldCBiIG9mIGEua2V5d29yZHMpIHsKICAgICAgICAgICAgaWYgKGMgJiYgIVNrLl9fZnV0dXJlX18ucHl0aG9uMykKICAgICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiQWR2YW5jZWQgdW5wYWNraW5nIG9mIGZ1bmN0aW9uIGFyZ3VtZW50cyBpcyBub3Qgc3VwcG9ydGVkIGluIFB5dGhvbiAyIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGIuYXJnCiAgICAgICAgICAgICAgPyAoZC5wdXNoKCInIiArIGIuYXJnLnYgKyAiJyIpLCBkLnB1c2godGhpcy52ZXhwcihiLnZhbHVlKSkpCiAgICAgICAgICAgICAgOiAoYyA9ICEwKQogICAgICAgICAgfQogICAgICAgICAgZCA9ICJbIiArIGQuam9pbigiLCIpICsgIl0iCiAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICBkID0gdGhpcy5fZ3IoImtleXdvcmRBcmdzIiwgZCkKICAgICAgICAgICAgZm9yIChsZXQgYyBvZiBhLmtleXdvcmRzKQogICAgICAgICAgICAgIGMuYXJnIHx8CiAgICAgICAgICAgICAgICAoZigKICAgICAgICAgICAgICAgICAgIiRyZXQgPSBTay5hYnN0ci5tYXBwaW5nVW5wYWNrSW50b0tleXdvcmRBcnJheSgiLAogICAgICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgICAgICAiLCIsCiAgICAgICAgICAgICAgICAgIHRoaXMudmV4cHIoYy52YWx1ZSksCiAgICAgICAgICAgICAgICAgICIsIiwKICAgICAgICAgICAgICAgICAgYiwKICAgICAgICAgICAgICAgICAgIik7IiwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oKSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgU2suX19mdXR1cmVfXy5zdXBlcl9hcmdzICYmCiAgICAgICAgICBhLmZ1bmMuaWQgJiYKICAgICAgICAgICJzdXBlciIgPT09IGEuZnVuYy5pZC52ICYmCiAgICAgICAgICAiW10iID09PSBjICYmCiAgICAgICAgICAoZigKICAgICAgICAgICAgJ2lmICh0eXBlb2Ygc2VsZiA9PT0gInVuZGVmaW5lZCIgfHwgc2VsZi50b1N0cmluZygpLmluZGV4T2YoIldpbmRvdyIpID4gMCkgeyB0aHJvdyBuZXcgU2suYnVpbHRpbi5SdW50aW1lRXJyb3IoInN1cGVyKCk6IG5vIGFyZ3VtZW50cyIpIH07JywKICAgICAgICAgICksCiAgICAgICAgICAoYyA9ICJbJGdibC5fX2NsYXNzX18sc2VsZl0iKSkKICAgICAgICAidW5kZWZpbmVkIiAhPT0gZAogICAgICAgICAgPyBmKAogICAgICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoIiwKICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgICIsdW5kZWZpbmVkLHVuZGVmaW5lZCwiLAogICAgICAgICAgICAgIGQsCiAgICAgICAgICAgICAgIiwiLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgIik7IiwKICAgICAgICAgICAgKQogICAgICAgICAgOiAiW10iICE9IGMKICAgICAgICAgID8gZigiJHJldCA9IFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSgiLCBiLCAiLCAiLCBjLCAiKTsiKQogICAgICAgICAgOiBmKCIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KCIsIGIsICIpOyIpCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgcmV0dXJuIHRoaXMuX2dyKCJjYWxsIiwgIiRyZXQiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNzbGljZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuU2xpY2UpCiAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18ucHl0aG9uMykgewogICAgICAgICAgdmFyIGIgPSBhLmxvd2VyID8gdGhpcy52ZXhwcihhLmxvd2VyKSA6ICJTay5idWlsdGluLm5vbmUubm9uZSQiCiAgICAgICAgICB2YXIgYyA9IGEudXBwZXIgPyB0aGlzLnZleHByKGEudXBwZXIpIDogIlNrLmJ1aWx0aW4ubm9uZS5ub25lJCIKICAgICAgICB9IGVsc2UKICAgICAgICAgIChiID0gYS5sb3dlcgogICAgICAgICAgICA/IHRoaXMudmV4cHIoYS5sb3dlcikKICAgICAgICAgICAgOiBhLnN0ZXAKICAgICAgICAgICAgPyAiU2suYnVpbHRpbi5ub25lLm5vbmUkIgogICAgICAgICAgICA6ICJuZXcgU2suYnVpbHRpbi5pbnRfKDApIiksCiAgICAgICAgICAgIChjID0gYS51cHBlcgogICAgICAgICAgICAgID8gdGhpcy52ZXhwcihhLnVwcGVyKQogICAgICAgICAgICAgIDogYS5zdGVwCiAgICAgICAgICAgICAgPyAiU2suYnVpbHRpbi5ub25lLm5vbmUkIgogICAgICAgICAgICAgIDogIm5ldyBTay5idWlsdGluLmludF8oMjE0NzQ4MzY0NykiKQogICAgICAgIGEgPSBhLnN0ZXAgPyB0aGlzLnZleHByKGEuc3RlcCkgOiAiU2suYnVpbHRpbi5ub25lLm5vbmUkIgogICAgICAgIHJldHVybiB0aGlzLl9ncigKICAgICAgICAgICJzbGljZSIsCiAgICAgICAgICAibmV3IFNrLmJ1aWx0aW5zWydzbGljZSddKCIsCiAgICAgICAgICBiLAogICAgICAgICAgIiwiLAogICAgICAgICAgYywKICAgICAgICAgICIsIiwKICAgICAgICAgIGEsCiAgICAgICAgICAiKSIsCiAgICAgICAgKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmVzbGljZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIGMucHVzaCh0aGlzLnZzbGljZXN1YihhW2JdKSkKICAgICAgICByZXR1cm4gdGhpcy5fZ3IoImV4dHNsaWNlIiwgIm5ldyBTay5idWlsdGluc1sndHVwbGUnXShbIiwgYywgIl0pIikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS52c2xpY2VzdWIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgc3dpdGNoIChhLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkluZGV4OgogICAgICAgICAgICB2YXIgYiA9IHRoaXMudmV4cHIoYS52YWx1ZSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2xpY2U6CiAgICAgICAgICAgIGIgPSB0aGlzLmNzbGljZShhKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5FbGxpcHNpczoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ0b2RvIGNvbXBpbGUuanMgRWxsaXBzaXM7IikKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRXh0U2xpY2U6CiAgICAgICAgICAgIGIgPSB0aGlzLmVzbGljZShhLmRpbXMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoImludmFsaWQgc3Vic2NyaXB0IGtpbmQiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnZzbGljZSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICBhID0gdGhpcy52c2xpY2VzdWIoYSkKICAgICAgICByZXR1cm4gdGhpcy5jaGFuZGxlc3Vic2NyKGIsIGMsIGEsIGQpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2hhbmRsZXN1YnNjciA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICBpZiAoYSA9PT0gU2suYXN0bm9kZXMuTG9hZCB8fCBhID09PSBTay5hc3Rub2Rlcy5BdWdMb2FkKQogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLm9iamVjdEdldEl0ZW0oIiwgYiwgIiwiLCBjLCAiLCB0cnVlKTsiKSwKICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKCksCiAgICAgICAgICAgIHRoaXMuX2dyKCJsc3Vic2NyIiwgIiRyZXQiKQogICAgICAgICAgKQogICAgICAgIGEgPT09IFNrLmFzdG5vZGVzLlN0b3JlIHx8IGEgPT09IFNrLmFzdG5vZGVzLkF1Z1N0b3JlCiAgICAgICAgICA/IChmKCIkcmV0ID0gU2suYWJzdHIub2JqZWN0U2V0SXRlbSgiLCBiLCAiLCIsIGMsICIsIiwgZCwgIiwgdHJ1ZSk7IiksCiAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbigpKQogICAgICAgICAgOiBhID09PSBTay5hc3Rub2Rlcy5EZWwKICAgICAgICAgID8gZigiU2suYWJzdHIub2JqZWN0RGVsSXRlbSgiLCBiLCAiLCIsIGMsICIpOyIpCiAgICAgICAgICA6IFNrLmFzc2VydHMuZmFpbCgiaGFuZGxlc3Vic2NyIGZhaWwiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNib29sb3AgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsIGMKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuQm9vbE9wKQogICAgICAgIHZhciBkID0gYS5vcCA9PT0gU2suYXN0bm9kZXMuQW5kID8gdGhpcy5fanVtcGZhbHNlIDogdGhpcy5fanVtcHRydWUKICAgICAgICB2YXIgZSA9IHRoaXMubmV3QmxvY2soImVuZCBvZiBib29sb3AiKQogICAgICAgIHZhciBrID0gYS52YWx1ZXMKICAgICAgICB2YXIgZyA9IGsubGVuZ3RoCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGc7ICsrYikKICAgICAgICAgIChhID0gdGhpcy52ZXhwcihrW2JdKSksCiAgICAgICAgICAgIDAgPT09IGIgJiYgKGMgPSB0aGlzLl9ncigiYm9vbG9wc3VjYyIsIGEpKSwKICAgICAgICAgICAgZihjLCAiPSIsIGEsICI7IiksCiAgICAgICAgICAgIGQuY2FsbCh0aGlzLCBhLCBlKQogICAgICAgIHRoaXMuX2p1bXAoZSkKICAgICAgICB0aGlzLnNldEJsb2NrKGUpCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBhLnByb3RvdHlwZS52ZXhwciA9IGZ1bmN0aW9uKGEsIGIsIGcsIGgpIHsKICAgICAgICB2YXIgawogICAgICAgIGEubGluZW5vID4gdGhpcy51LmxpbmVubyAmJgogICAgICAgICAgKCh0aGlzLnUubGluZW5vID0gYS5saW5lbm8pLCAodGhpcy51LmxpbmVub1NldCA9ICExKSkKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQm9vbE9wOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jYm9vbG9wKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkJpbk9wOgogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgImJpbm9wIiwKICAgICAgICAgICAgICAiU2suYWJzdHIubnVtYmVyQmluT3AoIiwKICAgICAgICAgICAgICB0aGlzLnZleHByKGEubGVmdCksCiAgICAgICAgICAgICAgIiwiLAogICAgICAgICAgICAgIHRoaXMudmV4cHIoYS5yaWdodCksCiAgICAgICAgICAgICAgIiwnIiwKICAgICAgICAgICAgICBhLm9wLnByb3RvdHlwZS5fYXN0bmFtZSwKICAgICAgICAgICAgICAiJykiLAogICAgICAgICAgICApCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlVuYXJ5T3A6CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncigKICAgICAgICAgICAgICAidW5hcnlvcCIsCiAgICAgICAgICAgICAgIlNrLmFic3RyLm51bWJlclVuYXJ5T3AoIiwKICAgICAgICAgICAgICB0aGlzLnZleHByKGEub3BlcmFuZCksCiAgICAgICAgICAgICAgIiwnIiwKICAgICAgICAgICAgICBhLm9wLnByb3RvdHlwZS5fYXN0bmFtZSwKICAgICAgICAgICAgICAiJykiLAogICAgICAgICAgICApCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxhbWJkYToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xhbWJkYShhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JZkV4cDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2lmZXhwKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRpY3Q6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNkaWN0KGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxpc3RDb21wOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGlzdGNvbXAoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGljdENvbXA6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNkaWN0Y29tcChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TZXRDb21wOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jc2V0Y29tcChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5HZW5lcmF0b3JFeHA6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNnZW5leHAoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuWWllbGQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN5aWVsZChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Db21wYXJlOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jY29tcGFyZShhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5DYWxsOgogICAgICAgICAgICByZXR1cm4gKGIgPSB0aGlzLmNjYWxsKGEpKSwgdGhpcy5hbm5vdGF0ZVNvdXJjZShhKSwgYgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OdW06CiAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEubikgcmV0dXJuIGEubgogICAgICAgICAgICBpZiAoYS5uIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLm1ha2VDb25zdGFudCgibmV3IFNrLmJ1aWx0aW4uaW50XygiICsgYS5uLnYgKyAiKSIpCiAgICAgICAgICAgIGlmIChhLm4gaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKGEgPSAwID09PSBhLm4udiAmJiAtSW5maW5pdHkgPT09IDEgLyBhLm4udiA/ICItMCIgOiBhLm4udiksCiAgICAgICAgICAgICAgICB0aGlzLm1ha2VDb25zdGFudCgibmV3IFNrLmJ1aWx0aW4uZmxvYXRfKCIgKyBhICsgIikiKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgKGEubiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLm1ha2VDb25zdGFudCgKICAgICAgICAgICAgICAgICJTay5sb25nRnJvbVN0cignIiArIGEubi50cCRzdHIoKS52ICsgIicpIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGlmIChhLm4gaW5zdGFuY2VvZiBTay5idWlsdGluLmNvbXBsZXgpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFrZUNvbnN0YW50KAogICAgICAgICAgICAgICAgIm5ldyBTay5idWlsdGluLmNvbXBsZXgobmV3IFNrLmJ1aWx0aW4uZmxvYXRfKCIgKwogICAgICAgICAgICAgICAgICAoMCA9PT0gYS5uLnJlYWwudiAmJiAtSW5maW5pdHkgPT09IDEgLyBhLm4ucmVhbC52CiAgICAgICAgICAgICAgICAgICAgPyAiLTAiCiAgICAgICAgICAgICAgICAgICAgOiBhLm4ucmVhbC52KSArCiAgICAgICAgICAgICAgICAgICIpLCBuZXcgU2suYnVpbHRpbi5mbG9hdF8oIiArCiAgICAgICAgICAgICAgICAgICgwID09PSBhLm4uaW1hZy52ICYmIC1JbmZpbml0eSA9PT0gMSAvIGEubi5pbWFnLnYKICAgICAgICAgICAgICAgICAgICA/ICItMCIKICAgICAgICAgICAgICAgICAgICA6IGEubi5pbWFnLnYpICsKICAgICAgICAgICAgICAgICAgIikpIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIE51bSB0eXBlIikKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3RyOgogICAgICAgICAgICByZXR1cm4gdGhpcy5tYWtlQ29uc3RhbnQoIm5ldyBTay5idWlsdGluLnN0cigiLCBhLnMuJHIoKS52LCAiKSIpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZToKICAgICAgICAgICAgYS5jdHggIT09IFNrLmFzdG5vZGVzLkF1Z0xvYWQgJiYKICAgICAgICAgICAgICBhLmN0eCAhPT0gU2suYXN0bm9kZXMuQXVnU3RvcmUgJiYKICAgICAgICAgICAgICAoayA9IHRoaXMudmV4cHIoYS52YWx1ZSkpCiAgICAgICAgICAgIGggPSBhLmF0dHIuJHIoKS52CiAgICAgICAgICAgIGggPSBoLnN1YnN0cmluZygxLCBoLmxlbmd0aCAtIDEpCiAgICAgICAgICAgIGggPSBlKHRoaXMudS5wcml2YXRlXywgbmV3IFNrLmJ1aWx0aW4uc3RyKGgpKS52CiAgICAgICAgICAgIGggPSBjKGgpCiAgICAgICAgICAgIGggPSBkKGgpCiAgICAgICAgICAgIGggPSB0aGlzLm1ha2VDb25zdGFudCgibmV3IFNrLmJ1aWx0aW4uc3RyKCciICsgaCArICInKSIpCiAgICAgICAgICAgIHN3aXRjaCAoYS5jdHgpIHsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF1Z0xvYWQ6CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBmKCIkcmV0ID0gU2suYWJzdHIuZ2F0dHIoIiwgZywgIiwiLCBoLCAiLCB0cnVlKTsiKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpLAogICAgICAgICAgICAgICAgICB0aGlzLl9ncigibGF0dHIiLCAiJHJldCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Mb2FkOgogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLmdhdHRyKCIsIGssICIsIiwgaCwgIiwgdHJ1ZSk7IiksCiAgICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fZ3IoImxhdHRyIiwgIiRyZXQiKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXVnU3RvcmU6CiAgICAgICAgICAgICAgICBmKCIkcmV0ID0gdW5kZWZpbmVkOyIpCiAgICAgICAgICAgICAgICBmKCJpZigiLCBiLCAiIT09dW5kZWZpbmVkKXsiKQogICAgICAgICAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLnNhdHRyKCIsIGcsICIsIiwgaCwgIiwiLCBiLCAiLCB0cnVlKTsiKQogICAgICAgICAgICAgICAgZigifSIpCiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdG9yZToKICAgICAgICAgICAgICAgIGYoIiRyZXQgPSBTay5hYnN0ci5zYXR0cigiLCBrLCAiLCIsIGgsICIsIiwgYiwgIiwgdHJ1ZSk7IikKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRlbDoKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidG9kbyBEZWw7IikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgiaW52YWxpZCBhdHRyaWJ1dGUgZXhwcmVzc2lvbiIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3Vic2NyaXB0OgogICAgICAgICAgICBzd2l0Y2ggKGEuY3R4KSB7CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5BdWdMb2FkOgogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLm9iamVjdEdldEl0ZW0oIiwgZywgIiwiLCBoLCAiLCB0cnVlKTsiKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpLAogICAgICAgICAgICAgICAgICB0aGlzLl9ncigiZ2l0ZW0iLCAiJHJldCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Mb2FkOgogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3RvcmU6CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWw6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52c2xpY2UoYS5zbGljZSwgYS5jdHgsIHRoaXMudmV4cHIoYS52YWx1ZSksIGIpCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5BdWdTdG9yZToKICAgICAgICAgICAgICAgIGYoIiRyZXQ9dW5kZWZpbmVkOyIpCiAgICAgICAgICAgICAgICBmKCJpZigiLCBiLCAiIT09dW5kZWZpbmVkKXsiKQogICAgICAgICAgICAgICAgZigiJHJldD1Tay5hYnN0ci5vYmplY3RTZXRJdGVtKCIsIGcsICIsIiwgaCwgIiwiLCBiLCAiLCB0cnVlKSIpCiAgICAgICAgICAgICAgICBmKCJ9IikKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJpbnZhbGlkIHN1YnNjcmlwdCBleHByZXNzaW9uIikKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lOgogICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lb3AoYS5pZCwgYS5jdHgsIGIpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudDoKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGEuY3R4ID09PSBTay5hc3Rub2Rlcy5TdG9yZSB8fAogICAgICAgICAgICAgIGEuY3R4ID09PSBTay5hc3Rub2Rlcy5BdWdTdG9yZSB8fAogICAgICAgICAgICAgIGEuY3R4ID09PSBTay5hc3Rub2Rlcy5EZWwKICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgImNhbiBub3QgYXNzaWduIHRvIGEgY29uc3RhbnQgbmFtZSIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBzd2l0Y2ggKGEudmFsdWUpIHsKICAgICAgICAgICAgICBjYXNlIFNrLmJ1aWx0aW4ubm9uZS5ub25lJDoKICAgICAgICAgICAgICAgIHJldHVybiAiU2suYnVpbHRpbi5ub25lLm5vbmUkIgogICAgICAgICAgICAgIGNhc2UgU2suYnVpbHRpbi5ib29sLnRydWUkOgogICAgICAgICAgICAgICAgcmV0dXJuICJTay5idWlsdGluLmJvb2wudHJ1ZSQiCiAgICAgICAgICAgICAgY2FzZSBTay5idWlsdGluLmJvb2wuZmFsc2UkOgogICAgICAgICAgICAgICAgcmV0dXJuICJTay5idWlsdGluLmJvb2wuZmFsc2UkIgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoImludmFsaWQgbmFtZWQgY29uc3RhbnQiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxpc3Q6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN0dXBsZWxpc3RvcnNldChhLCBiLCAibGlzdCIpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlR1cGxlOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jdHVwbGVsaXN0b3JzZXQoYSwgYiwgInR1cGxlIikKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2V0OgogICAgICAgICAgICByZXR1cm4gdGhpcy5jdHVwbGVsaXN0b3JzZXQoYSwgYiwgInNldCIpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0YXJyZWQ6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBjYXNlICIgKyBhLmNvbnN0cnVjdG9yLm5hbWUgKyAiIHZleHByIikKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUudnNlcWV4cHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgPT09IGIgfHwgYS5sZW5ndGggPT09IGIubGVuZ3RoKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykKICAgICAgICAgIGQucHVzaCh0aGlzLnZleHByKGFbY10sIHZvaWQgMCA9PT0gYiA/IHZvaWQgMCA6IGJbY10pKQogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2F1Z2Fzc2lnbiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuQXVnQXNzaWduKQogICAgICAgIHZhciBiID0gYS50YXJnZXQKICAgICAgICBzd2l0Y2ggKGIuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXR0cmlidXRlOgogICAgICAgICAgICB2YXIgYyA9IHRoaXMudmV4cHIoYi52YWx1ZSkKICAgICAgICAgICAgYiA9IG5ldyBTay5hc3Rub2Rlcy5BdHRyaWJ1dGUoCiAgICAgICAgICAgICAgYi52YWx1ZSwKICAgICAgICAgICAgICBiLmF0dHIsCiAgICAgICAgICAgICAgU2suYXN0bm9kZXMuQXVnTG9hZCwKICAgICAgICAgICAgICBiLmxpbmVubywKICAgICAgICAgICAgICBiLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnZleHByKGIsIHZvaWQgMCwgYykKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnZleHByKGEudmFsdWUpCiAgICAgICAgICAgIGEgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAiaW5wbGJpbm9wYXR0ciIsCiAgICAgICAgICAgICAgIlNrLmFic3RyLm51bWJlcklucGxhY2VCaW5PcCgiLAogICAgICAgICAgICAgIGQsCiAgICAgICAgICAgICAgIiwiLAogICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgIiwnIiwKICAgICAgICAgICAgICBhLm9wLnByb3RvdHlwZS5fYXN0bmFtZSwKICAgICAgICAgICAgICAiJykiLAogICAgICAgICAgICApCiAgICAgICAgICAgIGIuY3R4ID0gU2suYXN0bm9kZXMuQXVnU3RvcmUKICAgICAgICAgICAgcmV0dXJuIHRoaXMudmV4cHIoYiwgYSwgYykKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3Vic2NyaXB0OgogICAgICAgICAgICBjID0gdGhpcy52ZXhwcihiLnZhbHVlKQogICAgICAgICAgICB2YXIgayA9IHRoaXMudnNsaWNlc3ViKGIuc2xpY2UpCiAgICAgICAgICAgIGIgPSBuZXcgU2suYXN0bm9kZXMuU3Vic2NyaXB0KAogICAgICAgICAgICAgIGIudmFsdWUsCiAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5BdWdMb2FkLAogICAgICAgICAgICAgIGIubGluZW5vLAogICAgICAgICAgICAgIGIuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgICBkID0gdGhpcy52ZXhwcihiLCB2b2lkIDAsIGMsIGspCiAgICAgICAgICAgIGUgPSB0aGlzLnZleHByKGEudmFsdWUpCiAgICAgICAgICAgIGEgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAiaW5wbGJpbm9wc3Vic2NyIiwKICAgICAgICAgICAgICAiU2suYWJzdHIubnVtYmVySW5wbGFjZUJpbk9wKCIsCiAgICAgICAgICAgICAgZCwKICAgICAgICAgICAgICAiLCIsCiAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICAiLCciLAogICAgICAgICAgICAgIGEub3AucHJvdG90eXBlLl9hc3RuYW1lLAogICAgICAgICAgICAgICInKSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgYi5jdHggPSBTay5hc3Rub2Rlcy5BdWdTdG9yZQogICAgICAgICAgICByZXR1cm4gdGhpcy52ZXhwcihiLCBhLCBjLCBrKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lOgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIChjID0gdGhpcy5uYW1lb3AoYi5pZCwgU2suYXN0bm9kZXMuTG9hZCkpLAogICAgICAgICAgICAgIChlID0gdGhpcy52ZXhwcihhLnZhbHVlKSksCiAgICAgICAgICAgICAgKGEgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAgICJpbnBsYmlub3AiLAogICAgICAgICAgICAgICAgIlNrLmFic3RyLm51bWJlcklucGxhY2VCaW5PcCgiLAogICAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICAgICIsIiwKICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAiLCciLAogICAgICAgICAgICAgICAgYS5vcC5wcm90b3R5cGUuX2FzdG5hbWUsCiAgICAgICAgICAgICAgICAiJykiLAogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIHRoaXMubmFtZW9wKGIuaWQsIFNrLmFzdG5vZGVzLlN0b3JlLCBhKQogICAgICAgICAgICApCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBjYXNlIGluIGF1Z2Fzc2lnbiIpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmV4cHJDb25zdGFudCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTnVtOgogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuaXNUcnVlKGEubikgPyAxIDogMAogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdHI6CiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoYS5zKSA/IDEgOiAwCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUubmV3QmxvY2sgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLnUuYmxvY2tudW0rKwogICAgICAgIHRoaXMudS5ibG9ja3NbYl0gPSBbXQogICAgICAgIHRoaXMudS5ibG9ja3NbYl0uX25hbWUgPSBhIHx8ICI8dW5uYW1lZD4iCiAgICAgICAgdGhpcy51LmJsb2Nrc1tiXS5fbmV4dCA9IG51bGwKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnNldEJsb2NrID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPD0gYSAmJiBhIDwgdGhpcy51LmJsb2NrbnVtKQogICAgICAgIHRoaXMudS5jdXJibG9jayA9IGEKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wdXNoQnJlYWtCbG9jayA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGEgJiYgYSA8IHRoaXMudS5ibG9ja251bSkKICAgICAgICB0aGlzLnUuYnJlYWtCbG9ja3MucHVzaChhKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnBvcEJyZWFrQmxvY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnUuYnJlYWtCbG9ja3MucG9wKCkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wdXNoQ29udGludWVCbG9jayA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGEgJiYgYSA8IHRoaXMudS5ibG9ja251bSkKICAgICAgICB0aGlzLnUuY29udGludWVCbG9ja3MucHVzaChhKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnBvcENvbnRpbnVlQmxvY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnUuY29udGludWVCbG9ja3MucG9wKCkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wdXNoRXhjZXB0QmxvY2sgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8PSBhICYmIGEgPCB0aGlzLnUuYmxvY2tudW0pCiAgICAgICAgdGhpcy51LmV4Y2VwdEJsb2Nrcy5wdXNoKGEpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucG9wRXhjZXB0QmxvY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnUuZXhjZXB0QmxvY2tzLnBvcCgpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucHVzaEZpbmFsbHlCbG9jayA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGEgJiYgYSA8IHRoaXMudS5ibG9ja251bSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgIHRoaXMudS5icmVha0Jsb2Nrcy5sZW5ndGggPT09IHRoaXMudS5jb250aW51ZUJsb2Nrcy5sZW5ndGgsCiAgICAgICAgKQogICAgICAgIHRoaXMudS5maW5hbGx5QmxvY2tzLnB1c2goewogICAgICAgICAgYmxrOiBhLAogICAgICAgICAgYnJlYWtEZXB0aDogdGhpcy51LmJyZWFrQmxvY2tzLmxlbmd0aCwKICAgICAgICB9KQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnBvcEZpbmFsbHlCbG9jayA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMudS5maW5hbGx5QmxvY2tzLnBvcCgpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucGVla0ZpbmFsbHlCbG9jayA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy51LmZpbmFsbHlCbG9ja3MubGVuZ3RoCiAgICAgICAgICA/IHRoaXMudS5maW5hbGx5QmxvY2tzW3RoaXMudS5maW5hbGx5QmxvY2tzLmxlbmd0aCAtIDFdCiAgICAgICAgICA6IHZvaWQgMAogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnNldHVwRXhjZXB0ID0gZnVuY3Rpb24oYSkgewogICAgICAgIGYoIiRleGMucHVzaCgiLCBhLCAiKTsiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmVuZEV4Y2VwdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGYoIiRleGMucG9wKCk7IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5vdXRwdXRMb2NhbHMgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0ge30KICAgICAgICBmb3IgKGIgPSAwOyBhLmFyZ25hbWVzICYmIGIgPCBhLmFyZ25hbWVzLmxlbmd0aDsgKytiKQogICAgICAgICAgY1thLmFyZ25hbWVzW2JdXSA9ICEwCiAgICAgICAgYS5sb2NhbG5hbWVzLnNvcnQoKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5sb2NhbG5hbWVzLmxlbmd0aDsgKytiKSB7CiAgICAgICAgICB2YXIgZSA9IGEubG9jYWxuYW1lc1tiXQogICAgICAgICAgdm9pZCAwID09PSBjW2VdICYmIChkLnB1c2goZSksIChjW2VdID0gITApKQogICAgICAgIH0KICAgICAgICByZXR1cm4gMCA8IGQubGVuZ3RoID8gInZhciAiICsgZC5qb2luKCIsIikgKyAiOyAvKiBsb2NhbHMgKi8iIDogIiIKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5vdXRwdXRTdXNwZW5zaW9uSGVscGVycyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGMgPSBbXSwKICAgICAgICAgIGQgPSBhLmxvY2FsbmFtZXMuY29uY2F0KGEudGVtcHNUb1NhdmUpLAogICAgICAgICAgZSA9IHt9LAogICAgICAgICAgZiA9CiAgICAgICAgICAgIGEuc3RlLmJsb2NrVHlwZSA9PT0gU2suU1lNVEFCX0NPTlNUUy5GdW5jdGlvbkJsb2NrICYmCiAgICAgICAgICAgIGEuc3RlLmNoaWxkSGFzRnJlZSwKICAgICAgICAgIGsgPQogICAgICAgICAgICAoMCA8IGQubGVuZ3RoID8gInZhciAiICsgZC5qb2luKCIsIikgKyAiOyIgOiAiIikgKwogICAgICAgICAgICAidmFyICR3YWtlRnJvbVN1c3BlbnNpb24gPSBmdW5jdGlvbigpIHt2YXIgc3VzcCA9ICIgKwogICAgICAgICAgICBhLnNjb3BlbmFtZSArCiAgICAgICAgICAgICIuJHdha2luZ1N1c3BlbnNpb247ICIgKwogICAgICAgICAgICBhLnNjb3BlbmFtZSArCiAgICAgICAgICAgICIuJHdha2luZ1N1c3BlbnNpb24gPSB1bmRlZmluZWQ7JGJsaz1zdXNwLiRibGs7ICRsb2M9c3VzcC4kbG9jOyAkZ2JsPXN1c3AuJGdibDsgJGV4Yz1zdXNwLiRleGM7ICRlcnI9c3VzcC4kZXJyOyAkcG9zdGZpbmFsbHk9c3VzcC4kcG9zdGZpbmFsbHk7JGN1cnJMaW5lTm89c3VzcC4kbGluZW5vOyAkY3VyckNvbE5vPXN1c3AuJGNvbG5vOyBTay5sYXN0WWllbGQ9RGF0ZS5ub3coKTsiICsKICAgICAgICAgICAgKGYgPyAiJGNlbGw9c3VzcC4kY2VsbDsiIDogIiIpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQubGVuZ3RoOyBiKyspIHsKICAgICAgICAgIHZhciBnID0gZFtiXQogICAgICAgICAgdm9pZCAwID09PSBlW2ddICYmICgoayArPSBnICsgIj1zdXNwLiR0bXBzLiIgKyBnICsgIjsiKSwgKGVbZ10gPSAhMCkpCiAgICAgICAgfQogICAgICAgIGsgKz0KICAgICAgICAgICJ0cnkgeyAkcmV0PXN1c3AuY2hpbGQucmVzdW1lKCk7IH0gY2F0Y2goZXJyKSB7IGlmICghKGVyciBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbikpIHsgZXJyID0gbmV3IFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcihlcnIpOyB9IGVyci50cmFjZWJhY2sucHVzaCh7bGluZW5vOiAkY3VyckxpbmVObywgY29sbm86ICRjdXJyQ29sTm8sIGZpbGVuYW1lOiAnIiArCiAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICInfSk7IGlmKCRleGMubGVuZ3RoPjApIHsgJGVycj1lcnI7ICRibGs9JGV4Yy5wb3AoKTsgfSBlbHNlIHsgdGhyb3cgZXJyOyB9IH19OyIKICAgICAgICBrICs9CiAgICAgICAgICAidmFyICRzYXZlU3VzcGVuc2lvbiA9IGZ1bmN0aW9uKCRjaGlsZCwgJGZpbGVuYW1lLCAkbGluZW5vLCAkY29sbm8pIHt2YXIgc3VzcCA9IG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKCk7IHN1c3AuY2hpbGQ9JGNoaWxkO3N1c3AucmVzdW1lPWZ1bmN0aW9uKCl7IiArCiAgICAgICAgICBhLnNjb3BlbmFtZSArCiAgICAgICAgICAiLiR3YWtpbmdTdXNwZW5zaW9uPXN1c3A7IHJldHVybiAiICsKICAgICAgICAgIGEuc2NvcGVuYW1lICsKICAgICAgICAgICIoIiArCiAgICAgICAgICAoYS5zdGUuZ2VuZXJhdG9yID8gIiRnZW4iIDogIiIpICsKICAgICAgICAgICIpOyB9O3N1c3AuZGF0YT1zdXNwLmNoaWxkLmRhdGE7c3VzcC4kYmxrPSRibGs7c3VzcC4kbG9jPSRsb2M7c3VzcC4kZ2JsPSRnYmw7c3VzcC4kZXhjPSRleGM7c3VzcC4kZXJyPSRlcnI7c3VzcC4kcG9zdGZpbmFsbHk9JHBvc3RmaW5hbGx5O3N1c3AuJGZpbGVuYW1lPSRmaWxlbmFtZTtzdXNwLiRsaW5lbm89JGxpbmVubztzdXNwLiRjb2xubz0kY29sbm87c3VzcC5vcHRpb25hbD1zdXNwLmNoaWxkLm9wdGlvbmFsOyIgKwogICAgICAgICAgKGYgPyAic3VzcC4kY2VsbD0kY2VsbDsiIDogIiIpCiAgICAgICAgZSA9IHt9CiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQubGVuZ3RoOyBiKyspCiAgICAgICAgICAoZyA9IGRbYl0pLAogICAgICAgICAgICB2b2lkIDAgPT09IGVbZ10gJiYgKGMucHVzaCgnIicgKyBnICsgJyI6JyArIGcpLCAoZVtnXSA9ICEwKSkKICAgICAgICByZXR1cm4gKGsgKz0gInN1c3AuJHRtcHM9eyIgKyBjLmpvaW4oIiwiKSArICJ9O3JldHVybiBzdXNwO307IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5vdXRwdXRBbGxVbml0cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiwKICAgICAgICAgIGMgPSAiIgogICAgICAgIGZvciAoYiA9IDA7IGIgPCB0aGlzLmFsbFVuaXRzLmxlbmd0aDsgKytiKSB7CiAgICAgICAgICB2YXIgZCA9IHRoaXMuYWxsVW5pdHNbYl0KICAgICAgICAgIGMgKz0gZC5wcmVmaXhDb2RlCiAgICAgICAgICBjICs9IHRoaXMub3V0cHV0TG9jYWxzKGQpCiAgICAgICAgICBkLmRvZXNTdXNwZW5kICYmIChjICs9IHRoaXMub3V0cHV0U3VzcGVuc2lvbkhlbHBlcnMoZCkpCiAgICAgICAgICBjICs9IGQudmFyRGVjbHNDb2RlCiAgICAgICAgICBjICs9IGQuc3dpdGNoQ29kZQogICAgICAgICAgdmFyIGUgPSBkLmJsb2NrcwogICAgICAgICAgdmFyIGYgPSBPYmplY3QuY3JlYXRlKG51bGwpCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgZS5sZW5ndGg7ICsrYSkgewogICAgICAgICAgICB2YXIgZyA9IGEKICAgICAgICAgICAgaWYgKCEoZyBpbiBmKSkKICAgICAgICAgICAgICBmb3IgKDs7KQogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAoKGZbZ10gPSAhMCksCiAgICAgICAgICAgICAgICAgIChjICs9ICJjYXNlICIgKyBnICsgIjogLyogLS0tICIgKyBlW2ddLl9uYW1lICsgIiAtLS0gKi8iKSwKICAgICAgICAgICAgICAgICAgKGMgKz0gZVtnXS5qb2luKCIiKSksCiAgICAgICAgICAgICAgICAgIG51bGwgIT09IGVbZ10uX25leHQpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIGlmIChlW2ddLl9uZXh0IGluIGYpIHsKICAgICAgICAgICAgICAgICAgICBjICs9ICIvKiBqdW1wICovIGNvbnRpbnVlOyIKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAoYyArPSAiLyogYWxsb3dpbmcgY2FzZSBmYWxsdGhyb3VnaCAqLyIpLCAoZyA9IGVbZ10uX25leHQpCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgYyArPQogICAgICAgICAgICAgICAgICAgICJ0aHJvdyBuZXcgU2suYnVpbHRpbi5TeXN0ZW1FcnJvcignaW50ZXJuYWwgZXJyb3I6IHVudGVybWluYXRlZCBibG9jaycpOyIKICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGMgKz0gZC5zdWZmaXhDb2RlCiAgICAgICAgfQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2lmID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLklmKQogICAgICAgIHZhciBjID0gdGhpcy5leHByQ29uc3RhbnQoYS50ZXN0KQogICAgICAgIGlmICgwID09PSBjKSBhLm9yZWxzZSAmJiAwIDwgYS5vcmVsc2UubGVuZ3RoICYmIHRoaXMudnNlcXN0bXQoYS5vcmVsc2UpCiAgICAgICAgZWxzZSBpZiAoMSA9PT0gYykgdGhpcy52c2Vxc3RtdChhLmJvZHkpCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgZCA9IHRoaXMubmV3QmxvY2soImVuZCBvZiBpZiIpCiAgICAgICAgICBhLm9yZWxzZSAmJgogICAgICAgICAgICAwIDwgYS5vcmVsc2UubGVuZ3RoICYmCiAgICAgICAgICAgIChiID0gdGhpcy5uZXdCbG9jaygibmV4dCBicmFuY2ggb2YgaWYiKSkKICAgICAgICAgIGMgPSB0aGlzLnZleHByKGEudGVzdCkKICAgICAgICAgIGEub3JlbHNlICYmIDAgPCBhLm9yZWxzZS5sZW5ndGgKICAgICAgICAgICAgPyAodGhpcy5fanVtcGZhbHNlKGMsIGIpLAogICAgICAgICAgICAgIHRoaXMudnNlcXN0bXQoYS5ib2R5KSwKICAgICAgICAgICAgICB0aGlzLl9qdW1wKGQpLAogICAgICAgICAgICAgIHRoaXMuc2V0QmxvY2soYiksCiAgICAgICAgICAgICAgdGhpcy52c2Vxc3RtdChhLm9yZWxzZSkpCiAgICAgICAgICAgIDogKHRoaXMuX2p1bXBmYWxzZShjLCBkKSwgdGhpcy52c2Vxc3RtdChhLmJvZHkpKQogICAgICAgICAgdGhpcy5fanVtcChkKQogICAgICAgICAgdGhpcy5zZXRCbG9jayhkKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jd2hpbGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKDAgPT09IHRoaXMuZXhwckNvbnN0YW50KGEudGVzdCkpIGEub3JlbHNlICYmIHRoaXMudnNlcXN0bXQoYS5vcmVsc2UpCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgYiA9IHRoaXMubmV3QmxvY2soIndoaWxlIHRlc3QiKQogICAgICAgICAgdGhpcy5fanVtcChiKQogICAgICAgICAgdGhpcy5zZXRCbG9jayhiKQogICAgICAgICAgdmFyIGMgPSB0aGlzLm5ld0Jsb2NrKCJhZnRlciB3aGlsZSIpCiAgICAgICAgICB2YXIgZCA9IDAgPCBhLm9yZWxzZS5sZW5ndGggPyB0aGlzLm5ld0Jsb2NrKCJ3aGlsZSBvcmVsc2UiKSA6IG51bGwKICAgICAgICAgIHZhciBlID0gdGhpcy5uZXdCbG9jaygid2hpbGUgYm9keSIpCiAgICAgICAgICB0aGlzLmFubm90YXRlU291cmNlKGEpCiAgICAgICAgICB0aGlzLl9qdW1wZmFsc2UodGhpcy52ZXhwcihhLnRlc3QpLCBkID8gZCA6IGMpCiAgICAgICAgICB0aGlzLl9qdW1wKGUpCiAgICAgICAgICB0aGlzLnB1c2hCcmVha0Jsb2NrKGMpCiAgICAgICAgICB0aGlzLnB1c2hDb250aW51ZUJsb2NrKGIpCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGUpCiAgICAgICAgICA7KFNrLmRlYnVnZ2luZyB8fCBTay5raWxsYWJsZVdoaWxlKSAmJgogICAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCAmJgogICAgICAgICAgICAoKGUgPSB0aGlzLm5ld0Jsb2NrKCJkZWJ1ZyBicmVha3BvaW50IGZvciBsaW5lICIgKyBhLmxpbmVubykpLAogICAgICAgICAgICBmKAogICAgICAgICAgICAgICJpZiAoU2suYnJlYWtwb2ludHMoJyIgKwogICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSArCiAgICAgICAgICAgICAgICAiJywiICsKICAgICAgICAgICAgICAgIGEubGluZW5vICsKICAgICAgICAgICAgICAgICIsIiArCiAgICAgICAgICAgICAgICBhLmNvbF9vZmZzZXQgKwogICAgICAgICAgICAgICAgIikpIHsiLAogICAgICAgICAgICAgICJ2YXIgJHN1c3AgPSAkc2F2ZVN1c3BlbnNpb24oe2RhdGE6IHt0eXBlOiAnU2suZGVsYXknfSwgcmVzdW1lOiBmdW5jdGlvbigpIHt9fSwgJyIgKwogICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSArCiAgICAgICAgICAgICAgICAiJywiICsKICAgICAgICAgICAgICAgIGEubGluZW5vICsKICAgICAgICAgICAgICAgICIsIiArCiAgICAgICAgICAgICAgICBhLmNvbF9vZmZzZXQgKwogICAgICAgICAgICAgICAgIik7IiwKICAgICAgICAgICAgICAiJHN1c3AuJGJsayA9ICIgKyBlICsgIjsiLAogICAgICAgICAgICAgICIkc3VzcC5vcHRpb25hbCA9IHRydWU7IiwKICAgICAgICAgICAgICAicmV0dXJuICRzdXNwOyIsCiAgICAgICAgICAgICAgIn0iLAogICAgICAgICAgICApLAogICAgICAgICAgICB0aGlzLl9qdW1wKGUpLAogICAgICAgICAgICB0aGlzLnNldEJsb2NrKGUpLAogICAgICAgICAgICAodGhpcy51LmRvZXNTdXNwZW5kID0gITApKQogICAgICAgICAgdGhpcy52c2Vxc3RtdChhLmJvZHkpCiAgICAgICAgICB0aGlzLl9qdW1wKGIpCiAgICAgICAgICB0aGlzLnBvcENvbnRpbnVlQmxvY2soKQogICAgICAgICAgdGhpcy5wb3BCcmVha0Jsb2NrKCkKICAgICAgICAgIDAgPCBhLm9yZWxzZS5sZW5ndGggJiYKICAgICAgICAgICAgKHRoaXMuc2V0QmxvY2soZCksIHRoaXMudnNlcXN0bXQoYS5vcmVsc2UpLCB0aGlzLl9qdW1wKGMpKQogICAgICAgICAgdGhpcy5zZXRCbG9jayhjKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jZm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uZXdCbG9jaygiZm9yIHN0YXJ0IiksCiAgICAgICAgICBjID0gdGhpcy5uZXdCbG9jaygiZm9yIGNsZWFudXAiKSwKICAgICAgICAgIGQgPSB0aGlzLm5ld0Jsb2NrKCJmb3IgZW5kIikKICAgICAgICB0aGlzLnB1c2hCcmVha0Jsb2NrKGQpCiAgICAgICAgdGhpcy5wdXNoQ29udGludWVCbG9jayhiKQogICAgICAgIHZhciBlID0gdGhpcy52ZXhwcihhLml0ZXIpCiAgICAgICAgaWYgKHRoaXMudS5zdGUuZ2VuZXJhdG9yKSB7CiAgICAgICAgICB2YXIgayA9ICIkbG9jLiIgKyB0aGlzLmdlbnN5bSgiaXRlciIpCiAgICAgICAgICBmKGssICI9U2suYWJzdHIuaXRlcigiLCBlLCAiKTsiKQogICAgICAgIH0gZWxzZQogICAgICAgICAgKGsgPSB0aGlzLl9ncigiaXRlciIsICJTay5hYnN0ci5pdGVyKCIsIGUsICIpIikpLAogICAgICAgICAgICB0aGlzLnUudGVtcHNUb1NhdmUucHVzaChrKQogICAgICAgIHRoaXMuX2p1bXAoYikKICAgICAgICB0aGlzLnNldEJsb2NrKGIpCiAgICAgICAgZigKICAgICAgICAgICIkcmV0ID0gU2suYWJzdHIuaXRlcm5leHQoIiwKICAgICAgICAgIGssCiAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCA/ICIsIHRydWUiIDogIiwgZmFsc2UiLAogICAgICAgICAgIik7IiwKICAgICAgICApCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgayA9IHRoaXMuX2dyKCJuZXh0IiwgIiRyZXQiKQogICAgICAgIHRoaXMuX2p1bXB1bmRlZihrLCBjKQogICAgICAgIHRoaXMudmV4cHIoYS50YXJnZXQsIGspCiAgICAgICAgOyhTay5kZWJ1Z2dpbmcgfHwgU2sua2lsbGFibGVGb3IpICYmCiAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCAmJgogICAgICAgICAgKChrID0gdGhpcy5uZXdCbG9jaygiZGVidWcgYnJlYWtwb2ludCBmb3IgbGluZSAiICsgYS5saW5lbm8pKSwKICAgICAgICAgIGYoCiAgICAgICAgICAgICJpZiAoU2suYnJlYWtwb2ludHMoJyIgKwogICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgICAgICInLCIgKwogICAgICAgICAgICAgIGEubGluZW5vICsKICAgICAgICAgICAgICAiLCIgKwogICAgICAgICAgICAgIGEuY29sX29mZnNldCArCiAgICAgICAgICAgICAgIikpIHsiLAogICAgICAgICAgICAidmFyICRzdXNwID0gJHNhdmVTdXNwZW5zaW9uKHtkYXRhOiB7dHlwZTogJ1NrLmRlbGF5J30sIHJlc3VtZTogZnVuY3Rpb24oKSB7fX0sICciICsKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAiJywiICsKICAgICAgICAgICAgICBhLmxpbmVubyArCiAgICAgICAgICAgICAgIiwiICsKICAgICAgICAgICAgICBhLmNvbF9vZmZzZXQgKwogICAgICAgICAgICAgICIpOyIsCiAgICAgICAgICAgICIkc3VzcC4kYmxrID0gIiArIGsgKyAiOyIsCiAgICAgICAgICAgICIkc3VzcC5vcHRpb25hbCA9IHRydWU7IiwKICAgICAgICAgICAgInJldHVybiAkc3VzcDsiLAogICAgICAgICAgICAifSIsCiAgICAgICAgICApLAogICAgICAgICAgdGhpcy5fanVtcChrKSwKICAgICAgICAgIHRoaXMuc2V0QmxvY2soayksCiAgICAgICAgICAodGhpcy51LmRvZXNTdXNwZW5kID0gITApKQogICAgICAgIHRoaXMudnNlcXN0bXQoYS5ib2R5KQogICAgICAgIHRoaXMuX2p1bXAoYikKICAgICAgICB0aGlzLnNldEJsb2NrKGMpCiAgICAgICAgdGhpcy5wb3BDb250aW51ZUJsb2NrKCkKICAgICAgICB0aGlzLnBvcEJyZWFrQmxvY2soKQogICAgICAgIHRoaXMudnNlcXN0bXQoYS5vcmVsc2UpCiAgICAgICAgdGhpcy5fanVtcChkKQogICAgICAgIHRoaXMuc2V0QmxvY2soZCkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jcmFpc2UgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgaWYgKGEuZXhjKSB7CiAgICAgICAgICB2YXIgYiA9IHRoaXMuX2dyKCJleGMiLCB0aGlzLnZleHByKGEuZXhjKSksCiAgICAgICAgICAgIGMgPSB0aGlzLm5ld0Jsb2NrKCJleGNlcHRpb24gbm93IGluc3RhbnRpYXRlZCIpLAogICAgICAgICAgICBkID0gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgImlzY2xhc3MiLAogICAgICAgICAgICAgIGIgKwogICAgICAgICAgICAgICAgIiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHlwZSB8fCAiICsKICAgICAgICAgICAgICAgIGIgKwogICAgICAgICAgICAgICAgIi5wcm90b3R5cGUgaW5zdGFuY2VvZiBTay5idWlsdGluLkJhc2VFeGNlcHRpb24iLAogICAgICAgICAgICApCiAgICAgICAgICB0aGlzLl9qdW1wZmFsc2UoZCwgYykKICAgICAgICAgIGEuaW5zdAogICAgICAgICAgICA/ICgoZCA9IHRoaXMuX2dyKCJpbnN0IiwgdGhpcy52ZXhwcihhLmluc3QpKSksCiAgICAgICAgICAgICAgZigKICAgICAgICAgICAgICAgICJpZighKCIsCiAgICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgICAgIiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGUpKSB7IiwKICAgICAgICAgICAgICAgIGQsCiAgICAgICAgICAgICAgICAiPSBuZXcgU2suYnVpbHRpbi50dXBsZShbIiwKICAgICAgICAgICAgICAgIGQsCiAgICAgICAgICAgICAgICAiXSk7IiwKICAgICAgICAgICAgICAgICJ9IiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIGYoIiRyZXQgPSBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoIiwgYiwgIiwiLCBkLCAiLnYpOyIpKQogICAgICAgICAgICA6IGYoIiRyZXQgPSBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kKCIsIGIsICIpOyIpCiAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSkKICAgICAgICAgIGYoYiwgIj0kcmV0OyIpCiAgICAgICAgICB0aGlzLl9qdW1wKGMpCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGMpCiAgICAgICAgICBmKCJ0aHJvdyAiLCBiLCAiOyIpCiAgICAgICAgfSBlbHNlIGYoInRocm93ICRlcnI7IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5vdXRwdXRGaW5hbGx5Q2FzY2FkZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBpZiAoMCA9PSB0aGlzLnUuZmluYWxseUJsb2Nrcy5sZW5ndGgpCiAgICAgICAgICBmKAogICAgICAgICAgICAiaWYoJHBvc3RmaW5hbGx5IT09dW5kZWZpbmVkKSB7IGlmICgkcG9zdGZpbmFsbHkucmV0dXJuaW5nKSB7IHJldHVybiAkcG9zdGZpbmFsbHkucmV0dXJuaW5nOyB9IGVsc2UgeyAkYmxrPSRwb3N0ZmluYWxseS5nb3RvQmxvY2s7ICRwb3N0ZmluYWxseT11bmRlZmluZWQ7IGNvbnRpbnVlOyB9IH0iLAogICAgICAgICAgKQogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIGIgPSB0aGlzLnBlZWtGaW5hbGx5QmxvY2soKQogICAgICAgICAgZigKICAgICAgICAgICAgImlmKCRwb3N0ZmluYWxseSE9PXVuZGVmaW5lZCkgeyIsCiAgICAgICAgICAgICJpZiAoJHBvc3RmaW5hbGx5LnJldHVybmluZyIsCiAgICAgICAgICAgIGIuYnJlYWtEZXB0aCA9PSBhLmJyZWFrRGVwdGggPyAifHwgJHBvc3RmaW5hbGx5LmlzQnJlYWsiIDogIiIsCiAgICAgICAgICAgICIpIHsiLAogICAgICAgICAgICAiJGJsaz0iLAogICAgICAgICAgICBiLmJsaywKICAgICAgICAgICAgIjtjb250aW51ZTsiLAogICAgICAgICAgICAifSBlbHNlIHsiLAogICAgICAgICAgICAiJGJsaz0kcG9zdGZpbmFsbHkuZ290b0Jsb2NrOyRwb3N0ZmluYWxseT11bmRlZmluZWQ7Y29udGludWU7IiwKICAgICAgICAgICAgIn0iLAogICAgICAgICAgICAifSIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmN0cnkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gYS5oYW5kbGVycy5sZW5ndGgKICAgICAgICBpZiAoYS5maW5hbGJvZHkpIHsKICAgICAgICAgIHZhciBkID0gdGhpcy5uZXdCbG9jaygiZmluYWxib2R5IikKICAgICAgICAgIHZhciBlID0gdGhpcy5uZXdCbG9jaygiZmluYWxleGgiKQogICAgICAgICAgdmFyIGsgPSB0aGlzLl9ncigiZmluYWxseV9yZXJhaXNlIiwgInVuZGVmaW5lZCIpCiAgICAgICAgICB0aGlzLnUudGVtcHNUb1NhdmUucHVzaChrKQogICAgICAgICAgdGhpcy5wdXNoRmluYWxseUJsb2NrKGQpCiAgICAgICAgICB2YXIgZyA9IHRoaXMucGVla0ZpbmFsbHlCbG9jaygpCiAgICAgICAgICB0aGlzLnNldHVwRXhjZXB0KGUpCiAgICAgICAgfQogICAgICAgIHZhciBoID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYzsgKytiKSBoLnB1c2godGhpcy5uZXdCbG9jaygiZXhjZXB0XyIgKyBiICsgIl8iKSkKICAgICAgICB2YXIgbSA9IHRoaXMubmV3QmxvY2soInVuaGFuZGxlZCIpCiAgICAgICAgdmFyIHAgPSB0aGlzLm5ld0Jsb2NrKCJvcmVsc2UiKQogICAgICAgIHZhciBDID0gdGhpcy5uZXdCbG9jaygiZW5kIikKICAgICAgICAwICE9IGgubGVuZ3RoICYmIHRoaXMuc2V0dXBFeGNlcHQoaFswXSkKICAgICAgICB0aGlzLnZzZXFzdG10KGEuYm9keSkKICAgICAgICAwICE9IGgubGVuZ3RoICYmIHRoaXMuZW5kRXhjZXB0KCkKICAgICAgICB0aGlzLl9qdW1wKHApCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7ICsrYikgewogICAgICAgICAgdGhpcy5zZXRCbG9jayhoW2JdKQogICAgICAgICAgdmFyIEsgPSBhLmhhbmRsZXJzW2JdCiAgICAgICAgICBpZiAoIUsudHlwZSAmJiBiIDwgYyAtIDEpCiAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiZGVmYXVsdCAnZXhjZXB0OicgbXVzdCBiZSBsYXN0IikKICAgICAgICAgIGlmIChLLnR5cGUpIHsKICAgICAgICAgICAgdmFyIEIgPSB0aGlzLnZleHByKEsudHlwZSkKICAgICAgICAgICAgdmFyIFMgPSBiID09IGMgLSAxID8gbSA6IGhbYiArIDFdCiAgICAgICAgICAgIEIgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAiaW5zdGFuY2UiLAogICAgICAgICAgICAgICJTay5taXNjZXZhbC5pc1RydWUoU2suYnVpbHRpbi5pc2luc3RhbmNlKCRlcnIsICIsCiAgICAgICAgICAgICAgQiwKICAgICAgICAgICAgICAiKSkiLAogICAgICAgICAgICApCiAgICAgICAgICAgIHRoaXMuX2p1bXBmYWxzZShCLCBTKQogICAgICAgICAgfQogICAgICAgICAgSy5uYW1lICYmIHRoaXMudmV4cHIoSy5uYW1lLCAiJGVyciIpCiAgICAgICAgICB0aGlzLnZzZXFzdG10KEsuYm9keSkKICAgICAgICAgIHRoaXMuX2p1bXAoQykKICAgICAgICB9CiAgICAgICAgdGhpcy5zZXRCbG9jayhtKQogICAgICAgIGYoInRocm93ICRlcnI7IikKICAgICAgICB0aGlzLnNldEJsb2NrKHApCiAgICAgICAgdGhpcy52c2Vxc3RtdChhLm9yZWxzZSkKICAgICAgICB0aGlzLl9qdW1wKEMpCiAgICAgICAgdGhpcy5zZXRCbG9jayhDKQogICAgICAgIGEuZmluYWxib2R5ICYmCiAgICAgICAgICAodGhpcy5lbmRFeGNlcHQoKSwKICAgICAgICAgIHRoaXMuX2p1bXAoZCksCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGUpLAogICAgICAgICAgZihrLCAiPSRlcnI7IiksCiAgICAgICAgICB0aGlzLl9qdW1wKGQpLAogICAgICAgICAgdGhpcy5zZXRCbG9jayhkKSwKICAgICAgICAgIHRoaXMucG9wRmluYWxseUJsb2NrKCksCiAgICAgICAgICB0aGlzLnZzZXFzdG10KGEuZmluYWxib2R5KSwKICAgICAgICAgIGYoImlmKCIsIGssICIhPT11bmRlZmluZWQpIHsgdGhyb3cgIiwgaywgIjt9IiksCiAgICAgICAgICB0aGlzLm91dHB1dEZpbmFsbHlDYXNjYWRlKGcpKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmN3aXRoID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gdGhpcy5uZXdCbG9jaygid2l0aGV4aCIpLAogICAgICAgICAgZCA9IHRoaXMubmV3QmxvY2soIndpdGh0aWR5dXAiKSwKICAgICAgICAgIGUgPSB0aGlzLm5ld0Jsb2NrKCJ3aXRoY2FycnlvbiIpCiAgICAgICAgdmFyIGsgPSB0aGlzLl9ncigibWdyIiwgdGhpcy52ZXhwcihhLml0ZW1zW2JdLmNvbnRleHRfZXhwcikpCiAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLmdhdHRyKCIsIGssICIsU2suYnVpbHRpbi5zdHIuJGV4aXQsIHRydWUpOyIpCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgdmFyIGcgPSB0aGlzLl9ncigiZXhpdCIsICIkcmV0IikKICAgICAgICB0aGlzLnUudGVtcHNUb1NhdmUucHVzaChnKQogICAgICAgIGYoIiRyZXQgPSBTay5hYnN0ci5nYXR0cigiLCBrLCAiLFNrLmJ1aWx0aW4uc3RyLiRlbnRlciwgdHJ1ZSk7IikKICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSkKICAgICAgICBmKCIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KCRyZXQpOyIpCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgayA9IHRoaXMuX2dyKCJ2YWx1ZSIsICIkcmV0IikKICAgICAgICB0aGlzLnB1c2hGaW5hbGx5QmxvY2soZCkKICAgICAgICB2YXIgaCA9IHRoaXMudS5maW5hbGx5QmxvY2tzW3RoaXMudS5maW5hbGx5QmxvY2tzLmxlbmd0aCAtIDFdCiAgICAgICAgdGhpcy5zZXR1cEV4Y2VwdChjKQogICAgICAgIGEuaXRlbXNbYl0ub3B0aW9uYWxfdmFycyAmJgogICAgICAgICAgdGhpcy5uYW1lb3AoYS5pdGVtc1tiXS5vcHRpb25hbF92YXJzLmlkLCBTay5hc3Rub2Rlcy5TdG9yZSwgaykKICAgICAgICBiICsgMSA8IGEuaXRlbXMubGVuZ3RoID8gdGhpcy5jd2l0aChhLCBiICsgMSkgOiB0aGlzLnZzZXFzdG10KGEuYm9keSkKICAgICAgICB0aGlzLmVuZEV4Y2VwdCgpCiAgICAgICAgdGhpcy5fanVtcChkKQogICAgICAgIHRoaXMuc2V0QmxvY2soYykKICAgICAgICBmKAogICAgICAgICAgIiRyZXQgPSBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZCgiLAogICAgICAgICAgZywKICAgICAgICAgICIsdW5kZWZpbmVkLFNrLmJ1aWx0aW4uZ2V0RXhjSW5mbygkZXJyKSx1bmRlZmluZWQsW10pOyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgIHRoaXMuX2p1bXB0cnVlKCIkcmV0IiwgZSkKICAgICAgICBmKCJ0aHJvdyAkZXJyOyIpCiAgICAgICAgdGhpcy5zZXRCbG9jayhkKQogICAgICAgIHRoaXMucG9wRmluYWxseUJsb2NrKCkKICAgICAgICBmKAogICAgICAgICAgIiRyZXQgPSBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoIiwKICAgICAgICAgIGcsCiAgICAgICAgICAiLFtTay5idWlsdGluLm5vbmUubm9uZSQsU2suYnVpbHRpbi5ub25lLm5vbmUkLFNrLmJ1aWx0aW4ubm9uZS5ub25lJF0pOyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgIHRoaXMub3V0cHV0RmluYWxseUNhc2NhZGUoaCkKICAgICAgICB0aGlzLl9qdW1wKGUpCiAgICAgICAgdGhpcy5zZXRCbG9jayhlKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNhc3NlcnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLnZleHByKGEudGVzdCksCiAgICAgICAgICBjID0gdGhpcy5uZXdCbG9jaygiZW5kIikKICAgICAgICB0aGlzLl9qdW1wdHJ1ZShiLCBjKQogICAgICAgIGYoCiAgICAgICAgICAidGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXNzZXJ0aW9uRXJyb3IoIiwKICAgICAgICAgIGEubXNnID8gdGhpcy52ZXhwcihhLm1zZykgOiAiIiwKICAgICAgICAgICIpOyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuc2V0QmxvY2soYykKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jaW1wb3J0YXMgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgYSA9IGEudgogICAgICAgIHZhciBkID0gYS5pbmRleE9mKCIuIiksCiAgICAgICAgICBlID0gYwogICAgICAgIGlmICgtMSAhPT0gZCkKICAgICAgICAgIGZvciAoYSA9IGEuc3Vic3RyKGQgKyAxKTsgLTEgIT09IGQ7ICkKICAgICAgICAgICAgKGQgPSBhLmluZGV4T2YoIi4iKSksCiAgICAgICAgICAgICAgKGMgPSAtMSAhPT0gZCA/IGEuc3Vic3RyKDAsIGQpIDogYSksCiAgICAgICAgICAgICAgKGUgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAgICJsYXR0ciIsCiAgICAgICAgICAgICAgICAiU2suYWJzdHIuZ2F0dHIoIiwKICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAiLCBuZXcgU2suYnVpbHRpbi5zdHIoJyIsCiAgICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgICAgIicpKSIsCiAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgKGEgPSBhLnN1YnN0cihkICsgMSkpCiAgICAgICAgcmV0dXJuIHRoaXMubmFtZW9wKGIsIFNrLmFzdG5vZGVzLlN0b3JlLCBlKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNpbXBvcnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gYS5uYW1lcy5sZW5ndGgKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYzsgKytiKSB7CiAgICAgICAgICB2YXIgZCA9IGEubmFtZXNbYl0KICAgICAgICAgIGYoCiAgICAgICAgICAgICIkcmV0ID0gU2suYnVpbHRpbi5fX2ltcG9ydF9fKCIsCiAgICAgICAgICAgIGQubmFtZS4kcigpLnYsCiAgICAgICAgICAgICIsJGdibCwkbG9jLFtdLCIsCiAgICAgICAgICAgIFNrLl9fZnV0dXJlX18uYWJzb2x1dGVfaW1wb3J0ID8gMCA6IC0xLAogICAgICAgICAgICAiKTsiLAogICAgICAgICAgKQogICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgICB2YXIgZSA9IHRoaXMuX2dyKCJtb2R1bGUiLCAiJHJldCIpCiAgICAgICAgICBpZiAoZC5hc25hbWUpIHRoaXMuY2ltcG9ydGFzKGQubmFtZSwgZC5hc25hbWUsIGUpCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIGsgPSBkLm5hbWUKICAgICAgICAgICAgZCA9IGsudi5pbmRleE9mKCIuIikKICAgICAgICAgICAgOy0xICE9PSBkICYmIChrID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGsudi5zdWJzdHIoMCwgZCkpKQogICAgICAgICAgICB0aGlzLm5hbWVvcChrLCBTay5hc3Rub2Rlcy5TdG9yZSwgZSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2Zyb21pbXBvcnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBkID0gYS5uYW1lcy5sZW5ndGgKICAgICAgICB2YXIgZSA9IFtdCiAgICAgICAgdmFyIGsgPSBhLmxldmVsCiAgICAgICAgMCAhPSBrIHx8IFNrLl9fZnV0dXJlX18uYWJzb2x1dGVfaW1wb3J0IHx8IChrID0gLTEpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgZVtiXSA9ICInIiArIGMoYS5uYW1lc1tiXS5uYW1lLnYpICsgIiciCiAgICAgICAgZigKICAgICAgICAgICIkcmV0ID0gU2suYnVpbHRpbi5fX2ltcG9ydF9fKCIsCiAgICAgICAgICBhLm1vZHVsZS4kcigpLnYsCiAgICAgICAgICAiLCRnYmwsJGxvYyxbIiwKICAgICAgICAgIGUsCiAgICAgICAgICAiXSwiLAogICAgICAgICAgaywKICAgICAgICAgICIpOyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgIGsgPSB0aGlzLl9ncigibW9kdWxlIiwgIiRyZXQiKQogICAgICAgIGZvciAoYiA9IDA7IGIgPCBkOyArK2IpIHsKICAgICAgICAgIGUgPSBhLm5hbWVzW2JdCiAgICAgICAgICB2YXIgZyA9ICInIiArIGMoZS5uYW1lLnYpICsgIiciCiAgICAgICAgICBpZiAoMCA9PT0gYiAmJiAiKiIgPT09IGUubmFtZS52KSB7CiAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDEgPT09IGQpCiAgICAgICAgICAgIGYoIlNrLmltcG9ydFN0YXIoIiwgaywgIiwkbG9jLCAkZ2JsKTsiKQogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgICAgdmFyIGggPSB0aGlzLl9ncigKICAgICAgICAgICAgIml0ZW0iLAogICAgICAgICAgICAiU2suYWJzdHIuZ2F0dHIoIiwKICAgICAgICAgICAgaywKICAgICAgICAgICAgIiwgbmV3IFNrLmJ1aWx0aW4uc3RyKCIsCiAgICAgICAgICAgIGcsCiAgICAgICAgICAgICIpKSIsCiAgICAgICAgICApCiAgICAgICAgICBnID0gZS5uYW1lCiAgICAgICAgICBlLmFzbmFtZSAmJiAoZyA9IGUuYXNuYW1lKQogICAgICAgICAgdGhpcy5uYW1lb3AoZywgU2suYXN0bm9kZXMuU3RvcmUsIGgpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmJ1aWxkY29kZW9iaiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUsIGcpIHsKICAgICAgICB2YXIgayA9IFtdLAogICAgICAgICAgaCwKICAgICAgICAgIGwgPSBbXSwKICAgICAgICAgIG4gPSBbXSwKICAgICAgICAgIG0gPSBbXSwKICAgICAgICAgIHIgPSBudWxsLAogICAgICAgICAgcSA9IG51bGwKICAgICAgICBjICYmIChsID0gdGhpcy52c2VxZXhwcihjKSkKICAgICAgICBkICYmIGQuZGVmYXVsdHMgJiYgKG4gPSB0aGlzLnZzZXFleHByKGQuZGVmYXVsdHMpKQogICAgICAgIGQgJiYKICAgICAgICAgIGQua3dfZGVmYXVsdHMgJiYKICAgICAgICAgIChtID0gZC5rd19kZWZhdWx0cy5tYXAoYSA9PiAoYSA/IHRoaXMudmV4cHIoYSkgOiAidW5kZWZpbmVkIikpKQogICAgICAgIGQgJiYgZC52YXJhcmcgJiYgKHIgPSBkLnZhcmFyZykKICAgICAgICBkICYmIGQua3dhcmcgJiYgKHEgPSBkLmt3YXJnKQogICAgICAgIGlmICgKICAgICAgICAgICFTay5fX2Z1dHVyZV9fLnB5dGhvbjMgJiYKICAgICAgICAgIGQgJiYKICAgICAgICAgIGQua3dvbmx5YXJncyAmJgogICAgICAgICAgMCAhPSBkLmt3b25seWFyZ3MubGVuZ3RoCiAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICJLZXl3b3JkLW9ubHkgYXJndW1lbnRzIGFyZSBub3Qgc3VwcG9ydGVkIGluIFB5dGhvbiAyIiwKICAgICAgICAgICkKICAgICAgICBjID0gdGhpcy5lbnRlclNjb3BlKGIsIGEsIGEubGluZW5vLCB0aGlzLmNhblN1c3BlbmQpCiAgICAgICAgYSA9IHRoaXMudS5zdGUuZ2VuZXJhdG9yCiAgICAgICAgdmFyIHAgPSB0aGlzLnUuc3RlLmhhc0ZyZWUKICAgICAgICB2YXIgRCA9IHRoaXMudS5zdGUuY2hpbGRIYXNGcmVlCiAgICAgICAgdmFyIHogPSB0aGlzLm5ld0Jsb2NrKCJjb2Rlb2JqIGVudHJ5IikKICAgICAgICB0aGlzLnUucHJlZml4Q29kZSA9CiAgICAgICAgICAidmFyICIgKyBjICsgIj0oZnVuY3Rpb24gIiArIHRoaXMubmljZU5hbWUoYi52KSArICIkKCIKICAgICAgICB2YXIgUCA9IFtdCiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgIGlmIChxKQogICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgYi52ICsgIigpOiBrZXl3b3JkIGFyZ3VtZW50cyBpbiBnZW5lcmF0b3JzIG5vdCBzdXBwb3J0ZWQiLAogICAgICAgICAgICApCiAgICAgICAgICBpZiAocikKICAgICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKAogICAgICAgICAgICAgIGIudiArCiAgICAgICAgICAgICAgICAiKCk6IHZhcmlhYmxlIG51bWJlciBvZiBhcmd1bWVudHMgaW4gZ2VuZXJhdG9ycyBub3Qgc3VwcG9ydGVkIiwKICAgICAgICAgICAgKQogICAgICAgICAgUC5wdXNoKCIkZ2VuIikKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcSAmJiAoUC5wdXNoKCIka3dhIiksIHRoaXMudS50ZW1wc1RvU2F2ZS5wdXNoKCIka3dhIikpCiAgICAgICAgICBmb3IgKGggPSAwOyBkICYmIGggPCBkLmFyZ3MubGVuZ3RoOyArK2gpCiAgICAgICAgICAgIFAucHVzaCh0aGlzLm5hbWVvcChkLmFyZ3NbaF0uYXJnLCBTay5hc3Rub2Rlcy5QYXJhbSkpCiAgICAgICAgICBmb3IgKGggPSAwOyBkICYmIGQua3dvbmx5YXJncyAmJiBoIDwgZC5rd29ubHlhcmdzLmxlbmd0aDsgKytoKQogICAgICAgICAgICBQLnB1c2godGhpcy5uYW1lb3AoZC5rd29ubHlhcmdzW2hdLmFyZywgU2suYXN0bm9kZXMuUGFyYW0pKQogICAgICAgICAgciAmJiBQLnB1c2godGhpcy5uYW1lb3AoZC52YXJhcmcuYXJnLCBTay5hc3Rub2Rlcy5QYXJhbSkpCiAgICAgICAgfQogICAgICAgIHAgJiYgKFAucHVzaCgiJGZyZWUiKSwgdGhpcy51LnRlbXBzVG9TYXZlLnB1c2goIiRmcmVlIikpCiAgICAgICAgdGhpcy51LnByZWZpeENvZGUgKz0gUC5qb2luKCIsIikKICAgICAgICB0aGlzLnUucHJlZml4Q29kZSArPSAiKXsiCiAgICAgICAgYSAmJiAodGhpcy51LnByZWZpeENvZGUgKz0gIlxuLy8gZ2VuZXJhdG9yXG4iKQogICAgICAgIHAgJiYgKHRoaXMudS5wcmVmaXhDb2RlICs9ICJcbi8vIGhhcyBmcmVlXG4iKQogICAgICAgIEQgJiYgKHRoaXMudS5wcmVmaXhDb2RlICs9ICJcbi8vIGhhcyBjZWxsXG4iKQogICAgICAgIFAgPSAie30iCiAgICAgICAgYSAmJiAoKHogPSAiJGdlbi5naSRyZXN1bWVhdCIpLCAoUCA9ICIkZ2VuLmdpJGxvY2FscyIpKQogICAgICAgIGggPSAiLCRjZWxsPXt9IgogICAgICAgIEQgJiYgYSAmJiAoaCA9ICIsJGNlbGw9JGdlbi5naSRjZWxscyIpCiAgICAgICAgdGhpcy51LnZhckRlY2xzQ29kZSArPQogICAgICAgICAgInZhciAkYmxrPSIgKwogICAgICAgICAgeiArCiAgICAgICAgICAiLCRleGM9W10sJGxvYz0iICsKICAgICAgICAgIFAgKwogICAgICAgICAgaCArCiAgICAgICAgICAiLCRnYmw9dGhpcywkZXJyPXVuZGVmaW5lZCwkcmV0PXVuZGVmaW5lZCwkcG9zdGZpbmFsbHk9dW5kZWZpbmVkLCRjdXJyTGluZU5vPXVuZGVmaW5lZCwkY3VyckNvbE5vPXVuZGVmaW5lZDsiCiAgICAgICAgbnVsbCAhPT0gU2suZXhlY0xpbWl0ICYmCiAgICAgICAgICAodGhpcy51LnZhckRlY2xzQ29kZSArPQogICAgICAgICAgICAiaWYgKHR5cGVvZiBTay5leGVjU3RhcnQgPT09ICd1bmRlZmluZWQnKSB7U2suZXhlY1N0YXJ0ID0gRGF0ZS5ub3coKX0iKQogICAgICAgIG51bGwgIT09IFNrLnlpZWxkTGltaXQgJiYKICAgICAgICAgIHRoaXMudS5jYW5TdXNwZW5kICYmCiAgICAgICAgICAodGhpcy51LnZhckRlY2xzQ29kZSArPQogICAgICAgICAgICAiaWYgKHR5cGVvZiBTay5sYXN0WWllbGQgPT09ICd1bmRlZmluZWQnKSB7U2subGFzdFlpZWxkID0gRGF0ZS5ub3coKX0iKQogICAgICAgIHRoaXMudS52YXJEZWNsc0NvZGUgKz0KICAgICAgICAgICJpZiAoIiArCiAgICAgICAgICBjICsKICAgICAgICAgICIuJHdha2luZ1N1c3BlbnNpb24hPT11bmRlZmluZWQpIHsgJHdha2VGcm9tU3VzcGVuc2lvbigpOyB9IGVsc2UgeyIKICAgICAgICBpZiAoYSAmJiAwIDwgbi5sZW5ndGgpCiAgICAgICAgICBmb3IgKEQgPSBkLmFyZ3MubGVuZ3RoIC0gbi5sZW5ndGgsIGggPSAwOyBoIDwgbi5sZW5ndGg7ICsraCkKICAgICAgICAgICAgKHogPSB0aGlzLm5hbWVvcChkLmFyZ3NbaCArIERdLmFyZywgU2suYXN0bm9kZXMuUGFyYW0pKSwKICAgICAgICAgICAgICAodGhpcy51LnZhckRlY2xzQ29kZSArPQogICAgICAgICAgICAgICAgImlmKCIgKwogICAgICAgICAgICAgICAgeiArCiAgICAgICAgICAgICAgICAiPT09dW5kZWZpbmVkKSIgKwogICAgICAgICAgICAgICAgeiArCiAgICAgICAgICAgICAgICAiPSIgKwogICAgICAgICAgICAgICAgYyArCiAgICAgICAgICAgICAgICAiLiRkZWZhdWx0c1siICsKICAgICAgICAgICAgICAgIGggKwogICAgICAgICAgICAgICAgIl07IikKICAgICAgICBmb3IgKGggPSAwOyBkICYmIGggPCBkLmFyZ3MubGVuZ3RoOyArK2gpCiAgICAgICAgICAoeiA9IGQuYXJnc1toXS5hcmcpLAogICAgICAgICAgICB0aGlzLmlzQ2VsbCh6KSAmJgogICAgICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9ICIkY2VsbC4iICsgei52ICsgIj0iICsgei52ICsgIjsiKQogICAgICAgIGZvciAoaCA9IDA7IGQgJiYgZC5rd29ubHlhcmdzICYmIGggPCBkLmt3b25seWFyZ3MubGVuZ3RoOyArK2gpCiAgICAgICAgICAoeiA9IGQua3dvbmx5YXJnc1toXS5hcmcpLAogICAgICAgICAgICB0aGlzLmlzQ2VsbCh6KSAmJgogICAgICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9ICIkY2VsbC4iICsgei52ICsgIj0iICsgei52ICsgIjsiKQogICAgICAgIHIgJiYKICAgICAgICAgIHRoaXMuaXNDZWxsKHIuYXJnKSAmJgogICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0gIiRjZWxsLiIgKyByLmFyZy52ICsgIj0iICsgci5hcmcudiArICI7IikKICAgICAgICBxICYmCiAgICAgICAgICAodGhpcy51LmxvY2FsbmFtZXMucHVzaChxLmFyZy52KSwKICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9IHEuYXJnLnYgKyAiPW5ldyBTay5idWlsdGluc1snZGljdCddKCRrd2EpOyIpLAogICAgICAgICAgdGhpcy5pc0NlbGwocS5hcmcpICYmCiAgICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9ICIkY2VsbC4iICsgcS5hcmcudiArICI9IiArIHEuYXJnLnYgKyAiOyIpKQogICAgICAgIHRoaXMudS52YXJEZWNsc0NvZGUgKz0gIn0iCiAgICAgICAgU2sucHl0aG9uMyAmJgogICAgICAgICAgZyAmJgogICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0gIiRnYmwuX19jbGFzc19fPXRoaXMuIiArIGcudiArICI7IikKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSA9ICJ3aGlsZSh0cnVlKXt0cnl7IgogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlICs9IHRoaXMub3V0cHV0SW50ZXJydXB0VGVzdCgpCiAgICAgICAgdGhpcy51LnN3aXRjaENvZGUgKz0gInN3aXRjaCgkYmxrKXsiCiAgICAgICAgdGhpcy51LnN1ZmZpeENvZGUgPQogICAgICAgICAgIn0gfWNhdGNoKGVycil7IGlmICghKGVyciBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbikpIHsgZXJyID0gbmV3IFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcihlcnIpOyB9IGVyci50cmFjZWJhY2sucHVzaCh7bGluZW5vOiAkY3VyckxpbmVObywgY29sbm86ICRjdXJyQ29sTm8sIGZpbGVuYW1lOiAnIiArCiAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICInfSk7IGlmICgkZXhjLmxlbmd0aD4wKSB7ICRlcnIgPSBlcnI7ICRibGs9JGV4Yy5wb3AoKTsgY29udGludWU7IH0gZWxzZSB7IHRocm93IGVycjsgfX0gfX0pOyIKICAgICAgICBlLmNhbGwodGhpcywgYykKICAgICAgICBpZiAoZCkgewogICAgICAgICAgZm9yIChsZXQgYSBvZiBkLmFyZ3MpIGsucHVzaChhLmFyZy52KQogICAgICAgICAgZm9yIChsZXQgYSBvZiBkLmt3b25seWFyZ3MgfHwgW10pIGsucHVzaChhLmFyZy52KQogICAgICAgICAgdGhpcy51LmFyZ25hbWVzID0gawogICAgICAgIH0KICAgICAgICB0aGlzLmV4aXRTY29wZSgpCiAgICAgICAgMCA8IG4ubGVuZ3RoICYmIGYoYywgIi4kZGVmYXVsdHM9WyIsIG4uam9pbigiLCIpLCAiXTsiKQogICAgICAgIGQgJiYKICAgICAgICAgIGQua3dvbmx5YXJncyAmJgogICAgICAgICAgMCA8IGQua3dvbmx5YXJncy5sZW5ndGggJiYKICAgICAgICAgIChmKGMsICIuY29fYXJnY291bnQ9IiwgZC5hcmdzLmxlbmd0aCwgIjsiKSwKICAgICAgICAgIGYoYywgIi5jb19rd29ubHlhcmdjb3VudD0iLCBkLmt3b25seWFyZ3MubGVuZ3RoLCAiOyIpLAogICAgICAgICAgZihjLCAiLiRrd2RlZnM9WyIsIG0uam9pbigiLCIpLCAiXTsiKSkKICAgICAgICAwIDwgay5sZW5ndGgKICAgICAgICAgID8gZihjLCAiLmNvX3Zhcm5hbWVzPVsnIiwgay5qb2luKCInLCciKSwgIiddOyIpCiAgICAgICAgICA6IGYoYywgIi5jb192YXJuYW1lcz1bXTsiKQogICAgICAgIHEgJiYgZihjLCAiLmNvX2t3YXJncz0xOyIpCiAgICAgICAgciAmJiBmKGMsICIuY29fdmFyYXJncz0xOyIpCiAgICAgICAgZSA9ICIiCiAgICAgICAgcCAmJiAoKGUgPSAiLCRjZWxsIiksIChnID0gdGhpcy51LnN0ZS5oYXNGcmVlKSAmJiAoZSArPSAiLCRmcmVlIikpCiAgICAgICAgaWYgKGEpCiAgICAgICAgICByZXR1cm4gZCAmJiAwIDwgZC5hcmdzLmxlbmd0aAogICAgICAgICAgICA/IHRoaXMuX2dyKAogICAgICAgICAgICAgICAgImdlbmVyIiwKICAgICAgICAgICAgICAgICJuZXcgU2suYnVpbHRpbnNbJ2Z1bmN0aW9uJ10oKGZ1bmN0aW9uKCl7dmFyICRvcmlnYXJncz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1NrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oXCIiLAogICAgICAgICAgICAgICAgYi52LAogICAgICAgICAgICAgICAgJyIsYXJndW1lbnRzLmxlbmd0aCwnLAogICAgICAgICAgICAgICAgZC5hcmdzLmxlbmd0aCAtIG4ubGVuZ3RoLAogICAgICAgICAgICAgICAgIiwiLAogICAgICAgICAgICAgICAgZC5hcmdzLmxlbmd0aCwKICAgICAgICAgICAgICAgICIpO3JldHVybiBuZXcgU2suYnVpbHRpbnNbJ2dlbmVyYXRvciddKCIsCiAgICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgICAgIiwkZ2JsLCRvcmlnYXJncyIsCiAgICAgICAgICAgICAgICBlLAogICAgICAgICAgICAgICAgIik7fSkpIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIDogdGhpcy5fZ3IoCiAgICAgICAgICAgICAgICAiZ2VuZXIiLAogICAgICAgICAgICAgICAgIm5ldyBTay5idWlsdGluc1snZnVuY3Rpb24nXSgoZnVuY3Rpb24oKXtTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKFwiIiwKICAgICAgICAgICAgICAgIGIudiwKICAgICAgICAgICAgICAgICJcIixhcmd1bWVudHMubGVuZ3RoLDAsMCk7cmV0dXJuIG5ldyBTay5idWlsdGluc1snZ2VuZXJhdG9yJ10oIiwKICAgICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgICAiLCRnYmwsW10iLAogICAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICAgICIpO30pKSIsCiAgICAgICAgICAgICAgKQogICAgICAgIGlmICgwIDwgbC5sZW5ndGgpIHsKICAgICAgICAgIGYoIiRyZXQgPSBuZXcgU2suYnVpbHRpbnNbJ2Z1bmN0aW9uJ10oIiwgYywgIiwkZ2JsIiwgZSwgIik7IikKICAgICAgICAgIGZvciAobGV0IGEgb2YgbCkKICAgICAgICAgICAgZigiJHJldCA9IFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSgiLCBhLCAiLFskcmV0XSk7IiksCiAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKCkKICAgICAgICAgIHJldHVybiB0aGlzLl9ncigiZnVuY29iaiIsICIkcmV0IikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX2dyKAogICAgICAgICAgImZ1bmNvYmoiLAogICAgICAgICAgIm5ldyBTay5idWlsdGluc1snZnVuY3Rpb24nXSgiLAogICAgICAgICAgYywKICAgICAgICAgICIsJGdibCIsCiAgICAgICAgICBlLAogICAgICAgICAgIikiLAogICAgICAgICkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jZnVuY3Rpb24gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLkZ1bmN0aW9uRGVmKQogICAgICAgIGIgPSB0aGlzLmJ1aWxkY29kZW9iaigKICAgICAgICAgIGEsCiAgICAgICAgICBhLm5hbWUsCiAgICAgICAgICBhLmRlY29yYXRvcl9saXN0LAogICAgICAgICAgYS5hcmdzLAogICAgICAgICAgZnVuY3Rpb24oYikgewogICAgICAgICAgICB0aGlzLnZzZXFzdG10KGEuYm9keSkKICAgICAgICAgICAgZigicmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJDsiKQogICAgICAgICAgfSwKICAgICAgICAgIGIsCiAgICAgICAgKQogICAgICAgIHRoaXMubmFtZW9wKGEubmFtZSwgU2suYXN0bm9kZXMuU3RvcmUsIGIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2xhbWJkYSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuTGFtYmRhKQogICAgICAgIHJldHVybiB0aGlzLmJ1aWxkY29kZW9iaigKICAgICAgICAgIGEsCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoIjxsYW1iZGE+IiksCiAgICAgICAgICBudWxsLAogICAgICAgICAgYS5hcmdzLAogICAgICAgICAgZnVuY3Rpb24oYikgewogICAgICAgICAgICBiID0gdGhpcy52ZXhwcihhLmJvZHkpCiAgICAgICAgICAgIGYoInJldHVybiAiLCBiLCAiOyIpCiAgICAgICAgICB9LAogICAgICAgICkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jaWZleHAgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLm5ld0Jsb2NrKCJuZXh0IG9mIGlmZXhwIiksCiAgICAgICAgICBjID0gdGhpcy5uZXdCbG9jaygiZW5kIG9mIGlmZXhwIiksCiAgICAgICAgICBkID0gdGhpcy5fZ3IoInJlcyIsICJudWxsIiksCiAgICAgICAgICBlID0gdGhpcy52ZXhwcihhLnRlc3QpCiAgICAgICAgdGhpcy5fanVtcGZhbHNlKGUsIGIpCiAgICAgICAgZihkLCAiPSIsIHRoaXMudmV4cHIoYS5ib2R5KSwgIjsiKQogICAgICAgIHRoaXMuX2p1bXAoYykKICAgICAgICB0aGlzLnNldEJsb2NrKGIpCiAgICAgICAgZihkLCAiPSIsIHRoaXMudmV4cHIoYS5vcmVsc2UpLCAiOyIpCiAgICAgICAgdGhpcy5fanVtcChjKQogICAgICAgIHRoaXMuc2V0QmxvY2soYykKICAgICAgICByZXR1cm4gZAogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNnZW5leHBnZW4gPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSB0aGlzLm5ld0Jsb2NrKCJzdGFydCBmb3IgIiArIGIpLAogICAgICAgICAgZSA9IHRoaXMubmV3QmxvY2soInNraXAgZm9yICIgKyBiKQogICAgICAgIHRoaXMubmV3QmxvY2soImlmIGNsZWFudXAgZm9yICIgKyBiKQogICAgICAgIHZhciBnID0gdGhpcy5uZXdCbG9jaygiZW5kIGZvciAiICsgYiksCiAgICAgICAgICBrID0gYVtiXQogICAgICAgIGlmICgwID09PSBiKSB2YXIgaCA9ICIkbG9jLiRpdGVyMCIKICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBsID0gdGhpcy52ZXhwcihrLml0ZXIpCiAgICAgICAgICBoID0gIiRsb2MuIiArIHRoaXMuZ2Vuc3ltKCJpdGVyIikKICAgICAgICAgIGYoaCwgIj0iLCAiU2suYWJzdHIuaXRlcigiLCBsLCAiKTsiKQogICAgICAgIH0KICAgICAgICB0aGlzLl9qdW1wKGQpCiAgICAgICAgdGhpcy5zZXRCbG9jayhkKQogICAgICAgIHRoaXMuYW5ub3RhdGVTb3VyY2UoYykKICAgICAgICBmKAogICAgICAgICAgIiRyZXQgPSBTay5hYnN0ci5pdGVybmV4dCgiLAogICAgICAgICAgaCwKICAgICAgICAgIHRoaXMudS5jYW5TdXNwZW5kID8gIiwgdHJ1ZSIgOiAiLCBmYWxzZSIsCiAgICAgICAgICAiKTsiLAogICAgICAgICkKICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYykKICAgICAgICBsID0gdGhpcy5fZ3IoIm5leHQiLCAiJHJldCIpCiAgICAgICAgdGhpcy5fanVtcHVuZGVmKGwsIGcpCiAgICAgICAgdGhpcy52ZXhwcihrLnRhcmdldCwgbCkKICAgICAgICB2YXIgbSA9IGsuaWZzID8gay5pZnMubGVuZ3RoIDogMAogICAgICAgIGZvciAoaCA9IDA7IGggPCBtOyArK2gpCiAgICAgICAgICB0aGlzLmFubm90YXRlU291cmNlKGsuaWZzW2hdKSwKICAgICAgICAgICAgKGwgPSB0aGlzLnZleHByKGsuaWZzW2hdKSksCiAgICAgICAgICAgIHRoaXMuX2p1bXBmYWxzZShsLCBkKQogICAgICAgICsrYiA8IGEubGVuZ3RoICYmIHRoaXMuY2dlbmV4cGdlbihhLCBiLCBjKQogICAgICAgIGIgPj0gYS5sZW5ndGggJiYKICAgICAgICAgICh0aGlzLmFubm90YXRlU291cmNlKGMpLAogICAgICAgICAgKGEgPSB0aGlzLnZleHByKGMpKSwKICAgICAgICAgIGYoInJldHVybiBbIiwgZSwgIi8qcmVzdW1lKi8sIiwgYSwgIi8qcmV0Ki9dOyIpLAogICAgICAgICAgdGhpcy5zZXRCbG9jayhlKSkKICAgICAgICB0aGlzLl9qdW1wKGQpCiAgICAgICAgdGhpcy5zZXRCbG9jayhnKQogICAgICAgIDEgPT09IGIgJiYgZigicmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJDsiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNnZW5leHAgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLmJ1aWxkY29kZW9iaigKICAgICAgICAgIGEsCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoIjxnZW5leHByPiIpLAogICAgICAgICAgbnVsbCwKICAgICAgICAgIG51bGwsCiAgICAgICAgICBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgIHRoaXMuY2dlbmV4cGdlbihhLmdlbmVyYXRvcnMsIDAsIGEuZWx0KQogICAgICAgICAgfSwKICAgICAgICApCiAgICAgICAgYiA9IHRoaXMuX2dyKCJnZW5lciIsICJTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoIiwgYiwgIik7IikKICAgICAgICBmKAogICAgICAgICAgYiwKICAgICAgICAgICIuZ2kkbG9jYWxzLiRpdGVyMD1Tay5hYnN0ci5pdGVyKCIsCiAgICAgICAgICB0aGlzLnZleHByKGEuZ2VuZXJhdG9yc1swXS5pdGVyKSwKICAgICAgICAgICIpOyIsCiAgICAgICAgKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2NsYXNzID0gZnVuY3Rpb24oYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBTay5hc3Rub2Rlcy5DbGFzc0RlZikKICAgICAgICB2YXIgYiA9IHRoaXMudnNlcWV4cHIoYS5kZWNvcmF0b3JfbGlzdCkKICAgICAgICB2YXIgYyA9IHRoaXMudnNlcWV4cHIoYS5iYXNlcykKICAgICAgICB2YXIgZCA9IHRoaXMuZW50ZXJTY29wZShhLm5hbWUsIGEsIGEubGluZW5vKQogICAgICAgIHZhciBlID0gdGhpcy5uZXdCbG9jaygiY2xhc3MgZW50cnkiKQogICAgICAgIHRoaXMudS5wcmVmaXhDb2RlID0KICAgICAgICAgICJ2YXIgIiArCiAgICAgICAgICBkICsKICAgICAgICAgICI9KGZ1bmN0aW9uICQiICsKICAgICAgICAgIGEubmFtZS52ICsKICAgICAgICAgICIkY2xhc3Nfb3V0ZXIoJGdsb2JhbHMsJGxvY2FscywkY2VsbCl7dmFyICRnYmw9JGdsb2JhbHMsJGxvYz0kbG9jYWxzOyRmcmVlPSRnbG9iYWxzOyIKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPSAiKGZ1bmN0aW9uICQiICsgYS5uYW1lLnYgKyAiJF9jbG9zdXJlKCRjZWxsKXsiCiAgICAgICAgdGhpcy51LnN3aXRjaENvZGUgKz0KICAgICAgICAgICJ2YXIgJGJsaz0iICsKICAgICAgICAgIGUgKwogICAgICAgICAgIiwkZXhjPVtdLCRyZXQ9dW5kZWZpbmVkLCRwb3N0ZmluYWxseT11bmRlZmluZWQsJGN1cnJMaW5lTm89dW5kZWZpbmVkLCRjdXJyQ29sTm89dW5kZWZpbmVkOyIKICAgICAgICBudWxsICE9PSBTay5leGVjTGltaXQgJiYKICAgICAgICAgICh0aGlzLnUuc3dpdGNoQ29kZSArPQogICAgICAgICAgICAiaWYgKHR5cGVvZiBTay5leGVjU3RhcnQgPT09ICd1bmRlZmluZWQnKSB7U2suZXhlY1N0YXJ0ID0gRGF0ZS5ub3coKX0iKQogICAgICAgIG51bGwgIT09IFNrLnlpZWxkTGltaXQgJiYKICAgICAgICAgIHRoaXMudS5jYW5TdXNwZW5kICYmCiAgICAgICAgICAodGhpcy51LnN3aXRjaENvZGUgKz0KICAgICAgICAgICAgImlmICh0eXBlb2YgU2subGFzdFlpZWxkID09PSAndW5kZWZpbmVkJykge1NrLmxhc3RZaWVsZCA9IERhdGUubm93KCl9IikKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPSAid2hpbGUodHJ1ZSl7dHJ5eyIKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPSB0aGlzLm91dHB1dEludGVycnVwdFRlc3QoKQogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlICs9ICJzd2l0Y2goJGJsayl7IgogICAgICAgIHRoaXMudS5zdWZmaXhDb2RlID0KICAgICAgICAgICJ9fWNhdGNoKGVycil7IGlmICghKGVyciBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbikpIHsgZXJyID0gbmV3IFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcihlcnIpOyB9IGVyci50cmFjZWJhY2sucHVzaCh7bGluZW5vOiAkY3VyckxpbmVObywgY29sbm86ICRjdXJyQ29sTm8sIGZpbGVuYW1lOiAnIiArCiAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICInfSk7IGlmICgkZXhjLmxlbmd0aD4wKSB7ICRlcnIgPSBlcnI7ICRibGs9JGV4Yy5wb3AoKTsgY29udGludWU7IH0gZWxzZSB7IHRocm93IGVycjsgfX19IgogICAgICAgIHRoaXMudS5zdWZmaXhDb2RlICs9ICJ9KS5jYWxsKG51bGwsICRjZWxsKTt9KTsiCiAgICAgICAgdGhpcy51LnByaXZhdGVfID0gYS5uYW1lCiAgICAgICAgdGhpcy5jYm9keShhLmJvZHksIGEubmFtZSkKICAgICAgICBmKCJyZXR1cm47IikKICAgICAgICB0aGlzLmV4aXRTY29wZSgpCiAgICAgICAgZigKICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwuYnVpbGRDbGFzcygkZ2JsLCIsCiAgICAgICAgICBkLAogICAgICAgICAgIiwiLAogICAgICAgICAgYS5uYW1lLiRyKCkudiwKICAgICAgICAgICIsWyIsCiAgICAgICAgICBjLAogICAgICAgICAgIl0sICRjZWxsKTsiLAogICAgICAgICkKICAgICAgICBmb3IgKGxldCBhIG9mIGIpCiAgICAgICAgICBmKCIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KCIsIGEsICIsIFskcmV0XSk7IiksCiAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbigpCiAgICAgICAgdGhpcy5uYW1lb3AoYS5uYW1lLCBTay5hc3Rub2Rlcy5TdG9yZSwgIiRyZXQiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNjb250aW51ZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICBhID0gdGhpcy5wZWVrRmluYWxseUJsb2NrKCkKICAgICAgICBpZiAoMCA9PSB0aGlzLnUuY29udGludWVCbG9ja3MubGVuZ3RoKQogICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCInY29udGludWUnIG91dHNpZGUgbG9vcCIpCiAgICAgICAgdmFyIGIgPSB0aGlzLnUuY29udGludWVCbG9ja3NbdGhpcy51LmNvbnRpbnVlQmxvY2tzLmxlbmd0aCAtIDFdCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICB0aGlzLnUuYnJlYWtCbG9ja3MubGVuZ3RoID09PSB0aGlzLnUuY29udGludWVCbG9ja3MubGVuZ3RoLAogICAgICAgICkKICAgICAgICBhICYmIGEuYnJlYWtEZXB0aCA9PSB0aGlzLnUuY29udGludWVCbG9ja3MubGVuZ3RoCiAgICAgICAgICA/IGYoIiRwb3N0ZmluYWxseT17aXNCcmVhazp0cnVlLGdvdG9CbG9jazoiLCBiLCAifTsiKQogICAgICAgICAgOiB0aGlzLl9qdW1wKGIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2JyZWFrID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSB0aGlzLnBlZWtGaW5hbGx5QmxvY2soKQogICAgICAgIGlmICgwID09PSB0aGlzLnUuYnJlYWtCbG9ja3MubGVuZ3RoKQogICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCInYnJlYWsnIG91dHNpZGUgbG9vcCIpCiAgICAgICAgdmFyIGIgPSB0aGlzLnUuYnJlYWtCbG9ja3NbdGhpcy51LmJyZWFrQmxvY2tzLmxlbmd0aCAtIDFdCiAgICAgICAgYSAmJiBhLmJyZWFrRGVwdGggPT0gdGhpcy51LmJyZWFrQmxvY2tzLmxlbmd0aAogICAgICAgICAgPyBmKCIkcG9zdGZpbmFsbHk9e2lzQnJlYWs6dHJ1ZSxnb3RvQmxvY2s6IiwgYiwgIn07IikKICAgICAgICAgIDogdGhpcy5fanVtcChiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnZzdG10ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHRoaXMudS5saW5lbm8gPSBhLmxpbmVubwogICAgICAgIHRoaXMudS5saW5lbm9TZXQgPSAhMQogICAgICAgIHRoaXMudS5sb2NhbHRlbXBzID0gW10KICAgICAgICBpZiAoU2suZGVidWdnaW5nICYmIHRoaXMudS5jYW5TdXNwZW5kKSB7CiAgICAgICAgICB2YXIgYyA9IHRoaXMubmV3QmxvY2soImRlYnVnIGJyZWFrcG9pbnQgZm9yIGxpbmUgIiArIGEubGluZW5vKQogICAgICAgICAgZigKICAgICAgICAgICAgImlmIChTay5icmVha3BvaW50cygnIiArCiAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSArCiAgICAgICAgICAgICAgIicsIiArCiAgICAgICAgICAgICAgYS5saW5lbm8gKwogICAgICAgICAgICAgICIsIiArCiAgICAgICAgICAgICAgYS5jb2xfb2Zmc2V0ICsKICAgICAgICAgICAgICAiKSkgeyIsCiAgICAgICAgICAgICJ2YXIgJHN1c3AgPSAkc2F2ZVN1c3BlbnNpb24oe2RhdGE6IHt0eXBlOiAnU2suZGVidWcnfSwgcmVzdW1lOiBmdW5jdGlvbigpIHt9fSwgJyIgKwogICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgICAgICInLCIgKwogICAgICAgICAgICAgIGEubGluZW5vICsKICAgICAgICAgICAgICAiLCIgKwogICAgICAgICAgICAgIGEuY29sX29mZnNldCArCiAgICAgICAgICAgICAgIik7IiwKICAgICAgICAgICAgIiRzdXNwLiRibGsgPSAiICsgYyArICI7IiwKICAgICAgICAgICAgIiRzdXNwLm9wdGlvbmFsID0gdHJ1ZTsiLAogICAgICAgICAgICAicmV0dXJuICRzdXNwOyIsCiAgICAgICAgICAgICJ9IiwKICAgICAgICAgICkKICAgICAgICAgIHRoaXMuX2p1bXAoYykKICAgICAgICAgIHRoaXMuc2V0QmxvY2soYykKICAgICAgICAgIHRoaXMudS5kb2VzU3VzcGVuZCA9ICEwCiAgICAgICAgfQogICAgICAgIHRoaXMuYW5ub3RhdGVTb3VyY2UoYSkKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWY6CiAgICAgICAgICAgIHRoaXMuY2Z1bmN0aW9uKGEsIGIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNsYXNzRGVmOgogICAgICAgICAgICB0aGlzLmNjbGFzcyhhKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5SZXR1cm46CiAgICAgICAgICAgIGlmICh0aGlzLnUuc3RlLmJsb2NrVHlwZSAhPT0gU2suU1lNVEFCX0NPTlNUUy5GdW5jdGlvbkJsb2NrKQogICAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiJ3JldHVybicgb3V0c2lkZSBmdW5jdGlvbiIpCiAgICAgICAgICAgIGMgPSBhLnZhbHVlID8gdGhpcy52ZXhwcihhLnZhbHVlKSA6ICJTay5idWlsdGluLm5vbmUubm9uZSQiCiAgICAgICAgICAgIDAgPT0gdGhpcy51LmZpbmFsbHlCbG9ja3MubGVuZ3RoCiAgICAgICAgICAgICAgPyBmKCJyZXR1cm4gIiwgYywgIjsiKQogICAgICAgICAgICAgIDogKGYoIiRwb3N0ZmluYWxseT17cmV0dXJuaW5nOiIsIGMsICJ9OyIpLAogICAgICAgICAgICAgICAgdGhpcy5fanVtcCh0aGlzLnBlZWtGaW5hbGx5QmxvY2soKS5ibGspKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWxldGU6CiAgICAgICAgICAgIHRoaXMudnNlcWV4cHIoYS50YXJnZXRzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Bc3NpZ246CiAgICAgICAgICAgIHZhciBkID0gYS50YXJnZXRzLmxlbmd0aAogICAgICAgICAgICBjID0gdGhpcy52ZXhwcihhLnZhbHVlKQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZDsgKytiKSB0aGlzLnZleHByKGEudGFyZ2V0c1tiXSwgYykKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQW5uQXNzaWduOgogICAgICAgICAgICBjID0gdGhpcy52ZXhwcihhLnZhbHVlKQogICAgICAgICAgICB0aGlzLnZleHByKGEudGFyZ2V0LCBjKQogICAgICAgICAgICB0aGlzLnZleHByKGEuYW5ub3RhdGlvbikKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXVnQXNzaWduOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jYXVnYXNzaWduKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlByaW50OgogICAgICAgICAgICB0aGlzLmNwcmludChhKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Gb3I6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNmb3IoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuV2hpbGU6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN3aGlsZShhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JZjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2lmKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlJhaXNlOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jcmFpc2UoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVHJ5OgogICAgICAgICAgICByZXR1cm4gdGhpcy5jdHJ5KGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLldpdGg6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN3aXRoKGEsIDApCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkFzc2VydDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2Fzc2VydChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JbXBvcnQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNpbXBvcnQoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuSW1wb3J0RnJvbToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2Zyb21pbXBvcnQoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuR2xvYmFsOgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5FeHByOgogICAgICAgICAgICB0aGlzLnZleHByKGEudmFsdWUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlBhc3M6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkJyZWFrOgogICAgICAgICAgICB0aGlzLmNicmVhayhhKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Db250aW51ZToKICAgICAgICAgICAgdGhpcy5jY29udGludWUoYSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGVidWdnZXI6CiAgICAgICAgICAgIGYoImRlYnVnZ2VyOyIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBjYXNlIGluIHZzdG10OiAiICsgSlNPTi5zdHJpbmdpZnkoYSkpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnZzZXFzdG10ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyArK2IpIHRoaXMudnN0bXQoYVtiXSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5pc0NlbGwgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYSA9IGUodGhpcy51LnByaXZhdGVfLCBhKS52CiAgICAgICAgcmV0dXJuIHRoaXMudS5zdGUuZ2V0U2NvcGUoYSkgPT09IFNrLlNZTVRBQl9DT05TVFMuQ0VMTAogICAgICB9CiAgICAgIGEucHJvdG90eXBlLm5hbWVvcCA9IGZ1bmN0aW9uKGEsIGIsIGcpIHsKICAgICAgICBpZiAoCiAgICAgICAgICAoYiA9PT0gU2suYXN0bm9kZXMuU3RvcmUgfHwKICAgICAgICAgICAgYiA9PT0gU2suYXN0bm9kZXMuQXVnU3RvcmUgfHwKICAgICAgICAgICAgYiA9PT0gU2suYXN0bm9kZXMuRGVsKSAmJgogICAgICAgICAgIl9fZGVidWdfXyIgPT09IGEudgogICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKCJjYW4gbm90IGFzc2lnbiB0byBfX2RlYnVnX18iKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJOb25lIiAhPT0gYS52KQogICAgICAgIGlmICgiTm90SW1wbGVtZW50ZWQiID09PSBhLnYpCiAgICAgICAgICByZXR1cm4gIlNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkIgogICAgICAgIHZhciBrID0gZSh0aGlzLnUucHJpdmF0ZV8sIGEpLnYKICAgICAgICBrID0gZChrKQogICAgICAgIHZhciBoID0gMwogICAgICAgIHZhciBsID0gdGhpcy51LnN0ZS5nZXRTY29wZShrKQogICAgICAgIHZhciBtID0gbnVsbAogICAgICAgIHN3aXRjaCAobCkgewogICAgICAgICAgY2FzZSBTay5TWU1UQUJfQ09OU1RTLkZSRUU6CiAgICAgICAgICAgIG0gPSAiJGZyZWUiCiAgICAgICAgICAgIGggPSAyCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLlNZTVRBQl9DT05TVFMuQ0VMTDoKICAgICAgICAgICAgbSA9ICIkY2VsbCIKICAgICAgICAgICAgaCA9IDIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suU1lNVEFCX0NPTlNUUy5MT0NBTDoKICAgICAgICAgICAgdGhpcy51LnN0ZS5ibG9ja1R5cGUgIT09IFNrLlNZTVRBQl9DT05TVFMuRnVuY3Rpb25CbG9jayB8fAogICAgICAgICAgICAgIHRoaXMudS5zdGUuZ2VuZXJhdG9yIHx8CiAgICAgICAgICAgICAgKGggPSAwKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5TWU1UQUJfQ09OU1RTLkdMT0JBTF9JTVBMSUNJVDoKICAgICAgICAgICAgdGhpcy51LnN0ZS5ibG9ja1R5cGUgPT09IFNrLlNZTVRBQl9DT05TVFMuRnVuY3Rpb25CbG9jayAmJiAoaCA9IDEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLlNZTVRBQl9DT05TVFMuR0xPQkFMX0VYUExJQ0lUOgogICAgICAgICAgICBoID0gMQogICAgICAgIH0KICAgICAgICBrID0gYyhrKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGwgfHwgIl8iID09PSBhLnYuY2hhckF0KDEpKQogICAgICAgIGEgPSBrCiAgICAgICAgdGhpcy51LnN0ZS5nZW5lcmF0b3IgfHwKICAgICAgICB0aGlzLnUuc3RlLmJsb2NrVHlwZSAhPT0gU2suU1lNVEFCX0NPTlNUUy5GdW5jdGlvbkJsb2NrCiAgICAgICAgICA/IChrID0gIiRsb2MuIiArIGspCiAgICAgICAgICA6ICgwID09PSBoIHx8IDMgPT09IGgpICYmIHRoaXMudS5sb2NhbG5hbWVzLnB1c2goaykKICAgICAgICBzd2l0Y2ggKGgpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Mb2FkOgogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUGFyYW06CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBmKAogICAgICAgICAgICAgICAgICAgICJpZiAoIiwKICAgICAgICAgICAgICAgICAgICBrLAogICAgICAgICAgICAgICAgICAgICIgPT09IHVuZGVmaW5lZCkgeyB0aHJvdyBuZXcgU2suYnVpbHRpbi5VbmJvdW5kTG9jYWxFcnJvcignbG9jYWwgdmFyaWFibGUgXFwnIiwKICAgICAgICAgICAgICAgICAgICBrLAogICAgICAgICAgICAgICAgICAgICJcXCcgcmVmZXJlbmNlZCBiZWZvcmUgYXNzaWdubWVudCcpOyB9XG4iLAogICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICBrCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdG9yZToKICAgICAgICAgICAgICAgIGYoaywgIj0iLCBnLCAiOyIpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGVsOgogICAgICAgICAgICAgICAgZigiZGVsZXRlICIsIGssICI7IikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIikKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxvYWQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgICAgICJsb2FkbmFtZSIsCiAgICAgICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgICAgICIhPT11bmRlZmluZWQ/IiwKICAgICAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICAgICAgIjpTay5taXNjZXZhbC5sb2FkbmFtZSgnIiwKICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgIicsJGdibCk7IiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0b3JlOgogICAgICAgICAgICAgICAgZihrLCAiPSIsIGcsICI7IikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWw6CiAgICAgICAgICAgICAgICBmKCJkZWxldGUgIiwgaywgIjsiKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlBhcmFtOgogICAgICAgICAgICAgICAgcmV0dXJuIGsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTG9hZDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncigKICAgICAgICAgICAgICAgICAgImxvYWRnYmwiLAogICAgICAgICAgICAgICAgICAiU2subWlzY2V2YWwubG9hZG5hbWUoJyIsCiAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICInLCRnYmwpIiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0b3JlOgogICAgICAgICAgICAgICAgZigiJGdibC4iLCBhLCAiPSIsIGcsICI7IikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWw6CiAgICAgICAgICAgICAgICBmKCJkZWxldGUgJGdibC4iLCBhKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgY2FzZSBpbiBuYW1lIG9wX2dsb2JhbCIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Mb2FkOgogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAiLiIgKyBhCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdG9yZToKICAgICAgICAgICAgICAgIGYobSwgIi4iLCBhLCAiPSIsIGcsICI7IikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5QYXJhbToKICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIGNhc2UgaW4gbmFtZSBvcF9kZXJlZiIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIGNhc2UiKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5lbnRlclNjb3BlID0gZnVuY3Rpb24oYSwgYywgZCwgZSkgewogICAgICAgIHZhciBmID0gbmV3IGIoKQogICAgICAgIGYuc3RlID0gdGhpcy5zdC5nZXRTdHNGb3JBc3QoYykKICAgICAgICBmLm5hbWUgPSBhCiAgICAgICAgZi5maXJzdGxpbmVubyA9IGQKICAgICAgICBmLmNhblN1c3BlbmQgPSBlIHx8ICExCiAgICAgICAgdGhpcy51ICYmIHRoaXMudS5wcml2YXRlXyAmJiAoZi5wcml2YXRlXyA9IHRoaXMudS5wcml2YXRlXykKICAgICAgICB0aGlzLnN0YWNrLnB1c2godGhpcy51KQogICAgICAgIHRoaXMuYWxsVW5pdHMucHVzaChmKQogICAgICAgIGEgPSB0aGlzLmdlbnN5bSgic2NvcGUiKQogICAgICAgIGYuc2NvcGVuYW1lID0gYQogICAgICAgIHRoaXMudSA9IGYKICAgICAgICB0aGlzLnUuYWN0aXZhdGVTY29wZSgpCiAgICAgICAgdGhpcy5uZXN0bGV2ZWwrKwogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuZXhpdFNjb3BlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLnUKICAgICAgICB0aGlzLm5lc3RsZXZlbC0tCiAgICAgICAgOyh0aGlzLnUgPSAwIDw9IHRoaXMuc3RhY2subGVuZ3RoIC0gMSA/IHRoaXMuc3RhY2sucG9wKCkgOiBudWxsKSAmJgogICAgICAgICAgdGhpcy51LmFjdGl2YXRlU2NvcGUoKQogICAgICAgIGlmICgiPG1vZHVsZT4iICE9PSBhLm5hbWUudikgewogICAgICAgICAgdmFyIGIgPSBhLm5hbWUuJHIoKS52CiAgICAgICAgICBiID0gYi5zdWJzdHJpbmcoMSwgYi5sZW5ndGggLSAxKQogICAgICAgICAgYiA9IGMoYikKICAgICAgICAgIGIgPSBkKGIpCiAgICAgICAgICBmKGEuc2NvcGVuYW1lLCAiLmNvX25hbWU9bmV3IFNrLmJ1aWx0aW5zWydzdHInXSgnIiwgYiwgIicpOyIpCiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGUgaW4gYS5jb25zdHMpCiAgICAgICAgICBhLmNvbnN0cy5oYXNPd25Qcm9wZXJ0eShlKSAmJgogICAgICAgICAgICAoYS5zdWZmaXhDb2RlICs9IGUgKyAiID0gIiArIGEuY29uc3RzW2VdICsgIjsiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNib2R5ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGEubGVuZ3RoOyArK2MpIHRoaXMudnN0bXQoYVtjXSwgYikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jcHJpbnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuUHJpbnQpCiAgICAgICAgYS5kZXN0ICYmIHRoaXMudmV4cHIoYS5kZXN0KQogICAgICAgIHZhciBjID0gYS52YWx1ZXMubGVuZ3RoCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7ICsrYikKICAgICAgICAgIGYoCiAgICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwucHJpbnRfKCIsCiAgICAgICAgICAgICJuZXcgU2suYnVpbHRpbnNbJ3N0ciddKCIsCiAgICAgICAgICAgIHRoaXMudmV4cHIoYS52YWx1ZXNbYl0pLAogICAgICAgICAgICAiKS52KTsiLAogICAgICAgICAgKSwKICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgYS5ubCAmJgogICAgICAgICAgKGYoIiRyZXQgPSBTay5taXNjZXZhbC5wcmludF8oIiwgJyJcXG4iKTsnKSwgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNtb2QgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLmVudGVyU2NvcGUoCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cigiPG1vZHVsZT4iKSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgdGhpcy5jYW5TdXNwZW5kLAogICAgICAgICAgKSwKICAgICAgICAgIGMgPSB0aGlzLm5ld0Jsb2NrKCJtb2R1bGUgZW50cnkiKQogICAgICAgIHRoaXMudS5wcmVmaXhDb2RlID0gInZhciAiICsgYiArICI9KGZ1bmN0aW9uKCRmb3JjZWdibCl7IgogICAgICAgIHRoaXMudS52YXJEZWNsc0NvZGUgPQogICAgICAgICAgInZhciAkZ2JsID0gJGZvcmNlZ2JsIHx8IHt9LCAkYmxrPSIgKwogICAgICAgICAgYyArCiAgICAgICAgICAiLCRleGM9W10sJGxvYz0kZ2JsLCRjZWxsPXt9LCRlcnI9dW5kZWZpbmVkOyRsb2MuX19maWxlX189bmV3IFNrLmJ1aWx0aW5zLnN0cignIiArCiAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICInKTt2YXIgJHJldD11bmRlZmluZWQsJHBvc3RmaW5hbGx5PXVuZGVmaW5lZCwkY3VyckxpbmVObz11bmRlZmluZWQsJGN1cnJDb2xObz11bmRlZmluZWQ7IgogICAgICAgIG51bGwgIT09IFNrLmV4ZWNMaW1pdCAmJgogICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0KICAgICAgICAgICAgImlmICh0eXBlb2YgU2suZXhlY1N0YXJ0ID09PSAndW5kZWZpbmVkJykge1NrLmV4ZWNTdGFydCA9IERhdGUubm93KCl9IikKICAgICAgICBudWxsICE9PSBTay55aWVsZExpbWl0ICYmCiAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCAmJgogICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0KICAgICAgICAgICAgImlmICh0eXBlb2YgU2subGFzdFlpZWxkID09PSAndW5kZWZpbmVkJykge1NrLmxhc3RZaWVsZCA9IERhdGUubm93KCl9IikKICAgICAgICB0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAiaWYgKCIgKwogICAgICAgICAgYiArCiAgICAgICAgICAiLiR3YWtpbmdTdXNwZW5zaW9uIT09dW5kZWZpbmVkKSB7ICR3YWtlRnJvbVN1c3BlbnNpb24oKTsgfWlmIChTay5yZXRhaW5HbG9iYWxzKSB7ICAgIGlmIChTay5nbG9iYWxzKSB7ICRnYmwgPSBTay5nbG9iYWxzOyBTay5nbG9iYWxzID0gJGdibDsgJGxvYyA9ICRnYmw7IH0gICAgaWYgKFNrLmdsb2JhbHMpIHsgJGdibCA9IFNrLmdsb2JhbHM7IFNrLmdsb2JhbHMgPSAkZ2JsOyAkbG9jID0gJGdibDsgJGxvYy5fX2ZpbGVfXz1uZXcgU2suYnVpbHRpbnMuc3RyKCciICsKICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgIicpO30gICAgZWxzZSB7IFNrLmdsb2JhbHMgPSAkZ2JsOyB9fSBlbHNlIHsgU2suZ2xvYmFscyA9ICRnYmw7IH0iCiAgICAgICAgdGhpcy51LnN3aXRjaENvZGUgPSAid2hpbGUodHJ1ZSl7dHJ5eyIKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPSB0aGlzLm91dHB1dEludGVycnVwdFRlc3QoKQogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlICs9ICJzd2l0Y2goJGJsayl7IgogICAgICAgIHRoaXMudS5zdWZmaXhDb2RlID0gIn0iCiAgICAgICAgdGhpcy51LnN1ZmZpeENvZGUgKz0KICAgICAgICAgICJ9Y2F0Y2goZXJyKXsgaWYgKCEoZXJyIGluc3RhbmNlb2YgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uKSkgeyBlcnIgPSBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKGVycik7IH0gZXJyLnRyYWNlYmFjay5wdXNoKHtsaW5lbm86ICRjdXJyTGluZU5vLCBjb2xubzogJGN1cnJDb2xObywgZmlsZW5hbWU6ICciICsKICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgIid9KTsgaWYgKCRleGMubGVuZ3RoPjApIHsgJGVyciA9IGVycjsgJGJsaz0kZXhjLnBvcCgpOyBjb250aW51ZTsgfSBlbHNlIHsgdGhyb3cgZXJyOyB9fSB9IH0pOyIKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTW9kdWxlOgogICAgICAgICAgICB0aGlzLmNib2R5KGEuYm9keSkKICAgICAgICAgICAgZigicmV0dXJuICRsb2M7IikKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidG9kbzsgdW5oYW5kbGVkIGNhc2UgaW4gY29tcGlsZXJNb2QiKQogICAgICAgIH0KICAgICAgICB0aGlzLmV4aXRTY29wZSgpCiAgICAgICAgdGhpcy5yZXN1bHQucHVzaCh0aGlzLm91dHB1dEFsbFVuaXRzKCkpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5jb21waWxlID0gZnVuY3Rpb24oYiwgYywgZCwgZSkgewogICAgICAgIGQgPSBTay5fX2Z1dHVyZV9fCiAgICAgICAgU2suX19mdXR1cmVfXyA9IE9iamVjdC5jcmVhdGUoU2suX19mdXR1cmVfXykKICAgICAgICB2YXIgZiA9IFNrLnBhcnNlKGMsIGIpLAogICAgICAgICAgZyA9IFNrLmFzdEZyb21QYXJzZShmLmNzdCwgYywgZi5mbGFncykKICAgICAgICBmID0gZi5mbGFncwogICAgICAgIHZhciBoID0gU2suc3ltYm9sdGFibGUoZywgYykKICAgICAgICBiID0gbmV3IGEoYywgaCwgZiwgZSwgYikKICAgICAgICBjID0gYi5jbW9kKGcpCiAgICAgICAgU2suX19mdXR1cmVfXyA9IGQKICAgICAgICByZXR1cm4gewogICAgICAgICAgZnVuY25hbWU6ICIkY29tcGlsZWRtb2QiLAogICAgICAgICAgY29kZToKICAgICAgICAgICAgIiRjb21waWxlZG1vZCA9IGZ1bmN0aW9uKCkgeyIgKwogICAgICAgICAgICBiLnJlc3VsdC5qb2luKCIiKSArCiAgICAgICAgICAgICJcbnJldHVybiAiICsKICAgICAgICAgICAgYyArCiAgICAgICAgICAgICI7fSgpOyIsCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suY29tcGlsZSIsIFNrLmNvbXBpbGUpCiAgICAgIFNrLnJlc2V0Q29tcGlsZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBTay5nZW5zeW1jb3VudCA9IDAKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnJlc2V0Q29tcGlsZXIiLCBTay5yZXNldENvbXBpbGVyKQogICAgICBTay5maXhSZXNlcnZlZFdvcmRzID0gYwogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZpeFJlc2VydmVkV29yZHMiLCBTay5maXhSZXNlcnZlZFdvcmRzKQogICAgICBTay5maXhSZXNlcnZlZE5hbWVzID0gZAogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZpeFJlc2VydmVkTmFtZXMiLCBTay5maXhSZXNlcnZlZE5hbWVzKQogICAgICBTay51bmZpeFJlc2VydmVkID0gZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhLnJlcGxhY2UoL19cJHJbd25dXCQkLywgIiIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay51bmZpeFJlc2VydmVkIiwgU2sudW5maXhSZXNlcnZlZCkKICAgICAgU2subWFuZ2xlTmFtZSA9IGUKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5tYW5nbGVOYW1lIiwgU2subWFuZ2xlTmFtZSkKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLnN5c21vZHVsZXMgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICBTay5yZWFsc3lzcGF0aCA9IHZvaWQgMAogICAgICBTay5pbXBvcnRTZWFyY2hQYXRoRm9yTmFtZSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IGEucmVwbGFjZSgvXC4vZywgIi8iKSwKICAgICAgICAgIGUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgICBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gU2sucmVhZChhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHt9LAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYykKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5taXNjZXZhbC5CcmVhayh7CiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGEsCiAgICAgICAgICAgICAgICAgICAgY29kZTogYywKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlUGF0aDogYiwKICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gU2sucmVhbHN5c3BhdGgpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLml0ZXJGb3IoYy50cCRpdGVyKCksIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbihlKGEudiArICIvIiArIGQgKyBiLCAhMSksIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgcmV0dXJuIGMgPyBjIDogZShhLnYgKyAiLyIgKyBkICsgIi9fX2luaXRfXyIgKyBiLCBhLnYgKyAiLyIgKyBkKQogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9CiAgICAgIFNrLmRvT25lVGltZUluaXRpYWxpemF0aW9uID0gZnVuY3Rpb24oYSkgewogICAgICAgIHZhciBiCiAgICAgICAgU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXyA9IG5ldyBTay5idWlsdGluLnN0cigiX19iYXNlc19fIikKICAgICAgICBTay5idWlsdGluLnR5cGUubXJvU3RyXyA9IG5ldyBTay5idWlsdGluLnN0cigiX19tcm9fXyIpCiAgICAgICAgZm9yIChmIGluIFNrLmJ1aWx0aW4pCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgICgoYSA9IFNrLmJ1aWx0aW5bZl0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUgaW5zdGFuY2VvZiBTay5idWlsdGluLm9iamVjdCB8fAogICAgICAgICAgICAgIGEgPT09IFNrLmJ1aWx0aW4ub2JqZWN0KSAmJgogICAgICAgICAgICAgICFhLnNrJGFic3RyYWN0KQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHZhciBjID0gYQogICAgICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgICAgIGZvciAoYSA9IGMudHAkYmFzZTsgdm9pZCAwICE9PSBhOyBhID0gYS50cCRiYXNlKSBkLnB1c2goYSkKICAgICAgICAgICAgYy50cCRtcm8gPSBuZXcgU2suYnVpbHRpbi50dXBsZShbY10pCiAgICAgICAgICAgIGMudHAkYmFzZSB8fCAoYy50cCRiYXNlID0gZFswXSkKICAgICAgICAgICAgYy4kZCA9IG5ldyBTay5idWlsdGluLmRpY3QoW10pCiAgICAgICAgICAgIGMuJGQubXAkYXNzX3N1YnNjcmlwdCgKICAgICAgICAgICAgICBTay5idWlsdGluLnR5cGUuYmFzZXNTdHJfLAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnR1cGxlKGQpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGMuJGQubXAkYXNzX3N1YnNjcmlwdChTay5idWlsdGluLnR5cGUubXJvU3RyXywgYy50cCRtcm8pCiAgICAgICAgICB9CiAgICAgICAgZCA9IFsKICAgICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICAgICAgU2suYnVpbHRpbi50eXBlLAogICAgICAgICAgU2suYnVpbHRpbi5mdW5jLAogICAgICAgICAgU2suYnVpbHRpbi5tZXRob2QsCiAgICAgICAgXQogICAgICAgIGZvciAoYyA9IDA7IGMgPCBkLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICB2YXIgZSA9IGRbY10KICAgICAgICAgIHZhciBmID0gZS5wcm90b3R5cGUKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBlLnB5dGhvbkZ1bmN0aW9ucy5sZW5ndGg7IGIrKykgewogICAgICAgICAgICBhID0gZS5weXRob25GdW5jdGlvbnNbYl0KICAgICAgICAgICAgaWYgKGZbYV0gaW5zdGFuY2VvZiBTay5idWlsdGluLmZ1bmMpIGJyZWFrCiAgICAgICAgICAgIGZbYV0uY29fa3dhcmdzID0gbnVsbAogICAgICAgICAgICBmW2FdID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmW2FdKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBnIGluIFNrLmludGVybmFsUHkuZmlsZXMpCiAgICAgICAgICAoZiA9IGcuc3BsaXQoIi4iKVswXS5zcGxpdCgiLyIpWzFdKSwKICAgICAgICAgICAgKGEgPSBTay5pbXBvcnRCdWlsdGluV2l0aEJvZHkoZiwgITEsIFNrLmludGVybmFsUHkuZmlsZXNbZ10sICEwKSksCiAgICAgICAgICAgIChhID0gU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGEpKSwKICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAgICAgdm9pZCAwICE9PSBhLiRkW2ZdLAogICAgICAgICAgICAgICJTaG91bGQgaGF2ZSBpbXBvcnRlZCBuYW1lICIgKyBmLAogICAgICAgICAgICApLAogICAgICAgICAgICAoU2suYnVpbHRpbnNbZl0gPSBhLiRkW2ZdKQogICAgICB9CiAgICAgIFNrLmltcG9ydFNldFVwUGF0aCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICghU2sucmVhbHN5c3BhdGgpIHsKICAgICAgICAgIHZhciBjID0gWwogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoInNyYy9idWlsdGluIiksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cigic3JjL2xpYiIpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoIi4iKSwKICAgICAgICAgIF0KICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBTay5zeXNwYXRoLmxlbmd0aDsgKytiKQogICAgICAgICAgICBjLnB1c2gobmV3IFNrLmJ1aWx0aW4uc3RyKFNrLnN5c3BhdGhbYl0pKQogICAgICAgICAgU2sucmVhbHN5c3BhdGggPSBuZXcgU2suYnVpbHRpbi5saXN0KGMpCiAgICAgICAgICBTay5kb09uZVRpbWVJbml0aWFsaXphdGlvbihhKQogICAgICAgIH0KICAgICAgfQogICAgICBTay5pbXBvcnRNb2R1bGVJbnRlcm5hbF8gPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmLCBnKSB7CiAgICAgICAgdmFyIGgsCiAgICAgICAgICBrLAogICAgICAgICAgbCwKICAgICAgICAgIG0gPSBudWxsLAogICAgICAgICAgbiA9IHZvaWQgMCAhPT0gZSA/IGUudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kbmFtZSkgOiB2b2lkIDAsCiAgICAgICAgICBwID0gdm9pZCAwICE9PSBuID8gbi52ICsgIi4iIDogIiIsCiAgICAgICAgICBEID0gdm9pZCAwICE9PSBlID8gZS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRwYXRoKSA6IHZvaWQgMAogICAgICAgIFNrLmltcG9ydFNldFVwUGF0aChnKQogICAgICAgIGlmIChlICYmICFuKSB7CiAgICAgICAgICBpZiAoZikgcmV0dXJuCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAiQXR0ZW1wdGVkIHRvIGltcG9ydCByZWxhdGl2ZSB0byBpbnZhbGlkIHBhY2thZ2UgKG5vIG5hbWUpIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gcCArIGEpCiAgICAgICAgdmFyIHggPSBhLnNwbGl0KCIuIikKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIEggPSBTay5zeXNtb2R1bGVzLm1wJHN1YnNjcmlwdChjKQogICAgICAgICAgcmV0dXJuIDEgPCB4Lmxlbmd0aCA/IFNrLnN5c21vZHVsZXMubXAkc3Vic2NyaXB0KHAgKyB4WzBdKSA6IEgKICAgICAgICB9IGNhdGNoIChBKSB7fQogICAgICAgIGlmICgxIDwgeC5sZW5ndGgpIHsKICAgICAgICAgIHZhciBKID0geC5zbGljZSgwLCB4Lmxlbmd0aCAtIDEpLmpvaW4oIi4iKQogICAgICAgICAgbSA9IFNrLmltcG9ydE1vZHVsZUludGVybmFsXyhKLCBiLCB2b2lkIDAsIHZvaWQgMCwgZSwgZiwgZykKICAgICAgICB9CiAgICAgICAgSCA9IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgbSwKICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgdmFyIGMgPSBhCiAgICAgICAgICAgIG0gPSBiCiAgICAgICAgICAgIGlmICgxIDwgeC5sZW5ndGgpIHsKICAgICAgICAgICAgICBpZiAoIW0pIHJldHVybgogICAgICAgICAgICAgIGsgPSBTay5zeXNtb2R1bGVzLm1wJHN1YnNjcmlwdChwICsgSikKICAgICAgICAgICAgICBjID0geFt4Lmxlbmd0aCAtIDFdCiAgICAgICAgICAgICAgRCA9IGsudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcGF0aCkKICAgICAgICAgICAgfQogICAgICAgICAgICBsID0gbmV3IFNrLmJ1aWx0aW4ubW9kdWxlKCkKICAgICAgICAgICAgZAogICAgICAgICAgICAgID8gKChoID0gYSArICIucHkiKSwgKGIgPSBTay5jb21waWxlKGQsIGgsICJleGVjIiwgZykpKQogICAgICAgICAgICAgIDogKGIgPSBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICBTay5vbkJlZm9yZUltcG9ydCAmJgogICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLm9uQmVmb3JlSW1wb3J0CiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNrLm9uQmVmb3JlSW1wb3J0KGEpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoITEgPT09IGIpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbXBvcnRFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgIkltcG9ydGluZyAiICsgYSArICIgaXMgbm90IGFsbG93ZWQiLAogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbXBvcnRFcnJvcihiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBTay5pbXBvcnRTZWFyY2hQYXRoRm9yTmFtZShjLCAiLmpzIiwgRCkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgICA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jbmFtZTogIiRidWlsdGlubW9kdWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBhLmNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGEuZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZVBhdGg6IGEucGFja2FnZVBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIDogU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgU2suaW1wb3J0U2VhcmNoUGF0aEZvck5hbWUoYywgIi5weSIsIEQpLAogICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoYSA9IGIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2suY29tcGlsZShhLmNvZGUsIGEuZmlsZW5hbWUsICJleGVjIiwgZykKICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSByZXR1cm4gKGIucGFja2FnZVBhdGggPSBhLnBhY2thZ2VQYXRoKSwgYgogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgIFNrLnN5c21vZHVsZXMubXAkYXNzX3N1YnNjcmlwdChjLCBsKQogICAgICAgICAgICAgIHZhciBkID0gKGwuJGpzID0gYS5jb2RlKQogICAgICAgICAgICAgIG51bGwgPT0gaCAmJiAoaCA9IGEuZmlsZW5hbWUpCiAgICAgICAgICAgICAgOyhudWxsICE9IFNrLmRhdGVTZXQgJiYgU2suZGF0ZVNldCkgfHwKICAgICAgICAgICAgICAgICgoZCA9ICJTay5leGVjU3RhcnQgPSBTay5sYXN0WWllbGQgPSBuZXcgRGF0ZSgpO1xuIiArIGEuY29kZSksCiAgICAgICAgICAgICAgICAoU2suZGF0ZVNldCA9ICEwKSkKICAgICAgICAgICAgICBpZiAoYikgewogICAgICAgICAgICAgICAgdmFyIGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgIHZhciBiLAogICAgICAgICAgICAgICAgICAgIGMgPSBTay5qc19iZWF1dGlmeShhKS5zcGxpdCgiXG4iKQogICAgICAgICAgICAgICAgICBmb3IgKGIgPSAxOyBiIDw9IGMubGVuZ3RoOyArK2IpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9ICgiIiArIGIpLmxlbmd0aAogICAgICAgICAgICAgICAgICAgIGZvciAoYSA9ICIiOyA1ID4gZDsgKytkKSBhICs9ICIgIgogICAgICAgICAgICAgICAgICAgIGNbYiAtIDFdID0gIi8qICIgKyBhICsgYiArICIgKi8gIiArIGNbYiAtIDFdCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuam9pbigiXG4iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZCA9IGUoZCkKICAgICAgICAgICAgICAgIFNrLmRlYnVnb3V0KGQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGQgKz0gIlxuIiArIGEuZnVuY25hbWUgKyAiOyIKICAgICAgICAgICAgICBkID0gU2suZ2xvYmFsLmV2YWwoZCkKICAgICAgICAgICAgICBsLiRkID0gewogICAgICAgICAgICAgICAgX19uYW1lX186IG5ldyBTay5idWlsdGluLnN0cihjKSwKICAgICAgICAgICAgICAgIF9fZG9jX186IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICAgICAgICAgIF9fcGFja2FnZV9fOiBhLnBhY2thZ2VQYXRoCiAgICAgICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKGMpCiAgICAgICAgICAgICAgICAgIDogSgogICAgICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnN0cihwICsgSikKICAgICAgICAgICAgICAgICAgOiBuCiAgICAgICAgICAgICAgICAgID8gbgogICAgICAgICAgICAgICAgICA6IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYS5wYWNrYWdlUGF0aCAmJgogICAgICAgICAgICAgICAgKGwuJGQuX19wYXRoX18gPSBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cihhLnBhY2thZ2VQYXRoKSwKICAgICAgICAgICAgICAgIF0pKQogICAgICAgICAgICAgIHJldHVybiBkKGwuJGQpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgIHZhciBjCiAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIpIHsKICAgICAgICAgICAgICBpZiAoZiAmJiAhbSkgcmV0dXJuCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSW1wb3J0RXJyb3IoIk5vIG1vZHVsZSBuYW1lZCAiICsgYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYiAhPT0gbC4kZCkgewogICAgICAgICAgICAgIGZvciAoYyBpbiBsLiRkKSBiW2NdIHx8IChiW2NdID0gbC4kZFtjXSkKICAgICAgICAgICAgICBsLiRkID0gYgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChTay5vbkFmdGVySW1wb3J0ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5vbkFmdGVySW1wb3J0KQogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBTay5vbkFmdGVySW1wb3J0KGEpCiAgICAgICAgICAgICAgfSBjYXRjaCAoSykge30KICAgICAgICAgICAgaWYgKG0pCiAgICAgICAgICAgICAgcmV0dXJuIGsudHAkc2V0YXR0cihuZXcgU2suYnVpbHRpbi5zdHIoeFt4Lmxlbmd0aCAtIDFdKSwgbCksIG0KICAgICAgICAgICAgZSAmJiBlLnRwJHNldGF0dHIobmV3IFNrLmJ1aWx0aW4uc3RyKGEpLCBsKQogICAgICAgICAgICByZXR1cm4gbAogICAgICAgICAgfSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGcgPyBIIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KEgpCiAgICAgIH0KICAgICAgU2suaW1wb3J0TW9kdWxlID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIHJldHVybiBTay5pbXBvcnRNb2R1bGVJbnRlcm5hbF8oYSwgYiwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgITEsIGMpCiAgICAgIH0KICAgICAgU2suaW1wb3J0TWFpbiA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBTay5kYXRlU2V0ID0gITEKICAgICAgICBTay5maWxlc0xvYWRlZCA9ICExCiAgICAgICAgU2suc3lzbW9kdWxlcyA9IG5ldyBTay5idWlsdGluLmRpY3QoW10pCiAgICAgICAgU2sucmVhbHN5c3BhdGggPSB2b2lkIDAKICAgICAgICBTay5yZXNldENvbXBpbGVyKCkKICAgICAgICByZXR1cm4gU2suaW1wb3J0TW9kdWxlSW50ZXJuYWxfKGEsIGIsICJfX21haW5fXyIsIHZvaWQgMCwgdm9pZCAwLCAhMSwgYykKICAgICAgfQogICAgICBTay5pbXBvcnRNYWluV2l0aEJvZHkgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suZGF0ZVNldCA9ICExCiAgICAgICAgU2suZmlsZXNMb2FkZWQgPSAhMQogICAgICAgIFNrLnN5c21vZHVsZXMgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgIFNrLnJlYWxzeXNwYXRoID0gdm9pZCAwCiAgICAgICAgU2sucmVzZXRDb21waWxlcigpCiAgICAgICAgcmV0dXJuIFNrLmltcG9ydE1vZHVsZUludGVybmFsXyhhLCBiLCAiX19tYWluX18iLCBjLCB2b2lkIDAsICExLCBkKQogICAgICB9CiAgICAgIFNrLmltcG9ydEJ1aWx0aW5XaXRoQm9keSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICByZXR1cm4gU2suaW1wb3J0TW9kdWxlSW50ZXJuYWxfKAogICAgICAgICAgYSwKICAgICAgICAgIGIsCiAgICAgICAgICAiX19idWlsdGluX18uIiArIGEsCiAgICAgICAgICBjLAogICAgICAgICAgdm9pZCAwLAogICAgICAgICAgITEsCiAgICAgICAgICBkLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLl9faW1wb3J0X18gPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGYgPSBTay5nbG9iYWxzLAogICAgICAgICAgZwogICAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFNrLl9fZnV0dXJlX18uYWJzb2x1dGVfaW1wb3J0ID8gMCA6IC0xKQogICAgICAgIGlmICgKICAgICAgICAgIDAgIT09IGUgJiYKICAgICAgICAgIGIuX19wYWNrYWdlX18gJiYKICAgICAgICAgIGIuX19wYWNrYWdlX18gIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgICkgewogICAgICAgICAgaWYgKChnID0gYi5fX3BhY2thZ2VfXy52KSAmJiAwIDwgZSkgewogICAgICAgICAgICBiID0gZy5zcGxpdCgiLiIpCiAgICAgICAgICAgIGlmIChlIC0gMSA+PSBiLmxlbmd0aCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgIkF0dGVtcHRlZCByZWxhdGl2ZSBpbXBvcnQgYmV5b25kIHRvcGxldmVsIHBhY2thZ2UiLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgYi5sZW5ndGggLT0gZSAtIDEKICAgICAgICAgICAgZyA9IGIuam9pbigiLiIpCiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgaCA9IFNrLnN5c21vZHVsZXMubXAkc3Vic2NyaXB0KGcpCiAgICAgICAgICB9IGNhdGNoIChrKSB7CiAgICAgICAgICAgIGcgPSB2b2lkIDAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKDAgPCBlICYmIHZvaWQgMCA9PT0gaCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICJBdHRlbXB0ZWQgcmVsYXRpdmUgaW1wb3J0IGluIG5vbi1wYWNrYWdlIiwKICAgICAgICAgICkKICAgICAgICBhLnNwbGl0KCIuIikKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKDAgIT09IGUgJiYgdm9pZCAwICE9PSBoKQogICAgICAgICAgICAgIHJldHVybiAiIiA9PT0gYQogICAgICAgICAgICAgICAgPyBoCiAgICAgICAgICAgICAgICA6IFNrLmltcG9ydE1vZHVsZUludGVybmFsXygKICAgICAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICBnICsgIi4iICsgYSwKICAgICAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICAgICAgICAtMSA9PSBlLAogICAgICAgICAgICAgICAgICAgICEwLAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24oYikgewogICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBiCiAgICAgICAgICAgICAgPyAoKGcgPSBoID0gdm9pZCAwKSwKICAgICAgICAgICAgICAgIFNrLmltcG9ydE1vZHVsZUludGVybmFsXygKICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICAhMSwKICAgICAgICAgICAgICAgICAgITAsCiAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgIDogYgogICAgICAgICAgfSwKICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgaWYgKGQgJiYgMCAhPT0gZC5sZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgYwogICAgICAgICAgICAgIHZhciBlID0gU2suc3lzbW9kdWxlcy5tcCRzdWJzY3JpcHQoCiAgICAgICAgICAgICAgICAoZyB8fCAiIikgKyAoZyAmJiBhID8gIi4iIDogIiIpICsgYSwKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGQubGVuZ3RoOyBiKyspIHsKICAgICAgICAgICAgICAgIHZhciBmID0gZFtiXQogICAgICAgICAgICAgICAgIioiICE9IGYgJiYKICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBlLnRwJGdldGF0dHIobmV3IFNrLmJ1aWx0aW4uc3RyKGYpKSAmJgogICAgICAgICAgICAgICAgICAoYyA9IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgICAgICAgU2suaW1wb3J0TW9kdWxlSW50ZXJuYWxfLmJpbmQoCiAgICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAgICAgICAhMCwKICAgICAgICAgICAgICAgICAgICAgICEwLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbihjLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGUpCiAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgIH0sCiAgICAgICAgICBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGYgIT09IFNrLmdsb2JhbHMgJiYgKFNrLmdsb2JhbHMgPSBmKQogICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgfSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suaW1wb3J0U3RhciA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICBpZiAoKGMgPSBhLnRwJGdldGF0dHIobmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2FsbF9fIikpKSkKICAgICAgICAgIGZvciAoCiAgICAgICAgICAgIGxldCBkID0gU2suYWJzdHIuaXRlcihjKSwgZSA9IGQudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgdm9pZCAwICE9PSBlOwogICAgICAgICAgICBlID0gZC50cCRpdGVybmV4dCgpCiAgICAgICAgICApCiAgICAgICAgICAgIGJbZS52XSA9IFNrLmFic3RyLmdhdHRyKGEsIGUpCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBjID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYS4kZCkKICAgICAgICAgIGZvciAobGV0IGQgaW4gYykgIl8iICE9IGNbZF0uY2hhckF0KDApICYmIChiW2NbZF1dID0gYS4kZFtjW2RdXSkKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5pbXBvcnRNYWluIiwgU2suaW1wb3J0TWFpbikKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5pbXBvcnRNYWluV2l0aEJvZHkiLCBTay5pbXBvcnRNYWluV2l0aEJvZHkpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suaW1wb3J0QnVpbHRpbldpdGhCb2R5IiwgU2suaW1wb3J0QnVpbHRpbldpdGhCb2R5KQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uX19pbXBvcnRfXyIsIFNrLmJ1aWx0aW4uX19pbXBvcnRfXykKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5pbXBvcnRTdGFyIiwgU2suaW1wb3J0U3RhcikKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB0aGlzLmxpc3QgPSBuZXcgU2suYnVpbHRpbi5saXN0KGEudikKICAgICAgICB0aGlzLk1JTl9HQUxMT1AgPSA3CiAgICAgICAgdGhpcy5saXN0bGVuZ3RoID0gYiA/IGIgOiBhLnNxJGxlbmd0aCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5sdCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGEsIGIsICJMdCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5sZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gIXRoaXMubHQoYiwgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLnNldGl0ZW0gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdGhpcy5saXN0LnZbYV0gPSBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5iaW5hcnlfc29ydCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGZvciAoYyA9IGEuYmFzZSArIGI7IGMgPCBhLmJhc2UgKyBhLmxlbjsgYysrKSB7CiAgICAgICAgICB2YXIgZCA9IGEuYmFzZQogICAgICAgICAgdmFyIGUgPSBjCiAgICAgICAgICBmb3IgKGIgPSBhLmdldGl0ZW0oZSk7IGQgPCBlOyApIHsKICAgICAgICAgICAgdmFyIGYgPSBkICsgKChlIC0gZCkgPj4gMSkKICAgICAgICAgICAgdGhpcy5sdChiLCBhLmdldGl0ZW0oZikpID8gKGUgPSBmKSA6IChkID0gZiArIDEpCiAgICAgICAgICB9CiAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChkID09PSBlKQogICAgICAgICAgZm9yIChmID0gYzsgZiA+IGQ7IGYtLSkgYS5zZXRpdGVtKGYsIGEuZ2V0aXRlbShmIC0gMSkpCiAgICAgICAgICBhLnNldGl0ZW0oZCwgYikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5jb3VudF9ydW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMSA+PSBhLmxlbikgewogICAgICAgICAgdmFyIGMgPSBhLmxlbgogICAgICAgICAgdmFyIGQgPSAhMQogICAgICAgIH0gZWxzZSBpZiAoKChjID0gMiksIHRoaXMubHQoYS5nZXRpdGVtKGEuYmFzZSArIDEpLCBhLmdldGl0ZW0oYS5iYXNlKSkpKQogICAgICAgICAgZm9yIChkID0gITAsIGIgPSBhLmJhc2UgKyAyOyBiIDwgYS5iYXNlICsgYS5sZW47IGIrKykKICAgICAgICAgICAgaWYgKHRoaXMubHQoYS5nZXRpdGVtKGIpLCBhLmdldGl0ZW0oYiAtIDEpKSkgYysrCiAgICAgICAgICAgIGVsc2UgYnJlYWsKICAgICAgICBlbHNlCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBkID0gITEsIGIgPSBhLmJhc2UgKyAyOwogICAgICAgICAgICBiIDwgYS5iYXNlICsgYS5sZW4gJiYgIXRoaXMubHQoYS5nZXRpdGVtKGIpLCBhLmdldGl0ZW0oYiAtIDEpKTsKICAgICAgICAgICAgYisrCiAgICAgICAgICApCiAgICAgICAgICAgIGMrKwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBydW46IG5ldyBTay5idWlsdGluLmxpc3RTbGljZShhLmxpc3QsIGEuYmFzZSwgYyksCiAgICAgICAgICBkZXNjZW5kaW5nOiBkLAogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGIgPSBuZXcgU2suYnVpbHRpbi5saXN0U2xpY2UodGhpcy5saXN0LCAwLCB0aGlzLmxpc3RsZW5ndGgpCiAgICAgICAgaWYgKCEoMiA+IGIubGVuKSkgewogICAgICAgICAgdGhpcy5tZXJnZV9pbml0KCkKICAgICAgICAgIGZvciAoYSA9IHRoaXMubWVyZ2VfY29tcHV0ZV9taW5ydW4oYi5sZW4pOyAwIDwgYi5sZW47ICkgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuY291bnRfcnVuKGIpCiAgICAgICAgICAgIGMuZGVzY2VuZGluZyAmJiBjLnJ1bi5yZXZlcnNlKCkKICAgICAgICAgICAgaWYgKGMucnVuLmxlbiA8IGEpIHsKICAgICAgICAgICAgICB2YXIgZCA9IGMucnVuLmxlbgogICAgICAgICAgICAgIGMucnVuLmxlbiA9IGEgPCBiLmxlbiA/IGEgOiBiLmxlbgogICAgICAgICAgICAgIHRoaXMuYmluYXJ5X3NvcnQoYy5ydW4sIGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYi5hZHZhbmNlKGMucnVuLmxlbikKICAgICAgICAgICAgdGhpcy5wZW5kaW5nLnB1c2goYy5ydW4pCiAgICAgICAgICAgIHRoaXMubWVyZ2VfY29sbGFwc2UoKQogICAgICAgICAgfQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYi5iYXNlID09IHRoaXMubGlzdGxlbmd0aCkKICAgICAgICAgIHRoaXMubWVyZ2VfZm9yY2VfY29sbGFwc2UoKQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMSA9PSB0aGlzLnBlbmRpbmcubGVuZ3RoKQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA9PT0gdGhpcy5wZW5kaW5nWzBdLmJhc2UpCiAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh0aGlzLnBlbmRpbmdbMF0ubGVuID09IHRoaXMubGlzdGxlbmd0aCkKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5nYWxsb3AgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgdmFyIGUKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGMgJiYgYyA8IGIubGVuKQogICAgICAgIHZhciBmID0gdGhpcwogICAgICAgIGQgPSBkCiAgICAgICAgICA/IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gZi5sZShhLCBiKQogICAgICAgICAgICB9CiAgICAgICAgICA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gZi5sdChhLCBiKQogICAgICAgICAgICB9CiAgICAgICAgdmFyIGcgPSBiLmJhc2UgKyBjCiAgICAgICAgdmFyIGggPSAwCiAgICAgICAgdmFyIGsgPSAxCiAgICAgICAgaWYgKGQoYi5nZXRpdGVtKGcpLCBhKSkgewogICAgICAgICAgZm9yIChlID0gYi5sZW4gLSBjOyBrIDwgZTsgKQogICAgICAgICAgICBpZiAoZChiLmdldGl0ZW0oZyArIGspLCBhKSkgewogICAgICAgICAgICAgIGggPSBrCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGsgPSAoayA8PCAxKSArIDEKICAgICAgICAgICAgICB9IGNhdGNoIChsKSB7CiAgICAgICAgICAgICAgICBrID0gZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGJyZWFrCiAgICAgICAgICBrID4gZSAmJiAoayA9IGUpCiAgICAgICAgICBoICs9IGMKICAgICAgICAgIGsgKz0gYwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGUgPSBjICsgMTsgayA8IGUgJiYgIWQoYi5nZXRpdGVtKGcgLSBrKSwgYSk7ICkgewogICAgICAgICAgICBoID0gawogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGsgPSAoayA8PCAxKSArIDEKICAgICAgICAgICAgfSBjYXRjaCAobCkgewogICAgICAgICAgICAgIGsgPSBlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGsgPiBlICYmIChrID0gZSkKICAgICAgICAgIGcgPSBjIC0gaAogICAgICAgICAgaCA9IGMgLSBrCiAgICAgICAgICBrID0gZwogICAgICAgIH0KICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgtMSA8PSBoIDwgayA8PSBiLmxlbikKICAgICAgICBmb3IgKGggKz0gMTsgaCA8IGs7ICkKICAgICAgICAgIChjID0gaCArICgoayAtIGgpID4+IDEpKSwKICAgICAgICAgICAgZChiLmdldGl0ZW0oYi5iYXNlICsgYyksIGEpID8gKGggPSBjICsgMSkgOiAoayA9IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoaCA9PSBrKQogICAgICAgIHJldHVybiBrCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5tZXJnZV9pbml0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5taW5fZ2FsbG9wID0gdGhpcy5NSU5fR0FMTE9QCiAgICAgICAgdGhpcy5wZW5kaW5nID0gW10KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2xvID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLCBkLCBlCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8IGEubGVuICYmIDAgPCBiLmxlbiAmJiBhLmJhc2UgKyBhLmxlbiA9PSBiLmJhc2UpCiAgICAgICAgdmFyIGYgPSB0aGlzLm1pbl9nYWxsb3AKICAgICAgICB2YXIgZyA9IGEuYmFzZQogICAgICAgIGEgPSBhLmNvcHlpdGVtcygpCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICgodGhpcy5zZXRpdGVtKGcsIGIucG9wbGVmdCgpKSwgZysrLCAxICE9IGEubGVuICYmIDAgIT09IGIubGVuKSkKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGZvciAoZCA9IGMgPSAwOyA7ICkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmx0KGIuZ2V0aXRlbShiLmJhc2UpLCBhLmdldGl0ZW0oYS5iYXNlKSkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGIucG9wbGVmdCgpKQogICAgICAgICAgICAgICAgICBnKysKICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IGIubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgICAgZCsrCiAgICAgICAgICAgICAgICAgIGMgPSAwCiAgICAgICAgICAgICAgICAgIGlmIChkID49IGYpIGJyZWFrCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYS5wb3BsZWZ0KCkpCiAgICAgICAgICAgICAgICAgIGcrKwogICAgICAgICAgICAgICAgICBpZiAoMSA9PSBhLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICAgIGMrKwogICAgICAgICAgICAgICAgICBkID0gMAogICAgICAgICAgICAgICAgICBpZiAoYyA+PSBmKSBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAoZiArPSAxOyA7ICkgewogICAgICAgICAgICAgICAgdGhpcy5taW5fZ2FsbG9wID0gZiAtPSAxIDwgZgogICAgICAgICAgICAgICAgYyA9IHRoaXMuZ2FsbG9wKGIuZ2V0aXRlbShiLmJhc2UpLCBhLCAwLCAhMCkKICAgICAgICAgICAgICAgIGZvciAoZSA9IGEuYmFzZTsgZSA8IGEuYmFzZSArIGM7IGUrKykKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGEuZ2V0aXRlbShlKSksIGcrKwogICAgICAgICAgICAgICAgYS5hZHZhbmNlKGMpCiAgICAgICAgICAgICAgICBpZiAoMSA+PSBhLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYi5wb3BsZWZ0KCkpCiAgICAgICAgICAgICAgICBnKysKICAgICAgICAgICAgICAgIGlmICgwID09PSBiLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICBkID0gdGhpcy5nYWxsb3AoYS5nZXRpdGVtKGEuYmFzZSksIGIsIDAsICExKQogICAgICAgICAgICAgICAgZm9yIChlID0gYi5iYXNlOyBlIDwgYi5iYXNlICsgZDsgZSsrKQogICAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYi5nZXRpdGVtKGUpKSwgZysrCiAgICAgICAgICAgICAgICBiLmFkdmFuY2UoZCkKICAgICAgICAgICAgICAgIGlmICgwID09PSBiLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYS5wb3BsZWZ0KCkpCiAgICAgICAgICAgICAgICBnKysKICAgICAgICAgICAgICAgIGlmICgxID09IGEubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgIGlmIChjIDwgdGhpcy5NSU5fR0FMTE9QICYmIGQgPCB0aGlzLk1JTl9HQUxMT1ApIGJyZWFrCiAgICAgICAgICAgICAgICBmKysKICAgICAgICAgICAgICAgIHRoaXMubWluX2dhbGxvcCA9IGYKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8PSBhLmxlbiAmJiAwIDw9IGIubGVuKQogICAgICAgICAgZm9yIChlID0gYi5iYXNlOyBlIDwgYi5iYXNlICsgYi5sZW47IGUrKykKICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGIuZ2V0aXRlbShlKSksIGcrKwogICAgICAgICAgZm9yIChlID0gYS5iYXNlOyBlIDwgYS5iYXNlICsgYS5sZW47IGUrKykKICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGEuZ2V0aXRlbShlKSksIGcrKwogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2hpID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjLCBkLCBlCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8IGEubGVuICYmIDAgPCBiLmxlbiAmJiBhLmJhc2UgKyBhLmxlbiA9PSBiLmJhc2UpCiAgICAgICAgdmFyIGYgPSB0aGlzLm1pbl9nYWxsb3AKICAgICAgICB2YXIgZyA9IGIuYmFzZSArIGIubGVuCiAgICAgICAgYiA9IGIuY29weWl0ZW1zKCkKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKChnLS0sIHRoaXMuc2V0aXRlbShnLCBhLnBvcHJpZ2h0KCkpLCAwICE9PSBhLmxlbiAmJiAxICE9IGIubGVuKSkKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGZvciAoZCA9IGMgPSAwOyA7ICkgewogICAgICAgICAgICAgICAgdmFyIGggPSBhLmdldGl0ZW0oYS5iYXNlICsgYS5sZW4gLSAxKQogICAgICAgICAgICAgICAgdmFyIGsgPSBiLmdldGl0ZW0oYi5iYXNlICsgYi5sZW4gLSAxKQogICAgICAgICAgICAgICAgaWYgKHRoaXMubHQoaywgaCkpIHsKICAgICAgICAgICAgICAgICAgZy0tCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0aXRlbShnLCBoKQogICAgICAgICAgICAgICAgICBhLmxlbi0tCiAgICAgICAgICAgICAgICAgIGlmICgwID09PSBhLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICAgIGMrKwogICAgICAgICAgICAgICAgICBkID0gMAogICAgICAgICAgICAgICAgICBpZiAoYyA+PSBmKSBicmVhawogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZy0tCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0aXRlbShnLCBrKQogICAgICAgICAgICAgICAgICBiLmxlbi0tCiAgICAgICAgICAgICAgICAgIGlmICgxID09IGIubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgICAgZCsrCiAgICAgICAgICAgICAgICAgIGMgPSAwCiAgICAgICAgICAgICAgICAgIGlmIChkID49IGYpIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAoZiArPSAxOyA7ICkgewogICAgICAgICAgICAgICAgdGhpcy5taW5fZ2FsbG9wID0gZiAtPSAxIDwgZgogICAgICAgICAgICAgICAgayA9IGIuZ2V0aXRlbShiLmJhc2UgKyBiLmxlbiAtIDEpCiAgICAgICAgICAgICAgICB2YXIgbCA9IHRoaXMuZ2FsbG9wKGssIGEsIGEubGVuIC0gMSwgITApCiAgICAgICAgICAgICAgICBjID0gYS5sZW4gLSBsCiAgICAgICAgICAgICAgICBmb3IgKGUgPSBhLmJhc2UgKyBhLmxlbiAtIDE7IGUgPiBhLmJhc2UgKyBsIC0gMTsgZS0tKQogICAgICAgICAgICAgICAgICBnLS0sIHRoaXMuc2V0aXRlbShnLCBhLmdldGl0ZW0oZSkpCiAgICAgICAgICAgICAgICBhLmxlbiAtPSBjCiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYS5sZW4pIHJldHVybgogICAgICAgICAgICAgICAgZy0tCiAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYi5wb3ByaWdodCgpKQogICAgICAgICAgICAgICAgaWYgKDEgPT0gYi5sZW4pIHJldHVybgogICAgICAgICAgICAgICAgaCA9IGEuZ2V0aXRlbShhLmJhc2UgKyBhLmxlbiAtIDEpCiAgICAgICAgICAgICAgICBsID0gdGhpcy5nYWxsb3AoaCwgYiwgYi5sZW4gLSAxLCAhMSkKICAgICAgICAgICAgICAgIGQgPSBiLmxlbiAtIGwKICAgICAgICAgICAgICAgIGZvciAoZSA9IGIuYmFzZSArIGIubGVuIC0gMTsgZSA+IGIuYmFzZSArIGwgLSAxOyBlLS0pCiAgICAgICAgICAgICAgICAgIGctLSwgdGhpcy5zZXRpdGVtKGcsIGIuZ2V0aXRlbShlKSkKICAgICAgICAgICAgICAgIGIubGVuIC09IGQKICAgICAgICAgICAgICAgIGlmICgxID49IGIubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgIGctLQogICAgICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGEucG9wcmlnaHQoKSkKICAgICAgICAgICAgICAgIGlmICgwID09PSBhLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICBpZiAoYyA8IHRoaXMuTUlOX0dBTExPUCAmJiBkIDwgdGhpcy5NSU5fR0FMTE9QKSBicmVhawogICAgICAgICAgICAgICAgZisrCiAgICAgICAgICAgICAgICB0aGlzLm1pbl9nYWxsb3AgPSBmCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPD0gYS5sZW4gJiYgMCA8PSBiLmxlbikKICAgICAgICAgIGZvciAoZSA9IGEuYmFzZSArIGEubGVuIC0gMTsgZSA+IGEuYmFzZSAtIDE7IGUtLSkKICAgICAgICAgICAgZy0tLCB0aGlzLnNldGl0ZW0oZywgYS5nZXRpdGVtKGUpKQogICAgICAgICAgZm9yIChlID0gYi5iYXNlICsgYi5sZW4gLSAxOyBlID4gYi5iYXNlIC0gMTsgZS0tKQogICAgICAgICAgICBnLS0sIHRoaXMuc2V0aXRlbShnLCBiLmdldGl0ZW0oZSkpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUubWVyZ2VfYXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgMCA+IGEgJiYgKGEgPSB0aGlzLnBlbmRpbmcubGVuZ3RoICsgYSkKICAgICAgICB2YXIgYiA9IHRoaXMucGVuZGluZ1thXQogICAgICAgIHZhciBjID0gdGhpcy5wZW5kaW5nW2EgKyAxXQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPCBiLmxlbiAmJiAwIDwgYy5sZW4pCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYi5iYXNlICsgYi5sZW4gPT0gYy5iYXNlKQogICAgICAgIHRoaXMucGVuZGluZ1thXSA9IG5ldyBTay5idWlsdGluLmxpc3RTbGljZSgKICAgICAgICAgIHRoaXMubGlzdCwKICAgICAgICAgIGIuYmFzZSwKICAgICAgICAgIGIubGVuICsgYy5sZW4sCiAgICAgICAgKQogICAgICAgIHRoaXMucGVuZGluZy5zcGxpY2UoYSArIDEsIDEpCiAgICAgICAgYSA9IHRoaXMuZ2FsbG9wKGMuZ2V0aXRlbShjLmJhc2UpLCBiLCAwLCAhMCkKICAgICAgICBiLmFkdmFuY2UoYSkKICAgICAgICAwICE9PSBiLmxlbiAmJgogICAgICAgICAgKChjLmxlbiA9IHRoaXMuZ2FsbG9wKAogICAgICAgICAgICBiLmdldGl0ZW0oYi5iYXNlICsgYi5sZW4gLSAxKSwKICAgICAgICAgICAgYywKICAgICAgICAgICAgYy5sZW4gLSAxLAogICAgICAgICAgICAhMSwKICAgICAgICAgICkpLAogICAgICAgICAgMCAhPT0gYy5sZW4gJiYKICAgICAgICAgICAgKGIubGVuIDw9IGMubGVuID8gdGhpcy5tZXJnZV9sbyhiLCBjKSA6IHRoaXMubWVyZ2VfaGkoYiwgYykpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUubWVyZ2VfY29sbGFwc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5wZW5kaW5nOyAxIDwgYS5sZW5ndGg7ICkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgMyA8PSBhLmxlbmd0aCAmJgogICAgICAgICAgICBhW2EubGVuZ3RoIC0gM10ubGVuIDw9IGFbYS5sZW5ndGggLSAyXS5sZW4gKyBhW2EubGVuZ3RoIC0gMV0ubGVuCiAgICAgICAgICApCiAgICAgICAgICAgIGFbYS5sZW5ndGggLSAzXS5sZW4gPCBhW2EubGVuZ3RoIC0gMV0ubGVuCiAgICAgICAgICAgICAgPyB0aGlzLm1lcmdlX2F0KC0zKQogICAgICAgICAgICAgIDogdGhpcy5tZXJnZV9hdCgtMikKICAgICAgICAgIGVsc2UgaWYgKGFbYS5sZW5ndGggLSAyXS5sZW4gPD0gYVthLmxlbmd0aCAtIDFdLmxlbikgdGhpcy5tZXJnZV9hdCgtMikKICAgICAgICAgIGVsc2UgYnJlYWsKICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2ZvcmNlX2NvbGxhcHNlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgYSA9IHRoaXMucGVuZGluZzsgMSA8IGEubGVuZ3RoOyApCiAgICAgICAgICAzIDw9IGEubGVuZ3RoICYmIGFbYS5sZW5ndGggLSAzXS5sZW4gPCBhW2EubGVuZ3RoIC0gMV0ubGVuCiAgICAgICAgICAgID8gdGhpcy5tZXJnZV9hdCgtMykKICAgICAgICAgICAgOiB0aGlzLm1lcmdlX2F0KC0yKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUubWVyZ2VfY29tcHV0ZV9taW5ydW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgZm9yICh2YXIgYiA9IDA7IDY0IDw9IGE7ICkgKGIgfD0gYSAmIDEpLCAoYSA+Pj0gMSkKICAgICAgICByZXR1cm4gYSArIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZSA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICB0aGlzLmxpc3QgPSBhCiAgICAgICAgdGhpcy5iYXNlID0gYgogICAgICAgIHRoaXMubGVuID0gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdFNsaWNlLnByb3RvdHlwZS5jb3B5aXRlbXMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuYmFzZSwKICAgICAgICAgIGIgPSB0aGlzLmJhc2UgKyB0aGlzLmxlbgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPD0gYSA8PSBiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0U2xpY2UoCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5saXN0KHRoaXMubGlzdC52LnNsaWNlKGEsIGIpKSwKICAgICAgICAgIDAsCiAgICAgICAgICB0aGlzLmxlbiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0U2xpY2UucHJvdG90eXBlLmFkdmFuY2UgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdGhpcy5iYXNlICs9IGEKICAgICAgICB0aGlzLmxlbiAtPSBhCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodGhpcy5iYXNlIDw9IHRoaXMubGlzdC5zcSRsZW5ndGgoKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUuZ2V0aXRlbSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5saXN0LnZbYV0KICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUuc2V0aXRlbSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB0aGlzLmxpc3QudlthXSA9IGIKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUucG9wbGVmdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gdGhpcy5saXN0LnZbdGhpcy5iYXNlXQogICAgICAgIHRoaXMuYmFzZSsrCiAgICAgICAgdGhpcy5sZW4tLQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0U2xpY2UucHJvdG90eXBlLnBvcHJpZ2h0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5sZW4tLQogICAgICAgIHJldHVybiB0aGlzLmxpc3Qudlt0aGlzLmJhc2UgKyB0aGlzLmxlbl0KICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUucmV2ZXJzZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAoCiAgICAgICAgICB2YXIgYSwgYiwgYyA9IHRoaXMubGlzdCwgZCA9IHRoaXMuYmFzZSwgZSA9IGQgKyB0aGlzLmxlbiAtIDE7CiAgICAgICAgICBkIDwgZTsKCiAgICAgICAgKQogICAgICAgICAgKGEgPSBjLnZbZV0pLCAoYiA9IGMudltkXSksIChjLnZbZF0gPSBhKSwgKGMudltlXSA9IGIpLCBkKyssIGUtLQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5saXN0U2xpY2UiLCBTay5idWlsdGluLmxpc3RTbGljZSkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLnRpbVNvcnQiLCBTay5idWlsdGluLnRpbVNvcnQpCiAgICB9LAogICAgZnVuY3Rpb24obSwgcCkgewogICAgICBTay5idWlsdGluLnNvcnRlZCA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZQogICAgICAgIGlmICh2b2lkIDAgPT09IGQpIGQgPSAhMQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKGQgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkLCBnb3QgZmxvYXQiKQogICAgICAgICAgaWYgKAogICAgICAgICAgICBkIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICAgIGQucHJvdG90eXBlIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICApCiAgICAgICAgICAgIGQgPSBTay5taXNjZXZhbC5pc1RydWUoZCkKICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICB9CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYyB8fCBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lKQogICAgICAgICAgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSB8fCB2b2lkIDAgPT09IGIgfHwgKGUgPSBiKSwKICAgICAgICAgICAgKGEgPSBuZXcgU2suYnVpbHRpbi5saXN0KGEpKQogICAgICAgIGVsc2UgewogICAgICAgICAgZSA9CiAgICAgICAgICAgIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUgfHwgdm9pZCAwID09PSBiCiAgICAgICAgICAgICAgPyBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYVswXSwgYlswXSwgIkx0IikKICAgICAgICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmludF8oLTEpCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKDApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2FbMF0sIGNbMF1dKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgdmFyIGYgPSBhLnRwJGl0ZXIoKQogICAgICAgICAgdmFyIGcgPSBmLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgIGZvciAoYSA9IFtdOyB2b2lkIDAgIT09IGc7ICkKICAgICAgICAgICAgYS5wdXNoKFtTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYywgW2ddKSwgZ10pLCAoZyA9IGYudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5saXN0KGEpCiAgICAgICAgfQogICAgICAgIHZvaWQgMCAhPT0gZSA/IGEubGlzdF9zb3J0XyhhLCBlKSA6IGEubGlzdF9zb3J0XyhhKQogICAgICAgIGQgJiYgYS5saXN0X3JldmVyc2VfKGEpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYyAmJiAhKGMgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUpKSB7CiAgICAgICAgICBmID0gYS50cCRpdGVyKCkKICAgICAgICAgIGcgPSBmLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgIGZvciAoYSA9IFtdOyB2b2lkIDAgIT09IGc7ICkgYS5wdXNoKGdbMV0pLCAoZyA9IGYudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5saXN0KGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4udHlwZV9pc19zdWJ0eXBlX2Jhc2VfY2hhaW4gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKGEgPT0gYikgcmV0dXJuICEwCiAgICAgICAgICBhID0gYS50cCRiYXNlCiAgICAgICAgfSB3aGlsZSAodm9pZCAwICE9PSBhKQogICAgICAgIHJldHVybiBiID09IFNrLmJ1aWx0aW4ub2JqZWN0CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5QeVR5cGVfSXNTdWJ0eXBlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHZhciBjID0gYS50cCRtcm8KICAgICAgICBpZiAoYykgewogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGUpCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYy52Lmxlbmd0aDsgYSsrKSBpZiAoYy52W2FdID09IGIpIHJldHVybiAhMAogICAgICAgICAgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLnR5cGVfaXNfc3VidHlwZV9iYXNlX2NoYWluKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdXBlcl8gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigic3VwZXIiLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnN1cGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3VwZXJfKGEsIGIpCiAgICAgICAgU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KFNrLmJ1aWx0aW4uc3VwZXJfLl9faW5pdF9fLCBbdGhpcywgYSwgYl0pCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLnN1cGVyXy5fX2luaXRfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgIGEub2JqID0gYwogICAgICAgIGEudHlwZSA9IGIKICAgICAgICBpZiAoIWIudHAkbXJvKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAibXVzdCBiZSB0eXBlLCBub3QgIiArIGIub2IkdHlwZS50cCRuYW1lLAogICAgICAgICAgKQogICAgICAgIGEub2JqX3R5cGUgPSBiLnRwJG1yby52WzFdCiAgICAgICAgaWYgKCFjKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgInVuYm91bmQgc3VwZXIgbm90IHN1cHBvcnRlZCBiZWNhdXNlIHNrdWxwdHMgaW1wbGVtZW50YXRpb24gb2YgdHlwZSBkZXNjcmlwdG9ycyBhcmVuJ3QgYnJpbGxpYW50IHlldCwgc2VlIHRoaXMgcXVlc3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzMwMTkwMzQxLzExNzI0MiIsCiAgICAgICAgICApCiAgICAgICAgaWYgKCFTay5idWlsdGluLlB5VHlwZV9Jc1N1YnR5cGUoYS5vYmoub2IkdHlwZSwgYS50eXBlKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgInN1cGVyKHR5cGUsIG9iaik6IG9iaiBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIHN1YnR5cGUgb2YgdHlwZSIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9KQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJzdXBlciIsIFNrLmJ1aWx0aW4uc3VwZXJfLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi5zdXBlcl8ucHJvdG90eXBlLnRwJGdldGF0dHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIGMsCiAgICAgICAgICBkLAogICAgICAgICAgZSA9IGEuJGpzc3RyKCkKICAgICAgICB2YXIgZiA9IHRoaXMub2JqX3R5cGUKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGYsICJvYmplY3QgaGFzIG5vIG9iJHR5cGUhIikKICAgICAgICBpZiAoKGQgPSB0aGlzLm9iai4kZCB8fCB0aGlzLm9iai5jb25zdHJ1Y3Rvci4kZCkpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIChkLm1wJGxvb2t1cAogICAgICAgICAgICAgID8gKGMgPSBkLm1wJGxvb2t1cChhKSkKICAgICAgICAgICAgICA6IGQubXAkc3Vic2NyaXB0CiAgICAgICAgICAgICAgPyAoYyA9IFNrLmJ1aWx0aW4uX3RyeUdldFN1YnNjcmlwdChkLCBhKSkKICAgICAgICAgICAgICA6ICJvYmplY3QiID09PSB0eXBlb2YgZCAmJiAoYyA9IGRbZV0pLAogICAgICAgICAgICB2b2lkIDAgIT09IGMpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgYyA9IFNrLmJ1aWx0aW4udHlwZS50eXBlTG9va3VwKGYsIGEpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIChhID0gYy50cCRkZXNjcl9nZXQpKQogICAgICAgICAgcmV0dXJuIGEuY2FsbChjLCB0aGlzLm9iaiwgdGhpcy5vYmpfdHlwZSwgYikKICAgICAgICBpZiAodm9pZCAwICE9PSBjKSByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3VwZXJfLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmoKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICAgICAgICI8c3VwZXI6IDxjbGFzcyAnIiArCiAgICAgICAgICAgICAgICAodGhpcy50eXBlID8gdGhpcy50eXBlLnRwJG5hbWUgOiAiTlVMTCIpICsKICAgICAgICAgICAgICAgICInPiwgPCIgKwogICAgICAgICAgICAgICAgdGhpcy5vYmoudHAkbmFtZSArCiAgICAgICAgICAgICAgICAiIG9iamVjdD4+IiwKICAgICAgICAgICAgKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAgICAgIjxzdXBlcjogPGNsYXNzICciICsKICAgICAgICAgICAgICAgICh0aGlzLnR5cGUgPyB0aGlzLnR5cGUudHAkbmFtZSA6ICJOVUxMIikgKwogICAgICAgICAgICAgICAgIic+LCBOVUxMPiIsCiAgICAgICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLnN1cGVyXy5fX2RvY19fID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJzdXBlcih0eXBlLCBvYmopIC0+IGJvdW5kIHN1cGVyIG9iamVjdDsgcmVxdWlyZXMgaXNpbnN0YW5jZShvYmosIHR5cGUpXG5zdXBlcih0eXBlKSAtPiB1bmJvdW5kIHN1cGVyIG9iamVjdFxuc3VwZXIodHlwZSwgdHlwZTIpIC0+IGJvdW5kIHN1cGVyIG9iamVjdDsgcmVxdWlyZXMgaXNzdWJjbGFzcyh0eXBlMiwgdHlwZSlcblR5cGljYWwgdXNlIHRvIGNhbGwgYSBjb29wZXJhdGl2ZSBzdXBlcmNsYXNzIG1ldGhvZDpcbmNsYXNzIEMoQik6XG4gICAgZGVmIG1ldGgoc2VsZiwgYXJnKTpcbiAgICAgICAgc3VwZXIoQywgc2VsZikubWV0aChhcmcpIiwKICAgICAgKQogICAgfSwKICAgIGZ1bmN0aW9uKG0sIHApIHsKICAgICAgU2suYnVpbHRpbnMgPSB7CiAgICAgICAgcmFuZ2U6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5yYW5nZSksCiAgICAgICAgcm91bmQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5yb3VuZCksCiAgICAgICAgbGVuOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ubGVuKSwKICAgICAgICBtaW46IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5taW4pLAogICAgICAgIG1heDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLm1heCksCiAgICAgICAgc3VtOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uc3VtKSwKICAgICAgICBhYnM6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5hYnMpLAogICAgICAgIGZhYnM6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5mYWJzKSwKICAgICAgICBvcmQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5vcmQpLAogICAgICAgIGNocjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmNociksCiAgICAgICAgaGV4OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uaGV4KSwKICAgICAgICBvY3Q6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5vY3QpLAogICAgICAgIGJpbjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmJpbiksCiAgICAgICAgZGlyOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uZGlyKSwKICAgICAgICByZXByOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucmVwciksCiAgICAgICAgb3BlbjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLm9wZW4pLAogICAgICAgIGlzaW5zdGFuY2U6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5pc2luc3RhbmNlKSwKICAgICAgICBoYXNoOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uaGFzaCksCiAgICAgICAgZ2V0YXR0cjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmdldGF0dHIpLAogICAgICAgIGhhc2F0dHI6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5oYXNhdHRyKSwKICAgICAgICBpZDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmlkKSwKICAgICAgICByZWR1Y2U6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5yZWR1Y2UpLAogICAgICAgIHNvcnRlZDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnNvcnRlZCksCiAgICAgICAgYW55OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uYW55KSwKICAgICAgICBhbGw6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5hbGwpLAogICAgICAgIEF0dHJpYnV0ZUVycm9yOiBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yLAogICAgICAgIFZhbHVlRXJyb3I6IFNrLmJ1aWx0aW4uVmFsdWVFcnJvciwKICAgICAgICBFeGNlcHRpb246IFNrLmJ1aWx0aW4uRXhjZXB0aW9uLAogICAgICAgIFplcm9EaXZpc2lvbkVycm9yOiBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yLAogICAgICAgIEFzc2VydGlvbkVycm9yOiBTay5idWlsdGluLkFzc2VydGlvbkVycm9yLAogICAgICAgIEltcG9ydEVycm9yOiBTay5idWlsdGluLkltcG9ydEVycm9yLAogICAgICAgIEluZGVudGF0aW9uRXJyb3I6IFNrLmJ1aWx0aW4uSW5kZW50YXRpb25FcnJvciwKICAgICAgICBJbmRleEVycm9yOiBTay5idWlsdGluLkluZGV4RXJyb3IsCiAgICAgICAgS2V5RXJyb3I6IFNrLmJ1aWx0aW4uS2V5RXJyb3IsCiAgICAgICAgVHlwZUVycm9yOiBTay5idWlsdGluLlR5cGVFcnJvciwKICAgICAgICBOYW1lRXJyb3I6IFNrLmJ1aWx0aW4uTmFtZUVycm9yLAogICAgICAgIElPRXJyb3I6IFNrLmJ1aWx0aW4uSU9FcnJvciwKICAgICAgICBOb3RJbXBsZW1lbnRlZEVycm9yOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IsCiAgICAgICAgU3RhbmRhcmRFcnJvcjogU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICAgIFN5c3RlbUV4aXQ6IFNrLmJ1aWx0aW4uU3lzdGVtRXhpdCwKICAgICAgICBPdmVyZmxvd0Vycm9yOiBTay5idWlsdGluLk92ZXJmbG93RXJyb3IsCiAgICAgICAgT3BlcmF0aW9uRXJyb3I6IFNrLmJ1aWx0aW4uT3BlcmF0aW9uRXJyb3IsCiAgICAgICAgTmVnYXRpdmVQb3dlckVycm9yOiBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvciwKICAgICAgICBSdW50aW1lRXJyb3I6IFNrLmJ1aWx0aW4uUnVudGltZUVycm9yLAogICAgICAgIFN0b3BJdGVyYXRpb246IFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbiwKICAgICAgICBmbG9hdF8kcnckOiBTay5idWlsdGluLmZsb2F0XywKICAgICAgICBpbnRfJHJ3JDogU2suYnVpbHRpbi5pbnRfLAogICAgICAgIGJvb2w6IFNrLmJ1aWx0aW4uYm9vbCwKICAgICAgICBjb21wbGV4OiBTay5idWlsdGluLmNvbXBsZXgsCiAgICAgICAgZW51bWVyYXRlOiBTay5idWlsdGluLmVudW1lcmF0ZSwKICAgICAgICBkaWN0OiBTay5idWlsdGluLmRpY3QsCiAgICAgICAgZmlsZTogU2suYnVpbHRpbi5maWxlLAogICAgICAgIGZ1bmN0aW9uOiBTay5idWlsdGluLmZ1bmMsCiAgICAgICAgZ2VuZXJhdG9yOiBTay5idWlsdGluLmdlbmVyYXRvciwKICAgICAgICBsaXN0OiBTay5idWlsdGluLmxpc3QsCiAgICAgICAgbG9uZ18kcnckOiBTay5idWlsdGluLmxuZywKICAgICAgICBtZXRob2Q6IFNrLmJ1aWx0aW4ubWV0aG9kLAogICAgICAgIG9iamVjdDogU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICAgc2xpY2U6IFNrLmJ1aWx0aW4uc2xpY2UsCiAgICAgICAgc3RyOiBTay5idWlsdGluLnN0ciwKICAgICAgICBzZXQ6IFNrLmJ1aWx0aW4uc2V0LAogICAgICAgIHR1cGxlOiBTay5idWlsdGluLnR1cGxlLAogICAgICAgIHR5cGU6IFNrLmJ1aWx0aW4udHlwZSwKICAgICAgICBpbnB1dDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmlucHV0KSwKICAgICAgICByYXdfaW5wdXQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5yYXdfaW5wdXQpLAogICAgICAgIHNldGF0dHI6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5zZXRhdHRyKSwKICAgICAgICBqc2V2YWw6IFNrLmJ1aWx0aW4uanNldmFsLAogICAgICAgIGpzbWlsbGlzOiBTay5idWlsdGluLmpzbWlsbGlzLAogICAgICAgIHF1aXQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5xdWl0KSwKICAgICAgICBleGl0OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucXVpdCksCiAgICAgICAgcHJpbnQ6IFNrLmJ1aWx0aW4ucHJpbnQsCiAgICAgICAgZGl2bW9kOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uZGl2bW9kKSwKICAgICAgICBmb3JtYXQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5mb3JtYXQpLAogICAgICAgIGdsb2JhbHM6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5nbG9iYWxzKSwKICAgICAgICBpc3N1YmNsYXNzOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uaXNzdWJjbGFzcyksCiAgICAgICAgaXRlcjogU2suYnVpbHRpbi5pdGVyLAogICAgICAgIGJ5dGVhcnJheTogU2suYnVpbHRpbi5ieXRlYXJyYXksCiAgICAgICAgY2FsbGFibGU6IFNrLmJ1aWx0aW4uY2FsbGFibGUsCiAgICAgICAgZGVsYXR0cjogU2suYnVpbHRpbi5kZWxhdHRyLAogICAgICAgIGV2YWxfJHJuJDogU2suYnVpbHRpbi5ldmFsXywKICAgICAgICBleGVjZmlsZTogU2suYnVpbHRpbi5leGVjZmlsZSwKICAgICAgICBmcm96ZW5zZXQ6IFNrLmJ1aWx0aW4uZnJvemVuc2V0LAogICAgICAgIGhlbHA6IFNrLmJ1aWx0aW4uaGVscCwKICAgICAgICBsb2NhbHM6IFNrLmJ1aWx0aW4ubG9jYWxzLAogICAgICAgIG1lbW9yeXZpZXc6IFNrLmJ1aWx0aW4ubWVtb3J5dmlldywKICAgICAgICBuZXh0OiBTay5idWlsdGluLm5leHRfLAogICAgICAgIHBvdzogU2suYnVpbHRpbi5wb3csCiAgICAgICAgcmVsb2FkOiBTay5idWlsdGluLnJlbG9hZCwKICAgICAgICByZXZlcnNlZDogU2suYnVpbHRpbi5yZXZlcnNlZCwKICAgICAgICBzdXBlcjogU2suYnVpbHRpbi5zdXBlcl8sCiAgICAgICAgdW5pY2hyOiBTay5idWlsdGluLnVuaWNociwKICAgICAgICB2YXJzOiBTay5idWlsdGluLnZhcnMsCiAgICAgICAgeHJhbmdlOiBTay5idWlsdGluLnhyYW5nZSwKICAgICAgICBhcHBseV8kcm4kOiBTay5idWlsdGluLmFwcGx5XywKICAgICAgICBidWZmZXI6IFNrLmJ1aWx0aW4uYnVmZmVyLAogICAgICAgIGNvZXJjZTogU2suYnVpbHRpbi5jb2VyY2UsCiAgICAgICAgaW50ZXJuOiBTay5idWlsdGluLmludGVybiwKICAgICAgfQogICAgICBTay5zZXR1cE9iamVjdHMgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgYQogICAgICAgICAgPyAoKFNrLmJ1aWx0aW5zLmZpbHRlciA9IFNrLmJ1aWx0aW4uZmlsdGVyXyksCiAgICAgICAgICAgIChTay5idWlsdGlucy5tYXAgPSBTay5idWlsdGluLm1hcF8pLAogICAgICAgICAgICAoU2suYnVpbHRpbnMuemlwID0gU2suYnVpbHRpbi56aXBfKSwKICAgICAgICAgICAgKFNrLmJ1aWx0aW5zLnJhbmdlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnhyYW5nZSkpLAogICAgICAgICAgICBkZWxldGUgU2suYnVpbHRpbnMueHJhbmdlLAogICAgICAgICAgICBkZWxldGUgU2suYnVpbHRpbnMuU3RhbmRhcmRFcnJvcikKICAgICAgICAgIDogKChTay5idWlsdGlucy5maWx0ZXIgPSBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uZmlsdGVyKSksCiAgICAgICAgICAgIChTay5idWlsdGlucy5tYXAgPSBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ubWFwKSksCiAgICAgICAgICAgIChTay5idWlsdGlucy56aXAgPSBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uemlwKSksCiAgICAgICAgICAgIChTay5idWlsdGlucy5yYW5nZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5yYW5nZSkpLAogICAgICAgICAgICAoU2suYnVpbHRpbnMueHJhbmdlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnhyYW5nZSkpLAogICAgICAgICAgICAoU2suYnVpbHRpbnMuU3RhbmRhcmRFcnJvciA9IFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvcikpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5zZXR1cE9iamVjdHMiLCBTay5zZXR1cE9iamVjdHMpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbnMiLCBTay5idWlsdGlucykKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0ciA9IG5ldyBTay5idWlsdGluLnN0cigiIikKICAgICAgU2suYnVpbHRpbi5ib29sLnRydWUkID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLmJvb2wucHJvdG90eXBlLCB7CiAgICAgICAgdjogeyB2YWx1ZTogMSwgZW51bWVyYWJsZTogITAgfSwKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5ib29sLmZhbHNlJCA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5ib29sLnByb3RvdHlwZSwgewogICAgICAgIHY6IHsgdmFsdWU6IDAsIGVudW1lcmFibGU6ICEwIH0sCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5jb192YXJuYW1lcyA9IFsibnVtYmVyIiwgImJhc2UiXQogICAgICBTay5idWlsdGluLmludF8uJGRlZmF1bHRzID0gWzAsIFNrLmJ1aWx0aW4ubm9uZS5ub25lJF0KICAgICAgU2suYnVpbHRpbi5sbmcuY29fdmFybmFtZXMgPSBbIm51bWJlciIsICJiYXNlIl0KICAgICAgU2suYnVpbHRpbi5sbmcuJGRlZmF1bHRzID0gWzAsIFNrLmJ1aWx0aW4ubm9uZS5ub25lJF0KICAgICAgU2suYnVpbHRpbi5zb3J0ZWQuY29fdmFybmFtZXMgPSBbImxpc3QiLCAiY21wIiwgImtleSIsICJyZXZlcnNlIl0KICAgICAgU2suYnVpbHRpbi5zb3J0ZWQuJGRlZmF1bHRzID0gWwogICAgICAgIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgU2suYnVpbHRpbi5ib29sLmZhbHNlJCwKICAgICAgXQogICAgICBTay5idWlsdGluLmRpY3QuJGZyb21rZXlzLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoImZyb21rZXlzIikKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5mcm9ta2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5kaWN0LiRmcm9ta2V5cywKICAgICAgKQogICAgICBTay5idWlsdGluLnN0ci4kZW1wdHkgPSBuZXcgU2suYnVpbHRpbi5zdHIoIiIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRkZWZhdWx0X2ZhY3RvcnkgPSBuZXcgU2suYnVpbHRpbi5zdHIoImRlZmF1bHRfZmFjdG9yeSIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbWFnID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJpbWFnIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHJlYWwgPSBuZXcgU2suYnVpbHRpbi5zdHIoInJlYWwiKQogICAgICBTay5idWlsdGluLnN0ci4kYWJzID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2Fic19fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGNhbGwgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fY2FsbF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGNtcCA9IG5ldyBTay5idWlsdGluLnN0cigiX19jbXBfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRjb21wbGV4ID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2NvbXBsZXhfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRjb250YWlucyA9IG5ldyBTay5idWlsdGluLnN0cigiX19jb250YWluc19fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGNvcHkgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fY29weV9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGRpY3QgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fZGljdF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGRpciA9IG5ldyBTay5idWlsdGluLnN0cigiX19kaXJfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbnRlciA9IG5ldyBTay5idWlsdGluLnN0cigiX19lbnRlcl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGVxID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2VxX18iKQogICAgICBTay5idWlsdGluLnN0ci4kZXhpdCA9IG5ldyBTay5idWlsdGluLnN0cigiX19leGl0X18iKQogICAgICBTay5idWlsdGluLnN0ci4kaW5kZXggPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9faW5kZXhfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbml0ID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2luaXRfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbnRfID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2ludF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGl0ZXIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9faXRlcl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGZsb2F0XyA9IG5ldyBTay5idWlsdGluLnN0cigiX19mbG9hdF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGZvcm1hdCA9IG5ldyBTay5idWlsdGluLnN0cigiX19mb3JtYXRfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRnZSA9IG5ldyBTay5idWlsdGluLnN0cigiX19nZV9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGdldGF0dHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fZ2V0YXR0cl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGdldGF0dHJpYnV0ZSA9IG5ldyBTay5idWlsdGluLnN0cigiX19nZXRhdHRyaWJ1dGVfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2dldGl0ZW1fXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRndCA9IG5ldyBTay5idWlsdGluLnN0cigiX19ndF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGxlID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2xlX18iKQogICAgICBTay5idWlsdGluLnN0ci4kbGVuID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2xlbl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGx0ID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2x0X18iKQogICAgICBTay5idWlsdGluLnN0ci4kbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigiX19uYW1lX18iKQogICAgICBTay5idWlsdGluLnN0ci4kbmUgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbmVfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRuZXcgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbmV3X18iKQogICAgICBTay5idWlsdGluLnN0ci4kbmV4dDIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIm5leHQiKQogICAgICBTay5idWlsdGluLnN0ci4kbmV4dDMgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbmV4dF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHBhdGggPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fcGF0aF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHJlcHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fcmVwcl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHJldmVyc2VkID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX3JldmVyc2VkX18iKQogICAgICBTay5idWlsdGluLnN0ci4kcm91bmQgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fcm91bmRfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzZXRhdHRyID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX3NldGF0dHJfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzZXRpdGVtID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX3NldGl0ZW1fXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzdHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fc3RyX18iKQogICAgICBTay5idWlsdGluLnN0ci4kdHJ1bmMgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fdHJ1bmNfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiR3cml0ZSA9IG5ldyBTay5idWlsdGluLnN0cigid3JpdGUiKQogICAgICBTay5taXNjZXZhbC5vcDJtZXRob2RfID0gewogICAgICAgIEVxOiBTay5idWlsdGluLnN0ci4kZXEsCiAgICAgICAgTm90RXE6IFNrLmJ1aWx0aW4uc3RyLiRuZSwKICAgICAgICBHdDogU2suYnVpbHRpbi5zdHIuJGd0LAogICAgICAgIEd0RTogU2suYnVpbHRpbi5zdHIuJGdlLAogICAgICAgIEx0OiBTay5idWlsdGluLnN0ci4kbHQsCiAgICAgICAgTHRFOiBTay5idWlsdGluLnN0ci4kbGUsCiAgICAgIH0KICAgICAgbSA9ICJpbnRfIGxuZyBzb3J0ZWQgcmFuZ2Ugcm91bmQgbGVuIG1pbiBtYXggc3VtIHppcCBhYnMgZmFicyBvcmQgY2hyIGhleCBvY3QgYmluIGRpciByZXByIG9wZW4gaXNpbnN0YW5jZSBoYXNoIGdldGF0dHIgaGFzYXR0ciBpZCBtYXAgZmlsdGVyIHJlZHVjZSBzb3J0ZWQgYW55IGFsbCBpbnB1dCByYXdfaW5wdXQgc2V0YXR0ciBxdWl0IHF1aXQgZGl2bW9kIGZvcm1hdCBnbG9iYWxzIGlzc3ViY2xhc3MiLnNwbGl0KAogICAgICAgICIgIiwKICAgICAgKQogICAgICBmb3IgKHAgPSAwOyBwIDwgbS5sZW5ndGg7IHArKykKICAgICAgICBTay5idWlsdGluW21bcF1dLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIobVtwXSkKICAgIH0sCiAgICBmdW5jdGlvbihtLCBwKSB7CiAgICAgIFNrLmludGVybmFsUHkgPSB7CiAgICAgICAgZmlsZXM6IHsKICAgICAgICAgICJzcmMvY2xhc3NtZXRob2QucHkiOgogICAgICAgICAgICAnY2xhc3MgY2xhc3NtZXRob2Qob2JqZWN0KTpcbiAgICAiRW11bGF0ZSBQeUNsYXNzTWV0aG9kX1R5cGUoKSBpbiBPYmplY3RzL2Z1bmNvYmplY3QuYyJcblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmKTpcbiAgICAgICAgc2VsZi5mID0gZlxuXG4gICAgZGVmIF9fZ2V0X18oc2VsZiwgb2JqLCBrbGFzcz1Ob25lKTpcbiAgICAgICAgaWYga2xhc3MgaXMgTm9uZTpcbiAgICAgICAgICAgIGtsYXNzID0gdHlwZShvYmopXG4gICAgICAgIGRlZiBuZXdmdW5jKCphcmdzKTpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmYoa2xhc3MsICphcmdzKVxuICAgICAgICByZXR1cm4gbmV3ZnVuY1xuJywKICAgICAgICAgICJzcmMvcHJvcGVydHkucHkiOgogICAgICAgICAgICAnY2xhc3MgcHJvcGVydHkob2JqZWN0KTpcbiAgICAiRW11bGF0ZSBQeVByb3BlcnR5X1R5cGUoKSBpbiBPYmplY3RzL2Rlc2Nyb2JqZWN0LmMiXG5cbiAgICBkZWYgX19pbml0X18oc2VsZiwgZmdldD1Ob25lLCBmc2V0PU5vbmUsIGZkZWw9Tm9uZSwgZG9jPU5vbmUpOlxuICAgICAgICBzZWxmLmZnZXQgPSBmZ2V0XG4gICAgICAgIHNlbGYuZnNldCA9IGZzZXRcbiAgICAgICAgc2VsZi5mZGVsID0gZmRlbFxuICAgICAgICBpZiBkb2MgaXMgTm9uZSBhbmQgZmdldCBpcyBub3QgTm9uZTpcbiAgICAgICAgICAgIGlmIGhhc2F0dHIoZmdldCwgXCdfX2RvY19fXCcpOlxuICAgICAgICAgICAgICAgIGRvYyA9IGZnZXQuX19kb2NfX1xuICAgICAgICAgICAgZWxzZTpcbiAgICAgICAgICAgICAgICBkb2MgPSBOb25lXG4gICAgICAgIHNlbGYuX19kb2NfXyA9IGRvY1xuXG4gICAgZGVmIF9fZ2V0X18oc2VsZiwgb2JqLCBvYmp0eXBlPU5vbmUpOlxuICAgICAgICBpZiBvYmogaXMgTm9uZTpcbiAgICAgICAgICAgIHJldHVybiBzZWxmXG4gICAgICAgIGlmIHNlbGYuZmdldCBpcyBOb25lOlxuICAgICAgICAgICAgcmFpc2UgQXR0cmlidXRlRXJyb3IoInVucmVhZGFibGUgYXR0cmlidXRlIilcbiAgICAgICAgcmV0dXJuIHNlbGYuZmdldChvYmopXG5cbiAgICBkZWYgX19zZXRfXyhzZWxmLCBvYmosIHZhbHVlKTpcbiAgICAgICAgaWYgc2VsZi5mc2V0IGlzIE5vbmU6XG4gICAgICAgICAgICByYWlzZSBBdHRyaWJ1dGVFcnJvcigiY2FuXCd0IHNldCBhdHRyaWJ1dGUiKVxuICAgICAgICBzZWxmLmZzZXQob2JqLCB2YWx1ZSlcblxuICAgIGRlZiBfX2RlbGV0ZV9fKHNlbGYsIG9iaik6XG4gICAgICAgIGlmIHNlbGYuZmRlbCBpcyBOb25lOlxuICAgICAgICAgICAgcmFpc2UgQXR0cmlidXRlRXJyb3IoImNhblwndCBkZWxldGUgYXR0cmlidXRlIilcbiAgICAgICAgc2VsZi5mZGVsKG9iailcblxuICAgIGRlZiBnZXR0ZXIoc2VsZiwgZmdldCk6XG4gICAgICAgIHJldHVybiB0eXBlKHNlbGYpKGZnZXQsIHNlbGYuZnNldCwgc2VsZi5mZGVsLCBzZWxmLl9fZG9jX18pXG5cbiAgICBkZWYgc2V0dGVyKHNlbGYsIGZzZXQpOlxuICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmZnZXQsIGZzZXQsIHNlbGYuZmRlbCwgc2VsZi5fX2RvY19fKVxuXG4gICAgZGVmIGRlbGV0ZXIoc2VsZiwgZmRlbCk6XG4gICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZmdldCwgc2VsZi5mc2V0LCBmZGVsLCBzZWxmLl9fZG9jX18pXG4nLAogICAgICAgICAgInNyYy9zdGF0aWNtZXRob2QucHkiOgogICAgICAgICAgICAnY2xhc3Mgc3RhdGljbWV0aG9kKG9iamVjdCk6XG4gICAgIkVtdWxhdGUgUHlTdGF0aWNNZXRob2RfVHlwZSgpIGluIE9iamVjdHMvZnVuY29iamVjdC5jIlxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGYpOlxuICAgICAgICBzZWxmLmYgPSBmXG5cbiAgICBkZWYgX19nZXRfXyhzZWxmLCBvYmosIG9ianR5cGU9Tm9uZSk6XG4gICAgICAgIHJldHVybiBzZWxmLmZcbicsCiAgICAgICAgfSwKICAgICAgfQogICAgfSwKICBdKQp9LmNhbGwodGhpcyB8fCB3aW5kb3cpKQoKLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2t1bHB0Lm1pbi5qcy5tYXAK"
